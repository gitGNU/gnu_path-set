#
# # meta command:
# $ path-set-test \
# --input=tests/files2.txt \
# --expr='10 ** x' \
# --limits=1-6 \
# --pool-size=512M \
# --hash-size=2M \
# --node-size=4M \
# --separators='/' \
# --repeat=10 \
# --sleep=100 \
# --plain-set \
# --ternary-tree \
# --run-tests
#

$ date +'%Y-%m-%d %H:%M:%S.%N %z'
2016-10-14 00:52:11.283852387 +0300
$

$ ./path-set -C
CONFIG_PATH_TRIE_NODE_32BIT_OFFSETS: no
CONFIG_PATH_TRIE_ELEM_32BIT_OFFSETS: no
CONFIG_PATH_TRIE_UINT_HASH_IDENTOP:  no
CONFIG_TRIE_PATH_SET_PRINT_SET:      no
CONFIG_VALUE_TYPE_SIZE:              64
32BIT:                               no
DEBUG:                               yes
OPT:                                 -
$

$ ./path-set --plain-set --ternary-tree -I
node-struct-size: 32
$

$ ./path-set --plain-set --ternary-tree -N
dups-line
uniq-line
line-mem
dups-node
uniq-node
node-insert-eq
node-insert-lt
node-insert-gt
node-struct-size
node-struct
node-mem
total-node-mem
total-mem
insert-time
$

$ PATH_SET_TEST_INPUT=tests/files2.txt
$ PATH_SET_TEST_POOL_SIZE=512M
$ PATH_SET_TEST_HASH_SIZE=2M
$ PATH_SET_TEST_NODE_SIZE=4M
$ PATH_SET_TEST_STRUCT_TYPE=plain-set
$ PATH_SET_TEST_SET_TYPE=ternary-tree
$ PATH_SET_TEST_SEPARATORS='/'
$

$ time path-set-test -t 10
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10           10           10.00           0.00              0.00           
line-mem          517          682          577.70          3114.61           55.81          
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10           10           10.00           0.00              0.00           
node-insert-eq    81           127          103.10          208.89            14.45          
node-insert-lt    6            12           8.20            3.16              1.78           
node-insert-gt    3            11           7.90            5.29              2.30           
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       425          582          484.60          2287.04           47.82          
node-mem          13600        18624        15507.20        2341928.96        1530.34        
total-node-mem    13600        18624        15507.20        2341928.96        1530.34        
total-mem         13656        18680        15563.20        2341928.96        1530.34        
real-insert-time  28           42           37.00           15.40             3.92           
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m1.294s
user	0m0.808s
sys	0m0.224s
$

$ time path-set-test -t 100
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100          100          100.00          0.00              0.00           
line-mem          5462         6034         5724.60         35147.24          187.48         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100          100          100.00          0.00              0.00           
node-insert-eq    1726         2034         1883.90         11282.29          106.22         
node-insert-lt    144          276          205.50          1375.45           37.09          
node-insert-gt    109          241          155.00          1388.00           37.26          
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       3677         4109         3940.70         13557.21          116.44         
node-mem          117664       131488       126102.40       13882583.04       3725.93        
total-node-mem    117664       131488       126102.40       13882583.04       3725.93        
total-mem         117720       131544       126158.40       13882583.04       3725.93        
real-insert-time  227          292          252.00          611.80            24.73          
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m1.321s
user	0m0.828s
sys	0m0.224s
$

$ time path-set-test -t 1000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         1000         1000         1000.00         0.00              0.00           
line-mem          57538        58185        57889.50        50536.45          224.80         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         1000         1000         1000.00         0.00              0.00           
node-insert-eq    27861        29057        28566.10        154120.29         392.58         
node-insert-lt    2339         3562         2862.70         194351.81         440.85         
node-insert-gt    2322         3552         2964.70         179810.81         424.04         
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       29743        30967        30323.40        134706.84         367.02         
node-mem          951776       990944       970348.80       137939804.16      11744.78       
total-node-mem    951776       990944       970348.80       137939804.16      11744.78       
total-mem         951832       991000       970404.80       137939804.16      11744.78       
real-insert-time  2153         3999         3386.40         271093.44         520.67         
user-insert-time  0            4000         1600.00         3840000.00        1959.59        
sys-insert-time   0            4000         1200.00         3360000.00        1833.03        

real	0m1.372s
user	0m0.880s
sys	0m0.232s
$

$ time path-set-test -t 10000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10000        10000        10000.00        0.00              0.00           
line-mem          576375       582445       579538.10       2973209.49        1724.30        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10000        10000        10000.00        0.00              0.00           
node-insert-eq    369791       373867       371776.50       1448821.85        1203.67        
node-insert-lt    33410        44948        39426.70        9414534.81        3068.31        
node-insert-gt    34165        40321        36785.80        6495808.56        2548.69        
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       215338       220107       217761.60       1798873.84        1341.22        
node-mem          6890816      7043424      6968371.20      1842046812.16     42919.07       
total-node-mem    6890816      7043424      6968371.20      1842046812.16     42919.07       
total-mem         6890872      7043480      6968427.20      1842046812.16     42919.07       
real-insert-time  16509        22837        18930.50        2948816.05        1717.21        
user-insert-time  4000         24001        13200.60        28964160.24       5381.84        
sys-insert-time   0            12000        6000.00         16800000.00       4098.78        

real	0m1.535s
user	0m1.040s
sys	0m0.276s
$

$ time path-set-test -t 100000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100000       100000       100000.00       0.00              0.00           
line-mem          5781948      5797559      5788765.90      29200998.69       5403.79        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100000       100000       100000.00       0.00              0.00           
node-insert-eq    4366099      4380167      4372707.50      27666151.25       5259.86        
node-insert-lt    462524       569826       505026.50       1759013918.05     41940.60       
node-insert-gt    464496       558461       502095.50       1003879619.65     31684.06       
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       1513564      1519289      1516058.40      2690094.64        1640.15        
node-mem          48434048     48617248     48513868.80     2754656912.00     52484.83       
total-node-mem    48434048     48617248     48513868.80     2754656912.00     52484.83       
total-mem         48434104     48617304     48513924.80     2754656911.50     52484.83       
real-insert-time  170969       198858       177989.20       70007295.96       8367.04        
user-insert-time  112008       156009       137208.40       288171041.84      16975.60       
sys-insert-time   20001        72005        44402.70        263874641.41      16244.22       

real	0m3.546s
user	0m2.792s
sys	0m0.848s
$

$ time path-set-test -t 1000000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         830206       830206       830206.00       0.00              0.00           
line-mem          48049857     48049857     48049857.00     -0.50             0.71           
dups-node         0            0            0.00            0.00              0.00           
uniq-node         830206       830206       830206.00       0.00              0.00           
node-insert-eq    39958859     39958859     39958859.00     -0.25             0.50           
node-insert-lt    4575656      5396224      4800540.60      64960231639.45    254872.97      
node-insert-gt    4686911      5581195      5204431.20      84980046114.96    291513.37      
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       8921204      8921204      8921204.00      0.00              0.00           
node-mem          285478528    285478528    285478528.00    0.00              0.00           
total-node-mem    285478528    285478528    285478528.00    0.00              0.00           
total-mem         285478584    285478584    285478584.00    -16.00            4.00           
real-insert-time  1447328      1502906      1474279.00      275858583.20      16608.99       
user-insert-time  1116069      1288079      1187272.20      2534137142.16     50340.21       
sys-insert-time   264018       356022       297218.30       726677688.01      26956.96       

real	0m19.830s
user	0m17.689s
sys	0m4.576s
$

$ path-set-test -p dups-line -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-line -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p line-mem -R ...
files       min          max          avg             var               dev
10          517          682          577.70          3114.61           55.81
100         5462         6034         5724.60         35147.24          187.48
1000        57538        58185        57889.50        50536.45          224.80
10000       576375       582445       579538.10       2973209.49        1724.30
100000      5781948      5797559      5788765.90      29200998.69       5403.79
1000000     48049857     48049857     48049857.00     -0.50             0.71
$

$ path-set-test -p dups-node -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-node -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p node-insert-eq -R ...
files       min          max          avg             var               dev
10          81           127          103.10          208.89            14.45
100         1726         2034         1883.90         11282.29          106.22
1000        27861        29057        28566.10        154120.29         392.58
10000       369791       373867       371776.50       1448821.85        1203.67
100000      4366099      4380167      4372707.50      27666151.25       5259.86
1000000     39958859     39958859     39958859.00     -0.25             0.50
$

$ path-set-test -p node-insert-lt -R ...
files       min          max          avg             var               dev
10          6            12           8.20            3.16              1.78
100         144          276          205.50          1375.45           37.09
1000        2339         3562         2862.70         194351.81         440.85
10000       33410        44948        39426.70        9414534.81        3068.31
100000      462524       569826       505026.50       1759013918.05     41940.60
1000000     4575656      5396224      4800540.60      64960231639.45    254872.97
$

$ path-set-test -p node-insert-gt -R ...
files       min          max          avg             var               dev
10          3            11           7.90            5.29              2.30
100         109          241          155.00          1388.00           37.26
1000        2322         3552         2964.70         179810.81         424.04
10000       34165        40321        36785.80        6495808.56        2548.69
100000      464496       558461       502095.50       1003879619.65     31684.06
1000000     4686911      5581195      5204431.20      84980046114.96    291513.37
$

$ path-set-test -p node-struct-size -R ...
files       min          max          avg             var               dev
10          32           32           32.00           0.00              0.00
100         32           32           32.00           0.00              0.00
1000        32           32           32.00           0.00              0.00
10000       32           32           32.00           0.00              0.00
100000      32           32           32.00           0.00              0.00
1000000     32           32           32.00           0.00              0.00
$

$ path-set-test -p node-struct -R ...
files       min          max          avg             var               dev
10          425          582          484.60          2287.04           47.82
100         3677         4109         3940.70         13557.21          116.44
1000        29743        30967        30323.40        134706.84         367.02
10000       215338       220107       217761.60       1798873.84        1341.22
100000      1513564      1519289      1516058.40      2690094.64        1640.15
1000000     8921204      8921204      8921204.00      0.00              0.00
$

$ path-set-test -p node-mem -R ...
files       min          max          avg             var               dev
10          13600        18624        15507.20        2341928.96        1530.34
100         117664       131488       126102.40       13882583.04       3725.93
1000        951776       990944       970348.80       137939804.16      11744.78
10000       6890816      7043424      6968371.20      1842046812.16     42919.07
100000      48434048     48617248     48513868.80     2754656912.00     52484.83
1000000     285478528    285478528    285478528.00    0.00              0.00
$

$ path-set-test -p total-node-mem -R ...
files       min          max          avg             var               dev
10          13600        18624        15507.20        2341928.96        1530.34
100         117664       131488       126102.40       13882583.04       3725.93
1000        951776       990944       970348.80       137939804.16      11744.78
10000       6890816      7043424      6968371.20      1842046812.16     42919.07
100000      48434048     48617248     48513868.80     2754656912.00     52484.83
1000000     285478528    285478528    285478528.00    0.00              0.00
$

$ path-set-test -p total-mem -R ...
files       min          max          avg             var               dev
10          13656        18680        15563.20        2341928.96        1530.34
100         117720       131544       126158.40       13882583.04       3725.93
1000        951832       991000       970404.80       137939804.16      11744.78
10000       6890872      7043480      6968427.20      1842046812.16     42919.07
100000      48434104     48617304     48513924.80     2754656911.50     52484.83
1000000     285478584    285478584    285478584.00    -16.00            4.00
$

$ path-set-test -p real-insert-time -R ...
files       min          max          avg             var               dev
10          28           42           37.00           15.40             3.92
100         227          292          252.00          611.80            24.73
1000        2153         3999         3386.40         271093.44         520.67
10000       16509        22837        18930.50        2948816.05        1717.21
100000      170969       198858       177989.20       70007295.96       8367.04
1000000     1447328      1502906      1474279.00      275858583.20      16608.99
$

$ path-set-test -p user-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         1600.00         3840000.00        1959.59
10000       4000         24001        13200.60        28964160.24       5381.84
100000      112008       156009       137208.40       288171041.84      16975.60
1000000     1116069      1288079      1187272.20      2534137142.16     50340.21
$

$ path-set-test -p sys-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         1200.00         3360000.00        1833.03
10000       0            12000        6000.00         16800000.00       4098.78
100000      20001        72005        44402.70        263874641.41      16244.22
1000000     264018       356022       297218.30       726677688.01      26956.96
$

$ path-set-test -p dups-line -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-line -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p line-mem -A ...
min: 577
max: 48049857
avg: 9080391.67
var: 307986121592021.25
dev: 17549533.37
$

$ path-set-test -p dups-node -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-node -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p node-insert-eq -A ...
min: 103
max: 39958859
avg: 7455649.00
var: 213741633998225.66
dev: 14619905.40
$

$ path-set-test -p node-insert-lt -A ...
min: 8
max: 4800540
avg: 891344.50
var: 3089138014800.58
dev: 1757594.38
$

$ path-set-test -p node-insert-gt -A ...
min: 7
max: 5204431
avg: 957739.50
var: 3639328944869.92
dev: 1907702.53
$

$ path-set-test -p node-struct-size -A ...
min: 32
max: 32
avg: 32.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct -A ...
min: 484
max: 8921204
avg: 1781628.33
var: 10481578442578.22
dev: 3237526.59
$

$ path-set-test -p node-mem -A ...
min: 15507
max: 285478528
avg: 57012120.67
var: 10733134971953506.00
dev: 103600844.46
$

$ path-set-test -p total-node-mem -A ...
min: 15507
max: 285478528
avg: 57012120.67
var: 10733134971953506.00
dev: 103600844.46
$

$ path-set-test -p total-mem -A ...
min: 15563
max: 285478584
avg: 57012176.67
var: 10733134971953508.00
dev: 103600844.46
$

$ path-set-test -p real-insert-time -A ...
min: 37
max: 1474279
avg: 279145.50
var: 289669211284.92
dev: 538209.26
$

$ path-set-test -p user-insert-time -A ...
min: 0
max: 1187272
avg: 223213.33
var: 188278747363.56
dev: 433910.99
$

$ path-set-test -p sys-insert-time -A ...
min: 0
max: 297218
avg: 58136.67
var: 11678047510.22
dev: 108065.02
$

