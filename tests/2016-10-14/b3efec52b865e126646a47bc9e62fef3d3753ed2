#
# # meta command:
# $ path-set-test \
# --input=tests/files2.txt \
# --expr='10 ** x' \
# --limits=1-6 \
# --pool-size=512M \
# --hash-size=2M \
# --node-size=4M \
# --separators='/.-' \
# --repeat=10 \
# --sleep=100 \
# --plain-set \
# --ternary-tree \
# --run-tests
#

$ date +'%Y-%m-%d %H:%M:%S.%N %z'
2016-10-14 01:05:03.930687461 +0300
$

$ ./path-set -C
CONFIG_PATH_TRIE_NODE_32BIT_OFFSETS: yes
CONFIG_PATH_TRIE_ELEM_32BIT_OFFSETS: yes
CONFIG_PATH_TRIE_UINT_HASH_IDENTOP:  no
CONFIG_TRIE_PATH_SET_PRINT_SET:      no
CONFIG_VALUE_TYPE_SIZE:              64
32BIT:                               no
DEBUG:                               yes
OPT:                                 -
$

$ ./path-set --plain-set --ternary-tree -I
node-struct-size: 32
$

$ ./path-set --plain-set --ternary-tree -N
dups-line
uniq-line
line-mem
dups-node
uniq-node
node-insert-eq
node-insert-lt
node-insert-gt
node-struct-size
node-struct
node-mem
total-node-mem
total-mem
insert-time
$

$ PATH_SET_TEST_INPUT=tests/files2.txt
$ PATH_SET_TEST_POOL_SIZE=512M
$ PATH_SET_TEST_HASH_SIZE=2M
$ PATH_SET_TEST_NODE_SIZE=4M
$ PATH_SET_TEST_STRUCT_TYPE=plain-set
$ PATH_SET_TEST_SET_TYPE=ternary-tree
$ PATH_SET_TEST_SEPARATORS='/.-'
$

$ time path-set-test -t 10
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10           10           10.00           0.00              0.00           
line-mem          432          727          601.70          6607.61           81.29          
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10           10           10.00           0.00              0.00           
node-insert-eq    66           107          84.70           152.21            12.34          
node-insert-lt    3            12           9.10            6.69              2.59           
node-insert-gt    4            19           8.70            23.81             4.88           
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       368          630          527.00          5833.40           76.38          
node-mem          11776        20160        16864.00        5973401.60        2444.05        
total-node-mem    11776        20160        16864.00        5973401.60        2444.05        
total-mem         11832        20216        16920.00        5973401.60        2444.05        
real-insert-time  29           45           39.90           23.29             4.83           
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m1.336s
user	0m0.884s
sys	0m0.220s
$

$ time path-set-test -t 100
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100          100          100.00          0.00              0.00           
line-mem          5441         6111         5755.80         35470.76          188.34         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100          100          100.00          0.00              0.00           
node-insert-eq    1761         2132         1933.30         11368.21          106.62         
node-insert-lt    130          286          187.20          2137.16           46.23          
node-insert-gt    112          275          170.40          1987.44           44.58          
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       3514         4081         3922.50         25884.65          160.89         
node-mem          112448       130592       125520.00       26505881.60       5148.39        
total-node-mem    112448       130592       125520.00       26505881.60       5148.39        
total-mem         112504       130648       125576.00       26505881.60       5148.39        
real-insert-time  220          370          268.80          1848.36           42.99          
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m1.332s
user	0m0.876s
sys	0m0.216s
$

$ time path-set-test -t 1000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         1000         1000         1000.00         0.00              0.00           
line-mem          57327        58120        57739.40        73267.44          270.68         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         1000         1000         1000.00         0.00              0.00           
node-insert-eq    28469        29391        28870.80        94955.16          308.15         
node-insert-lt    2382         3623         2788.20         92233.36          303.70         
node-insert-gt    2331         3532         2946.30         203737.61         451.37         
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       29357        30430        29868.60        68329.64          261.40         
node-mem          939424       973760       955795.20       69969551.36       8364.78        
total-node-mem    939424       973760       955795.20       69969551.36       8364.78        
total-mem         939480       973816       955851.20       69969551.36       8364.78        
real-insert-time  1847         3955         3509.50         338558.85         581.86         
user-insert-time  0            4000         1600.00         3840000.00        1959.59        
sys-insert-time   0            4000         800.00          2560000.00        1600.00        

real	0m1.339s
user	0m0.828s
sys	0m0.236s
$

$ time path-set-test -t 10000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10000        10000        10000.00        0.00              0.00           
line-mem          575782       581062       578163.80       3505367.16        1872.26        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10000        10000        10000.00        0.00              0.00           
node-insert-eq    368071       372609       370400.20       2070540.96        1438.94        
node-insert-lt    33476        41439        38157.60        6955110.04        2637.25        
node-insert-gt    32928        45780        38302.60        17045281.84       4128.59        
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       216666       219231       217763.60       565256.84         751.84         
node-mem          6933312      7015392      6968435.20      578823004.16      24058.74       
total-node-mem    6933312      7015392      6968435.20      578823004.16      24058.74       
total-mem         6933368      7015448      6968491.20      578823004.16      24058.74       
real-insert-time  17221        24346        20617.40        4303099.24        2074.39        
user-insert-time  4000         24001        14000.60        39204800.24       6261.37        
sys-insert-time   0            12000        5600.00         13440000.00       3666.06        

real	0m1.530s
user	0m1.000s
sys	0m0.288s
$

$ time path-set-test -t 100000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100000       100000       100000.00       0.00              0.00           
line-mem          5780363      5816573      5790686.00      89733399.00       9472.77        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100000       100000       100000.00       0.00              0.00           
node-insert-eq    4364622      4393670      4374371.10      53007715.69       7280.64        
node-insert-lt    465846       607863       521137.20       1436140416.36     37896.44       
node-insert-gt    402465       566873       483855.70       3393469351.81     58253.49       
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       1513653      1522903      1516314.90      6448984.69        2539.49        
node-mem          48436896     48732896     48522076.80     6603760323.00     81263.52       
total-node-mem    48436896     48732896     48522076.80     6603760323.00     81263.52       
total-mem         48436952     48732952     48522132.80     6603760323.00     81263.52       
real-insert-time  172672       197627       182068.10       51711828.89       7191.09        
user-insert-time  108003       168010       137207.90       358621044.09      18937.29       
sys-insert-time   28000        68003        45602.30        125453440.81      11200.60       

real	0m3.644s
user	0m2.860s
sys	0m0.896s
$

$ time path-set-test -t 1000000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         830206       830206       830206.00       0.00              0.00           
line-mem          48049857     48049857     48049857.00     -0.50             0.71           
dups-node         0            0            0.00            0.00              0.00           
uniq-node         830206       830206       830206.00       0.00              0.00           
node-insert-eq    39958859     39958859     39958859.00     -0.25             0.50           
node-insert-lt    4465486      5317729      4889061.70      85816203864.01    292944.03      
node-insert-gt    4431406      5788186      4973879.60      172449496135.04   415270.39      
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       8921204      8921204      8921204.00      0.00              0.00           
node-mem          285478528    285478528    285478528.00    0.00              0.00           
total-node-mem    285478528    285478528    285478528.00    0.00              0.00           
total-mem         285478584    285478584    285478584.00    -16.00            4.00           
real-insert-time  1449478      1490803      1469179.40      138284873.84      11759.46       
user-insert-time  1172073      1320081      1198875.30      1958747931.61     44257.74       
sys-insert-time   236011       348020       295617.80       1355251850.56     36813.75       

real	0m19.771s
user	0m17.645s
sys	0m4.508s
$

$ path-set-test -p dups-line -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-line -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p line-mem -R ...
files       min          max          avg             var               dev
10          432          727          601.70          6607.61           81.29
100         5441         6111         5755.80         35470.76          188.34
1000        57327        58120        57739.40        73267.44          270.68
10000       575782       581062       578163.80       3505367.16        1872.26
100000      5780363      5816573      5790686.00      89733399.00       9472.77
1000000     48049857     48049857     48049857.00     -0.50             0.71
$

$ path-set-test -p dups-node -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-node -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p node-insert-eq -R ...
files       min          max          avg             var               dev
10          66           107          84.70           152.21            12.34
100         1761         2132         1933.30         11368.21          106.62
1000        28469        29391        28870.80        94955.16          308.15
10000       368071       372609       370400.20       2070540.96        1438.94
100000      4364622      4393670      4374371.10      53007715.69       7280.64
1000000     39958859     39958859     39958859.00     -0.25             0.50
$

$ path-set-test -p node-insert-lt -R ...
files       min          max          avg             var               dev
10          3            12           9.10            6.69              2.59
100         130          286          187.20          2137.16           46.23
1000        2382         3623         2788.20         92233.36          303.70
10000       33476        41439        38157.60        6955110.04        2637.25
100000      465846       607863       521137.20       1436140416.36     37896.44
1000000     4465486      5317729      4889061.70      85816203864.01    292944.03
$

$ path-set-test -p node-insert-gt -R ...
files       min          max          avg             var               dev
10          4            19           8.70            23.81             4.88
100         112          275          170.40          1987.44           44.58
1000        2331         3532         2946.30         203737.61         451.37
10000       32928        45780        38302.60        17045281.84       4128.59
100000      402465       566873       483855.70       3393469351.81     58253.49
1000000     4431406      5788186      4973879.60      172449496135.04   415270.39
$

$ path-set-test -p node-struct-size -R ...
files       min          max          avg             var               dev
10          32           32           32.00           0.00              0.00
100         32           32           32.00           0.00              0.00
1000        32           32           32.00           0.00              0.00
10000       32           32           32.00           0.00              0.00
100000      32           32           32.00           0.00              0.00
1000000     32           32           32.00           0.00              0.00
$

$ path-set-test -p node-struct -R ...
files       min          max          avg             var               dev
10          368          630          527.00          5833.40           76.38
100         3514         4081         3922.50         25884.65          160.89
1000        29357        30430        29868.60        68329.64          261.40
10000       216666       219231       217763.60       565256.84         751.84
100000      1513653      1522903      1516314.90      6448984.69        2539.49
1000000     8921204      8921204      8921204.00      0.00              0.00
$

$ path-set-test -p node-mem -R ...
files       min          max          avg             var               dev
10          11776        20160        16864.00        5973401.60        2444.05
100         112448       130592       125520.00       26505881.60       5148.39
1000        939424       973760       955795.20       69969551.36       8364.78
10000       6933312      7015392      6968435.20      578823004.16      24058.74
100000      48436896     48732896     48522076.80     6603760323.00     81263.52
1000000     285478528    285478528    285478528.00    0.00              0.00
$

$ path-set-test -p total-node-mem -R ...
files       min          max          avg             var               dev
10          11776        20160        16864.00        5973401.60        2444.05
100         112448       130592       125520.00       26505881.60       5148.39
1000        939424       973760       955795.20       69969551.36       8364.78
10000       6933312      7015392      6968435.20      578823004.16      24058.74
100000      48436896     48732896     48522076.80     6603760323.00     81263.52
1000000     285478528    285478528    285478528.00    0.00              0.00
$

$ path-set-test -p total-mem -R ...
files       min          max          avg             var               dev
10          11832        20216        16920.00        5973401.60        2444.05
100         112504       130648       125576.00       26505881.60       5148.39
1000        939480       973816       955851.20       69969551.36       8364.78
10000       6933368      7015448      6968491.20      578823004.16      24058.74
100000      48436952     48732952     48522132.80     6603760323.00     81263.52
1000000     285478584    285478584    285478584.00    -16.00            4.00
$

$ path-set-test -p real-insert-time -R ...
files       min          max          avg             var               dev
10          29           45           39.90           23.29             4.83
100         220          370          268.80          1848.36           42.99
1000        1847         3955         3509.50         338558.85         581.86
10000       17221        24346        20617.40        4303099.24        2074.39
100000      172672       197627       182068.10       51711828.89       7191.09
1000000     1449478      1490803      1469179.40      138284873.84      11759.46
$

$ path-set-test -p user-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         1600.00         3840000.00        1959.59
10000       4000         24001        14000.60        39204800.24       6261.37
100000      108003       168010       137207.90       358621044.09      18937.29
1000000     1172073      1320081      1198875.30      1958747931.61     44257.74
$

$ path-set-test -p sys-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         800.00          2560000.00        1600.00
10000       0            12000        5600.00         13440000.00       3666.06
100000      28000        68003        45602.30        125453440.81      11200.60
1000000     236011       348020       295617.80       1355251850.56     36813.75
$

$ path-set-test -p dups-line -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-line -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p line-mem -A ...
min: 601
max: 48049857
avg: 9080466.83
var: 307988195721893.50
dev: 17549592.47
$

$ path-set-test -p dups-node -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-node -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p node-insert-eq -A ...
min: 84
max: 39958859
avg: 7455752.83
var: 213742344289569.81
dev: 14619929.70
$

$ path-set-test -p node-insert-lt -A ...
min: 9
max: 4889061
avg: 908556.50
var: 3203852586163.25
dev: 1789930.89
$

$ path-set-test -p node-insert-gt -A ...
min: 8
max: 4973879
avg: 916526.67
var: 3322489489080.56
dev: 1822769.73
$

$ path-set-test -p node-struct-size -A ...
min: 32
max: 32
avg: 32.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct -A ...
min: 527
max: 8921204
avg: 1781599.67
var: 10481805534002.89
dev: 3237561.66
$

$ path-set-test -p node-mem -A ...
min: 16864
max: 285478528
avg: 57011203.00
var: 10733367812241576.00
dev: 103601968.19
$

$ path-set-test -p total-node-mem -A ...
min: 16864
max: 285478528
avg: 57011203.00
var: 10733367812241576.00
dev: 103601968.19
$

$ path-set-test -p total-mem -A ...
min: 16920
max: 285478584
avg: 57011259.00
var: 10733367812241576.00
dev: 103601968.19
$

$ path-set-test -p real-insert-time -A ...
min: 39
max: 1469179
avg: 279280.00
var: 287348204563.33
dev: 536048.70
$

$ path-set-test -p user-insert-time -A ...
min: 0
max: 1198875
avg: 225280.33
var: 191969702492.22
dev: 438143.47
$

$ path-set-test -p sys-insert-time -A ...
min: 0
max: 295617
avg: 57936.50
var: 11560187483.25
dev: 107518.31
$

