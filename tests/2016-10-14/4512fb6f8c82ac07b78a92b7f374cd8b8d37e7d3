#
# # meta command:
# $ path-set-test \
# --input=tests/files2.txt \
# --expr='10 ** x' \
# --limits=1-6 \
# --pool-size=512M \
# --hash-size=2M \
# --node-size=4M \
# --separators='/.-' \
# --repeat=10 \
# --sleep=100 \
# --plain-set \
# --ternary-tree \
# --run-tests
#

$ date +'%Y-%m-%d %H:%M:%S.%N %z'
2016-10-14 01:01:42.196483643 +0300
$

$ ./path-set -C
CONFIG_PATH_TRIE_NODE_32BIT_OFFSETS: no
CONFIG_PATH_TRIE_ELEM_32BIT_OFFSETS: no
CONFIG_PATH_TRIE_UINT_HASH_IDENTOP:  no
CONFIG_TRIE_PATH_SET_PRINT_SET:      no
CONFIG_VALUE_TYPE_SIZE:              64
32BIT:                               no
DEBUG:                               yes
OPT:                                 -
$

$ ./path-set --plain-set --ternary-tree -I
node-struct-size: 32
$

$ ./path-set --plain-set --ternary-tree -N
dups-line
uniq-line
line-mem
dups-node
uniq-node
node-insert-eq
node-insert-lt
node-insert-gt
node-struct-size
node-struct
node-mem
total-node-mem
total-mem
insert-time
$

$ PATH_SET_TEST_INPUT=tests/files2.txt
$ PATH_SET_TEST_POOL_SIZE=512M
$ PATH_SET_TEST_HASH_SIZE=2M
$ PATH_SET_TEST_NODE_SIZE=4M
$ PATH_SET_TEST_STRUCT_TYPE=plain-set
$ PATH_SET_TEST_SET_TYPE=ternary-tree
$ PATH_SET_TEST_SEPARATORS='/.-'
$

$ time path-set-test -t 10
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10           10           10.00           0.00              0.00           
line-mem          521          817          586.70          6767.01           82.26          
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10           10           10.00           0.00              0.00           
node-insert-eq    67           153          109.90          590.29            24.30          
node-insert-lt    4            17           8.70            14.21             3.77           
node-insert-gt    2            17           9.30            19.01             4.36           
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       418          685          486.80          5481.96           74.04          
node-mem          13376        21920        15577.60        5613527.04        2369.29        
total-node-mem    13376        21920        15577.60        5613527.04        2369.29        
total-mem         13432        21976        15633.60        5613527.04        2369.29        
real-insert-time  34           50           38.30           21.81             4.67           
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m1.286s
user	0m0.816s
sys	0m0.212s
$

$ time path-set-test -t 100
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100          100          100.00          0.00              0.00           
line-mem          5435         6075         5744.80         48983.56          221.32         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100          100          100.00          0.00              0.00           
node-insert-eq    1825         2156         1957.70         12228.61          110.58         
node-insert-lt    148          218          172.60          477.24            21.85          
node-insert-gt    104          318          208.20          4409.56           66.40          
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       3664         4087         3887.10         22427.69          149.76         
node-mem          117248       130784       124387.20       22965954.56       4792.28        
total-node-mem    117248       130784       124387.20       22965954.56       4792.28        
total-mem         117304       130840       124443.20       22965954.56       4792.28        
real-insert-time  221          386          249.50          2127.25           46.12          
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m1.292s
user	0m0.816s
sys	0m0.224s
$

$ time path-set-test -t 1000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         1000         1000         1000.00         0.00              0.00           
line-mem          57158        58663        58178.00        187523.80         433.04         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         1000         1000         1000.00         0.00              0.00           
node-insert-eq    28319        29212        28780.00        88762.00          297.93         
node-insert-lt    2311         3660         2939.00         162803.60         403.49         
node-insert-gt    2293         3211         2608.90         76070.49          275.81         
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       29797        30810        30398.00        73781.00          271.63         
node-mem          953504       985920       972736.00       75551744.00       8692.05        
total-node-mem    953504       985920       972736.00       75551744.00       8692.05        
total-mem         953560       985976       972792.00       75551744.00       8692.05        
real-insert-time  1834         3926         3398.60         499928.04         707.06         
user-insert-time  0            4000         1600.00         3840000.00        1959.59        
sys-insert-time   0            4000         1200.00         3360000.00        1833.03        

real	0m1.378s
user	0m0.864s
sys	0m0.256s
$

$ time path-set-test -t 10000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10000        10000        10000.00        0.00              0.00           
line-mem          575066       580879       578207.90       3363133.49        1833.88        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10000        10000        10000.00        0.00              0.00           
node-insert-eq    369134       373216       370911.60       2723587.44        1650.33        
node-insert-lt    34982        45259        39954.50        10926291.65       3305.49        
node-insert-gt    32305        49948        39947.90        35981913.29       5998.49        
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       215878       218474       217296.30       623288.21         789.49         
node-mem          6908096      6991168      6953481.60      638247127.05      25263.55       
total-node-mem    6908096      6991168      6953481.60      638247127.05      25263.55       
total-mem         6908152      6991224      6953537.60      638247127.04      25263.55       
real-insert-time  17074        23855        21460.30        4590683.81        2142.59        
user-insert-time  12000        24001        18000.60        20000000.24       4472.14        
sys-insert-time   0            8000         2400.00         10240000.00       3200.00        

real	0m1.570s
user	0m1.052s
sys	0m0.272s
$

$ time path-set-test -t 100000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100000       100000       100000.00       0.00              0.00           
line-mem          5779891      5798572      5788230.90      29315146.49       5414.35        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100000       100000       100000.00       0.00              0.00           
node-insert-eq    4366110      4379484      4373041.80      17831485.16       4222.73        
node-insert-lt    461966       524098       494917.30       367609911.81      19173.16       
node-insert-gt    433682       575339       487283.90       2260817332.09     47548.05       
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       1511629      1519088      1515189.10      4745468.29        2178.41        
node-mem          48372128     48610816     48486051.20     4859359529.00     69709.11       
total-node-mem    48372128     48610816     48486051.20     4859359529.00     69709.11       
total-mem         48372184     48610872     48486107.20     4859359529.00     69709.11       
real-insert-time  169115       185933       174613.40       22660364.04       4760.29        
user-insert-time  112007       160010       139608.30       251068241.41      15845.13       
sys-insert-time   16000        52003        33201.60        89774560.84       9474.94        

real	0m3.501s
user	0m2.784s
sys	0m0.808s
$

$ time path-set-test -t 1000000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         830206       830206       830206.00       0.00              0.00           
line-mem          48049857     48049857     48049857.00     -0.50             0.71           
dups-node         0            0            0.00            0.00              0.00           
uniq-node         830206       830206       830206.00       0.00              0.00           
node-insert-eq    39958859     39958859     39958859.00     -0.25             0.50           
node-insert-lt    4589041      5630310      4960992.90      79242028371.29    281499.61      
node-insert-gt    4286546      5599820      4769773.70      151187268086.01   388828.07      
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       8921204      8921204      8921204.00      0.00              0.00           
node-mem          285478528    285478528    285478528.00    0.00              0.00           
total-node-mem    285478528    285478528    285478528.00    0.00              0.00           
total-mem         285478584    285478584    285478584.00    -16.00            4.00           
real-insert-time  1454832      1526570      1488924.20      413686272.16      20339.28       
user-insert-time  1116069      1240070      1185672.60      1098283692.04     33140.36       
sys-insert-time   276018       340020       302018.90       464806800.89      21559.38       

real	0m20.005s
user	0m17.681s
sys	0m4.712s
$

$ path-set-test -p dups-line -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-line -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p line-mem -R ...
files       min          max          avg             var               dev
10          521          817          586.70          6767.01           82.26
100         5435         6075         5744.80         48983.56          221.32
1000        57158        58663        58178.00        187523.80         433.04
10000       575066       580879       578207.90       3363133.49        1833.88
100000      5779891      5798572      5788230.90      29315146.49       5414.35
1000000     48049857     48049857     48049857.00     -0.50             0.71
$

$ path-set-test -p dups-node -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-node -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p node-insert-eq -R ...
files       min          max          avg             var               dev
10          67           153          109.90          590.29            24.30
100         1825         2156         1957.70         12228.61          110.58
1000        28319        29212        28780.00        88762.00          297.93
10000       369134       373216       370911.60       2723587.44        1650.33
100000      4366110      4379484      4373041.80      17831485.16       4222.73
1000000     39958859     39958859     39958859.00     -0.25             0.50
$

$ path-set-test -p node-insert-lt -R ...
files       min          max          avg             var               dev
10          4            17           8.70            14.21             3.77
100         148          218          172.60          477.24            21.85
1000        2311         3660         2939.00         162803.60         403.49
10000       34982        45259        39954.50        10926291.65       3305.49
100000      461966       524098       494917.30       367609911.81      19173.16
1000000     4589041      5630310      4960992.90      79242028371.29    281499.61
$

$ path-set-test -p node-insert-gt -R ...
files       min          max          avg             var               dev
10          2            17           9.30            19.01             4.36
100         104          318          208.20          4409.56           66.40
1000        2293         3211         2608.90         76070.49          275.81
10000       32305        49948        39947.90        35981913.29       5998.49
100000      433682       575339       487283.90       2260817332.09     47548.05
1000000     4286546      5599820      4769773.70      151187268086.01   388828.07
$

$ path-set-test -p node-struct-size -R ...
files       min          max          avg             var               dev
10          32           32           32.00           0.00              0.00
100         32           32           32.00           0.00              0.00
1000        32           32           32.00           0.00              0.00
10000       32           32           32.00           0.00              0.00
100000      32           32           32.00           0.00              0.00
1000000     32           32           32.00           0.00              0.00
$

$ path-set-test -p node-struct -R ...
files       min          max          avg             var               dev
10          418          685          486.80          5481.96           74.04
100         3664         4087         3887.10         22427.69          149.76
1000        29797        30810        30398.00        73781.00          271.63
10000       215878       218474       217296.30       623288.21         789.49
100000      1511629      1519088      1515189.10      4745468.29        2178.41
1000000     8921204      8921204      8921204.00      0.00              0.00
$

$ path-set-test -p node-mem -R ...
files       min          max          avg             var               dev
10          13376        21920        15577.60        5613527.04        2369.29
100         117248       130784       124387.20       22965954.56       4792.28
1000        953504       985920       972736.00       75551744.00       8692.05
10000       6908096      6991168      6953481.60      638247127.05      25263.55
100000      48372128     48610816     48486051.20     4859359529.00     69709.11
1000000     285478528    285478528    285478528.00    0.00              0.00
$

$ path-set-test -p total-node-mem -R ...
files       min          max          avg             var               dev
10          13376        21920        15577.60        5613527.04        2369.29
100         117248       130784       124387.20       22965954.56       4792.28
1000        953504       985920       972736.00       75551744.00       8692.05
10000       6908096      6991168      6953481.60      638247127.05      25263.55
100000      48372128     48610816     48486051.20     4859359529.00     69709.11
1000000     285478528    285478528    285478528.00    0.00              0.00
$

$ path-set-test -p total-mem -R ...
files       min          max          avg             var               dev
10          13432        21976        15633.60        5613527.04        2369.29
100         117304       130840       124443.20       22965954.56       4792.28
1000        953560       985976       972792.00       75551744.00       8692.05
10000       6908152      6991224      6953537.60      638247127.04      25263.55
100000      48372184     48610872     48486107.20     4859359529.00     69709.11
1000000     285478584    285478584    285478584.00    -16.00            4.00
$

$ path-set-test -p real-insert-time -R ...
files       min          max          avg             var               dev
10          34           50           38.30           21.81             4.67
100         221          386          249.50          2127.25           46.12
1000        1834         3926         3398.60         499928.04         707.06
10000       17074        23855        21460.30        4590683.81        2142.59
100000      169115       185933       174613.40       22660364.04       4760.29
1000000     1454832      1526570      1488924.20      413686272.16      20339.28
$

$ path-set-test -p user-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         1600.00         3840000.00        1959.59
10000       12000        24001        18000.60        20000000.24       4472.14
100000      112007       160010       139608.30       251068241.41      15845.13
1000000     1116069      1240070      1185672.60      1098283692.04     33140.36
$

$ path-set-test -p sys-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         1200.00         3360000.00        1833.03
10000       0            8000         2400.00         10240000.00       3200.00
100000      16000        52003        33201.60        89774560.84       9474.94
1000000     276018       340020       302018.90       464806800.89      21559.38
$

$ path-set-test -p dups-line -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-line -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p line-mem -A ...
min: 586
max: 48049857
avg: 9080133.67
var: 307989523529602.25
dev: 17549630.30
$

$ path-set-test -p dups-node -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-node -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p node-insert-eq -A ...
min: 109
max: 39958859
avg: 7455609.50
var: 213742604861778.59
dev: 14619938.61
$

$ path-set-test -p node-insert-lt -A ...
min: 8
max: 4960992
avg: 916497.00
var: 3303031490730.67
dev: 1817424.41
$

$ path-set-test -p node-insert-gt -A ...
min: 9
max: 4769773
avg: 883304.67
var: 3051403166084.22
dev: 1746826.60
$

$ path-set-test -p node-struct-size -A ...
min: 32
max: 32
avg: 32.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct -A ...
min: 486
max: 8921204
avg: 1781410.00
var: 10481884320287.00
dev: 3237573.83
$

$ path-set-test -p node-mem -A ...
min: 15577
max: 285478528
avg: 57005126.67
var: 10733448853506144.00
dev: 103602359.30
$

$ path-set-test -p total-node-mem -A ...
min: 15577
max: 285478528
avg: 57005126.67
var: 10733448853506144.00
dev: 103602359.30
$

$ path-set-test -p total-mem -A ...
min: 15633
max: 285478584
avg: 57005182.67
var: 10733448853506144.00
dev: 103602359.30
$

$ path-set-test -p real-insert-time -A ...
min: 38
max: 1488924
avg: 281447.00
var: 295430339356.67
dev: 543535.04
$

$ path-set-test -p user-insert-time -A ...
min: 0
max: 1185672
avg: 224146.67
var: 187364112696.89
dev: 432855.76
$

$ path-set-test -p sys-insert-time -A ...
min: 0
max: 302018
avg: 56469.83
var: 12198554377.47
dev: 110447.07
$

