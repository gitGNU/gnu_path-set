#
# # meta command:
# $ path-set-test \
# --input=tests/files.txt \
# --expr='10 ** x' \
# --limits=1-6 \
# --pool-size=128M \
# --hash-size=2M \
# --node-size=4M \
# --separators='/' \
# --repeat=10 \
# --sleep=100 \
# --plain-set \
# --gnulib-hash \
# --run-tests
#

$ date +'%Y-%m-%d %H:%M:%S.%N %z'
2016-09-29 13:12:31.301248986 +0300
$

$ ./path-set -C
CONFIG_PATH_TRIE_NODE_32BIT_OFFSETS: no
CONFIG_PATH_TRIE_ELEM_32BIT_OFFSETS: no
CONFIG_PATH_TRIE_UINT_HASH_IDENTOP:  no
CONFIG_TRIE_PATH_SET_PRINT_SET:      no
CONFIG_VALUE_TYPE_SIZE:              64
32BIT:                               no
DEBUG:                               yes
OPT:                                 -
$

$ ./path-set --plain-set --gnulib-hash -I
node-struct-size: 16
$

$ ./path-set --plain-set --gnulib-hash -N
dups-line
uniq-line
line-mem
dups-node
uniq-node
node-insert-eq
node-insert-ne
node-rehash-eq
node-rehash-ne
hash-size
hash-used
hash-load
node-struct-size
node-struct
node-mem
total-node-mem
total-mem
insert-time
$

$ PATH_SET_TEST_INPUT=tests/files.txt
$ PATH_SET_TEST_POOL_SIZE=128M
$ PATH_SET_TEST_HASH_SIZE=2M
$ PATH_SET_TEST_NODE_SIZE=4M
$ PATH_SET_TEST_STRUCT_TYPE=plain-set
$ PATH_SET_TEST_SET_TYPE=gnulib-hash
$ PATH_SET_TEST_SEPARATORS='/'
$

$ time path-set-test -t 10
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10           10           10.00           0.00              0.00           
line-mem          576          715          643.70          1803.81           42.47          
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10           10           10.00           0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            0            0.00            0.00              0.00           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         10           10           10.00           0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       10           10           10.00           0.00              0.00           
node-mem          746          885          813.70          1803.81           42.47          
total-node-mem    746          885          813.70          1803.81           42.47          
total-mem         41944106     41944245     41944173.70     1803.25           42.46          
real-insert-time  1578         2765         2060.50         96266.85          310.27         
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m1.031s
user	0m0.536s
sys	0m0.216s
$

$ time path-set-test -t 100
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100          100          100.00          0.00              0.00           
line-mem          6273         6687         6473.20         24685.16          157.12         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100          100          100.00          0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            0            0.00            0.00              0.00           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         100          100          100.00          0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       100          100          100.00          0.00              0.00           
node-mem          7973         8387         8173.20         24685.16          157.12         
total-node-mem    7973         8387         8173.20         24685.16          157.12         
total-mem         41951333     41951747     41951533.20     24684.75          157.11         
real-insert-time  5311         5688         5497.20         25143.56          158.57         
user-insert-time  0            4000         400.00          1440000.00        1200.00        
sys-insert-time   0            4000         3600.00         1440000.00        1200.00        

real	0m1.026s
user	0m0.448s
sys	0m0.276s
$

$ time path-set-test -t 1000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         1000         1000         1000.00         0.00              0.00           
line-mem          64936        67531        66177.40        675634.44         821.97         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         1000         1000         1000.00         0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            0            0.00            0.00              0.00           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         1000         1000         1000.00         0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       1000         1000         1000.00         0.00              0.00           
node-mem          81936        84531        83177.40        675634.44         821.97         
total-node-mem    81936        84531        83177.40        675634.44         821.97         
total-mem         42025296     42027891     42026537.40     675634.50         821.97         
real-insert-time  5934         7297         6982.10         196858.09         443.69         
user-insert-time  0            4000         800.00          2560000.00        1600.00        
sys-insert-time   0            8000         4400.00         4640000.00        2154.07        

real	0m1.055s
user	0m0.508s
sys	0m0.256s
$

$ time path-set-test -t 10000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10000        10000        10000.00        0.00              0.00           
line-mem          651529       658771       656535.00       4444392.80        2108.17        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10000        10000        10000.00        0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    13           25           18.50           16.85             4.10           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         9976         9987         9981.60         15.64             3.95           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       10000        10000        10000.00        0.00              0.00           
node-mem          821529       828771       826535.00       4444392.80        2108.17        
total-node-mem    821529       828771       826535.00       4444392.80        2108.17        
total-mem         42765161     42772435     42770189.40     4565561.25        2136.72        
real-insert-time  12801        15219        14031.10        645559.89         803.47         
user-insert-time  0            4000         2800.00         3360000.00        1833.03        
sys-insert-time   4000         16001        8000.20         12802400.16       3578.04        

real	0m1.138s
user	0m0.564s
sys	0m0.324s
$

$ time path-set-test -t 100000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100000       100000       100000.00       0.00              0.00           
line-mem          6563019      6576810      6570660.20      11455657.76       3384.62        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100000       100000       100000.00       0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    1885         2003         1939.00         1109.20           33.30          
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         98024        98143        98089.70        1205.01           34.71          
hash-load         0.04         0.04         0.04            0.00              0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       100000       100000       100000.00       0.00              0.00           
node-mem          8263019      8276810      8270660.20      11455657.75       3384.62        
total-node-mem    8263019      8276810      8270660.20      11455657.75       3384.62        
total-mem         50236635     50250650     50244585.00     11495958.50       3390.57        
real-insert-time  75483        78669        77019.60        674645.04         821.37         
user-insert-time  24000        60003        42802.50        105776401.45      10284.77       
sys-insert-time   12000        52004        31201.80        175387681.56      13243.40       

real	0m2.183s
user	0m1.368s
sys	0m0.812s
$

$ time path-set-test -t 1000000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         405909       405909       405909.00       0.00              0.00           
line-mem          26666438     26666438     26666438.00     0.00              0.00           
dups-node         0            0            0.00            0.00              0.00           
uniq-node         405909       405909       405909.00       0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    31613        31613        31613.00        0.00              0.00           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         375952       375952       375952.00       0.00              0.00           
hash-load         0.14         0.14         0.14            -0.00             0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       405909       405909       405909.00       0.00              0.00           
node-mem          33566891     33566891     33566891.00     -0.25             0.50           
total-node-mem    33566891     33566891     33566891.00     -0.25             0.50           
total-mem         75989563     75989563     75989563.00     0.00              0.00           
real-insert-time  290403       300138       294076.60       10191230.24       3192.37        
user-insert-time  156011       192009       173210.10       144154162.69      12006.42       
sys-insert-time   80003        140006       114006.50       397635602.85      19940.80       

real	0m5.780s
user	0m4.280s
sys	0m2.376s
$

$ path-set-test -p dups-line -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-line -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p line-mem -R ...
files       min          max          avg             var               dev
10          576          715          643.70          1803.81           42.47
100         6273         6687         6473.20         24685.16          157.12
1000        64936        67531        66177.40        675634.44         821.97
10000       651529       658771       656535.00       4444392.80        2108.17
100000      6563019      6576810      6570660.20      11455657.76       3384.62
1000000     26666438     26666438     26666438.00     0.00              0.00
$

$ path-set-test -p dups-node -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-node -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p node-insert-eq -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p node-insert-ne -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       13           25           18.50           16.85             4.10
100000      1885         2003         1939.00         1109.20           33.30
1000000     31613        31613        31613.00        0.00              0.00
$

$ path-set-test -p node-rehash-eq -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p node-rehash-ne -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p hash-size -R ...
files       min          max          avg             var               dev
10          2621447      2621447      2621447.00      0.00              0.00
100         2621447      2621447      2621447.00      0.00              0.00
1000        2621447      2621447      2621447.00      0.00              0.00
10000       2621447      2621447      2621447.00      0.00              0.00
100000      2621447      2621447      2621447.00      0.00              0.00
1000000     2621447      2621447      2621447.00      0.00              0.00
$

$ path-set-test -p hash-used -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       9976         9987         9981.60         15.64             3.95
100000      98024        98143        98089.70        1205.01           34.71
1000000     375952       375952       375952.00       0.00              0.00
$

$ path-set-test -p hash-load -R ...
files       min          max          avg             var               dev
10          0.00         0.00         0.00            0.00              0.00
100         0.00         0.00         0.00            0.00              0.00
1000        0.00         0.00         0.00            0.00              0.00
10000       0.00         0.00         0.00            0.00              0.00
100000      0.04         0.04         0.04            0.00              0.00
1000000     0.14         0.14         0.14            -0.00             0.00
$

$ path-set-test -p node-struct-size -R ...
files       min          max          avg             var               dev
10          16           16           16.00           0.00              0.00
100         16           16           16.00           0.00              0.00
1000        16           16           16.00           0.00              0.00
10000       16           16           16.00           0.00              0.00
100000      16           16           16.00           0.00              0.00
1000000     16           16           16.00           0.00              0.00
$

$ path-set-test -p node-struct -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p node-mem -R ...
files       min          max          avg             var               dev
10          746          885          813.70          1803.81           42.47
100         7973         8387         8173.20         24685.16          157.12
1000        81936        84531        83177.40        675634.44         821.97
10000       821529       828771       826535.00       4444392.80        2108.17
100000      8263019      8276810      8270660.20      11455657.75       3384.62
1000000     33566891     33566891     33566891.00     -0.25             0.50
$

$ path-set-test -p total-node-mem -R ...
files       min          max          avg             var               dev
10          746          885          813.70          1803.81           42.47
100         7973         8387         8173.20         24685.16          157.12
1000        81936        84531        83177.40        675634.44         821.97
10000       821529       828771       826535.00       4444392.80        2108.17
100000      8263019      8276810      8270660.20      11455657.75       3384.62
1000000     33566891     33566891     33566891.00     -0.25             0.50
$

$ path-set-test -p total-mem -R ...
files       min          max          avg             var               dev
10          41944106     41944245     41944173.70     1803.25           42.46
100         41951333     41951747     41951533.20     24684.75          157.11
1000        42025296     42027891     42026537.40     675634.50         821.97
10000       42765161     42772435     42770189.40     4565561.25        2136.72
100000      50236635     50250650     50244585.00     11495958.50       3390.57
1000000     75989563     75989563     75989563.00     0.00              0.00
$

$ path-set-test -p real-insert-time -R ...
files       min          max          avg             var               dev
10          1578         2765         2060.50         96266.85          310.27
100         5311         5688         5497.20         25143.56          158.57
1000        5934         7297         6982.10         196858.09         443.69
10000       12801        15219        14031.10        645559.89         803.47
100000      75483        78669        77019.60        674645.04         821.37
1000000     290403       300138       294076.60       10191230.24       3192.37
$

$ path-set-test -p user-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            4000         400.00          1440000.00        1200.00
1000        0            4000         800.00          2560000.00        1600.00
10000       0            4000         2800.00         3360000.00        1833.03
100000      24000        60003        42802.50        105776401.45      10284.77
1000000     156011       192009       173210.10       144154162.69      12006.42
$

$ path-set-test -p sys-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            4000         3600.00         1440000.00        1200.00
1000        0            8000         4400.00         4640000.00        2154.07
10000       4000         16001        8000.20         12802400.16       3578.04
100000      12000        52004        31201.80        175387681.56      13243.40
1000000     80003        140006       114006.50       397635602.85      19940.80
$

$ path-set-test -p dups-line -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-line -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p line-mem -A ...
min: 643
max: 26666438
avg: 5661154.33
var: 93735989673877.22
dev: 9681734.85
$

$ path-set-test -p dups-node -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-node -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p node-insert-eq -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-insert-ne -A ...
min: 0
max: 31613
avg: 5595.00
var: 135886277.33
dev: 11657.03
$

$ path-set-test -p node-rehash-eq -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-rehash-ne -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p hash-size -A ...
min: 2621447
max: 2621447
avg: 2621447.00
var: 0.00
dev: 0.00
$

$ path-set-test -p hash-used -A ...
min: 10
max: 375952
avg: 80855.33
var: 18639413185.89
dev: 136526.24
$

$ path-set-test -p hash-load -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct-size -A ...
min: 16
max: 16
avg: 16.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p node-mem -A ...
min: 813
max: 33566891
avg: 7126041.50
var: 148524554910266.59
dev: 12187065.07
$

$ path-set-test -p total-node-mem -A ...
min: 813
max: 33566891
avg: 7126041.50
var: 148524554910266.59
dev: 12187065.07
$

$ path-set-test -p total-mem -A ...
min: 41944173
max: 75989563
avg: 49154430.00
var: 152791287335983.50
dev: 12360877.29
$

$ path-set-test -p real-insert-time -A ...
min: 2060
max: 294076
avg: 66610.83
var: 11011779887.81
dev: 104937.03
$

$ path-set-test -p user-insert-time -A ...
min: 0
max: 173210
avg: 36668.67
var: 3962468102.22
dev: 62948.14
$

$ path-set-test -p sys-insert-time -A ...
min: 0
max: 114006
avg: 26867.83
var: 1622651271.47
dev: 40282.15
$

