#
# # meta command:
# $ path-set-test \
# --input=tests/files.txt \
# --expr='10 ** x' \
# --limits=1-6 \
# --pool-size=128M \
# --hash-size=2M \
# --node-size=4M \
# --separators='/' \
# --repeat=10 \
# --sleep=100 \
# --plain-set \
# --linear-hash \
# --run-tests
#

$ date +'%Y-%m-%d %H:%M:%S.%N %z'
2016-09-29 13:16:02.830465394 +0300
$

$ ./path-set -C
CONFIG_PATH_TRIE_NODE_32BIT_OFFSETS: no
CONFIG_PATH_TRIE_ELEM_32BIT_OFFSETS: no
CONFIG_PATH_TRIE_UINT_HASH_IDENTOP:  no
CONFIG_TRIE_PATH_SET_PRINT_SET:      no
CONFIG_VALUE_TYPE_SIZE:              32
32BIT:                               yes
DEBUG:                               yes
OPT:                                 -
$

$ ./path-set --plain-set --linear-hash -I
node-struct-size: 4
$

$ ./path-set --plain-set --linear-hash -N
dups-line
uniq-line
line-mem
dups-node
uniq-node
node-insert-eq
node-insert-ne
hash-size
hash-used
hash-load
node-struct-size
node-struct
node-mem
total-node-mem
total-mem
insert-time
$

$ PATH_SET_TEST_INPUT=tests/files.txt
$ PATH_SET_TEST_POOL_SIZE=128M
$ PATH_SET_TEST_HASH_SIZE=2M
$ PATH_SET_TEST_NODE_SIZE=4M
$ PATH_SET_TEST_STRUCT_TYPE=plain-set
$ PATH_SET_TEST_SET_TYPE=linear-hash
$ PATH_SET_TEST_SEPARATORS='/'
$

$ time path-set-test -t 10
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10           10           10.00           0.00              0.00           
line-mem          544          750          637.90          4445.09           66.67          
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10           10           10.00           0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            0            0.00            0.00              0.00           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         10           10           10.00           0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  4            4            4.00            0.00              0.00           
node-struct       10           10           10.00           0.00              0.00           
node-mem          594          800          687.90          4445.09           66.67          
total-node-mem    594          800          687.90          4445.09           66.67          
total-mem         8389302      8389508      8389395.90      4445.09           66.67          
real-insert-time  431          1227         671.00          42433.00          205.99         
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m0.856s
user	0m0.396s
sys	0m0.192s
$

$ time path-set-test -t 100
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100          100          100.00          0.00              0.00           
line-mem          6163         6943         6606.20         57045.96          238.84         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100          100          100.00          0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            0            0.00            0.00              0.00           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         100          100          100.00          0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  4            4            4.00            0.00              0.00           
node-struct       100          100          100.00          0.00              0.00           
node-mem          6663         7443         7106.20         57045.96          238.84         
total-node-mem    6663         7443         7106.20         57045.96          238.84         
total-mem         8395371      8396151      8395814.20      57045.97          238.84         
real-insert-time  836          1108         933.70          7574.61           87.03          
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m0.853s
user	0m0.384s
sys	0m0.180s
$

$ time path-set-test -t 1000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         1000         1000         1000.00         0.00              0.00           
line-mem          64713        67342        65756.50        624985.65         790.56         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         1000         1000         1000.00         0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            2            0.20            0.36              0.60           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         1000         1000         1000.00         0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  4            4            4.00            0.00              0.00           
node-struct       1000         1000         1000.00         0.00              0.00           
node-mem          69713        72342        70756.50        624985.65         790.56         
total-node-mem    69713        72342        70756.50        624985.65         790.56         
total-mem         8458421      8461050      8459464.50      624985.66         790.56         
real-insert-time  2600         3070         2818.60         13260.64          115.15         
user-insert-time  0            4000         400.00          1440000.00        1200.00        
sys-insert-time   0            4000         1600.00         3840000.00        1959.59        

real	0m0.907s
user	0m0.412s
sys	0m0.212s
$

$ time path-set-test -t 10000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10000        10000        10000.00        0.00              0.00           
line-mem          652803       658176       655796.30       2976406.81        1725.23        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10000        10000        10000.00        0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    18           28           23.00           9.80              3.13           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         10000        10000        10000.00        0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  4            4            4.00            0.00              0.00           
node-struct       10000        10000        10000.00        0.00              0.00           
node-mem          702803       708176       705796.30       2976406.81        1725.23        
total-node-mem    702803       708176       705796.30       2976406.81        1725.23        
total-mem         9091511      9096884      9094504.30      2976406.80        1725.23        
real-insert-time  9539         13592        11319.80        1549057.76        1244.61        
user-insert-time  0            12000        3600.00         17440000.00       4176.12        
sys-insert-time   0            8000         4400.00         14240000.00       3773.59        

real	0m1.005s
user	0m0.476s
sys	0m0.284s
$

$ time path-set-test -t 100000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100000       100000       100000.00       0.00              0.00           
line-mem          6560754      6577693      6569370.70      45982284.61       6781.02        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100000       100000       100000.00       0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    2520         2786         2690.00         6755.40           82.19          
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         100000       100000       100000.00       0.00              0.00           
hash-load         0.05         0.05         0.05            0.00              0.00           
node-struct-size  4            4            4.00            0.00              0.00           
node-struct       100000       100000       100000.00       0.00              0.00           
node-mem          7060754      7077693      7069370.70      45982284.61       6781.02        
total-node-mem    7060754      7077693      7069370.70      45982284.61       6781.02        
total-mem         15449462     15466401     15458078.70     45982284.66       6781.02        
real-insert-time  74037        79850        76698.30        2732749.81        1653.10        
user-insert-time  24002        52004        39202.60        108168160.64      10400.39       
sys-insert-time   20001        44002        34402.00        39045601.40       6248.65        

real	0m2.259s
user	0m1.336s
sys	0m0.952s
$

$ time path-set-test -t 1000000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         405909       405909       405909.00       0.00              0.00           
line-mem          26666438     26666438     26666438.00     0.00              0.00           
dups-node         0            0            0.00            0.00              0.00           
uniq-node         405909       405909       405909.00       0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    88701        88701        88701.00        0.00              0.00           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         405909       405909       405909.00       0.00              0.00           
hash-load         0.19         0.19         0.19            0.00              0.00           
node-struct-size  4            4            4.00            0.00              0.00           
node-struct       405909       405909       405909.00       0.00              0.00           
node-mem          28695983     28695983     28695983.00     0.00              0.00           
total-node-mem    28695983     28695983     28695983.00     0.00              0.00           
total-mem         37084691     37084691     37084691.00     -0.25             0.50           
real-insert-time  290248       304063       297690.90       19449620.29       4410.17        
user-insert-time  112011       212012       161210.90       681789044.09      26111.09       
sys-insert-time   100006       160009       137208.00       288186404.20      16976.05       

real	0m6.253s
user	0m4.256s
sys	0m2.868s
$

$ path-set-test -p dups-line -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-line -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p line-mem -R ...
files       min          max          avg             var               dev
10          544          750          637.90          4445.09           66.67
100         6163         6943         6606.20         57045.96          238.84
1000        64713        67342        65756.50        624985.65         790.56
10000       652803       658176       655796.30       2976406.81        1725.23
100000      6560754      6577693      6569370.70      45982284.61       6781.02
1000000     26666438     26666438     26666438.00     0.00              0.00
$

$ path-set-test -p dups-node -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-node -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p node-insert-eq -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p node-insert-ne -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            2            0.20            0.36              0.60
10000       18           28           23.00           9.80              3.13
100000      2520         2786         2690.00         6755.40           82.19
1000000     88701        88701        88701.00        0.00              0.00
$

$ path-set-test -p hash-size -R ...
files       min          max          avg             var               dev
10          2097169      2097169      2097169.00      0.00              0.00
100         2097169      2097169      2097169.00      0.00              0.00
1000        2097169      2097169      2097169.00      0.00              0.00
10000       2097169      2097169      2097169.00      0.00              0.00
100000      2097169      2097169      2097169.00      0.00              0.00
1000000     2097169      2097169      2097169.00      0.00              0.00
$

$ path-set-test -p hash-used -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p hash-load -R ...
files       min          max          avg             var               dev
10          0.00         0.00         0.00            0.00              0.00
100         0.00         0.00         0.00            0.00              0.00
1000        0.00         0.00         0.00            0.00              0.00
10000       0.00         0.00         0.00            0.00              0.00
100000      0.05         0.05         0.05            0.00              0.00
1000000     0.19         0.19         0.19            0.00              0.00
$

$ path-set-test -p node-struct-size -R ...
files       min          max          avg             var               dev
10          4            4            4.00            0.00              0.00
100         4            4            4.00            0.00              0.00
1000        4            4            4.00            0.00              0.00
10000       4            4            4.00            0.00              0.00
100000      4            4            4.00            0.00              0.00
1000000     4            4            4.00            0.00              0.00
$

$ path-set-test -p node-struct -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p node-mem -R ...
files       min          max          avg             var               dev
10          594          800          687.90          4445.09           66.67
100         6663         7443         7106.20         57045.96          238.84
1000        69713        72342        70756.50        624985.65         790.56
10000       702803       708176       705796.30       2976406.81        1725.23
100000      7060754      7077693      7069370.70      45982284.61       6781.02
1000000     28695983     28695983     28695983.00     0.00              0.00
$

$ path-set-test -p total-node-mem -R ...
files       min          max          avg             var               dev
10          594          800          687.90          4445.09           66.67
100         6663         7443         7106.20         57045.96          238.84
1000        69713        72342        70756.50        624985.65         790.56
10000       702803       708176       705796.30       2976406.81        1725.23
100000      7060754      7077693      7069370.70      45982284.61       6781.02
1000000     28695983     28695983     28695983.00     0.00              0.00
$

$ path-set-test -p total-mem -R ...
files       min          max          avg             var               dev
10          8389302      8389508      8389395.90      4445.09           66.67
100         8395371      8396151      8395814.20      57045.97          238.84
1000        8458421      8461050      8459464.50      624985.66         790.56
10000       9091511      9096884      9094504.30      2976406.80        1725.23
100000      15449462     15466401     15458078.70     45982284.66       6781.02
1000000     37084691     37084691     37084691.00     -0.25             0.50
$

$ path-set-test -p real-insert-time -R ...
files       min          max          avg             var               dev
10          431          1227         671.00          42433.00          205.99
100         836          1108         933.70          7574.61           87.03
1000        2600         3070         2818.60         13260.64          115.15
10000       9539         13592        11319.80        1549057.76        1244.61
100000      74037        79850        76698.30        2732749.81        1653.10
1000000     290248       304063       297690.90       19449620.29       4410.17
$

$ path-set-test -p user-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         400.00          1440000.00        1200.00
10000       0            12000        3600.00         17440000.00       4176.12
100000      24002        52004        39202.60        108168160.64      10400.39
1000000     112011       212012       161210.90       681789044.09      26111.09
$

$ path-set-test -p sys-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         1600.00         3840000.00        1959.59
10000       0            8000         4400.00         14240000.00       3773.59
100000      20001        44002        34402.00        39045601.40       6248.65
1000000     100006       160009       137208.00       288186404.20      16976.05
$

$ path-set-test -p dups-line -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-line -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p line-mem -A ...
min: 637
max: 26666438
avg: 5660767.17
var: 93737377433938.81
dev: 9681806.52
$

$ path-set-test -p dups-node -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-node -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p node-insert-eq -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-insert-ne -A ...
min: 0
max: 88701
avg: 15235.67
var: 1080391799.56
dev: 32869.31
$

$ path-set-test -p hash-size -A ...
min: 2097169
max: 2097169
avg: 2097169.00
var: 0.00
dev: 0.00
$

$ path-set-test -p hash-used -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p hash-load -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct-size -A ...
min: 4
max: 4
avg: 4.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p node-mem -A ...
min: 687
max: 28695983
avg: 6091616.33
var: 108548650098390.91
dev: 10418668.35
$

$ path-set-test -p total-node-mem -A ...
min: 687
max: 28695983
avg: 6091616.33
var: 108548650098390.91
dev: 10418668.35
$

$ path-set-test -p total-mem -A ...
min: 8389395
max: 37084691
avg: 14480324.33
var: 108548650098390.84
dev: 10418668.35
$

$ path-set-test -p real-insert-time -A ...
min: 671
max: 297690
avg: 65021.50
var: 11545421357.58
dev: 107449.62
$

$ path-set-test -p user-insert-time -A ...
min: 0
max: 161210
avg: 34068.67
var: 3429089435.56
dev: 58558.43
$

$ path-set-test -p sys-insert-time -A ...
min: 0
max: 137208
avg: 29601.67
var: 2462316808.56
dev: 49621.74
$

