#
# # meta command:
# $ path-set-test \
# --input=tests/files2.txt \
# --expr='10 ** x' \
# --limits=1-6 \
# --pool-size=512M \
# --hash-size=2M \
# --node-size=4M \
# --separators='/.-' \
# --repeat=10 \
# --sleep=100 \
# --plain-set \
# --linear-hash \
# --run-tests
#

$ date +'%Y-%m-%d %H:%M:%S.%N %z'
2016-09-29 13:36:59.386392858 +0300
$

$ ./path-set -C
CONFIG_PATH_TRIE_NODE_32BIT_OFFSETS: yes
CONFIG_PATH_TRIE_ELEM_32BIT_OFFSETS: yes
CONFIG_PATH_TRIE_UINT_HASH_IDENTOP:  no
CONFIG_TRIE_PATH_SET_PRINT_SET:      no
CONFIG_VALUE_TYPE_SIZE:              64
32BIT:                               no
DEBUG:                               yes
OPT:                                 -
$

$ ./path-set --plain-set --linear-hash -I
node-struct-size: 8
$

$ ./path-set --plain-set --linear-hash -N
dups-line
uniq-line
line-mem
dups-node
uniq-node
node-insert-eq
node-insert-ne
hash-size
hash-used
hash-load
node-struct-size
node-struct
node-mem
total-node-mem
total-mem
insert-time
$

$ PATH_SET_TEST_INPUT=tests/files2.txt
$ PATH_SET_TEST_POOL_SIZE=512M
$ PATH_SET_TEST_HASH_SIZE=2M
$ PATH_SET_TEST_NODE_SIZE=4M
$ PATH_SET_TEST_STRUCT_TYPE=plain-set
$ PATH_SET_TEST_SET_TYPE=linear-hash
$ PATH_SET_TEST_SEPARATORS='/.-'
$

$ time path-set-test -t 10
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10           10           10.00           0.00              0.00           
line-mem          417          662          552.30          4583.81           67.70          
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10           10           10.00           0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            0            0.00            0.00              0.00           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         10           10           10.00           0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       10           10           10.00           0.00              0.00           
node-mem          507          752          642.30          4583.81           67.70          
total-node-mem    507          752          642.30          4583.81           67.70          
total-mem         16777923     16778168     16778058.30     4583.75           67.70          
real-insert-time  996          1937         1381.80         74674.96          273.27         
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m1.295s
user	0m0.780s
sys	0m0.236s
$

$ time path-set-test -t 100
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100          100          100.00          0.00              0.00           
line-mem          5504         6149         5822.60         40854.24          202.12         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100          100          100.00          0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            0            0.00            0.00              0.00           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         100          100          100.00          0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       100          100          100.00          0.00              0.00           
node-mem          6404         7049         6722.60         40854.24          202.12         
total-node-mem    6404         7049         6722.60         40854.24          202.12         
total-mem         16783820     16784465     16784138.60     40854.19          202.12         
real-insert-time  2025         2141         2072.30         1666.61           40.82          
user-insert-time  0            4000         400.00          1440000.00        1200.00        
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m1.351s
user	0m0.796s
sys	0m0.268s
$

$ time path-set-test -t 1000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         1000         1000         1000.00         0.00              0.00           
line-mem          57150        58831        57695.30        215954.01         464.71         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         1000         1000         1000.00         0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            1            0.10            0.09              0.30           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         1000         1000         1000.00         0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       1000         1000         1000.00         0.00              0.00           
node-mem          66150        67831        66695.30        215954.01         464.71         
total-node-mem    66150        67831        66695.30        215954.01         464.71         
total-mem         16843566     16845247     16844111.30     215954.00         464.71         
real-insert-time  3557         3653         3605.40         846.84            29.10          
user-insert-time  0            4000         800.00          2560000.00        1600.00        
sys-insert-time   0            4000         800.00          2560000.00        1600.00        

real	0m1.376s
user	0m0.804s
sys	0m0.284s
$

$ time path-set-test -t 10000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10000        10000        10000.00        0.00              0.00           
line-mem          575270       582313       578730.30       5211830.61        2282.94        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10000        10000        10000.00        0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    17           33           24.20           29.76             5.46           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         10000        10000        10000.00        0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       10000        10000        10000.00        0.00              0.00           
node-mem          665270       672313       668730.30       5211830.61        2282.94        
total-node-mem    665270       672313       668730.30       5211830.61        2282.94        
total-mem         17442686     17449729     17446146.30     5211830.62        2282.94        
real-insert-time  8858         13563        11063.70        2607051.21        1614.64        
user-insert-time  0            8000         3600.00         7840000.00        2800.00        
sys-insert-time   4000         12000        6800.00         6560000.00        2561.25        

real	0m1.430s
user	0m0.856s
sys	0m0.340s
$

$ time path-set-test -t 100000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100000       100000       100000.00       0.00              0.00           
line-mem          5781674      5793647      5789546.10      13557197.89       3682.01        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100000       100000       100000.00       0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    2446         2591         2527.90         2113.29           45.97          
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         100000       100000       100000.00       0.00              0.00           
hash-load         0.05         0.05         0.05            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       100000       100000       100000.00       0.00              0.00           
node-mem          6681674      6693647      6689546.10      13557197.90       3682.01        
total-node-mem    6681674      6693647      6689546.10      13557197.90       3682.01        
total-mem         23459090     23471063     23466962.10     13557197.81       3682.01        
real-insert-time  59908        67455        65378.90        4112167.49        2027.85        
user-insert-time  20002        44003        32002.30        38401600.21       6196.90        
sys-insert-time   12001        44003        26801.60        70566240.64       8400.37        

real	0m2.423s
user	0m1.632s
sys	0m0.796s
$

$ time path-set-test -t 1000000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         830206       830206       830206.00       0.00              0.00           
line-mem          48049857     48049857     48049857.00     -0.50             0.71           
dups-node         0            0            0.00            0.00              0.00           
uniq-node         830206       830206       830206.00       0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    286678       286678       286678.00       0.00              0.00           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         830206       830206       830206.00       0.00              0.00           
hash-load         0.40         0.40         0.40            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       830206       830206       830206.00       0.00              0.00           
node-mem          55521711     55521711     55521711.00     -0.50             0.71           
total-node-mem    55521711     55521711     55521711.00     -0.50             0.71           
total-mem         72299127     72299127     72299127.00     0.00              0.00           
real-insert-time  496873       523581       513783.90       85576894.09       9250.78        
user-insert-time  228015       344021       284018.90       1049712805.29     32399.27       
sys-insert-time   176011       284018       216013.80       924953609.76      30413.05       

real	0m10.173s
user	0m7.724s
sys	0m4.368s
$

$ path-set-test -p dups-line -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-line -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p line-mem -R ...
files       min          max          avg             var               dev
10          417          662          552.30          4583.81           67.70
100         5504         6149         5822.60         40854.24          202.12
1000        57150        58831        57695.30        215954.01         464.71
10000       575270       582313       578730.30       5211830.61        2282.94
100000      5781674      5793647      5789546.10      13557197.89       3682.01
1000000     48049857     48049857     48049857.00     -0.50             0.71
$

$ path-set-test -p dups-node -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-node -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p node-insert-eq -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p node-insert-ne -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            1            0.10            0.09              0.30
10000       17           33           24.20           29.76             5.46
100000      2446         2591         2527.90         2113.29           45.97
1000000     286678       286678       286678.00       0.00              0.00
$

$ path-set-test -p hash-size -R ...
files       min          max          avg             var               dev
10          2097169      2097169      2097169.00      0.00              0.00
100         2097169      2097169      2097169.00      0.00              0.00
1000        2097169      2097169      2097169.00      0.00              0.00
10000       2097169      2097169      2097169.00      0.00              0.00
100000      2097169      2097169      2097169.00      0.00              0.00
1000000     2097169      2097169      2097169.00      0.00              0.00
$

$ path-set-test -p hash-used -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p hash-load -R ...
files       min          max          avg             var               dev
10          0.00         0.00         0.00            0.00              0.00
100         0.00         0.00         0.00            0.00              0.00
1000        0.00         0.00         0.00            0.00              0.00
10000       0.00         0.00         0.00            0.00              0.00
100000      0.05         0.05         0.05            0.00              0.00
1000000     0.40         0.40         0.40            0.00              0.00
$

$ path-set-test -p node-struct-size -R ...
files       min          max          avg             var               dev
10          8            8            8.00            0.00              0.00
100         8            8            8.00            0.00              0.00
1000        8            8            8.00            0.00              0.00
10000       8            8            8.00            0.00              0.00
100000      8            8            8.00            0.00              0.00
1000000     8            8            8.00            0.00              0.00
$

$ path-set-test -p node-struct -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p node-mem -R ...
files       min          max          avg             var               dev
10          507          752          642.30          4583.81           67.70
100         6404         7049         6722.60         40854.24          202.12
1000        66150        67831        66695.30        215954.01         464.71
10000       665270       672313       668730.30       5211830.61        2282.94
100000      6681674      6693647      6689546.10      13557197.90       3682.01
1000000     55521711     55521711     55521711.00     -0.50             0.71
$

$ path-set-test -p total-node-mem -R ...
files       min          max          avg             var               dev
10          507          752          642.30          4583.81           67.70
100         6404         7049         6722.60         40854.24          202.12
1000        66150        67831        66695.30        215954.01         464.71
10000       665270       672313       668730.30       5211830.61        2282.94
100000      6681674      6693647      6689546.10      13557197.90       3682.01
1000000     55521711     55521711     55521711.00     -0.50             0.71
$

$ path-set-test -p total-mem -R ...
files       min          max          avg             var               dev
10          16777923     16778168     16778058.30     4583.75           67.70
100         16783820     16784465     16784138.60     40854.19          202.12
1000        16843566     16845247     16844111.30     215954.00         464.71
10000       17442686     17449729     17446146.30     5211830.62        2282.94
100000      23459090     23471063     23466962.10     13557197.81       3682.01
1000000     72299127     72299127     72299127.00     0.00              0.00
$

$ path-set-test -p real-insert-time -R ...
files       min          max          avg             var               dev
10          996          1937         1381.80         74674.96          273.27
100         2025         2141         2072.30         1666.61           40.82
1000        3557         3653         3605.40         846.84            29.10
10000       8858         13563        11063.70        2607051.21        1614.64
100000      59908        67455        65378.90        4112167.49        2027.85
1000000     496873       523581       513783.90       85576894.09       9250.78
$

$ path-set-test -p user-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            4000         400.00          1440000.00        1200.00
1000        0            4000         800.00          2560000.00        1600.00
10000       0            8000         3600.00         7840000.00        2800.00
100000      20002        44003        32002.30        38401600.21       6196.90
1000000     228015       344021       284018.90       1049712805.29     32399.27
$

$ path-set-test -p sys-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         800.00          2560000.00        1600.00
10000       4000         12000        6800.00         6560000.00        2561.25
100000      12001        44003        26801.60        70566240.64       8400.37
1000000     176011       284018       216013.80       924953609.76      30413.05
$

$ path-set-test -p dups-line -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-line -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p line-mem -A ...
min: 552
max: 48049857
avg: 9080367.00
var: 307987917134124.00
dev: 17549584.53
$

$ path-set-test -p dups-node -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-node -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p node-insert-eq -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-insert-ne -A ...
min: 0
max: 286678
avg: 48204.83
var: 11374737708.14
dev: 106652.42
$

$ path-set-test -p hash-size -A ...
min: 2097169
max: 2097169
avg: 2097169.00
var: 0.00
dev: 0.00
$

$ path-set-test -p hash-used -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p hash-load -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct-size -A ...
min: 8
max: 8
avg: 8.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p node-mem -A ...
min: 642
max: 55521711
avg: 10492341.00
var: 411221132287554.00
dev: 20278588.02
$

$ path-set-test -p total-node-mem -A ...
min: 642
max: 55521711
avg: 10492341.00
var: 411221132287554.00
dev: 20278588.02
$

$ path-set-test -p total-mem -A ...
min: 16778058
max: 72299127
avg: 27269757.00
var: 411221132287554.00
dev: 20278588.02
$

$ path-set-test -p real-insert-time -A ...
min: 1381
max: 513783
avg: 99547.00
var: 34821868176.33
dev: 186606.18
$

$ path-set-test -p user-insert-time -A ...
min: 0
max: 284018
avg: 53470.00
var: 10758311154.67
dev: 103722.28
$

$ path-set-test -p sys-insert-time -A ...
min: 0
max: 216013
avg: 41735.67
var: 6162599089.56
dev: 78502.22
$

