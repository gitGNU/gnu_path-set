#
# # meta command:
# $ path-set-test \
# --input=tests/files2.txt \
# --expr='10 ** x' \
# --limits=1-6 \
# --pool-size=512M \
# --hash-size=2M \
# --node-size=4M \
# --separators='/.-' \
# --repeat=10 \
# --sleep=100 \
# --plain-set \
# --gnulib-hash \
# --run-tests
#

$ date +'%Y-%m-%d %H:%M:%S.%N %z'
2016-09-29 13:37:18.095705470 +0300
$

$ ./path-set -C
CONFIG_PATH_TRIE_NODE_32BIT_OFFSETS: yes
CONFIG_PATH_TRIE_ELEM_32BIT_OFFSETS: yes
CONFIG_PATH_TRIE_UINT_HASH_IDENTOP:  no
CONFIG_TRIE_PATH_SET_PRINT_SET:      no
CONFIG_VALUE_TYPE_SIZE:              64
32BIT:                               no
DEBUG:                               yes
OPT:                                 -
$

$ ./path-set --plain-set --gnulib-hash -I
node-struct-size: 16
$

$ ./path-set --plain-set --gnulib-hash -N
dups-line
uniq-line
line-mem
dups-node
uniq-node
node-insert-eq
node-insert-ne
node-rehash-eq
node-rehash-ne
hash-size
hash-used
hash-load
node-struct-size
node-struct
node-mem
total-node-mem
total-mem
insert-time
$

$ PATH_SET_TEST_INPUT=tests/files2.txt
$ PATH_SET_TEST_POOL_SIZE=512M
$ PATH_SET_TEST_HASH_SIZE=2M
$ PATH_SET_TEST_NODE_SIZE=4M
$ PATH_SET_TEST_STRUCT_TYPE=plain-set
$ PATH_SET_TEST_SET_TYPE=gnulib-hash
$ PATH_SET_TEST_SEPARATORS='/.-'
$

$ time path-set-test -t 10
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10           10           10.00           0.00              0.00           
line-mem          535          672          597.20          2312.36           48.09          
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10           10           10.00           0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            0            0.00            0.00              0.00           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         10           10           10.00           0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       10           10           10.00           0.00              0.00           
node-mem          705          842          767.20          2312.36           48.09          
total-node-mem    705          842          767.20          2312.36           48.09          
total-mem         41944065     41944202     41944127.20     2312.00           48.08          
real-insert-time  1602         2796         2099.70         114986.61         339.10         
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m1.490s
user	0m0.908s
sys	0m0.304s
$

$ time path-set-test -t 100
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100          100          100.00          0.00              0.00           
line-mem          5481         6042         5832.40         26831.84          163.80         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100          100          100.00          0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            1            0.10            0.09              0.30           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         99           100          99.90           0.09              0.30           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       100          100          100.00          0.00              0.00           
node-mem          7181         7742         7532.40         26831.84          163.80         
total-node-mem    7181         7742         7532.40         26831.84          163.80         
total-mem         41950557     41951102     41950894.00     25730.50          160.41         
real-insert-time  5213         5716         5570.50         24041.85          155.05         
user-insert-time  0            4000         1600.00         3840000.00        1959.59        
sys-insert-time   0            4000         2400.00         3840000.00        1959.59        

real	0m1.506s
user	0m0.892s
sys	0m0.324s
$

$ time path-set-test -t 1000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         1000         1000         1000.00         0.00              0.00           
line-mem          56144        58269        57419.10        433919.89         658.73         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         1000         1000         1000.00         0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            0            0.00            0.00              0.00           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         1000         1000         1000.00         0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       1000         1000         1000.00         0.00              0.00           
node-mem          73144        75269        74419.10        433919.89         658.73         
total-node-mem    73144        75269        74419.10        433919.89         658.73         
total-mem         42016504     42018629     42017779.10     433919.50         658.73         
real-insert-time  5643         7200         6743.40         314330.04         560.65         
user-insert-time  0            4000         1600.00         3840000.00        1959.59        
sys-insert-time   0            8000         4400.00         4640000.00        2154.07        

real	0m1.523s
user	0m0.856s
sys	0m0.352s
$

$ time path-set-test -t 10000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10000        10000        10000.00        0.00              0.00           
line-mem          577026       583862       580463.80       3988043.96        1997.01        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10000        10000        10000.00        0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    16           28           22.30           11.81             3.44           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         9972         9984         9977.70         11.81             3.44           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       10000        10000        10000.00        0.00              0.00           
node-mem          747026       753862       750463.80       3988043.96        1997.01        
total-node-mem    747026       753862       750463.80       3988043.96        1997.01        
total-mem         42690738     42697542     42694180.60     4035308.75        2008.81        
real-insert-time  12516        16580        14607.10        2257022.89        1502.34        
user-insert-time  0            12000        5600.10         10240480.09       3200.08        
sys-insert-time   4000         12000        7600.20         4640160.16        2154.10        

real	0m1.644s
user	0m0.948s
sys	0m0.416s
$

$ time path-set-test -t 100000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100000       100000       100000.00       0.00              0.00           
line-mem          5775054      5795032      5787184.40      30735610.04       5543.97        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100000       100000       100000.00       0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    1855         1950         1912.50         1226.25           35.02          
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         98064        98172        98112.00        1273.20           35.68          
hash-load         0.04         0.04         0.04            0.00              0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       100000       100000       100000.00       0.00              0.00           
node-mem          7475054      7495032      7487184.40      30735610.03       5543.97        
total-node-mem    7475054      7495032      7487184.40      30735610.03       5543.97        
total-mem         49447870     49467864     49460752.40     32838874.00       5730.52        
real-insert-time  72835        76859        74996.40        1685889.24        1298.42        
user-insert-time  36002        56003        47202.50        53764001.45       7332.39        
sys-insert-time   16001        48003        35201.90        66567040.69       8158.86        

real	0m2.632s
user	0m1.848s
sys	0m0.764s
$

$ time path-set-test -t 1000000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         830206       830206       830206.00       0.00              0.00           
line-mem          48049857     48049857     48049857.00     -0.50             0.71           
dups-node         0            0            0.00            0.00              0.00           
uniq-node         830206       830206       830206.00       0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    131735       131735       131735.00       0.00              0.00           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         711483       711483       711483.00       0.00              0.00           
hash-load         0.27         0.27         0.27            -0.00             0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       830206       830206       830206.00       0.00              0.00           
node-mem          62163359     62163359     62163359.00     0.00              0.00           
total-node-mem    62163359     62163359     62163359.00     0.00              0.00           
total-mem         106006287    106006287    106006287.00    0.00              0.00           
real-insert-time  548833       584530       562380.30       130227312.01      11411.72       
user-insert-time  288016       384027       341620.00       794409615.00      28185.27       
sys-insert-time   188011       260016       225214.80       464241285.56      21546.26       

real	0m10.813s
user	0m8.301s
sys	0m4.348s
$

$ path-set-test -p dups-line -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-line -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p line-mem -R ...
files       min          max          avg             var               dev
10          535          672          597.20          2312.36           48.09
100         5481         6042         5832.40         26831.84          163.80
1000        56144        58269        57419.10        433919.89         658.73
10000       577026       583862       580463.80       3988043.96        1997.01
100000      5775054      5795032      5787184.40      30735610.04       5543.97
1000000     48049857     48049857     48049857.00     -0.50             0.71
$

$ path-set-test -p dups-node -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-node -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p node-insert-eq -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p node-insert-ne -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            1            0.10            0.09              0.30
1000        0            0            0.00            0.00              0.00
10000       16           28           22.30           11.81             3.44
100000      1855         1950         1912.50         1226.25           35.02
1000000     131735       131735       131735.00       0.00              0.00
$

$ path-set-test -p node-rehash-eq -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p node-rehash-ne -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p hash-size -R ...
files       min          max          avg             var               dev
10          2621447      2621447      2621447.00      0.00              0.00
100         2621447      2621447      2621447.00      0.00              0.00
1000        2621447      2621447      2621447.00      0.00              0.00
10000       2621447      2621447      2621447.00      0.00              0.00
100000      2621447      2621447      2621447.00      0.00              0.00
1000000     2621447      2621447      2621447.00      0.00              0.00
$

$ path-set-test -p hash-used -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         99           100          99.90           0.09              0.30
1000        1000         1000         1000.00         0.00              0.00
10000       9972         9984         9977.70         11.81             3.44
100000      98064        98172        98112.00        1273.20           35.68
1000000     711483       711483       711483.00       0.00              0.00
$

$ path-set-test -p hash-load -R ...
files       min          max          avg             var               dev
10          0.00         0.00         0.00            0.00              0.00
100         0.00         0.00         0.00            0.00              0.00
1000        0.00         0.00         0.00            0.00              0.00
10000       0.00         0.00         0.00            0.00              0.00
100000      0.04         0.04         0.04            0.00              0.00
1000000     0.27         0.27         0.27            -0.00             0.00
$

$ path-set-test -p node-struct-size -R ...
files       min          max          avg             var               dev
10          16           16           16.00           0.00              0.00
100         16           16           16.00           0.00              0.00
1000        16           16           16.00           0.00              0.00
10000       16           16           16.00           0.00              0.00
100000      16           16           16.00           0.00              0.00
1000000     16           16           16.00           0.00              0.00
$

$ path-set-test -p node-struct -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p node-mem -R ...
files       min          max          avg             var               dev
10          705          842          767.20          2312.36           48.09
100         7181         7742         7532.40         26831.84          163.80
1000        73144        75269        74419.10        433919.89         658.73
10000       747026       753862       750463.80       3988043.96        1997.01
100000      7475054      7495032      7487184.40      30735610.03       5543.97
1000000     62163359     62163359     62163359.00     0.00              0.00
$

$ path-set-test -p total-node-mem -R ...
files       min          max          avg             var               dev
10          705          842          767.20          2312.36           48.09
100         7181         7742         7532.40         26831.84          163.80
1000        73144        75269        74419.10        433919.89         658.73
10000       747026       753862       750463.80       3988043.96        1997.01
100000      7475054      7495032      7487184.40      30735610.03       5543.97
1000000     62163359     62163359     62163359.00     0.00              0.00
$

$ path-set-test -p total-mem -R ...
files       min          max          avg             var               dev
10          41944065     41944202     41944127.20     2312.00           48.08
100         41950557     41951102     41950894.00     25730.50          160.41
1000        42016504     42018629     42017779.10     433919.50         658.73
10000       42690738     42697542     42694180.60     4035308.75        2008.81
100000      49447870     49467864     49460752.40     32838874.00       5730.52
1000000     106006287    106006287    106006287.00    0.00              0.00
$

$ path-set-test -p real-insert-time -R ...
files       min          max          avg             var               dev
10          1602         2796         2099.70         114986.61         339.10
100         5213         5716         5570.50         24041.85          155.05
1000        5643         7200         6743.40         314330.04         560.65
10000       12516        16580        14607.10        2257022.89        1502.34
100000      72835        76859        74996.40        1685889.24        1298.42
1000000     548833       584530       562380.30       130227312.01      11411.72
$

$ path-set-test -p user-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            4000         1600.00         3840000.00        1959.59
1000        0            4000         1600.00         3840000.00        1959.59
10000       0            12000        5600.10         10240480.09       3200.08
100000      36002        56003        47202.50        53764001.45       7332.39
1000000     288016       384027       341620.00       794409615.00      28185.27
$

$ path-set-test -p sys-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            4000         2400.00         3840000.00        1959.59
1000        0            8000         4400.00         4640000.00        2154.07
10000       4000         12000        7600.20         4640160.16        2154.10
100000      16001        48003        35201.90        66567040.69       8158.86
1000000     188011       260016       225214.80       464241285.56      21546.26
$

$ path-set-test -p dups-line -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-line -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p line-mem -A ...
min: 597
max: 48049857
avg: 9080225.33
var: 307986262058369.56
dev: 17549537.37
$

$ path-set-test -p dups-node -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-node -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p node-insert-eq -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-insert-ne -A ...
min: 0
max: 131735
avg: 22278.17
var: 2396644365.47
dev: 48955.53
$

$ path-set-test -p node-rehash-eq -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-rehash-ne -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p hash-size -A ...
min: 2621447
max: 2621447
avg: 2621447.00
var: 0.00
dev: 0.00
$

$ path-set-test -p hash-used -A ...
min: 10
max: 711483
avg: 136780.17
var: 67280281717.14
dev: 259384.43
$

$ path-set-test -p hash-load -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct-size -A ...
min: 16
max: 16
avg: 16.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p node-mem -A ...
min: 767
max: 62163359
avg: 11747287.33
var: 515486226413769.56
dev: 22704321.76
$

$ path-set-test -p total-node-mem -A ...
min: 767
max: 62163359
avg: 11747287.33
var: 515486226413769.56
dev: 22704321.76
$

$ path-set-test -p total-mem -A ...
min: 41944127
max: 106006287
avg: 54012336.50
var: 547862993658848.00
dev: 23406473.33
$

$ path-set-test -p real-insert-time -A ...
min: 2099
max: 562380
avg: 111065.83
var: 41362701935.14
dev: 203378.22
$

$ path-set-test -p user-insert-time -A ...
min: 0
max: 341620
avg: 66270.33
var: 15436365120.56
dev: 124243.17
$

$ path-set-test -p sys-insert-time -A ...
min: 0
max: 225214
avg: 45802.50
var: 6576020359.92
dev: 81092.67
$

