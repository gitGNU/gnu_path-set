#
# # meta command:
# $ path-set-test \
# --input=tests/files.txt \
# --expr='10 ** x' \
# --limits=1-6 \
# --pool-size=128M \
# --hash-size=2M \
# --node-size=4M \
# --separators='/.-' \
# --repeat=10 \
# --sleep=100 \
# --plain-set \
# --gnulib-hash \
# --run-tests
#

$ date +'%Y-%m-%d %H:%M:%S.%N %z'
2016-09-29 13:18:09.839855222 +0300
$

$ ./path-set -C
CONFIG_PATH_TRIE_NODE_32BIT_OFFSETS: no
CONFIG_PATH_TRIE_ELEM_32BIT_OFFSETS: no
CONFIG_PATH_TRIE_UINT_HASH_IDENTOP:  no
CONFIG_TRIE_PATH_SET_PRINT_SET:      no
CONFIG_VALUE_TYPE_SIZE:              64
32BIT:                               no
DEBUG:                               yes
OPT:                                 -
$

$ ./path-set --plain-set --gnulib-hash -I
node-struct-size: 16
$

$ ./path-set --plain-set --gnulib-hash -N
dups-line
uniq-line
line-mem
dups-node
uniq-node
node-insert-eq
node-insert-ne
node-rehash-eq
node-rehash-ne
hash-size
hash-used
hash-load
node-struct-size
node-struct
node-mem
total-node-mem
total-mem
insert-time
$

$ PATH_SET_TEST_INPUT=tests/files.txt
$ PATH_SET_TEST_POOL_SIZE=128M
$ PATH_SET_TEST_HASH_SIZE=2M
$ PATH_SET_TEST_NODE_SIZE=4M
$ PATH_SET_TEST_STRUCT_TYPE=plain-set
$ PATH_SET_TEST_SET_TYPE=gnulib-hash
$ PATH_SET_TEST_SEPARATORS='/.-'
$

$ time path-set-test -t 10
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10           10           10.00           0.00              0.00           
line-mem          512          840          693.50          10310.45          101.54         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10           10           10.00           0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            0            0.00            0.00              0.00           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         10           10           10.00           0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       10           10           10.00           0.00              0.00           
node-mem          682          1010         863.50          10310.45          101.54         
total-node-mem    682          1010         863.50          10310.45          101.54         
total-mem         41944042     41944370     41944223.50     10310.25          101.54         
real-insert-time  1339         2501         1994.90         136003.29         368.79         
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            4000         400.00          1440000.00        1200.00        

real	0m1.049s
user	0m0.516s
sys	0m0.232s
$

$ time path-set-test -t 100
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100          100          100.00          0.00              0.00           
line-mem          6234         7094         6581.40         57466.24          239.72         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100          100          100.00          0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            0            0.00            0.00              0.00           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         100          100          100.00          0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       100          100          100.00          0.00              0.00           
node-mem          7934         8794         8281.40         57466.24          239.72         
total-node-mem    7934         8794         8281.40         57466.24          239.72         
total-mem         41951294     41952154     41951641.40     57466.25          239.72         
real-insert-time  4673         5706         5521.70         92123.21          303.52         
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   4000         4000         4000.00         0.00              0.00           

real	0m1.030s
user	0m0.472s
sys	0m0.260s
$

$ time path-set-test -t 1000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         1000         1000         1000.00         0.00              0.00           
line-mem          65315        67138        66066.30        399474.81         632.04         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         1000         1000         1000.00         0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            1            0.10            0.09              0.30           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         999          1000         999.90          0.09              0.30           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       1000         1000         1000.00         0.00              0.00           
node-mem          82315        84138        83066.30        399474.81         632.04         
total-node-mem    82315        84138        83066.30        399474.81         632.04         
total-mem         42025675     42027498     42026427.90     397423.25         630.42         
real-insert-time  4602         7266         6303.80         1072202.56        1035.47        
user-insert-time  0            4000         1200.00         3360000.00        1833.03        
sys-insert-time   0            8000         4400.00         7840000.00        2800.00        

real	0m1.040s
user	0m0.500s
sys	0m0.252s
$

$ time path-set-test -t 10000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10000        10000        10000.00        0.00              0.00           
line-mem          653557       660341       657374.90       3933437.69        1983.29        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10000        10000        10000.00        0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    13           29           19.30           18.01             4.24           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         9971         9987         9980.70         18.01             4.24           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       10000        10000        10000.00        0.00              0.00           
node-mem          823557       830341       827374.90       3933437.69        1983.29        
total-node-mem    823557       830341       827374.90       3933437.69        1983.29        
total-mem         42767381     42773939     42771043.70     3796756.00        1948.53        
real-insert-time  13174        16820        14988.80        1626856.16        1275.48        
user-insert-time  0            16001        6400.20         29443840.16       5426.22        
sys-insert-time   4000         12001        6800.20         6561280.16        2561.50        

real	0m1.163s
user	0m0.568s
sys	0m0.332s
$

$ time path-set-test -t 100000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100000       100000       100000.00       0.00              0.00           
line-mem          6555653      6575529      6566162.00      36875446.60       6072.52        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100000       100000       100000.00       0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    1829         1990         1908.30         2040.81           45.18          
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         98042        98191        98117.80        1755.36           41.90          
hash-load         0.04         0.04         0.04            0.00              0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       100000       100000       100000.00       0.00              0.00           
node-mem          8255653      8275529      8266162.00      36875446.60       6072.52        
total-node-mem    8255653      8275529      8266162.00      36875446.60       6072.52        
total-mem         50228885     50249529     50239637.20     38875819.50       6235.05        
real-insert-time  76085        79560        77823.50        1262343.25        1123.54        
user-insert-time  40002        56003        47202.60        31360960.64       5600.09        
sys-insert-time   16000        40002        31601.70        62249360.81       7889.83        

real	0m2.211s
user	0m1.388s
sys	0m0.816s
$

$ time path-set-test -t 1000000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         405909       405909       405909.00       0.00              0.00           
line-mem          26666438     26666438     26666438.00     0.00              0.00           
dups-node         0            0            0.00            0.00              0.00           
uniq-node         405909       405909       405909.00       0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    31613        31613        31613.00        0.00              0.00           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         375952       375952       375952.00       0.00              0.00           
hash-load         0.14         0.14         0.14            -0.00             0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       405909       405909       405909.00       0.00              0.00           
node-mem          33566891     33566891     33566891.00     -0.25             0.50           
total-node-mem    33566891     33566891     33566891.00     -0.25             0.50           
total-mem         75989563     75989563     75989563.00     0.00              0.00           
real-insert-time  279597       295494       289612.60       22695820.44       4764.01        
user-insert-time  140007       196010       169210.20       246608323.96      15703.77       
sys-insert-time   88005        148010       111606.70       391885364.01      19796.09       

real	0m5.697s
user	0m4.240s
sys	0m2.308s
$

$ path-set-test -p dups-line -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-line -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p line-mem -R ...
files       min          max          avg             var               dev
10          512          840          693.50          10310.45          101.54
100         6234         7094         6581.40         57466.24          239.72
1000        65315        67138        66066.30        399474.81         632.04
10000       653557       660341       657374.90       3933437.69        1983.29
100000      6555653      6575529      6566162.00      36875446.60       6072.52
1000000     26666438     26666438     26666438.00     0.00              0.00
$

$ path-set-test -p dups-node -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-node -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p node-insert-eq -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p node-insert-ne -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            1            0.10            0.09              0.30
10000       13           29           19.30           18.01             4.24
100000      1829         1990         1908.30         2040.81           45.18
1000000     31613        31613        31613.00        0.00              0.00
$

$ path-set-test -p node-rehash-eq -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p node-rehash-ne -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p hash-size -R ...
files       min          max          avg             var               dev
10          2621447      2621447      2621447.00      0.00              0.00
100         2621447      2621447      2621447.00      0.00              0.00
1000        2621447      2621447      2621447.00      0.00              0.00
10000       2621447      2621447      2621447.00      0.00              0.00
100000      2621447      2621447      2621447.00      0.00              0.00
1000000     2621447      2621447      2621447.00      0.00              0.00
$

$ path-set-test -p hash-used -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        999          1000         999.90          0.09              0.30
10000       9971         9987         9980.70         18.01             4.24
100000      98042        98191        98117.80        1755.36           41.90
1000000     375952       375952       375952.00       0.00              0.00
$

$ path-set-test -p hash-load -R ...
files       min          max          avg             var               dev
10          0.00         0.00         0.00            0.00              0.00
100         0.00         0.00         0.00            0.00              0.00
1000        0.00         0.00         0.00            0.00              0.00
10000       0.00         0.00         0.00            0.00              0.00
100000      0.04         0.04         0.04            0.00              0.00
1000000     0.14         0.14         0.14            -0.00             0.00
$

$ path-set-test -p node-struct-size -R ...
files       min          max          avg             var               dev
10          16           16           16.00           0.00              0.00
100         16           16           16.00           0.00              0.00
1000        16           16           16.00           0.00              0.00
10000       16           16           16.00           0.00              0.00
100000      16           16           16.00           0.00              0.00
1000000     16           16           16.00           0.00              0.00
$

$ path-set-test -p node-struct -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p node-mem -R ...
files       min          max          avg             var               dev
10          682          1010         863.50          10310.45          101.54
100         7934         8794         8281.40         57466.24          239.72
1000        82315        84138        83066.30        399474.81         632.04
10000       823557       830341       827374.90       3933437.69        1983.29
100000      8255653      8275529      8266162.00      36875446.60       6072.52
1000000     33566891     33566891     33566891.00     -0.25             0.50
$

$ path-set-test -p total-node-mem -R ...
files       min          max          avg             var               dev
10          682          1010         863.50          10310.45          101.54
100         7934         8794         8281.40         57466.24          239.72
1000        82315        84138        83066.30        399474.81         632.04
10000       823557       830341       827374.90       3933437.69        1983.29
100000      8255653      8275529      8266162.00      36875446.60       6072.52
1000000     33566891     33566891     33566891.00     -0.25             0.50
$

$ path-set-test -p total-mem -R ...
files       min          max          avg             var               dev
10          41944042     41944370     41944223.50     10310.25          101.54
100         41951294     41952154     41951641.40     57466.25          239.72
1000        42025675     42027498     42026427.90     397423.25         630.42
10000       42767381     42773939     42771043.70     3796756.00        1948.53
100000      50228885     50249529     50239637.20     38875819.50       6235.05
1000000     75989563     75989563     75989563.00     0.00              0.00
$

$ path-set-test -p real-insert-time -R ...
files       min          max          avg             var               dev
10          1339         2501         1994.90         136003.29         368.79
100         4673         5706         5521.70         92123.21          303.52
1000        4602         7266         6303.80         1072202.56        1035.47
10000       13174        16820        14988.80        1626856.16        1275.48
100000      76085        79560        77823.50        1262343.25        1123.54
1000000     279597       295494       289612.60       22695820.44       4764.01
$

$ path-set-test -p user-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         1200.00         3360000.00        1833.03
10000       0            16001        6400.20         29443840.16       5426.22
100000      40002        56003        47202.60        31360960.64       5600.09
1000000     140007       196010       169210.20       246608323.96      15703.77
$

$ path-set-test -p sys-insert-time -R ...
files       min          max          avg             var               dev
10          0            4000         400.00          1440000.00        1200.00
100         4000         4000         4000.00         0.00              0.00
1000        0            8000         4400.00         7840000.00        2800.00
10000       4000         12001        6800.20         6561280.16        2561.50
100000      16000        40002        31601.70        62249360.81       7889.83
1000000     88005        148010       111606.70       391885364.01      19796.09
$

$ path-set-test -p dups-line -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-line -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p line-mem -A ...
min: 693
max: 26666438
avg: 5660552.33
var: 93733138631616.23
dev: 9681587.61
$

$ path-set-test -p dups-node -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-node -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p node-insert-eq -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-insert-ne -A ...
min: 0
max: 31613
avg: 5590.00
var: 135922332.33
dev: 11658.57
$

$ path-set-test -p node-rehash-eq -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-rehash-ne -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p hash-size -A ...
min: 2621447
max: 2621447
avg: 2621447.00
var: 0.00
dev: 0.00
$

$ path-set-test -p hash-used -A ...
min: 10
max: 375952
avg: 80859.67
var: 18639624388.89
dev: 136527.01
$

$ path-set-test -p hash-load -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct-size -A ...
min: 16
max: 16
avg: 16.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p node-mem -A ...
min: 863
max: 33566891
avg: 7125439.50
var: 148520965703854.25
dev: 12186917.81
$

$ path-set-test -p total-node-mem -A ...
min: 863
max: 33566891
avg: 7125439.50
var: 148520965703854.25
dev: 12186917.81
$

$ path-set-test -p total-mem -A ...
min: 41944223
max: 75989563
avg: 49153755.67
var: 152787557558889.00
dev: 12360726.42
$

$ path-set-test -p real-insert-time -A ...
min: 1994
max: 289612
avg: 66040.17
var: 10677088937.14
dev: 103330.00
$

$ path-set-test -p user-insert-time -A ...
min: 0
max: 169210
avg: 37335.33
var: 3756481702.22
dev: 61290.14
$

$ path-set-test -p sys-insert-time -A ...
min: 400
max: 111606
avg: 26467.83
var: 1555500871.47
dev: 39439.84
$

