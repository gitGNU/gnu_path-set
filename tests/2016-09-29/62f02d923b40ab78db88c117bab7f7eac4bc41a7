#
# # meta command:
# $ path-set-test \
# --input=tests/files.txt \
# --expr='10 ** x' \
# --limits=1-6 \
# --pool-size=128M \
# --hash-size=2M \
# --node-size=4M \
# --separators='/.-' \
# --repeat=10 \
# --sleep=100 \
# --plain-set \
# --linear-hash \
# --run-tests
#

$ date +'%Y-%m-%d %H:%M:%S.%N %z'
2016-09-29 13:21:56.611362700 +0300
$

$ ./path-set -C
CONFIG_PATH_TRIE_NODE_32BIT_OFFSETS: no
CONFIG_PATH_TRIE_ELEM_32BIT_OFFSETS: no
CONFIG_PATH_TRIE_UINT_HASH_IDENTOP:  no
CONFIG_TRIE_PATH_SET_PRINT_SET:      no
CONFIG_VALUE_TYPE_SIZE:              32
32BIT:                               yes
DEBUG:                               yes
OPT:                                 -
$

$ ./path-set --plain-set --linear-hash -I
node-struct-size: 4
$

$ ./path-set --plain-set --linear-hash -N
dups-line
uniq-line
line-mem
dups-node
uniq-node
node-insert-eq
node-insert-ne
hash-size
hash-used
hash-load
node-struct-size
node-struct
node-mem
total-node-mem
total-mem
insert-time
$

$ PATH_SET_TEST_INPUT=tests/files.txt
$ PATH_SET_TEST_POOL_SIZE=128M
$ PATH_SET_TEST_HASH_SIZE=2M
$ PATH_SET_TEST_NODE_SIZE=4M
$ PATH_SET_TEST_STRUCT_TYPE=plain-set
$ PATH_SET_TEST_SET_TYPE=linear-hash
$ PATH_SET_TEST_SEPARATORS='/.-'
$

$ time path-set-test -t 10
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10           10           10.00           0.00              0.00           
line-mem          543          795          666.20          3905.56           62.49          
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10           10           10.00           0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            0            0.00            0.00              0.00           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         10           10           10.00           0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  4            4            4.00            0.00              0.00           
node-struct       10           10           10.00           0.00              0.00           
node-mem          593          845          716.20          3905.56           62.49          
total-node-mem    593          845          716.20          3905.56           62.49          
total-mem         8389301      8389553      8389424.20      3905.58           62.49          
real-insert-time  620          776          668.70          1557.21           39.46          
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m0.895s
user	0m0.396s
sys	0m0.204s
$

$ time path-set-test -t 100
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100          100          100.00          0.00              0.00           
line-mem          6339         6793         6532.00         16598.40          128.83         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100          100          100.00          0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            0            0.00            0.00              0.00           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         100          100          100.00          0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  4            4            4.00            0.00              0.00           
node-struct       100          100          100.00          0.00              0.00           
node-mem          6839         7293         7032.00         16598.40          128.83         
total-node-mem    6839         7293         7032.00         16598.40          128.83         
total-mem         8395547      8396001      8395740.00      16598.41          128.83         
real-insert-time  688          980          878.90          5552.29           74.51          
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m0.879s
user	0m0.384s
sys	0m0.200s
$

$ time path-set-test -t 1000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         1000         1000         1000.00         0.00              0.00           
line-mem          65017        66465        65532.50        182058.65         426.68         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         1000         1000         1000.00         0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            2            0.40            0.44              0.66           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         1000         1000         1000.00         0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  4            4            4.00            0.00              0.00           
node-struct       1000         1000         1000.00         0.00              0.00           
node-mem          70017        71465        70532.50        182058.65         426.68         
total-node-mem    70017        71465        70532.50        182058.65         426.68         
total-mem         8458725      8460173      8459240.50      182058.66         426.68         
real-insert-time  2761         2939         2850.90         3079.29           55.49          
user-insert-time  0            4000         800.00          2560000.00        1600.00        
sys-insert-time   0            4000         2000.00         4000000.00        2000.00        

real	0m0.909s
user	0m0.412s
sys	0m0.216s
$

$ time path-set-test -t 10000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10000        10000        10000.00        0.00              0.00           
line-mem          653951       660369       656801.70       4962537.81        2227.68        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10000        10000        10000.00        0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    12           34           24.60           26.64             5.16           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         10000        10000        10000.00        0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  4            4            4.00            0.00              0.00           
node-struct       10000        10000        10000.00        0.00              0.00           
node-mem          703951       710369       706801.70       4962537.81        2227.68        
total-node-mem    703951       710369       706801.70       4962537.81        2227.68        
total-mem         9092659      9099077      9095509.70      4962537.83        2227.68        
real-insert-time  10155        13549        11677.20        1312525.56        1145.66        
user-insert-time  0            4000         2000.00         4000000.00        2000.00        
sys-insert-time   0            16001        7600.20         27043360.16       5200.32        

real	0m1.016s
user	0m0.420s
sys	0m0.356s
$

$ time path-set-test -t 100000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100000       100000       100000.00       0.00              0.00           
line-mem          6559788      6578136      6569673.10      34756581.10       5895.47        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100000       100000       100000.00       0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    2625         2774         2702.80         2383.16           48.82          
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         100000       100000       100000.00       0.00              0.00           
hash-load         0.05         0.05         0.05            0.00              0.00           
node-struct-size  4            4            4.00            0.00              0.00           
node-struct       100000       100000       100000.00       0.00              0.00           
node-mem          7059788      7078136      7069673.10      34756581.10       5895.47        
total-node-mem    7059788      7078136      7069673.10      34756581.10       5895.47        
total-mem         15448496     15466844     15458381.10     34756581.12       5895.47        
real-insert-time  74653        78046        76498.40        1337932.24        1156.69        
user-insert-time  32001        56005        40802.60        72975841.24       8542.59        
sys-insert-time   24001        48003        35201.90        47367840.49       6882.43        

real	0m2.229s
user	0m1.344s
sys	0m0.928s
$

$ time path-set-test -t 1000000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         405909       405909       405909.00       0.00              0.00           
line-mem          26666438     26666438     26666438.00     0.00              0.00           
dups-node         0            0            0.00            0.00              0.00           
uniq-node         405909       405909       405909.00       0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    88701        88701        88701.00        0.00              0.00           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         405909       405909       405909.00       0.00              0.00           
hash-load         0.19         0.19         0.19            0.00              0.00           
node-struct-size  4            4            4.00            0.00              0.00           
node-struct       405909       405909       405909.00       0.00              0.00           
node-mem          28695983     28695983     28695983.00     0.00              0.00           
total-node-mem    28695983     28695983     28695983.00     0.00              0.00           
total-mem         37084691     37084691     37084691.00     -0.25             0.50           
real-insert-time  289064       304335       296486.60       36746296.04       6061.87        
user-insert-time  124009       188013       165610.30       323873443.61      17996.48       
sys-insert-time   100005       168010       134007.90       320842802.69      17912.09       

real	0m6.222s
user	0m4.232s
sys	0m2.876s
$

$ path-set-test -p dups-line -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-line -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p line-mem -R ...
files       min          max          avg             var               dev
10          543          795          666.20          3905.56           62.49
100         6339         6793         6532.00         16598.40          128.83
1000        65017        66465        65532.50        182058.65         426.68
10000       653951       660369       656801.70       4962537.81        2227.68
100000      6559788      6578136      6569673.10      34756581.10       5895.47
1000000     26666438     26666438     26666438.00     0.00              0.00
$

$ path-set-test -p dups-node -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-node -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p node-insert-eq -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p node-insert-ne -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            2            0.40            0.44              0.66
10000       12           34           24.60           26.64             5.16
100000      2625         2774         2702.80         2383.16           48.82
1000000     88701        88701        88701.00        0.00              0.00
$

$ path-set-test -p hash-size -R ...
files       min          max          avg             var               dev
10          2097169      2097169      2097169.00      0.00              0.00
100         2097169      2097169      2097169.00      0.00              0.00
1000        2097169      2097169      2097169.00      0.00              0.00
10000       2097169      2097169      2097169.00      0.00              0.00
100000      2097169      2097169      2097169.00      0.00              0.00
1000000     2097169      2097169      2097169.00      0.00              0.00
$

$ path-set-test -p hash-used -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p hash-load -R ...
files       min          max          avg             var               dev
10          0.00         0.00         0.00            0.00              0.00
100         0.00         0.00         0.00            0.00              0.00
1000        0.00         0.00         0.00            0.00              0.00
10000       0.00         0.00         0.00            0.00              0.00
100000      0.05         0.05         0.05            0.00              0.00
1000000     0.19         0.19         0.19            0.00              0.00
$

$ path-set-test -p node-struct-size -R ...
files       min          max          avg             var               dev
10          4            4            4.00            0.00              0.00
100         4            4            4.00            0.00              0.00
1000        4            4            4.00            0.00              0.00
10000       4            4            4.00            0.00              0.00
100000      4            4            4.00            0.00              0.00
1000000     4            4            4.00            0.00              0.00
$

$ path-set-test -p node-struct -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p node-mem -R ...
files       min          max          avg             var               dev
10          593          845          716.20          3905.56           62.49
100         6839         7293         7032.00         16598.40          128.83
1000        70017        71465        70532.50        182058.65         426.68
10000       703951       710369       706801.70       4962537.81        2227.68
100000      7059788      7078136      7069673.10      34756581.10       5895.47
1000000     28695983     28695983     28695983.00     0.00              0.00
$

$ path-set-test -p total-node-mem -R ...
files       min          max          avg             var               dev
10          593          845          716.20          3905.56           62.49
100         6839         7293         7032.00         16598.40          128.83
1000        70017        71465        70532.50        182058.65         426.68
10000       703951       710369       706801.70       4962537.81        2227.68
100000      7059788      7078136      7069673.10      34756581.10       5895.47
1000000     28695983     28695983     28695983.00     0.00              0.00
$

$ path-set-test -p total-mem -R ...
files       min          max          avg             var               dev
10          8389301      8389553      8389424.20      3905.58           62.49
100         8395547      8396001      8395740.00      16598.41          128.83
1000        8458725      8460173      8459240.50      182058.66         426.68
10000       9092659      9099077      9095509.70      4962537.83        2227.68
100000      15448496     15466844     15458381.10     34756581.12       5895.47
1000000     37084691     37084691     37084691.00     -0.25             0.50
$

$ path-set-test -p real-insert-time -R ...
files       min          max          avg             var               dev
10          620          776          668.70          1557.21           39.46
100         688          980          878.90          5552.29           74.51
1000        2761         2939         2850.90         3079.29           55.49
10000       10155        13549        11677.20        1312525.56        1145.66
100000      74653        78046        76498.40        1337932.24        1156.69
1000000     289064       304335       296486.60       36746296.04       6061.87
$

$ path-set-test -p user-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         800.00          2560000.00        1600.00
10000       0            4000         2000.00         4000000.00        2000.00
100000      32001        56005        40802.60        72975841.24       8542.59
1000000     124009       188013       165610.30       323873443.61      17996.48
$

$ path-set-test -p sys-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         2000.00         4000000.00        2000.00
10000       0            16001        7600.20         27043360.16       5200.32
100000      24001        48003        35201.90        47367840.49       6882.43
1000000     100005       168010       134007.90       320842802.69      17912.09
$

$ path-set-test -p dups-line -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-line -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p line-mem -A ...
min: 666
max: 26666438
avg: 5660940.33
var: 93736295216102.89
dev: 9681750.63
$

$ path-set-test -p dups-node -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-node -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p node-insert-eq -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-insert-ne -A ...
min: 0
max: 88701
avg: 15237.83
var: 1080336565.47
dev: 32868.47
$

$ path-set-test -p hash-size -A ...
min: 2097169
max: 2097169
avg: 2097169.00
var: 0.00
dev: 0.00
$

$ path-set-test -p hash-used -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p hash-load -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct-size -A ...
min: 4
max: 4
avg: 4.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p node-mem -A ...
min: 716
max: 28695983
avg: 6091789.50
var: 108547485527943.59
dev: 10418612.46
$

$ path-set-test -p total-node-mem -A ...
min: 716
max: 28695983
avg: 6091789.50
var: 108547485527943.59
dev: 10418612.46
$

$ path-set-test -p total-mem -A ...
min: 8389424
max: 37084691
avg: 14480497.50
var: 108547485527943.56
dev: 10418612.46
$

$ path-set-test -p real-insert-time -A ...
min: 668
max: 296486
avg: 64842.83
var: 11445670988.14
dev: 106984.44
$

$ path-set-test -p user-insert-time -A ...
min: 0
max: 165610
avg: 34868.67
var: 3633528635.56
dev: 60278.76
$

$ path-set-test -p sys-insert-time -A ...
min: 0
max: 134007
avg: 29801.33
var: 2321671606.56
dev: 48183.73
$

