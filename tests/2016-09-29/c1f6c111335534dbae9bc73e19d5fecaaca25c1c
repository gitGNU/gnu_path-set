#
# # meta command:
# $ path-set-test \
# --input=tests/files.txt \
# --expr='10 ** x' \
# --limits=1-6 \
# --pool-size=128M \
# --hash-size=2M \
# --node-size=4M \
# --separators='/.-' \
# --repeat=10 \
# --sleep=100 \
# --plain-set \
# --gnulib-hash \
# --run-tests
#

$ date +'%Y-%m-%d %H:%M:%S.%N %z'
2016-09-29 13:20:09.000582447 +0300
$

$ ./path-set -C
CONFIG_PATH_TRIE_NODE_32BIT_OFFSETS: yes
CONFIG_PATH_TRIE_ELEM_32BIT_OFFSETS: yes
CONFIG_PATH_TRIE_UINT_HASH_IDENTOP:  no
CONFIG_TRIE_PATH_SET_PRINT_SET:      no
CONFIG_VALUE_TYPE_SIZE:              64
32BIT:                               no
DEBUG:                               yes
OPT:                                 -
$

$ ./path-set --plain-set --gnulib-hash -I
node-struct-size: 16
$

$ ./path-set --plain-set --gnulib-hash -N
dups-line
uniq-line
line-mem
dups-node
uniq-node
node-insert-eq
node-insert-ne
node-rehash-eq
node-rehash-ne
hash-size
hash-used
hash-load
node-struct-size
node-struct
node-mem
total-node-mem
total-mem
insert-time
$

$ PATH_SET_TEST_INPUT=tests/files.txt
$ PATH_SET_TEST_POOL_SIZE=128M
$ PATH_SET_TEST_HASH_SIZE=2M
$ PATH_SET_TEST_NODE_SIZE=4M
$ PATH_SET_TEST_STRUCT_TYPE=plain-set
$ PATH_SET_TEST_SET_TYPE=gnulib-hash
$ PATH_SET_TEST_SEPARATORS='/.-'
$

$ time path-set-test -t 10
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10           10           10.00           0.00              0.00           
line-mem          562          761          628.70          3523.41           59.36          
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10           10           10.00           0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            0            0.00            0.00              0.00           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         10           10           10.00           0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       10           10           10.00           0.00              0.00           
node-mem          732          931          798.70          3523.41           59.36          
total-node-mem    732          931          798.70          3523.41           59.36          
total-mem         41944092     41944291     41944158.70     3523.25           59.36          
real-insert-time  1504         2429         2056.30         84446.81          290.60         
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m1.034s
user	0m0.500s
sys	0m0.240s
$

$ time path-set-test -t 100
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100          100          100.00          0.00              0.00           
line-mem          6123         6803         6461.80         48047.36          219.20         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100          100          100.00          0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            0            0.00            0.00              0.00           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         100          100          100.00          0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       100          100          100.00          0.00              0.00           
node-mem          7823         8503         8161.80         48047.36          219.20         
total-node-mem    7823         8503         8161.80         48047.36          219.20         
total-mem         41951183     41951863     41951521.80     48047.50          219.20         
real-insert-time  4702         5727         5489.50         84605.25          290.87         
user-insert-time  0            4000         1600.00         3840000.00        1959.59        
sys-insert-time   0            4000         2400.00         3840000.00        1959.59        

real	0m1.020s
user	0m0.484s
sys	0m0.244s
$

$ time path-set-test -t 1000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         1000         1000         1000.00         0.00              0.00           
line-mem          65301        66600        65822.00        215692.80         464.43         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         1000         1000         1000.00         0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            2            0.50            0.65              0.81           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         998          1000         999.50          0.65              0.81           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       1000         1000         1000.00         0.00              0.00           
node-mem          82301        83600        82822.00        215692.80         464.43         
total-node-mem    82301        83600        82822.00        215692.80         464.43         
total-mem         42025677     42026992     42026190.00     222691.25         471.90         
real-insert-time  5061         7218         6356.60         505988.44         711.33         
user-insert-time  0            4000         400.00          1440000.00        1200.00        
sys-insert-time   0            8000         4800.00         5760000.00        2400.00        

real	0m1.037s
user	0m0.508s
sys	0m0.236s
$

$ time path-set-test -t 10000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10000        10000        10000.00        0.00              0.00           
line-mem          653576       659570       656381.80       4352278.56        2086.21        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10000        10000        10000.00        0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    12           23           18.40           11.44             3.38           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         9977         9988         9981.60         11.44             3.38           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       10000        10000        10000.00        0.00              0.00           
node-mem          823576       829570       826381.80       4352278.56        2086.21        
total-node-mem    823576       829570       826381.80       4352278.56        2086.21        
total-mem         42767256     42773202     42770036.20     4252886.00        2062.25        
real-insert-time  13013        16398        15043.00        1407423.40        1186.35        
user-insert-time  0            8000         2800.00         9760000.00        3124.10        
sys-insert-time   4000         20001        10800.50        22563600.25       4750.12        

real	0m1.160s
user	0m0.508s
sys	0m0.384s
$

$ time path-set-test -t 100000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100000       100000       100000.00       0.00              0.00           
line-mem          6558301      6583643      6569848.40      46048549.04       6785.91        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100000       100000       100000.00       0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    1870         1994         1922.80         1326.96           36.43          
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         98028        98154        98104.10        1278.89           35.76          
hash-load         0.04         0.04         0.04            0.00              0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       100000       100000       100000.00       0.00              0.00           
node-mem          8258301      8283643      8269848.40      46048549.04       6785.91        
total-node-mem    8258301      8283643      8269848.40      46048549.04       6785.91        
total-mem         50231421     50258555     50243542.80     50346995.50       7095.56        
real-insert-time  74796        77718        76570.20        829304.96         910.66         
user-insert-time  32002        60004        44802.20        44167681.36       6645.88        
sys-insert-time   20001        48002        32001.20        80010400.56       8944.85        

real	0m2.193s
user	0m1.428s
sys	0m0.772s
$

$ time path-set-test -t 1000000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         405909       405909       405909.00       0.00              0.00           
line-mem          26666438     26666438     26666438.00     0.00              0.00           
dups-node         0            0            0.00            0.00              0.00           
uniq-node         405909       405909       405909.00       0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    31613        31613        31613.00        0.00              0.00           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         375952       375952       375952.00       0.00              0.00           
hash-load         0.14         0.14         0.14            -0.00             0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       405909       405909       405909.00       0.00              0.00           
node-mem          33566891     33566891     33566891.00     -0.25             0.50           
total-node-mem    33566891     33566891     33566891.00     -0.25             0.50           
total-mem         75989563     75989563     75989563.00     0.00              0.00           
real-insert-time  278234       295474       285613.40       33693849.24       5804.64        
user-insert-time  152010       220012       172011.00       419251203.80      20475.62       
sys-insert-time   68006        136009       107607.30       359872241.81      18970.30       

real	0m5.635s
user	0m4.216s
sys	0m2.252s
$

$ path-set-test -p dups-line -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-line -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p line-mem -R ...
files       min          max          avg             var               dev
10          562          761          628.70          3523.41           59.36
100         6123         6803         6461.80         48047.36          219.20
1000        65301        66600        65822.00        215692.80         464.43
10000       653576       659570       656381.80       4352278.56        2086.21
100000      6558301      6583643      6569848.40      46048549.04       6785.91
1000000     26666438     26666438     26666438.00     0.00              0.00
$

$ path-set-test -p dups-node -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-node -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p node-insert-eq -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p node-insert-ne -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            2            0.50            0.65              0.81
10000       12           23           18.40           11.44             3.38
100000      1870         1994         1922.80         1326.96           36.43
1000000     31613        31613        31613.00        0.00              0.00
$

$ path-set-test -p node-rehash-eq -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p node-rehash-ne -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p hash-size -R ...
files       min          max          avg             var               dev
10          2621447      2621447      2621447.00      0.00              0.00
100         2621447      2621447      2621447.00      0.00              0.00
1000        2621447      2621447      2621447.00      0.00              0.00
10000       2621447      2621447      2621447.00      0.00              0.00
100000      2621447      2621447      2621447.00      0.00              0.00
1000000     2621447      2621447      2621447.00      0.00              0.00
$

$ path-set-test -p hash-used -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        998          1000         999.50          0.65              0.81
10000       9977         9988         9981.60         11.44             3.38
100000      98028        98154        98104.10        1278.89           35.76
1000000     375952       375952       375952.00       0.00              0.00
$

$ path-set-test -p hash-load -R ...
files       min          max          avg             var               dev
10          0.00         0.00         0.00            0.00              0.00
100         0.00         0.00         0.00            0.00              0.00
1000        0.00         0.00         0.00            0.00              0.00
10000       0.00         0.00         0.00            0.00              0.00
100000      0.04         0.04         0.04            0.00              0.00
1000000     0.14         0.14         0.14            -0.00             0.00
$

$ path-set-test -p node-struct-size -R ...
files       min          max          avg             var               dev
10          16           16           16.00           0.00              0.00
100         16           16           16.00           0.00              0.00
1000        16           16           16.00           0.00              0.00
10000       16           16           16.00           0.00              0.00
100000      16           16           16.00           0.00              0.00
1000000     16           16           16.00           0.00              0.00
$

$ path-set-test -p node-struct -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p node-mem -R ...
files       min          max          avg             var               dev
10          732          931          798.70          3523.41           59.36
100         7823         8503         8161.80         48047.36          219.20
1000        82301        83600        82822.00        215692.80         464.43
10000       823576       829570       826381.80       4352278.56        2086.21
100000      8258301      8283643      8269848.40      46048549.04       6785.91
1000000     33566891     33566891     33566891.00     -0.25             0.50
$

$ path-set-test -p total-node-mem -R ...
files       min          max          avg             var               dev
10          732          931          798.70          3523.41           59.36
100         7823         8503         8161.80         48047.36          219.20
1000        82301        83600        82822.00        215692.80         464.43
10000       823576       829570       826381.80       4352278.56        2086.21
100000      8258301      8283643      8269848.40      46048549.04       6785.91
1000000     33566891     33566891     33566891.00     -0.25             0.50
$

$ path-set-test -p total-mem -R ...
files       min          max          avg             var               dev
10          41944092     41944291     41944158.70     3523.25           59.36
100         41951183     41951863     41951521.80     48047.50          219.20
1000        42025677     42026992     42026190.00     222691.25         471.90
10000       42767256     42773202     42770036.20     4252886.00        2062.25
100000      50231421     50258555     50243542.80     50346995.50       7095.56
1000000     75989563     75989563     75989563.00     0.00              0.00
$

$ path-set-test -p real-insert-time -R ...
files       min          max          avg             var               dev
10          1504         2429         2056.30         84446.81          290.60
100         4702         5727         5489.50         84605.25          290.87
1000        5061         7218         6356.60         505988.44         711.33
10000       13013        16398        15043.00        1407423.40        1186.35
100000      74796        77718        76570.20        829304.96         910.66
1000000     278234       295474       285613.40       33693849.24       5804.64
$

$ path-set-test -p user-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            4000         1600.00         3840000.00        1959.59
1000        0            4000         400.00          1440000.00        1200.00
10000       0            8000         2800.00         9760000.00        3124.10
100000      32002        60004        44802.20        44167681.36       6645.88
1000000     152010       220012       172011.00       419251203.80      20475.62
$

$ path-set-test -p sys-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            4000         2400.00         3840000.00        1959.59
1000        0            8000         4800.00         5760000.00        2400.00
10000       4000         20001        10800.50        22563600.25       4750.12
100000      20001        48002        32001.20        80010400.56       8944.85
1000000     68006        136009       107607.30       359872241.81      18970.30
$

$ path-set-test -p dups-line -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-line -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p line-mem -A ...
min: 628
max: 26666438
avg: 5660929.67
var: 93736713482836.22
dev: 9681772.23
$

$ path-set-test -p dups-node -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-node -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p node-insert-eq -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-insert-ne -A ...
min: 0
max: 31613
avg: 5592.17
var: 135907034.81
dev: 11657.92
$

$ path-set-test -p node-rehash-eq -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-rehash-ne -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p hash-size -A ...
min: 2621447
max: 2621447
avg: 2621447.00
var: 0.00
dev: 0.00
$

$ path-set-test -p hash-used -A ...
min: 10
max: 375952
avg: 80857.67
var: 18639526004.89
dev: 136526.65
$

$ path-set-test -p hash-load -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct-size -A ...
min: 16
max: 16
avg: 16.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p node-mem -A ...
min: 798
max: 33566891
avg: 7125816.83
var: 148525466062542.47
dev: 12187102.45
$

$ path-set-test -p total-node-mem -A ...
min: 798
max: 33566891
avg: 7125816.83
var: 148525466062542.47
dev: 12187102.45
$

$ path-set-test -p total-mem -A ...
min: 41944158
max: 75989563
avg: 49154168.33
var: 152792123381086.00
dev: 12360911.11
$

$ path-set-test -p real-insert-time -A ...
min: 2056
max: 285613
avg: 65187.83
var: 10373679303.81
dev: 101851.26
$

$ path-set-test -p user-insert-time -A ...
min: 0
max: 172011
avg: 36935.50
var: 3903362727.25
dev: 62476.90
$

$ path-set-test -p sys-insert-time -A ...
min: 0
max: 107607
avg: 26268.00
var: 1434787251.00
dev: 37878.59
$

