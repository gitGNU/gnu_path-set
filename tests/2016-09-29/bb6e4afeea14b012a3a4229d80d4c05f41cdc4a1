#
# # meta command:
# $ path-set-test \
# --input=tests/files.txt \
# --expr='10 ** x' \
# --limits=1-6 \
# --pool-size=128M \
# --hash-size=2M \
# --node-size=4M \
# --separators='/' \
# --repeat=10 \
# --sleep=100 \
# --plain-set \
# --ternary-tree \
# --run-tests
#

$ date +'%Y-%m-%d %H:%M:%S.%N %z'
2016-09-29 13:15:45.689869043 +0300
$

$ ./path-set -C
CONFIG_PATH_TRIE_NODE_32BIT_OFFSETS: no
CONFIG_PATH_TRIE_ELEM_32BIT_OFFSETS: no
CONFIG_PATH_TRIE_UINT_HASH_IDENTOP:  no
CONFIG_TRIE_PATH_SET_PRINT_SET:      no
CONFIG_VALUE_TYPE_SIZE:              32
32BIT:                               yes
DEBUG:                               yes
OPT:                                 -
$

$ ./path-set --plain-set --ternary-tree -I
node-struct-size: 16
$

$ ./path-set --plain-set --ternary-tree -N
dups-line
uniq-line
line-mem
dups-node
uniq-node
node-insert-eq
node-insert-lt
node-insert-gt
node-struct-size
node-struct
node-mem
total-node-mem
total-mem
insert-time
$

$ PATH_SET_TEST_INPUT=tests/files.txt
$ PATH_SET_TEST_POOL_SIZE=128M
$ PATH_SET_TEST_HASH_SIZE=2M
$ PATH_SET_TEST_NODE_SIZE=4M
$ PATH_SET_TEST_STRUCT_TYPE=plain-set
$ PATH_SET_TEST_SET_TYPE=ternary-tree
$ PATH_SET_TEST_SEPARATORS='/'
$

$ time path-set-test -t 10
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10           10           10.00           0.00              0.00           
line-mem          589          733          671.10          1748.09           41.81          
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10           10           10.00           0.00              0.00           
node-insert-eq    130          185          164.40          284.84            16.88          
node-insert-lt    3            17           8.60            21.84             4.67           
node-insert-gt    4            12           7.90            7.69              2.77           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       432          579          516.70          1923.01           43.85          
node-mem          6912         9264         8267.20         492290.56         701.63         
total-node-mem    6912         9264         8267.20         492290.56         701.63         
total-mem         6940         9292         8295.20         492290.56         701.63         
real-insert-time  32           39           35.70           6.61              2.57           
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m0.849s
user	0m0.364s
sys	0m0.212s
$

$ time path-set-test -t 100
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100          100          100.00          0.00              0.00           
line-mem          6295         6753         6512.80         17319.56          131.60         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100          100          100.00          0.00              0.00           
node-insert-eq    2591         2892         2715.90         8832.69           93.98          
node-insert-lt    125          255          184.40          1885.44           43.42          
node-insert-gt    141          225          173.40          660.04            25.69          
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       3666         4255         3896.90         23420.69          153.04         
node-mem          58656        68080        62350.40        5995696.64        2448.61        
total-node-mem    58656        68080        62350.40        5995696.64        2448.61        
total-mem         58684        68108        62378.40        5995696.64        2448.61        
real-insert-time  170          329          215.40          1611.44           40.14          
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m0.872s
user	0m0.380s
sys	0m0.192s
$

$ time path-set-test -t 1000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         1000         1000         1000.00         0.00              0.00           
line-mem          64707        67111        65772.40        552433.24         743.26         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         1000         1000         1000.00         0.00              0.00           
node-insert-eq    39053        40364        39547.50        169391.85         411.57         
node-insert-lt    1832         3702         2456.50         266572.25         516.31         
node-insert-gt    2085         3770         2868.00         216561.60         465.36         
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       26346        27991        27224.90        270209.09         519.82         
node-mem          421536       447856       435598.40       69173527.04       8317.06        
total-node-mem    421536       447856       435598.40       69173527.04       8317.06        
total-mem         421564       447884       435626.40       69173527.04       8317.06        
real-insert-time  2904         3458         3214.20         20013.56          141.47         
user-insert-time  0            4000         2400.00         3840000.00        1959.59        
sys-insert-time   0            4000         800.00          2560000.00        1600.00        

real	0m0.927s
user	0m0.432s
sys	0m0.200s
$

$ time path-set-test -t 10000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10000        10000        10000.00        0.00              0.00           
line-mem          652865       658353       655638.80       2894800.16        1701.41        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10000        10000        10000.00        0.00              0.00           
node-insert-eq    481466       488047       484432.70       3434128.81        1853.14        
node-insert-lt    32777        42310        34908.30        7976195.21        2824.22        
node-insert-gt    36203        44416        38788.40        6701845.64        2588.79        
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       180283       182188       181206.10       350859.89         592.33         
node-mem          2884528      2915008      2899297.60      89820131.84       9477.35        
total-node-mem    2884528      2915008      2899297.60      89820131.84       9477.35        
total-mem         2884556      2915036      2899325.60      89820131.84       9477.35        
real-insert-time  16501        21128        19196.70        2617126.61        1617.75        
user-insert-time  8000         28001        15600.50        36643600.25       6053.40        
sys-insert-time   0            20001        5200.10         32162960.09       5671.24        

real	0m1.146s
user	0m0.616s
sys	0m0.268s
$

$ time path-set-test -t 100000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100000       100000       100000.00       0.00              0.00           
line-mem          6559818      6576998      6569573.50      23659798.65       4864.13        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100000       100000       100000.00       0.00              0.00           
node-insert-eq    5429971      5444409      5439209.10      15440827.30       3929.48        
node-insert-lt    416260       547260       466183.00       1685134057.20     41050.38       
node-insert-gt    419235       651362       482078.30       3618091760.01     60150.58       
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       1226672      1234423      1230364.40      3948358.44        1987.05        
node-mem          19626752     19750768     19685830.40     1010779760.69     31792.76       
total-node-mem    19626752     19750768     19685830.40     1010779760.69     31792.76       
total-mem         19626780     19750796     19685858.40     1010779760.69     31792.76       
real-insert-time  153525       160183       156310.30       4358876.81        2087.79        
user-insert-time  72004        144010       118806.80       352214722.96      18767.38       
sys-insert-time   32000        60004        43602.30        52653841.41       7256.30        

real	0m3.045s
user	0m2.228s
sys	0m0.880s
$

$ time path-set-test -t 1000000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         405909       405909       405909.00       0.00              0.00           
line-mem          26666438     26666438     26666438.00     0.00              0.00           
dups-node         0            0            0.00            0.00              0.00           
uniq-node         405909       405909       405909.00       0.00              0.00           
node-insert-eq    23077486     23077486     23077486.00     0.00              0.00           
node-insert-lt    1986181      2521733      2211468.50      34251769905.45    185072.34      
node-insert-gt    2034561      2470189      2215735.90      15444519418.89    124275.98      
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       3994861      3994861      3994861.00      0.00              0.00           
node-mem          63917776     63917776     63917776.00     0.00              0.00           
total-node-mem    63917776     63917776     63917776.00     0.00              0.00           
total-mem         63917804     63917804     63917804.00     0.00              0.00           
real-insert-time  628203       651970       641307.50       50925407.45       7136.20        
user-insert-time  396027       520037       460429.20       1448019850.76     38052.86       
sys-insert-time   144007       212014       175210.90       463450245.49      21527.89       

real	0m9.697s
user	0m7.792s
sys	0m2.932s
$

$ path-set-test -p dups-line -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-line -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p line-mem -R ...
files       min          max          avg             var               dev
10          589          733          671.10          1748.09           41.81
100         6295         6753         6512.80         17319.56          131.60
1000        64707        67111        65772.40        552433.24         743.26
10000       652865       658353       655638.80       2894800.16        1701.41
100000      6559818      6576998      6569573.50      23659798.65       4864.13
1000000     26666438     26666438     26666438.00     0.00              0.00
$

$ path-set-test -p dups-node -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-node -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p node-insert-eq -R ...
files       min          max          avg             var               dev
10          130          185          164.40          284.84            16.88
100         2591         2892         2715.90         8832.69           93.98
1000        39053        40364        39547.50        169391.85         411.57
10000       481466       488047       484432.70       3434128.81        1853.14
100000      5429971      5444409      5439209.10      15440827.30       3929.48
1000000     23077486     23077486     23077486.00     0.00              0.00
$

$ path-set-test -p node-insert-lt -R ...
files       min          max          avg             var               dev
10          3            17           8.60            21.84             4.67
100         125          255          184.40          1885.44           43.42
1000        1832         3702         2456.50         266572.25         516.31
10000       32777        42310        34908.30        7976195.21        2824.22
100000      416260       547260       466183.00       1685134057.20     41050.38
1000000     1986181      2521733      2211468.50      34251769905.45    185072.34
$

$ path-set-test -p node-insert-gt -R ...
files       min          max          avg             var               dev
10          4            12           7.90            7.69              2.77
100         141          225          173.40          660.04            25.69
1000        2085         3770         2868.00         216561.60         465.36
10000       36203        44416        38788.40        6701845.64        2588.79
100000      419235       651362       482078.30       3618091760.01     60150.58
1000000     2034561      2470189      2215735.90      15444519418.89    124275.98
$

$ path-set-test -p node-struct-size -R ...
files       min          max          avg             var               dev
10          16           16           16.00           0.00              0.00
100         16           16           16.00           0.00              0.00
1000        16           16           16.00           0.00              0.00
10000       16           16           16.00           0.00              0.00
100000      16           16           16.00           0.00              0.00
1000000     16           16           16.00           0.00              0.00
$

$ path-set-test -p node-struct -R ...
files       min          max          avg             var               dev
10          432          579          516.70          1923.01           43.85
100         3666         4255         3896.90         23420.69          153.04
1000        26346        27991        27224.90        270209.09         519.82
10000       180283       182188       181206.10       350859.89         592.33
100000      1226672      1234423      1230364.40      3948358.44        1987.05
1000000     3994861      3994861      3994861.00      0.00              0.00
$

$ path-set-test -p node-mem -R ...
files       min          max          avg             var               dev
10          6912         9264         8267.20         492290.56         701.63
100         58656        68080        62350.40        5995696.64        2448.61
1000        421536       447856       435598.40       69173527.04       8317.06
10000       2884528      2915008      2899297.60      89820131.84       9477.35
100000      19626752     19750768     19685830.40     1010779760.69     31792.76
1000000     63917776     63917776     63917776.00     0.00              0.00
$

$ path-set-test -p total-node-mem -R ...
files       min          max          avg             var               dev
10          6912         9264         8267.20         492290.56         701.63
100         58656        68080        62350.40        5995696.64        2448.61
1000        421536       447856       435598.40       69173527.04       8317.06
10000       2884528      2915008      2899297.60      89820131.84       9477.35
100000      19626752     19750768     19685830.40     1010779760.69     31792.76
1000000     63917776     63917776     63917776.00     0.00              0.00
$

$ path-set-test -p total-mem -R ...
files       min          max          avg             var               dev
10          6940         9292         8295.20         492290.56         701.63
100         58684        68108        62378.40        5995696.64        2448.61
1000        421564       447884       435626.40       69173527.04       8317.06
10000       2884556      2915036      2899325.60      89820131.84       9477.35
100000      19626780     19750796     19685858.40     1010779760.69     31792.76
1000000     63917804     63917804     63917804.00     0.00              0.00
$

$ path-set-test -p real-insert-time -R ...
files       min          max          avg             var               dev
10          32           39           35.70           6.61              2.57
100         170          329          215.40          1611.44           40.14
1000        2904         3458         3214.20         20013.56          141.47
10000       16501        21128        19196.70        2617126.61        1617.75
100000      153525       160183       156310.30       4358876.81        2087.79
1000000     628203       651970       641307.50       50925407.45       7136.20
$

$ path-set-test -p user-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         2400.00         3840000.00        1959.59
10000       8000         28001        15600.50        36643600.25       6053.40
100000      72004        144010       118806.80       352214722.96      18767.38
1000000     396027       520037       460429.20       1448019850.76     38052.86
$

$ path-set-test -p sys-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         800.00          2560000.00        1600.00
10000       0            20001        5200.10         32162960.09       5671.24
100000      32000        60004        43602.30        52653841.41       7256.30
1000000     144007       212014       175210.90       463450245.49      21527.89
$

$ path-set-test -p dups-line -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-line -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p line-mem -A ...
min: 671
max: 26666438
avg: 5660767.33
var: 93737785699463.91
dev: 9681827.60
$

$ path-set-test -p dups-node -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-node -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p node-insert-eq -A ...
min: 164
max: 23077486
avg: 4840592.17
var: 70300600867977.12
dev: 8384545.36
$

$ path-set-test -p node-insert-lt -A ...
min: 8
max: 2211468
avg: 452534.50
var: 646736182781.92
dev: 804199.09
$

$ path-set-test -p node-insert-gt -A ...
min: 7
max: 2215735
avg: 456608.17
var: 648741240909.14
dev: 805444.75
$

$ path-set-test -p node-struct-size -A ...
min: 16
max: 16
avg: 16.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct -A ...
min: 516
max: 3994861
avg: 906344.50
var: 2096256678569.92
dev: 1447845.53
$

$ path-set-test -p node-mem -A ...
min: 8267
max: 63917776
avg: 14501519.67
var: 536641530049392.88
dev: 23165524.60
$

$ path-set-test -p total-node-mem -A ...
min: 8267
max: 63917776
avg: 14501519.67
var: 536641530049392.88
dev: 23165524.60
$

$ path-set-test -p total-mem -A ...
min: 8295
max: 63917804
avg: 14501547.67
var: 536641530049392.94
dev: 23165524.60
$

$ path-set-test -p real-insert-time -A ...
min: 35
max: 641307
avg: 136712.83
var: 53990659203.81
dev: 232358.90
$

$ path-set-test -p user-insert-time -A ...
min: 0
max: 460429
avg: 99539.17
var: 27818429245.47
dev: 166788.58
$

$ path-set-test -p sys-insert-time -A ...
min: 0
max: 175210
avg: 37468.67
var: 4033992102.22
dev: 63513.72
$

