#
# # meta command:
# $ path-set-test \
# --input=tests/files2.txt \
# --expr='10 ** x' \
# --limits=1-6 \
# --pool-size=512M \
# --hash-size=2M \
# --node-size=4M \
# --separators='/.-' \
# --repeat=10 \
# --sleep=100 \
# --plain-set \
# --ternary-tree \
# --run-tests
#

$ date +'%Y-%m-%d %H:%M:%S.%N %z'
2016-09-29 13:39:47.922266908 +0300
$

$ ./path-set -C
CONFIG_PATH_TRIE_NODE_32BIT_OFFSETS: no
CONFIG_PATH_TRIE_ELEM_32BIT_OFFSETS: no
CONFIG_PATH_TRIE_UINT_HASH_IDENTOP:  no
CONFIG_TRIE_PATH_SET_PRINT_SET:      no
CONFIG_VALUE_TYPE_SIZE:              32
32BIT:                               yes
DEBUG:                               yes
OPT:                                 -
$

$ ./path-set --plain-set --ternary-tree -I
node-struct-size: 16
$

$ ./path-set --plain-set --ternary-tree -N
dups-line
uniq-line
line-mem
dups-node
uniq-node
node-insert-eq
node-insert-lt
node-insert-gt
node-struct-size
node-struct
node-mem
total-node-mem
total-mem
insert-time
$

$ PATH_SET_TEST_INPUT=tests/files2.txt
$ PATH_SET_TEST_POOL_SIZE=512M
$ PATH_SET_TEST_HASH_SIZE=2M
$ PATH_SET_TEST_NODE_SIZE=4M
$ PATH_SET_TEST_STRUCT_TYPE=plain-set
$ PATH_SET_TEST_SET_TYPE=ternary-tree
$ PATH_SET_TEST_SEPARATORS='/.-'
$

$ time path-set-test -t 10
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10           10           10.00           0.00              0.00           
line-mem          455          732          616.70          5907.81           76.86          
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10           10           10.00           0.00              0.00           
node-insert-eq    77           146          110.20          359.76            18.97          
node-insert-lt    5            15           9.10            14.09             3.75           
node-insert-gt    5            12           8.80            6.36              2.52           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       360          619          516.50          5430.45           73.69          
node-mem          5760         9904         8264.00         1390195.20        1179.07        
total-node-mem    5760         9904         8264.00         1390195.20        1179.07        
total-mem         5788         9932         8292.00         1390195.20        1179.07        
real-insert-time  31           40           35.70           8.81              2.97           
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m1.329s
user	0m0.832s
sys	0m0.224s
$

$ time path-set-test -t 100
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100          100          100.00          0.00              0.00           
line-mem          5484         6151         5787.40         36328.44          190.60         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100          100          100.00          0.00              0.00           
node-insert-eq    1811         2034         1965.10         3717.69           60.97          
node-insert-lt    142          276          203.90          1415.89           37.63          
node-insert-gt    106          239          169.30          2292.41           47.88          
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       3578         4269         3922.30         47103.81          217.03         
node-mem          57248        68304        62756.80        12058575.36       3472.55        
total-node-mem    57248        68304        62756.80        12058575.36       3472.55        
total-mem         57276        68332        62784.80        12058575.36       3472.55        
real-insert-time  188          331          215.20          1547.36           39.34          
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m1.335s
user	0m0.812s
sys	0m0.236s
$

$ time path-set-test -t 1000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         1000         1000         1000.00         0.00              0.00           
line-mem          56550        58809        58069.30        400529.61         632.87         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         1000         1000         1000.00         0.00              0.00           
node-insert-eq    28126        29293        28710.50        127662.05         357.30         
node-insert-lt    2142         4314         3079.80         366846.36         605.68         
node-insert-gt    1907         4009         2834.50         532998.05         730.07         
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       29424        30893        30358.80        159124.76         398.90         
node-mem          470784       494288       485740.80       40735938.56       6382.47        
total-node-mem    470784       494288       485740.80       40735938.56       6382.47        
total-mem         470812       494316       485768.80       40735938.56       6382.47        
real-insert-time  3069         3676         3348.90         29163.29          170.77         
user-insert-time  0            4000         2800.00         3360000.00        1833.03        
sys-insert-time   0            4000         400.00          1440000.00        1200.00        

real	0m1.366s
user	0m0.824s
sys	0m0.260s
$

$ time path-set-test -t 10000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10000        10000        10000.00        0.00              0.00           
line-mem          576393       580149       577887.00       2006956.40        1416.67        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10000        10000        10000.00        0.00              0.00           
node-insert-eq    368013       372571       370515.50       1984419.25        1408.69        
node-insert-lt    36314        46426        41511.20        13615214.36       3689.88        
node-insert-gt    29814        50578        37220.50        44992565.85       6707.65        
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       215747       218552       217371.50       844140.45         918.77         
node-mem          3451952      3496832      3477944.00      216099955.20      14700.34       
total-node-mem    3451952      3496832      3477944.00      216099955.20      14700.34       
total-mem         3451980      3496860      3477972.00      216099955.20      14700.34       
real-insert-time  16597        20633        18374.00        1969523.60        1403.40        
user-insert-time  8000         20001        12800.50        15363200.25       3919.59        
sys-insert-time   0            20001        6400.20         29443040.16       5426.14        

real	0m1.581s
user	0m0.996s
sys	0m0.320s
$

$ time path-set-test -t 100000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100000       100000       100000.00       0.00              0.00           
line-mem          5774619      5796102      5785962.80      37750612.16       6144.15        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100000       100000       100000.00       0.00              0.00           
node-insert-eq    4360630      4383092      4371088.50      36994007.25       6082.27        
node-insert-lt    418616       543420       483112.20       1024403132.56     32006.30       
node-insert-gt    423259       555242       496607.30       1542020176.41     39268.56       
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       1512773      1518357      1514874.30      3263343.01        1806.47        
node-mem          24204368     24293712     24237988.80     835415810.50      28903.56       
total-node-mem    24204368     24293712     24237988.80     835415810.50      28903.56       
total-mem         24204396     24293740     24238016.80     835415810.50      28903.56       
real-insert-time  151650       158981       155953.30       6111184.21        2472.08        
user-insert-time  88004        160010       119207.20       354613122.76      18831.17       
sys-insert-time   24000        64004        44402.30        148654161.21      12192.38       

real	0m3.493s
user	0m2.576s
sys	0m0.980s
$

$ time path-set-test -t 1000000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         830206       830206       830206.00       0.00              0.00           
line-mem          48049857     48049857     48049857.00     -0.50             0.71           
dups-node         0            0            0.00            0.00              0.00           
uniq-node         830206       830206       830206.00       0.00              0.00           
node-insert-eq    39958859     39958859     39958859.00     -0.25             0.50           
node-insert-lt    4474957      5451189      4966966.40      71976604821.64    268284.56      
node-insert-gt    4220940      5260389      4745364.20      131091094738.16   362065.04      
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       8921204      8921204      8921204.00      0.00              0.00           
node-mem          142739264    142739264    142739264.00    0.00              0.00           
total-node-mem    142739264    142739264    142739264.00    0.00              0.00           
total-mem         142739292    142739292    142739292.00    -4.00             2.00           
real-insert-time  1298266      1477662      1330505.40      2614511183.64     51132.29       
user-insert-time  904057       1092067      978059.60       2509890412.24     50098.81       
sys-insert-time   280015       396025       345220.70       1001894328.61     31652.71       

real	0m19.527s
user	0m16.301s
sys	0m5.540s
$

$ path-set-test -p dups-line -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-line -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p line-mem -R ...
files       min          max          avg             var               dev
10          455          732          616.70          5907.81           76.86
100         5484         6151         5787.40         36328.44          190.60
1000        56550        58809        58069.30        400529.61         632.87
10000       576393       580149       577887.00       2006956.40        1416.67
100000      5774619      5796102      5785962.80      37750612.16       6144.15
1000000     48049857     48049857     48049857.00     -0.50             0.71
$

$ path-set-test -p dups-node -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-node -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p node-insert-eq -R ...
files       min          max          avg             var               dev
10          77           146          110.20          359.76            18.97
100         1811         2034         1965.10         3717.69           60.97
1000        28126        29293        28710.50        127662.05         357.30
10000       368013       372571       370515.50       1984419.25        1408.69
100000      4360630      4383092      4371088.50      36994007.25       6082.27
1000000     39958859     39958859     39958859.00     -0.25             0.50
$

$ path-set-test -p node-insert-lt -R ...
files       min          max          avg             var               dev
10          5            15           9.10            14.09             3.75
100         142          276          203.90          1415.89           37.63
1000        2142         4314         3079.80         366846.36         605.68
10000       36314        46426        41511.20        13615214.36       3689.88
100000      418616       543420       483112.20       1024403132.56     32006.30
1000000     4474957      5451189      4966966.40      71976604821.64    268284.56
$

$ path-set-test -p node-insert-gt -R ...
files       min          max          avg             var               dev
10          5            12           8.80            6.36              2.52
100         106          239          169.30          2292.41           47.88
1000        1907         4009         2834.50         532998.05         730.07
10000       29814        50578        37220.50        44992565.85       6707.65
100000      423259       555242       496607.30       1542020176.41     39268.56
1000000     4220940      5260389      4745364.20      131091094738.16   362065.04
$

$ path-set-test -p node-struct-size -R ...
files       min          max          avg             var               dev
10          16           16           16.00           0.00              0.00
100         16           16           16.00           0.00              0.00
1000        16           16           16.00           0.00              0.00
10000       16           16           16.00           0.00              0.00
100000      16           16           16.00           0.00              0.00
1000000     16           16           16.00           0.00              0.00
$

$ path-set-test -p node-struct -R ...
files       min          max          avg             var               dev
10          360          619          516.50          5430.45           73.69
100         3578         4269         3922.30         47103.81          217.03
1000        29424        30893        30358.80        159124.76         398.90
10000       215747       218552       217371.50       844140.45         918.77
100000      1512773      1518357      1514874.30      3263343.01        1806.47
1000000     8921204      8921204      8921204.00      0.00              0.00
$

$ path-set-test -p node-mem -R ...
files       min          max          avg             var               dev
10          5760         9904         8264.00         1390195.20        1179.07
100         57248        68304        62756.80        12058575.36       3472.55
1000        470784       494288       485740.80       40735938.56       6382.47
10000       3451952      3496832      3477944.00      216099955.20      14700.34
100000      24204368     24293712     24237988.80     835415810.50      28903.56
1000000     142739264    142739264    142739264.00    0.00              0.00
$

$ path-set-test -p total-node-mem -R ...
files       min          max          avg             var               dev
10          5760         9904         8264.00         1390195.20        1179.07
100         57248        68304        62756.80        12058575.36       3472.55
1000        470784       494288       485740.80       40735938.56       6382.47
10000       3451952      3496832      3477944.00      216099955.20      14700.34
100000      24204368     24293712     24237988.80     835415810.50      28903.56
1000000     142739264    142739264    142739264.00    0.00              0.00
$

$ path-set-test -p total-mem -R ...
files       min          max          avg             var               dev
10          5788         9932         8292.00         1390195.20        1179.07
100         57276        68332        62784.80        12058575.36       3472.55
1000        470812       494316       485768.80       40735938.56       6382.47
10000       3451980      3496860      3477972.00      216099955.20      14700.34
100000      24204396     24293740     24238016.80     835415810.50      28903.56
1000000     142739292    142739292    142739292.00    -4.00             2.00
$

$ path-set-test -p real-insert-time -R ...
files       min          max          avg             var               dev
10          31           40           35.70           8.81              2.97
100         188          331          215.20          1547.36           39.34
1000        3069         3676         3348.90         29163.29          170.77
10000       16597        20633        18374.00        1969523.60        1403.40
100000      151650       158981       155953.30       6111184.21        2472.08
1000000     1298266      1477662      1330505.40      2614511183.64     51132.29
$

$ path-set-test -p user-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         2800.00         3360000.00        1833.03
10000       8000         20001        12800.50        15363200.25       3919.59
100000      88004        160010       119207.20       354613122.76      18831.17
1000000     904057       1092067      978059.60       2509890412.24     50098.81
$

$ path-set-test -p sys-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         400.00          1440000.00        1200.00
10000       0            20001        6400.20         29443040.16       5426.14
100000      24000        64004        44402.30        148654161.21      12192.38
1000000     280015       396025       345220.70       1001894328.61     31652.71
$

$ path-set-test -p dups-line -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-line -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p line-mem -A ...
min: 616
max: 48049857
avg: 9079696.33
var: 307993026702494.50
dev: 17549730.10
$

$ path-set-test -p dups-node -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-node -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p node-insert-eq -A ...
min: 110
max: 39958859
avg: 7455207.83
var: 213745698226517.81
dev: 14620044.40
$

$ path-set-test -p node-insert-lt -A ...
min: 9
max: 4966966
avg: 915813.33
var: 3312266127547.56
dev: 1819963.22
$

$ path-set-test -p node-insert-gt -A ...
min: 8
max: 4745364
avg: 880367.00
var: 3019369177565.33
dev: 1737633.21
$

$ path-set-test -p node-struct-size -A ...
min: 16
max: 16
avg: 16.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct -A ...
min: 516
max: 8921204
avg: 1781374.17
var: 10481857987272.14
dev: 3237569.77
$

$ path-set-test -p node-mem -A ...
min: 8264
max: 142739264
avg: 28501992.67
var: 2683355346358247.50
dev: 51801113.37
$

$ path-set-test -p total-node-mem -A ...
min: 8264
max: 142739264
avg: 28501992.67
var: 2683355346358247.50
dev: 51801113.37
$

$ path-set-test -p total-mem -A ...
min: 8292
max: 142739292
avg: 28502020.67
var: 2683355346358247.50
dev: 51801113.37
$

$ path-set-test -p real-insert-time -A ...
min: 35
max: 1330505
avg: 251405.00
var: 235947818252.33
dev: 485744.60
$

$ path-set-test -p user-insert-time -A ...
min: 0
max: 978059
avg: 185477.67
var: 127428267889.56
dev: 356970.96
$

$ path-set-test -p sys-insert-time -A ...
min: 0
max: 345220
avg: 66070.33
var: 15832962053.89
dev: 125829.10
$

