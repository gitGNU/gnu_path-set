#
# # meta command:
# $ path-set-test \
# --input=tests/files.txt \
# --expr='10 ** x' \
# --limits=1-6 \
# --pool-size=128M \
# --hash-size=2M \
# --node-size=4M \
# --separators='/' \
# --repeat=10 \
# --sleep=100 \
# --plain-set \
# --ternary-tree \
# --run-tests
#

$ date +'%Y-%m-%d %H:%M:%S.%N %z'
2016-09-29 13:13:54.146635939 +0300
$

$ ./path-set -C
CONFIG_PATH_TRIE_NODE_32BIT_OFFSETS: yes
CONFIG_PATH_TRIE_ELEM_32BIT_OFFSETS: yes
CONFIG_PATH_TRIE_UINT_HASH_IDENTOP:  no
CONFIG_TRIE_PATH_SET_PRINT_SET:      no
CONFIG_VALUE_TYPE_SIZE:              64
32BIT:                               no
DEBUG:                               yes
OPT:                                 -
$

$ ./path-set --plain-set --ternary-tree -I
node-struct-size: 32
$

$ ./path-set --plain-set --ternary-tree -N
dups-line
uniq-line
line-mem
dups-node
uniq-node
node-insert-eq
node-insert-lt
node-insert-gt
node-struct-size
node-struct
node-mem
total-node-mem
total-mem
insert-time
$

$ PATH_SET_TEST_INPUT=tests/files.txt
$ PATH_SET_TEST_POOL_SIZE=128M
$ PATH_SET_TEST_HASH_SIZE=2M
$ PATH_SET_TEST_NODE_SIZE=4M
$ PATH_SET_TEST_STRUCT_TYPE=plain-set
$ PATH_SET_TEST_SET_TYPE=ternary-tree
$ PATH_SET_TEST_SEPARATORS='/'
$

$ time path-set-test -t 10
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10           10           10.00           0.00              0.00           
line-mem          579          754          667.60          2594.04           50.93          
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10           10           10.00           0.00              0.00           
node-insert-eq    135          246          171.00          1387.80           37.25          
node-insert-lt    4            16           9.10            13.89             3.73           
node-insert-gt    2            13           7.40            10.04             3.17           
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       438          589          506.60          2684.44           51.81          
node-mem          14016        18848        16211.20        2748866.56        1657.97        
total-node-mem    14016        18848        16211.20        2748866.56        1657.97        
total-mem         14072        18904        16267.20        2748866.56        1657.97        
real-insert-time  37           46           40.60           10.44             3.23           
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m0.857s
user	0m0.384s
sys	0m0.184s
$

$ time path-set-test -t 100
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100          100          100.00          0.00              0.00           
line-mem          6199         6882         6530.10         48355.69          219.90         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100          100          100.00          0.00              0.00           
node-insert-eq    2538         2959         2776.40         21148.44          145.43         
node-insert-lt    107          268          178.40          3075.64           55.46          
node-insert-gt    120          341          187.20          4141.76           64.36          
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       3621         4023         3853.70         16047.41          126.68         
node-mem          115872       128736       123318.40       16432547.84       4053.71        
total-node-mem    115872       128736       123318.40       16432547.84       4053.71        
total-mem         115928       128792       123374.40       16432547.84       4053.71        
real-insert-time  228          374          267.90          2297.09           47.93          
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m0.878s
user	0m0.428s
sys	0m0.172s
$

$ time path-set-test -t 1000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         1000         1000         1000.00         0.00              0.00           
line-mem          64158        66451        65298.20        515682.16         718.11         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         1000         1000         1000.00         0.00              0.00           
node-insert-eq    38606        40614        39535.30        409195.41         639.68         
node-insert-lt    2150         3155         2716.70         128441.61         358.39         
node-insert-gt    2202         4166         2851.80         323111.96         568.43         
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       26239        27493        26762.90        121376.69         348.39         
node-mem          839648       879776       856412.80       124289730.56      11148.53       
total-node-mem    839648       879776       856412.80       124289730.56      11148.53       
total-mem         839704       879832       856468.80       124289730.56      11148.53       
real-insert-time  3566         3871         3654.40         8615.04           92.82          
user-insert-time  0            4000         2800.00         3360000.00        1833.03        
sys-insert-time   0            4000         400.00          1440000.00        1200.00        

real	0m0.902s
user	0m0.420s
sys	0m0.200s
$

$ time path-set-test -t 10000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10000        10000        10000.00        0.00              0.00           
line-mem          653032       660599       657365.10       3746373.29        1935.56        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10000        10000        10000.00        0.00              0.00           
node-insert-eq    482322       488657       486400.30       2839483.21        1685.08        
node-insert-lt    30614        46036        36110.80        24632601.16       4963.12        
node-insert-gt    32845        38827        36725.10        3118184.29        1765.84        
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       179906       181942       180964.80       270252.16         519.86         
node-mem          5756992      5822144      5790873.60      276738211.84      16635.45       
total-node-mem    5756992      5822144      5790873.60      276738211.84      16635.45       
total-mem         5757048      5822200      5790929.60      276738211.84      16635.45       
real-insert-time  18194        22531        20491.60        2412967.64        1553.37        
user-insert-time  12001        20001        17200.90        6559440.09        2561.14        
sys-insert-time   0            8000         5200.00         9760000.00        3124.10        

real	0m1.113s
user	0m0.600s
sys	0m0.260s
$

$ time path-set-test -t 100000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100000       100000       100000.00       0.00              0.00           
line-mem          6561829      6582754      6570229.10      26372288.49       5135.40        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100000       100000       100000.00       0.00              0.00           
node-insert-eq    5434486      5451874      5440133.30      24301472.01       4929.65        
node-insert-lt    440903       558810       479139.20       1236520523.56     35164.19       
node-insert-gt    466789       560726       488167.60       796733620.84      28226.47       
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       1227343      1232608      1230095.80      2482282.36        1575.53        
node-mem          39274976     39443456     39363065.60     2541857136.50     50416.83       
total-node-mem    39274976     39443456     39363065.60     2541857136.50     50416.83       
total-mem         39275032     39443512     39363121.60     2541857136.50     50416.83       
real-insert-time  156688       172895       167185.20       18808037.36       4336.82        
user-insert-time  96006        156010       130808.00       313796802.20      17714.31       
sys-insert-time   20001        52003        34001.60        122412000.84      11064.00       

real	0m2.974s
user	0m2.324s
sys	0m0.736s
$

$ time path-set-test -t 1000000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         405909       405909       405909.00       0.00              0.00           
line-mem          26666438     26666438     26666438.00     0.00              0.00           
dups-node         0            0            0.00            0.00              0.00           
uniq-node         405909       405909       405909.00       0.00              0.00           
node-insert-eq    23077486     23077486     23077486.00     0.00              0.00           
node-insert-lt    1939213      2524627      2144377.00      37186210185.00    192837.26      
node-insert-gt    2226631      2495543      2344934.90      6519752180.49     80744.98       
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       3994861      3994861      3994861.00      0.00              0.00           
node-mem          127835552    127835552    127835552.00    0.00              0.00           
total-node-mem    127835552    127835552    127835552.00    0.00              0.00           
total-mem         127835608    127835608    127835608.00    0.00              0.00           
real-insert-time  665939       707111       679911.70       137499478.41      11726.02       
user-insert-time  452028       540036       516032.90       537676005.49      23187.84       
sys-insert-time   124006       192012       150409.00       455097603.60      21333.02       

real	0m9.505s
user	0m8.053s
sys	0m2.456s
$

$ path-set-test -p dups-line -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-line -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p line-mem -R ...
files       min          max          avg             var               dev
10          579          754          667.60          2594.04           50.93
100         6199         6882         6530.10         48355.69          219.90
1000        64158        66451        65298.20        515682.16         718.11
10000       653032       660599       657365.10       3746373.29        1935.56
100000      6561829      6582754      6570229.10      26372288.49       5135.40
1000000     26666438     26666438     26666438.00     0.00              0.00
$

$ path-set-test -p dups-node -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-node -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p node-insert-eq -R ...
files       min          max          avg             var               dev
10          135          246          171.00          1387.80           37.25
100         2538         2959         2776.40         21148.44          145.43
1000        38606        40614        39535.30        409195.41         639.68
10000       482322       488657       486400.30       2839483.21        1685.08
100000      5434486      5451874      5440133.30      24301472.01       4929.65
1000000     23077486     23077486     23077486.00     0.00              0.00
$

$ path-set-test -p node-insert-lt -R ...
files       min          max          avg             var               dev
10          4            16           9.10            13.89             3.73
100         107          268          178.40          3075.64           55.46
1000        2150         3155         2716.70         128441.61         358.39
10000       30614        46036        36110.80        24632601.16       4963.12
100000      440903       558810       479139.20       1236520523.56     35164.19
1000000     1939213      2524627      2144377.00      37186210185.00    192837.26
$

$ path-set-test -p node-insert-gt -R ...
files       min          max          avg             var               dev
10          2            13           7.40            10.04             3.17
100         120          341          187.20          4141.76           64.36
1000        2202         4166         2851.80         323111.96         568.43
10000       32845        38827        36725.10        3118184.29        1765.84
100000      466789       560726       488167.60       796733620.84      28226.47
1000000     2226631      2495543      2344934.90      6519752180.49     80744.98
$

$ path-set-test -p node-struct-size -R ...
files       min          max          avg             var               dev
10          32           32           32.00           0.00              0.00
100         32           32           32.00           0.00              0.00
1000        32           32           32.00           0.00              0.00
10000       32           32           32.00           0.00              0.00
100000      32           32           32.00           0.00              0.00
1000000     32           32           32.00           0.00              0.00
$

$ path-set-test -p node-struct -R ...
files       min          max          avg             var               dev
10          438          589          506.60          2684.44           51.81
100         3621         4023         3853.70         16047.41          126.68
1000        26239        27493        26762.90        121376.69         348.39
10000       179906       181942       180964.80       270252.16         519.86
100000      1227343      1232608      1230095.80      2482282.36        1575.53
1000000     3994861      3994861      3994861.00      0.00              0.00
$

$ path-set-test -p node-mem -R ...
files       min          max          avg             var               dev
10          14016        18848        16211.20        2748866.56        1657.97
100         115872       128736       123318.40       16432547.84       4053.71
1000        839648       879776       856412.80       124289730.56      11148.53
10000       5756992      5822144      5790873.60      276738211.84      16635.45
100000      39274976     39443456     39363065.60     2541857136.50     50416.83
1000000     127835552    127835552    127835552.00    0.00              0.00
$

$ path-set-test -p total-node-mem -R ...
files       min          max          avg             var               dev
10          14016        18848        16211.20        2748866.56        1657.97
100         115872       128736       123318.40       16432547.84       4053.71
1000        839648       879776       856412.80       124289730.56      11148.53
10000       5756992      5822144      5790873.60      276738211.84      16635.45
100000      39274976     39443456     39363065.60     2541857136.50     50416.83
1000000     127835552    127835552    127835552.00    0.00              0.00
$

$ path-set-test -p total-mem -R ...
files       min          max          avg             var               dev
10          14072        18904        16267.20        2748866.56        1657.97
100         115928       128792       123374.40       16432547.84       4053.71
1000        839704       879832       856468.80       124289730.56      11148.53
10000       5757048      5822200      5790929.60      276738211.84      16635.45
100000      39275032     39443512     39363121.60     2541857136.50     50416.83
1000000     127835608    127835608    127835608.00    0.00              0.00
$

$ path-set-test -p real-insert-time -R ...
files       min          max          avg             var               dev
10          37           46           40.60           10.44             3.23
100         228          374          267.90          2297.09           47.93
1000        3566         3871         3654.40         8615.04           92.82
10000       18194        22531        20491.60        2412967.64        1553.37
100000      156688       172895       167185.20       18808037.36       4336.82
1000000     665939       707111       679911.70       137499478.41      11726.02
$

$ path-set-test -p user-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         2800.00         3360000.00        1833.03
10000       12001        20001        17200.90        6559440.09        2561.14
100000      96006        156010       130808.00       313796802.20      17714.31
1000000     452028       540036       516032.90       537676005.49      23187.84
$

$ path-set-test -p sys-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         400.00          1440000.00        1200.00
10000       0            8000         5200.00         9760000.00        3124.10
100000      20001        52003        34001.60        122412000.84      11064.00
1000000     124006       192012       150409.00       455097603.60      21333.02
$

$ path-set-test -p dups-line -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-line -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p line-mem -A ...
min: 667
max: 26666438
avg: 5661087.83
var: 93735961272969.14
dev: 9681733.38
$

$ path-set-test -p dups-node -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-node -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p node-insert-eq -A ...
min: 171
max: 23077486
avg: 4841083.50
var: 70297837687615.58
dev: 8384380.58
$

$ path-set-test -p node-insert-lt -A ...
min: 9
max: 2144377
avg: 443754.83
var: 607954687888.47
dev: 779714.49
$

$ path-set-test -p node-insert-gt -A ...
min: 7
max: 2344934
avg: 478811.83
var: 727135790441.47
dev: 852722.58
$

$ path-set-test -p node-struct-size -A ...
min: 32
max: 32
avg: 32.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct -A ...
min: 506
max: 3994861
avg: 906173.50
var: 2096437486886.25
dev: 1447907.97
$

$ path-set-test -p node-mem -A ...
min: 16211
max: 127835552
avg: 28997571.83
var: 2146751221617415.00
dev: 46333046.76
$

$ path-set-test -p total-node-mem -A ...
min: 16211
max: 127835552
avg: 28997571.83
var: 2146751221617415.00
dev: 46333046.76
$

$ path-set-test -p total-mem -A ...
min: 16267
max: 127835608
avg: 28997627.83
var: 2146751221617414.50
dev: 46333046.76
$

$ path-set-test -p real-insert-time -A ...
min: 40
max: 679911
avg: 145258.00
var: 60677296408.00
dev: 246327.62
$

$ path-set-test -p user-insert-time -A ...
min: 0
max: 516032
avg: 111140.00
var: 34931806714.67
dev: 186900.53
$

$ path-set-test -p sys-insert-time -A ...
min: 0
max: 150409
avg: 31668.33
var: 2964805877.56
dev: 54450.03
$

