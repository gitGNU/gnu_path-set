#
# # meta command:
# $ path-set-test \
# --input=tests/files2.txt \
# --expr='10 ** x' \
# --limits=1-6 \
# --pool-size=512M \
# --hash-size=2M \
# --node-size=4M \
# --separators='/' \
# --repeat=10 \
# --sleep=100 \
# --plain-set \
# --ternary-tree \
# --run-tests
#

$ date +'%Y-%m-%d %H:%M:%S.%N %z'
2016-09-29 13:29:58.636339395 +0300
$

$ ./path-set -C
CONFIG_PATH_TRIE_NODE_32BIT_OFFSETS: no
CONFIG_PATH_TRIE_ELEM_32BIT_OFFSETS: no
CONFIG_PATH_TRIE_UINT_HASH_IDENTOP:  no
CONFIG_TRIE_PATH_SET_PRINT_SET:      no
CONFIG_VALUE_TYPE_SIZE:              32
32BIT:                               yes
DEBUG:                               yes
OPT:                                 -
$

$ ./path-set --plain-set --ternary-tree -I
node-struct-size: 16
$

$ ./path-set --plain-set --ternary-tree -N
dups-line
uniq-line
line-mem
dups-node
uniq-node
node-insert-eq
node-insert-lt
node-insert-gt
node-struct-size
node-struct
node-mem
total-node-mem
total-mem
insert-time
$

$ PATH_SET_TEST_INPUT=tests/files2.txt
$ PATH_SET_TEST_POOL_SIZE=512M
$ PATH_SET_TEST_HASH_SIZE=2M
$ PATH_SET_TEST_NODE_SIZE=4M
$ PATH_SET_TEST_STRUCT_TYPE=plain-set
$ PATH_SET_TEST_SET_TYPE=ternary-tree
$ PATH_SET_TEST_SEPARATORS='/'
$

$ time path-set-test -t 10
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10           10           10.00           0.00              0.00           
line-mem          503          734          595.80          5751.76           75.84          
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10           10           10.00           0.00              0.00           
node-insert-eq    64           134          94.50           301.45            17.36          
node-insert-lt    3            12           7.20            5.36              2.32           
node-insert-gt    6            13           8.60            4.44              2.11           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       427          644          511.30          4368.81           66.10          
node-mem          6832         10304        8180.80         1118415.36        1057.55        
total-node-mem    6832         10304        8180.80         1118415.36        1057.55        
total-mem         6860         10332        8208.80         1118415.36        1057.55        
real-insert-time  30           41           34.90           12.49             3.53           
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m1.346s
user	0m0.804s
sys	0m0.256s
$

$ time path-set-test -t 100
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100          100          100.00          0.00              0.00           
line-mem          5531         6120         5858.90         28365.69          168.42         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100          100          100.00          0.00              0.00           
node-insert-eq    1822         2091         1980.30         7598.01           87.17          
node-insert-lt    150          224          190.00          569.00            23.85          
node-insert-gt    121          334          166.50          3684.25           60.70          
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       3738         4179         3978.60         17808.84          133.45         
node-mem          59808        66864        63657.60        4559063.04        2135.20        
total-node-mem    59808        66864        63657.60        4559063.04        2135.20        
total-mem         59836        66892        63685.60        4559063.04        2135.20        
real-insert-time  192          364          218.20          2384.16           48.83          
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m1.319s
user	0m0.804s
sys	0m0.236s
$

$ time path-set-test -t 1000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         1000         1000         1000.00         0.00              0.00           
line-mem          56931        59214        57836.50        336650.85         580.22         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         1000         1000         1000.00         0.00              0.00           
node-insert-eq    27837        29179        28607.80        179324.76         423.47         
node-insert-lt    2291         2993         2645.50         50957.45          225.74         
node-insert-gt    2223         3112         2711.80         111720.56         334.25         
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       29672        31185        30228.70        178258.61         422.21         
node-mem          474752       498960       483659.20       45634204.16       6755.31        
total-node-mem    474752       498960       483659.20       45634204.16       6755.31        
total-mem         474780       498988       483687.20       45634204.16       6755.31        
real-insert-time  2207         3509         3103.70         124907.41         353.42         
user-insert-time  0            4000         1600.00         3840000.00        1959.59        
sys-insert-time   0            4000         800.00          2560000.00        1600.00        

real	0m1.382s
user	0m0.848s
sys	0m0.252s
$

$ time path-set-test -t 10000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10000        10000        10000.00        0.00              0.00           
line-mem          575004       580774       578179.70       3456115.01        1859.06        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10000        10000        10000.00        0.00              0.00           
node-insert-eq    369079       373677       370818.00       1818621.60        1348.56        
node-insert-lt    32550        43926        38625.00        9547757.00        3089.94        
node-insert-gt    31631        47740        38696.30        33669100.21       5802.51        
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       214959       218974       217361.70       1830332.21        1352.90        
node-mem          3439344      3503584      3477787.20      468565045.76      21646.36       
total-node-mem    3439344      3503584      3477787.20      468565045.76      21646.36       
total-mem         3439372      3503612      3477815.20      468565045.76      21646.36       
real-insert-time  16449        20807        18714.60        2362194.64        1536.94        
user-insert-time  4000         12001        10000.30        7201200.21        2683.51        
sys-insert-time   4000         16001        8800.10         15361440.09       3919.37        

real	0m1.580s
user	0m0.940s
sys	0m0.376s
$

$ time path-set-test -t 100000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100000       100000       100000.00       0.00              0.00           
line-mem          5774855      5794246      5786519.80      32892980.36       5735.24        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100000       100000       100000.00       0.00              0.00           
node-insert-eq    4361966      4377207      4370915.50      27429999.25       5237.37        
node-insert-lt    442197       533865       493986.60       1033941315.64     32154.96       
node-insert-gt    446516       621805       493125.30       2352732236.21     48504.97       
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       1512889      1518997      1515604.30      2724848.41        1650.71        
node-mem          24206224     24303952     24249668.80     697561192.88      26411.38       
total-node-mem    24206224     24303952     24249668.80     697561192.88      26411.38       
total-mem         24206252     24303980     24249696.80     697561193.00      26411.38       
real-insert-time  150766       158681       155814.70       4839482.81        2199.88        
user-insert-time  108006       160012       124407.80       263876962.56      16244.29       
sys-insert-time   20001        56003        36802.10        143372640.69      11973.83       

real	0m3.488s
user	0m2.688s
sys	0m0.864s
$

$ time path-set-test -t 1000000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         830206       830206       830206.00       0.00              0.00           
line-mem          48049857     48049857     48049857.00     -0.50             0.71           
dups-node         0            0            0.00            0.00              0.00           
uniq-node         830206       830206       830206.00       0.00              0.00           
node-insert-eq    39958859     39958859     39958859.00     -0.25             0.50           
node-insert-lt    4541228      5189620      4790724.90      44566253463.69    211107.21      
node-insert-gt    4542417      5937469      4811941.90      167930437868.09   409793.16      
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       8921204      8921204      8921204.00      0.00              0.00           
node-mem          142739264    142739264    142739264.00    0.00              0.00           
total-node-mem    142739264    142739264    142739264.00    0.00              0.00           
total-mem         142739292    142739292    142739292.00    -4.00             2.00           
real-insert-time  1298385      1341575      1320295.20      207014075.56      14387.98       
user-insert-time  940061       1072065      1001261.10      1657910969.29     40717.45       
sys-insert-time   288021       368025       335221.40       463424645.84      21527.30       

real	0m19.351s
user	0m16.129s
sys	0m5.524s
$

$ path-set-test -p dups-line -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-line -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p line-mem -R ...
files       min          max          avg             var               dev
10          503          734          595.80          5751.76           75.84
100         5531         6120         5858.90         28365.69          168.42
1000        56931        59214        57836.50        336650.85         580.22
10000       575004       580774       578179.70       3456115.01        1859.06
100000      5774855      5794246      5786519.80      32892980.36       5735.24
1000000     48049857     48049857     48049857.00     -0.50             0.71
$

$ path-set-test -p dups-node -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-node -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p node-insert-eq -R ...
files       min          max          avg             var               dev
10          64           134          94.50           301.45            17.36
100         1822         2091         1980.30         7598.01           87.17
1000        27837        29179        28607.80        179324.76         423.47
10000       369079       373677       370818.00       1818621.60        1348.56
100000      4361966      4377207      4370915.50      27429999.25       5237.37
1000000     39958859     39958859     39958859.00     -0.25             0.50
$

$ path-set-test -p node-insert-lt -R ...
files       min          max          avg             var               dev
10          3            12           7.20            5.36              2.32
100         150          224          190.00          569.00            23.85
1000        2291         2993         2645.50         50957.45          225.74
10000       32550        43926        38625.00        9547757.00        3089.94
100000      442197       533865       493986.60       1033941315.64     32154.96
1000000     4541228      5189620      4790724.90      44566253463.69    211107.21
$

$ path-set-test -p node-insert-gt -R ...
files       min          max          avg             var               dev
10          6            13           8.60            4.44              2.11
100         121          334          166.50          3684.25           60.70
1000        2223         3112         2711.80         111720.56         334.25
10000       31631        47740        38696.30        33669100.21       5802.51
100000      446516       621805       493125.30       2352732236.21     48504.97
1000000     4542417      5937469      4811941.90      167930437868.09   409793.16
$

$ path-set-test -p node-struct-size -R ...
files       min          max          avg             var               dev
10          16           16           16.00           0.00              0.00
100         16           16           16.00           0.00              0.00
1000        16           16           16.00           0.00              0.00
10000       16           16           16.00           0.00              0.00
100000      16           16           16.00           0.00              0.00
1000000     16           16           16.00           0.00              0.00
$

$ path-set-test -p node-struct -R ...
files       min          max          avg             var               dev
10          427          644          511.30          4368.81           66.10
100         3738         4179         3978.60         17808.84          133.45
1000        29672        31185        30228.70        178258.61         422.21
10000       214959       218974       217361.70       1830332.21        1352.90
100000      1512889      1518997      1515604.30      2724848.41        1650.71
1000000     8921204      8921204      8921204.00      0.00              0.00
$

$ path-set-test -p node-mem -R ...
files       min          max          avg             var               dev
10          6832         10304        8180.80         1118415.36        1057.55
100         59808        66864        63657.60        4559063.04        2135.20
1000        474752       498960       483659.20       45634204.16       6755.31
10000       3439344      3503584      3477787.20      468565045.76      21646.36
100000      24206224     24303952     24249668.80     697561192.88      26411.38
1000000     142739264    142739264    142739264.00    0.00              0.00
$

$ path-set-test -p total-node-mem -R ...
files       min          max          avg             var               dev
10          6832         10304        8180.80         1118415.36        1057.55
100         59808        66864        63657.60        4559063.04        2135.20
1000        474752       498960       483659.20       45634204.16       6755.31
10000       3439344      3503584      3477787.20      468565045.76      21646.36
100000      24206224     24303952     24249668.80     697561192.88      26411.38
1000000     142739264    142739264    142739264.00    0.00              0.00
$

$ path-set-test -p total-mem -R ...
files       min          max          avg             var               dev
10          6860         10332        8208.80         1118415.36        1057.55
100         59836        66892        63685.60        4559063.04        2135.20
1000        474780       498988       483687.20       45634204.16       6755.31
10000       3439372      3503612      3477815.20      468565045.76      21646.36
100000      24206252     24303980     24249696.80     697561193.00      26411.38
1000000     142739292    142739292    142739292.00    -4.00             2.00
$

$ path-set-test -p real-insert-time -R ...
files       min          max          avg             var               dev
10          30           41           34.90           12.49             3.53
100         192          364          218.20          2384.16           48.83
1000        2207         3509         3103.70         124907.41         353.42
10000       16449        20807        18714.60        2362194.64        1536.94
100000      150766       158681       155814.70       4839482.81        2199.88
1000000     1298385      1341575      1320295.20      207014075.56      14387.98
$

$ path-set-test -p user-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         1600.00         3840000.00        1959.59
10000       4000         12001        10000.30        7201200.21        2683.51
100000      108006       160012       124407.80       263876962.56      16244.29
1000000     940061       1072065      1001261.10      1657910969.29     40717.45
$

$ path-set-test -p sys-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         800.00          2560000.00        1600.00
10000       4000         16001        8800.10         15361440.09       3919.37
100000      20001        56003        36802.10        143372640.69      11973.83
1000000     288021       368025       335221.40       463424645.84      21527.30
$

$ path-set-test -p dups-line -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-line -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p line-mem -A ...
min: 595
max: 48049857
avg: 9079807.33
var: 307992137204035.50
dev: 17549704.76
$

$ path-set-test -p dups-node -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-node -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p node-insert-eq -A ...
min: 94
max: 39958859
avg: 7455212.17
var: 213745418016304.47
dev: 14620034.82
$

$ path-set-test -p node-insert-lt -A ...
min: 7
max: 4790724
avg: 887696.17
var: 3078088438213.81
dev: 1754448.19
$

$ path-set-test -p node-insert-gt -A ...
min: 8
max: 4811941
avg: 891107.83
var: 3105835697815.81
dev: 1762338.13
$

$ path-set-test -p node-struct-size -A ...
min: 16
max: 16
avg: 16.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct -A ...
min: 511
max: 8921204
avg: 1781481.00
var: 10481844099362.67
dev: 3237567.62
$

$ path-set-test -p node-mem -A ...
min: 8180
max: 142739264
avg: 28503702.50
var: 2683351765948764.00
dev: 51801078.81
$

$ path-set-test -p total-node-mem -A ...
min: 8180
max: 142739264
avg: 28503702.50
var: 2683351765948764.00
dev: 51801078.81
$

$ path-set-test -p total-mem -A ...
min: 8208
max: 142739292
avg: 28503730.50
var: 2683351765948764.00
dev: 51801078.81
$

$ path-set-test -p real-insert-time -A ...
min: 34
max: 1320295
avg: 249696.33
var: 232287871237.56
dev: 481962.52
$

$ path-set-test -p user-insert-time -A ...
min: 0
max: 1001261
avg: 189544.67
var: 133756694633.22
dev: 365727.62
$

$ path-set-test -p sys-insert-time -A ...
min: 0
max: 335221
avg: 63603.83
var: 14922150059.47
dev: 122156.25
$

