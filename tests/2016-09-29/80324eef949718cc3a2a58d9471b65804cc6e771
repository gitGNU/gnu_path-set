#
# # meta command:
# $ path-set-test \
# --input=tests/files2.txt \
# --expr='10 ** x' \
# --limits=1-6 \
# --pool-size=512M \
# --hash-size=2M \
# --node-size=4M \
# --separators='/.-' \
# --repeat=10 \
# --sleep=100 \
# --plain-set \
# --gnulib-hash \
# --run-tests
#

$ date +'%Y-%m-%d %H:%M:%S.%N %z'
2016-09-29 13:40:38.008683662 +0300
$

$ ./path-set -C
CONFIG_PATH_TRIE_NODE_32BIT_OFFSETS: no
CONFIG_PATH_TRIE_ELEM_32BIT_OFFSETS: no
CONFIG_PATH_TRIE_UINT_HASH_IDENTOP:  no
CONFIG_TRIE_PATH_SET_PRINT_SET:      no
CONFIG_VALUE_TYPE_SIZE:              32
32BIT:                               yes
DEBUG:                               yes
OPT:                                 -
$

$ ./path-set --plain-set --gnulib-hash -I
node-struct-size: 8
$

$ ./path-set --plain-set --gnulib-hash -N
dups-line
uniq-line
line-mem
dups-node
uniq-node
node-insert-eq
node-insert-ne
node-rehash-eq
node-rehash-ne
hash-size
hash-used
hash-load
node-struct-size
node-struct
node-mem
total-node-mem
total-mem
insert-time
$

$ PATH_SET_TEST_INPUT=tests/files2.txt
$ PATH_SET_TEST_POOL_SIZE=512M
$ PATH_SET_TEST_HASH_SIZE=2M
$ PATH_SET_TEST_NODE_SIZE=4M
$ PATH_SET_TEST_STRUCT_TYPE=plain-set
$ PATH_SET_TEST_SET_TYPE=gnulib-hash
$ PATH_SET_TEST_SEPARATORS='/.-'
$

$ time path-set-test -t 10
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10           10           10.00           0.00              0.00           
line-mem          494          659          569.70          3757.21           61.30          
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10           10           10.00           0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            0            0.00            0.00              0.00           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         10           10           10.00           0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       10           10           10.00           0.00              0.00           
node-mem          584          749          659.70          3757.21           61.30          
total-node-mem    584          749          659.70          3757.21           61.30          
total-mem         20972264     20972429     20972339.70     3757.25           61.30          
real-insert-time  1234         1931         1638.70         50443.61          224.60         
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m1.474s
user	0m0.892s
sys	0m0.284s
$

$ time path-set-test -t 100
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100          100          100.00          0.00              0.00           
line-mem          5605         6305         5898.30         43939.21          209.62         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100          100          100.00          0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            0            0.00            0.00              0.00           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         100          100          100.00          0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       100          100          100.00          0.00              0.00           
node-mem          6505         7205         6798.30         43939.21          209.62         
total-node-mem    6505         7205         6798.30         43939.21          209.62         
total-mem         20978185     20978885     20978478.30     43939.19          209.62         
real-insert-time  2514         2745         2691.90         4392.29           66.27          
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m1.440s
user	0m0.888s
sys	0m0.268s
$

$ time path-set-test -t 1000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         1000         1000         1000.00         0.00              0.00           
line-mem          56699        58685        57635.40        429996.44         655.74         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         1000         1000         1000.00         0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            1            0.20            0.16              0.40           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         999          1000         999.80          0.16              0.40           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       1000         1000         1000.00         0.00              0.00           
node-mem          65699        67685        66635.40        429996.44         655.74         
total-node-mem    65699        67685        66635.40        429996.44         655.74         
total-mem         21037379     21039365     21038317.00     430251.81         655.94         
real-insert-time  4310         4527         4438.30         3721.01           61.00          
user-insert-time  0            4000         1200.00         3360000.00        1833.03        
sys-insert-time   0            4000         2000.00         4000000.00        2000.00        

real	0m1.500s
user	0m0.892s
sys	0m0.316s
$

$ time path-set-test -t 10000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10000        10000        10000.00        0.00              0.00           
line-mem          576489       582498       579165.50       3198111.45        1788.33        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10000        10000        10000.00        0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    16           23           19.20           7.56              2.75           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         9977         9984         9980.80         7.56              2.75           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       10000        10000        10000.00        0.00              0.00           
node-mem          666489       672498       669165.50       3198111.45        1788.33        
total-node-mem    666489       672498       669165.50       3198111.45        1788.33        
total-mem         21638353     21644330     21640999.10     3173142.44        1781.33        
real-insert-time  11234        15292        13191.30        2041079.61        1428.66        
user-insert-time  4000         12000        5600.10         7040480.09        2653.39        
sys-insert-time   0            12001        4800.10         12161440.09       3487.33        

real	0m1.623s
user	0m0.964s
sys	0m0.384s
$

$ time path-set-test -t 100000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100000       100000       100000.00       0.00              0.00           
line-mem          5778489      5797957      5788273.00      27022230.60       5198.29        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100000       100000       100000.00       0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    1866         1973         1912.30         1013.21           31.83          
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         98047        98156        98108.00        1100.20           33.17          
hash-load         0.04         0.04         0.04            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       100000       100000       100000.00       0.00              0.00           
node-mem          6678489      6697957      6688273.00      27022230.60       5198.29        
total-node-mem    6678489      6697957      6688273.00      27022230.60       5198.29        
total-mem         27665337     27684389     27675089.00     27086731.38       5204.49        
real-insert-time  78490        82904        80195.40        1564450.64        1250.78        
user-insert-time  32001        52002        40401.80        33444160.36       5783.09        
sys-insert-time   24000        60004        40402.20        81451041.36       9025.02        

real	0m2.818s
user	0m1.800s
sys	0m1.024s
$

$ time path-set-test -t 1000000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         830206       830206       830206.00       0.00              0.00           
line-mem          48049857     48049857     48049857.00     -0.50             0.71           
dups-node         0            0            0.00            0.00              0.00           
uniq-node         830206       830206       830206.00       0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    132120       132120       132120.00       0.00              0.00           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         711243       711243       711243.00       0.00              0.00           
hash-load         0.27         0.27         0.27            -0.00             0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       830206       830206       830206.00       0.00              0.00           
node-mem          55521711     55521711     55521711.00     -0.50             0.71           
total-node-mem    55521711     55521711     55521711.00     -0.50             0.71           
total-mem         77445095     77445095     77445095.00     0.00              0.00           
real-insert-time  609028       644573       626520.20       133603882.96      11558.71       
user-insert-time  312024       436028       369622.90       1277527525.69     35742.52       
sys-insert-time   204010       352022       277616.50       1709692811.65     41348.43       

real	0m12.443s
user	0m8.861s
sys	0m5.496s
$

$ path-set-test -p dups-line -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-line -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p line-mem -R ...
files       min          max          avg             var               dev
10          494          659          569.70          3757.21           61.30
100         5605         6305         5898.30         43939.21          209.62
1000        56699        58685        57635.40        429996.44         655.74
10000       576489       582498       579165.50       3198111.45        1788.33
100000      5778489      5797957      5788273.00      27022230.60       5198.29
1000000     48049857     48049857     48049857.00     -0.50             0.71
$

$ path-set-test -p dups-node -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-node -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p node-insert-eq -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p node-insert-ne -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            1            0.20            0.16              0.40
10000       16           23           19.20           7.56              2.75
100000      1866         1973         1912.30         1013.21           31.83
1000000     132120       132120       132120.00       0.00              0.00
$

$ path-set-test -p node-rehash-eq -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p node-rehash-ne -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p hash-size -R ...
files       min          max          avg             var               dev
10          2621447      2621447      2621447.00      0.00              0.00
100         2621447      2621447      2621447.00      0.00              0.00
1000        2621447      2621447      2621447.00      0.00              0.00
10000       2621447      2621447      2621447.00      0.00              0.00
100000      2621447      2621447      2621447.00      0.00              0.00
1000000     2621447      2621447      2621447.00      0.00              0.00
$

$ path-set-test -p hash-used -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        999          1000         999.80          0.16              0.40
10000       9977         9984         9980.80         7.56              2.75
100000      98047        98156        98108.00        1100.20           33.17
1000000     711243       711243       711243.00       0.00              0.00
$

$ path-set-test -p hash-load -R ...
files       min          max          avg             var               dev
10          0.00         0.00         0.00            0.00              0.00
100         0.00         0.00         0.00            0.00              0.00
1000        0.00         0.00         0.00            0.00              0.00
10000       0.00         0.00         0.00            0.00              0.00
100000      0.04         0.04         0.04            0.00              0.00
1000000     0.27         0.27         0.27            -0.00             0.00
$

$ path-set-test -p node-struct-size -R ...
files       min          max          avg             var               dev
10          8            8            8.00            0.00              0.00
100         8            8            8.00            0.00              0.00
1000        8            8            8.00            0.00              0.00
10000       8            8            8.00            0.00              0.00
100000      8            8            8.00            0.00              0.00
1000000     8            8            8.00            0.00              0.00
$

$ path-set-test -p node-struct -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p node-mem -R ...
files       min          max          avg             var               dev
10          584          749          659.70          3757.21           61.30
100         6505         7205         6798.30         43939.21          209.62
1000        65699        67685        66635.40        429996.44         655.74
10000       666489       672498       669165.50       3198111.45        1788.33
100000      6678489      6697957      6688273.00      27022230.60       5198.29
1000000     55521711     55521711     55521711.00     -0.50             0.71
$

$ path-set-test -p total-node-mem -R ...
files       min          max          avg             var               dev
10          584          749          659.70          3757.21           61.30
100         6505         7205         6798.30         43939.21          209.62
1000        65699        67685        66635.40        429996.44         655.74
10000       666489       672498       669165.50       3198111.45        1788.33
100000      6678489      6697957      6688273.00      27022230.60       5198.29
1000000     55521711     55521711     55521711.00     -0.50             0.71
$

$ path-set-test -p total-mem -R ...
files       min          max          avg             var               dev
10          20972264     20972429     20972339.70     3757.25           61.30
100         20978185     20978885     20978478.30     43939.19          209.62
1000        21037379     21039365     21038317.00     430251.81         655.94
10000       21638353     21644330     21640999.10     3173142.44        1781.33
100000      27665337     27684389     27675089.00     27086731.38       5204.49
1000000     77445095     77445095     77445095.00     0.00              0.00
$

$ path-set-test -p real-insert-time -R ...
files       min          max          avg             var               dev
10          1234         1931         1638.70         50443.61          224.60
100         2514         2745         2691.90         4392.29           66.27
1000        4310         4527         4438.30         3721.01           61.00
10000       11234        15292        13191.30        2041079.61        1428.66
100000      78490        82904        80195.40        1564450.64        1250.78
1000000     609028       644573       626520.20       133603882.96      11558.71
$

$ path-set-test -p user-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         1200.00         3360000.00        1833.03
10000       4000         12000        5600.10         7040480.09        2653.39
100000      32001        52002        40401.80        33444160.36       5783.09
1000000     312024       436028       369622.90       1277527525.69     35742.52
$

$ path-set-test -p sys-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         2000.00         4000000.00        2000.00
10000       0            12001        4800.10         12161440.09       3487.33
100000      24000        60004        40402.20        81451041.36       9025.02
1000000     204010       352022       277616.50       1709692811.65     41348.43
$

$ path-set-test -p dups-line -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-line -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p line-mem -A ...
min: 569
max: 48049857
avg: 9080232.83
var: 307987980199720.81
dev: 17549586.33
$

$ path-set-test -p dups-node -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-node -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p node-insert-eq -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-insert-ne -A ...
min: 0
max: 132120
avg: 22341.83
var: 2410734234.14
dev: 49099.23
$

$ path-set-test -p node-rehash-eq -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-rehash-ne -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p hash-size -A ...
min: 2621447
max: 2621447
avg: 2621447.00
var: 0.00
dev: 0.00
$

$ path-set-test -p hash-used -A ...
min: 10
max: 711243
avg: 136740.00
var: 67234237935.67
dev: 259295.66
$

$ path-set-test -p hash-load -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct-size -A ...
min: 8
max: 8
avg: 8.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p node-mem -A ...
min: 659
max: 55521711
avg: 10492206.83
var: 411221205226150.81
dev: 20278589.82
$

$ path-set-test -p total-node-mem -A ...
min: 659
max: 55521711
avg: 10492206.83
var: 411221205226150.81
dev: 20278589.82
$

$ path-set-test -p total-mem -A ...
min: 20972339
max: 77445095
avg: 31625052.83
var: 425611442114682.12
dev: 20630352.45
$

$ path-set-test -p real-insert-time -A ...
min: 1638
max: 626520
avg: 121445.50
var: 51778019075.58
dev: 227547.84
$

$ path-set-test -p user-insert-time -A ...
min: 0
max: 369622
avg: 69470.50
var: 18221426910.58
dev: 134986.77
$

$ path-set-test -p sys-insert-time -A ...
min: 0
max: 277616
avg: 54136.33
var: 10190924923.22
dev: 100950.11
$

