#
# # meta command:
# $ path-set-test \
# --input=tests/files.txt \
# --expr='10 ** x' \
# --limits=1-6 \
# --pool-size=128M \
# --hash-size=2M \
# --node-size=4M \
# --separators='/' \
# --repeat=10 \
# --sleep=100 \
# --plain-set \
# --gnulib-hash \
# --run-tests
#

$ date +'%Y-%m-%d %H:%M:%S.%N %z'
2016-09-29 13:16:15.571517592 +0300
$

$ ./path-set -C
CONFIG_PATH_TRIE_NODE_32BIT_OFFSETS: no
CONFIG_PATH_TRIE_ELEM_32BIT_OFFSETS: no
CONFIG_PATH_TRIE_UINT_HASH_IDENTOP:  no
CONFIG_TRIE_PATH_SET_PRINT_SET:      no
CONFIG_VALUE_TYPE_SIZE:              32
32BIT:                               yes
DEBUG:                               yes
OPT:                                 -
$

$ ./path-set --plain-set --gnulib-hash -I
node-struct-size: 8
$

$ ./path-set --plain-set --gnulib-hash -N
dups-line
uniq-line
line-mem
dups-node
uniq-node
node-insert-eq
node-insert-ne
node-rehash-eq
node-rehash-ne
hash-size
hash-used
hash-load
node-struct-size
node-struct
node-mem
total-node-mem
total-mem
insert-time
$

$ PATH_SET_TEST_INPUT=tests/files.txt
$ PATH_SET_TEST_POOL_SIZE=128M
$ PATH_SET_TEST_HASH_SIZE=2M
$ PATH_SET_TEST_NODE_SIZE=4M
$ PATH_SET_TEST_STRUCT_TYPE=plain-set
$ PATH_SET_TEST_SET_TYPE=gnulib-hash
$ PATH_SET_TEST_SEPARATORS='/'
$

$ time path-set-test -t 10
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10           10           10.00           0.00              0.00           
line-mem          556          877          714.20          7857.76           88.64          
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10           10           10.00           0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            0            0.00            0.00              0.00           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         10           10           10.00           0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       10           10           10.00           0.00              0.00           
node-mem          646          967          804.20          7857.76           88.64          
total-node-mem    646          967          804.20          7857.76           88.64          
total-mem         20972326     20972647     20972484.20     7857.75           88.64          
real-insert-time  1223         2139         1564.80         73617.16          271.32         
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m1.014s
user	0m0.464s
sys	0m0.252s
$

$ time path-set-test -t 100
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100          100          100.00          0.00              0.00           
line-mem          6296         6983         6577.60         51736.64          227.46         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100          100          100.00          0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            0            0.00            0.00              0.00           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         100          100          100.00          0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       100          100          100.00          0.00              0.00           
node-mem          7196         7883         7477.60         51736.64          227.46         
total-node-mem    7196         7883         7477.60         51736.64          227.46         
total-mem         20978876     20979563     20979157.60     51736.56          227.46         
real-insert-time  2134         2739         2636.00         30060.40          173.38         
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m1.034s
user	0m0.524s
sys	0m0.204s
$

$ time path-set-test -t 1000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         1000         1000         1000.00         0.00              0.00           
line-mem          64622        67038        65793.20        644427.36         802.76         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         1000         1000         1000.00         0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            1            0.20            0.16              0.40           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         999          1000         999.80          0.16              0.40           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       1000         1000         1000.00         0.00              0.00           
node-mem          73622        76038        74793.20        644427.36         802.76         
total-node-mem    73622        76038        74793.20        644427.36         802.76         
total-mem         21045302     21047718     21046474.80     645432.12         803.39         
real-insert-time  4170         4551         4433.90         11587.69          107.65         
user-insert-time  0            4000         400.00          1440000.00        1200.00        
sys-insert-time   0            4000         2400.00         3840000.00        1959.59        

real	0m0.996s
user	0m0.496s
sys	0m0.224s
$

$ time path-set-test -t 10000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10000        10000        10000.00        0.00              0.00           
line-mem          654623       661764       656808.30       3788945.01        1946.52        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10000        10000        10000.00        0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    16           30           19.50           18.05             4.25           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         9970         9984         9980.50         18.05             4.25           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       10000        10000        10000.00        0.00              0.00           
node-mem          744623       751764       746808.30       3788945.01        1946.52        
total-node-mem    744623       751764       746808.30       3788945.01        1946.52        
total-mem         21716471     21723572     21718644.30     3756869.00        1938.26        
real-insert-time  10334        15390        13512.60        2512737.44        1585.16        
user-insert-time  4000         12001        8000.10         9600800.09        3098.52        
sys-insert-time   0            8000         3600.10         4640080.09        2154.08        

real	0m1.192s
user	0m0.596s
sys	0m0.312s
$

$ time path-set-test -t 100000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100000       100000       100000.00       0.00              0.00           
line-mem          6556980      6578066      6569925.70      43984327.21       6632.07        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100000       100000       100000.00       0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    1878         2036         1951.20         2187.76           46.77          
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         98003        98156        98079.80        1838.16           42.87          
hash-load         0.04         0.04         0.04            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       100000       100000       100000.00       0.00              0.00           
node-mem          7456980      7478066      7469925.70      43984327.21       6632.07        
total-node-mem    7456980      7478066      7469925.70      43984327.21       6632.07        
total-mem         28444300     28465498     28456967.30     44684135.12       6684.62        
real-insert-time  80744        84169        82656.50        1171602.05        1082.41        
user-insert-time  28002        68003        42002.30        138411600.61      11764.85       
sys-insert-time   32002        48001        38002.20        23196000.76       4816.22        

real	0m2.401s
user	0m1.500s
sys	0m0.908s
$

$ time path-set-test -t 1000000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         405909       405909       405909.00       0.00              0.00           
line-mem          26666438     26666438     26666438.00     0.00              0.00           
dups-node         0            0            0.00            0.00              0.00           
uniq-node         405909       405909       405909.00       0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    32057        32057        32057.00        0.00              0.00           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         375601       375601       375601.00       0.00              0.00           
hash-load         0.14         0.14         0.14            -0.00             0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       405909       405909       405909.00       0.00              0.00           
node-mem          30319619     30319619     30319619.00     0.00              0.00           
total-node-mem    30319619     30319619     30319619.00     0.00              0.00           
total-mem         51533763     51533763     51533763.00     -0.50             0.71           
real-insert-time  306526       327807       316663.40       36533284.04       6044.28        
user-insert-time  144011       208008       176410.50       324627603.05      18017.42       
sys-insert-time   100004       160009       128407.30       337492567.01      18370.97       

real	0m6.501s
user	0m4.552s
sys	0m2.820s
$

$ path-set-test -p dups-line -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-line -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p line-mem -R ...
files       min          max          avg             var               dev
10          556          877          714.20          7857.76           88.64
100         6296         6983         6577.60         51736.64          227.46
1000        64622        67038        65793.20        644427.36         802.76
10000       654623       661764       656808.30       3788945.01        1946.52
100000      6556980      6578066      6569925.70      43984327.21       6632.07
1000000     26666438     26666438     26666438.00     0.00              0.00
$

$ path-set-test -p dups-node -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-node -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p node-insert-eq -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p node-insert-ne -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            1            0.20            0.16              0.40
10000       16           30           19.50           18.05             4.25
100000      1878         2036         1951.20         2187.76           46.77
1000000     32057        32057        32057.00        0.00              0.00
$

$ path-set-test -p node-rehash-eq -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p node-rehash-ne -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p hash-size -R ...
files       min          max          avg             var               dev
10          2621447      2621447      2621447.00      0.00              0.00
100         2621447      2621447      2621447.00      0.00              0.00
1000        2621447      2621447      2621447.00      0.00              0.00
10000       2621447      2621447      2621447.00      0.00              0.00
100000      2621447      2621447      2621447.00      0.00              0.00
1000000     2621447      2621447      2621447.00      0.00              0.00
$

$ path-set-test -p hash-used -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        999          1000         999.80          0.16              0.40
10000       9970         9984         9980.50         18.05             4.25
100000      98003        98156        98079.80        1838.16           42.87
1000000     375601       375601       375601.00       0.00              0.00
$

$ path-set-test -p hash-load -R ...
files       min          max          avg             var               dev
10          0.00         0.00         0.00            0.00              0.00
100         0.00         0.00         0.00            0.00              0.00
1000        0.00         0.00         0.00            0.00              0.00
10000       0.00         0.00         0.00            0.00              0.00
100000      0.04         0.04         0.04            0.00              0.00
1000000     0.14         0.14         0.14            -0.00             0.00
$

$ path-set-test -p node-struct-size -R ...
files       min          max          avg             var               dev
10          8            8            8.00            0.00              0.00
100         8            8            8.00            0.00              0.00
1000        8            8            8.00            0.00              0.00
10000       8            8            8.00            0.00              0.00
100000      8            8            8.00            0.00              0.00
1000000     8            8            8.00            0.00              0.00
$

$ path-set-test -p node-struct -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p node-mem -R ...
files       min          max          avg             var               dev
10          646          967          804.20          7857.76           88.64
100         7196         7883         7477.60         51736.64          227.46
1000        73622        76038        74793.20        644427.36         802.76
10000       744623       751764       746808.30       3788945.01        1946.52
100000      7456980      7478066      7469925.70      43984327.21       6632.07
1000000     30319619     30319619     30319619.00     0.00              0.00
$

$ path-set-test -p total-node-mem -R ...
files       min          max          avg             var               dev
10          646          967          804.20          7857.76           88.64
100         7196         7883         7477.60         51736.64          227.46
1000        73622        76038        74793.20        644427.36         802.76
10000       744623       751764       746808.30       3788945.01        1946.52
100000      7456980      7478066      7469925.70      43984327.21       6632.07
1000000     30319619     30319619     30319619.00     0.00              0.00
$

$ path-set-test -p total-mem -R ...
files       min          max          avg             var               dev
10          20972326     20972647     20972484.20     7857.75           88.64
100         20978876     20979563     20979157.60     51736.56          227.46
1000        21045302     21047718     21046474.80     645432.12         803.39
10000       21716471     21723572     21718644.30     3756869.00        1938.26
100000      28444300     28465498     28456967.30     44684135.12       6684.62
1000000     51533763     51533763     51533763.00     -0.50             0.71
$

$ path-set-test -p real-insert-time -R ...
files       min          max          avg             var               dev
10          1223         2139         1564.80         73617.16          271.32
100         2134         2739         2636.00         30060.40          173.38
1000        4170         4551         4433.90         11587.69          107.65
10000       10334        15390        13512.60        2512737.44        1585.16
100000      80744        84169        82656.50        1171602.05        1082.41
1000000     306526       327807       316663.40       36533284.04       6044.28
$

$ path-set-test -p user-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         400.00          1440000.00        1200.00
10000       4000         12001        8000.10         9600800.09        3098.52
100000      28002        68003        42002.30        138411600.61      11764.85
1000000     144011       208008       176410.50       324627603.05      18017.42
$

$ path-set-test -p sys-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         2400.00         3840000.00        1959.59
10000       0            8000         3600.10         4640080.09        2154.08
100000      32002        48001        38002.20        23196000.76       4816.22
1000000     100004       160009       128407.30       337492567.01      18370.97
$

$ path-set-test -p dups-line -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-line -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p line-mem -A ...
min: 714
max: 26666438
avg: 5661042.50
var: 93735697704511.58
dev: 9681719.77
$

$ path-set-test -p dups-node -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-node -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p node-insert-eq -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-insert-ne -A ...
min: 0
max: 32057
avg: 5671.17
var: 139747537.14
dev: 11821.49
$

$ path-set-test -p node-rehash-eq -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-rehash-ne -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p hash-size -A ...
min: 2621447
max: 2621447
avg: 2621447.00
var: 0.00
dev: 0.00
$

$ path-set-test -p hash-used -A ...
min: 10
max: 375601
avg: 80794.83
var: 18604896563.81
dev: 136399.77
$

$ path-set-test -p hash-load -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct-size -A ...
min: 8
max: 8
avg: 8.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p node-mem -A ...
min: 804
max: 30319619
avg: 6436571.00
var: 121177628519366.34
dev: 11008071.06
$

$ path-set-test -p total-node-mem -A ...
min: 804
max: 30319619
avg: 6436571.00
var: 121177628519366.34
dev: 11008071.06
$

$ path-set-test -p total-mem -A ...
min: 20972484
max: 51533763
avg: 27451248.17
var: 123120870487342.38
dev: 11095984.43
$

$ path-set-test -p real-insert-time -A ...
min: 1564
max: 316663
avg: 70244.00
var: 12952295485.67
dev: 113808.15
$

$ path-set-test -p user-insert-time -A ...
min: 0
max: 176410
avg: 37802.00
var: 4062478146.67
dev: 63737.57
$

$ path-set-test -p sys-insert-time -A ...
min: 0
max: 128407
avg: 28734.83
var: 2166180962.14
dev: 46542.25
$

