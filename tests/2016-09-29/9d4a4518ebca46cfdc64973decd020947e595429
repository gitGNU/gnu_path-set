#
# # meta command:
# $ path-set-test \
# --input=tests/files2.txt \
# --expr='10 ** x' \
# --limits=1-6 \
# --pool-size=512M \
# --hash-size=2M \
# --node-size=4M \
# --separators='/' \
# --repeat=10 \
# --sleep=100 \
# --plain-set \
# --linear-hash \
# --run-tests
#

$ date +'%Y-%m-%d %H:%M:%S.%N %z'
2016-09-29 13:27:21.515010107 +0300
$

$ ./path-set -C
CONFIG_PATH_TRIE_NODE_32BIT_OFFSETS: yes
CONFIG_PATH_TRIE_ELEM_32BIT_OFFSETS: yes
CONFIG_PATH_TRIE_UINT_HASH_IDENTOP:  no
CONFIG_TRIE_PATH_SET_PRINT_SET:      no
CONFIG_VALUE_TYPE_SIZE:              64
32BIT:                               no
DEBUG:                               yes
OPT:                                 -
$

$ ./path-set --plain-set --linear-hash -I
node-struct-size: 8
$

$ ./path-set --plain-set --linear-hash -N
dups-line
uniq-line
line-mem
dups-node
uniq-node
node-insert-eq
node-insert-ne
hash-size
hash-used
hash-load
node-struct-size
node-struct
node-mem
total-node-mem
total-mem
insert-time
$

$ PATH_SET_TEST_INPUT=tests/files2.txt
$ PATH_SET_TEST_POOL_SIZE=512M
$ PATH_SET_TEST_HASH_SIZE=2M
$ PATH_SET_TEST_NODE_SIZE=4M
$ PATH_SET_TEST_STRUCT_TYPE=plain-set
$ PATH_SET_TEST_SET_TYPE=linear-hash
$ PATH_SET_TEST_SEPARATORS='/'
$

$ time path-set-test -t 10
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10           10           10.00           0.00              0.00           
line-mem          504          638          574.80          1852.56           43.04          
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10           10           10.00           0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            0            0.00            0.00              0.00           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         10           10           10.00           0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       10           10           10.00           0.00              0.00           
node-mem          594          728          664.80          1852.56           43.04          
total-node-mem    594          728          664.80          1852.56           43.04          
total-mem         16778010     16778144     16778080.80     1852.50           43.04          
real-insert-time  904          1910         1248.10         94614.89          307.60         
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m1.343s
user	0m0.760s
sys	0m0.284s
$

$ time path-set-test -t 100
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100          100          100.00          0.00              0.00           
line-mem          5484         6101         5807.00         27451.60          165.69         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100          100          100.00          0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            0            0.00            0.00              0.00           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         100          100          100.00          0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       100          100          100.00          0.00              0.00           
node-mem          6384         7001         6707.00         27451.60          165.69         
total-node-mem    6384         7001         6707.00         27451.60          165.69         
total-mem         16783800     16784417     16784123.00     27451.62          165.69         
real-insert-time  2028         2153         2090.30         1381.81           37.17          
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m1.331s
user	0m0.788s
sys	0m0.252s
$

$ time path-set-test -t 1000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         1000         1000         1000.00         0.00              0.00           
line-mem          57081        58481        57792.00        219618.40         468.63         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         1000         1000         1000.00         0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            2            0.20            0.36              0.60           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         1000         1000         1000.00         0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       1000         1000         1000.00         0.00              0.00           
node-mem          66081        67481        66792.00        219618.40         468.63         
total-node-mem    66081        67481        66792.00        219618.40         468.63         
total-mem         16843497     16844897     16844208.00     219618.38         468.63         
real-insert-time  3546         3701         3625.10         2294.09           47.90          
user-insert-time  0            4000         400.00          1440000.00        1200.00        
sys-insert-time   0            4000         2400.00         3840000.00        1959.59        

real	0m1.369s
user	0m0.800s
sys	0m0.304s
$

$ time path-set-test -t 10000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10000        10000        10000.00        0.00              0.00           
line-mem          576713       583740       578489.90       3692081.49        1921.48        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10000        10000        10000.00        0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    19           30           24.80           10.96             3.31           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         10000        10000        10000.00        0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       10000        10000        10000.00        0.00              0.00           
node-mem          666713       673740       668489.90       3692081.49        1921.48        
total-node-mem    666713       673740       668489.90       3692081.49        1921.48        
total-mem         17444129     17451156     17445905.90     3692081.56        1921.48        
real-insert-time  10032        12973        11609.70        1045461.61        1022.48        
user-insert-time  0            12000        4400.10         17440720.09       4176.21        
sys-insert-time   0            12000        4800.00         12160000.00       3487.12        

real	0m1.485s
user	0m0.908s
sys	0m0.316s
$

$ time path-set-test -t 100000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100000       100000       100000.00       0.00              0.00           
line-mem          5779380      5798933      5790542.40      25942180.04       5093.35        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100000       100000       100000.00       0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    2444         2563         2515.50         1806.65           42.50          
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         100000       100000       100000.00       0.00              0.00           
hash-load         0.05         0.05         0.05            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       100000       100000       100000.00       0.00              0.00           
node-mem          6679380      6698933      6690542.40      25942180.03       5093.35        
total-node-mem    6679380      6698933      6690542.40      25942180.03       5093.35        
total-mem         23456796     23476349     23467958.40     25942180.12       5093.35        
real-insert-time  63032        67541        65615.20        2387409.16        1545.12        
user-insert-time  28000        48002        37602.10        39047681.29       6248.81        
sys-insert-time   20001        44001        29601.50        48641600.45       6974.35        

real	0m2.437s
user	0m1.624s
sys	0m0.812s
$

$ time path-set-test -t 1000000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         830206       830206       830206.00       0.00              0.00           
line-mem          48049857     48049857     48049857.00     -0.50             0.71           
dups-node         0            0            0.00            0.00              0.00           
uniq-node         830206       830206       830206.00       0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    286678       286678       286678.00       0.00              0.00           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         830206       830206       830206.00       0.00              0.00           
hash-load         0.40         0.40         0.40            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       830206       830206       830206.00       0.00              0.00           
node-mem          55521711     55521711     55521711.00     -0.50             0.71           
total-node-mem    55521711     55521711     55521711.00     -0.50             0.71           
total-mem         72299127     72299127     72299127.00     0.00              0.00           
real-insert-time  499512       521895       509525.60       57755954.44       7599.73        
user-insert-time  276017       352025       308020.10       720084807.29      26834.40       
sys-insert-time   160011       240016       209612.80       739935047.16      27201.75       

real	0m10.096s
user	0m7.620s
sys	0m4.348s
$

$ path-set-test -p dups-line -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-line -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p line-mem -R ...
files       min          max          avg             var               dev
10          504          638          574.80          1852.56           43.04
100         5484         6101         5807.00         27451.60          165.69
1000        57081        58481        57792.00        219618.40         468.63
10000       576713       583740       578489.90       3692081.49        1921.48
100000      5779380      5798933      5790542.40      25942180.04       5093.35
1000000     48049857     48049857     48049857.00     -0.50             0.71
$

$ path-set-test -p dups-node -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-node -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p node-insert-eq -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p node-insert-ne -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            2            0.20            0.36              0.60
10000       19           30           24.80           10.96             3.31
100000      2444         2563         2515.50         1806.65           42.50
1000000     286678       286678       286678.00       0.00              0.00
$

$ path-set-test -p hash-size -R ...
files       min          max          avg             var               dev
10          2097169      2097169      2097169.00      0.00              0.00
100         2097169      2097169      2097169.00      0.00              0.00
1000        2097169      2097169      2097169.00      0.00              0.00
10000       2097169      2097169      2097169.00      0.00              0.00
100000      2097169      2097169      2097169.00      0.00              0.00
1000000     2097169      2097169      2097169.00      0.00              0.00
$

$ path-set-test -p hash-used -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p hash-load -R ...
files       min          max          avg             var               dev
10          0.00         0.00         0.00            0.00              0.00
100         0.00         0.00         0.00            0.00              0.00
1000        0.00         0.00         0.00            0.00              0.00
10000       0.00         0.00         0.00            0.00              0.00
100000      0.05         0.05         0.05            0.00              0.00
1000000     0.40         0.40         0.40            0.00              0.00
$

$ path-set-test -p node-struct-size -R ...
files       min          max          avg             var               dev
10          8            8            8.00            0.00              0.00
100         8            8            8.00            0.00              0.00
1000        8            8            8.00            0.00              0.00
10000       8            8            8.00            0.00              0.00
100000      8            8            8.00            0.00              0.00
1000000     8            8            8.00            0.00              0.00
$

$ path-set-test -p node-struct -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p node-mem -R ...
files       min          max          avg             var               dev
10          594          728          664.80          1852.56           43.04
100         6384         7001         6707.00         27451.60          165.69
1000        66081        67481        66792.00        219618.40         468.63
10000       666713       673740       668489.90       3692081.49        1921.48
100000      6679380      6698933      6690542.40      25942180.03       5093.35
1000000     55521711     55521711     55521711.00     -0.50             0.71
$

$ path-set-test -p total-node-mem -R ...
files       min          max          avg             var               dev
10          594          728          664.80          1852.56           43.04
100         6384         7001         6707.00         27451.60          165.69
1000        66081        67481        66792.00        219618.40         468.63
10000       666713       673740       668489.90       3692081.49        1921.48
100000      6679380      6698933      6690542.40      25942180.03       5093.35
1000000     55521711     55521711     55521711.00     -0.50             0.71
$

$ path-set-test -p total-mem -R ...
files       min          max          avg             var               dev
10          16778010     16778144     16778080.80     1852.50           43.04
100         16783800     16784417     16784123.00     27451.62          165.69
1000        16843497     16844897     16844208.00     219618.38         468.63
10000       17444129     17451156     17445905.90     3692081.56        1921.48
100000      23456796     23476349     23467958.40     25942180.12       5093.35
1000000     72299127     72299127     72299127.00     0.00              0.00
$

$ path-set-test -p real-insert-time -R ...
files       min          max          avg             var               dev
10          904          1910         1248.10         94614.89          307.60
100         2028         2153         2090.30         1381.81           37.17
1000        3546         3701         3625.10         2294.09           47.90
10000       10032        12973        11609.70        1045461.61        1022.48
100000      63032        67541        65615.20        2387409.16        1545.12
1000000     499512       521895       509525.60       57755954.44       7599.73
$

$ path-set-test -p user-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         400.00          1440000.00        1200.00
10000       0            12000        4400.10         17440720.09       4176.21
100000      28000        48002        37602.10        39047681.29       6248.81
1000000     276017       352025       308020.10       720084807.29      26834.40
$

$ path-set-test -p sys-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         2400.00         3840000.00        1959.59
10000       0            12000        4800.00         12160000.00       3487.12
100000      20001        44001        29601.50        48641600.45       6974.35
1000000     160011       240016       209612.80       739935047.16      27201.75
$

$ path-set-test -p dups-line -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-line -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p line-mem -A ...
min: 574
max: 48049857
avg: 9080510.17
var: 307987194756950.50
dev: 17549563.95
$

$ path-set-test -p dups-node -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-node -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p node-insert-eq -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-insert-ne -A ...
min: 0
max: 286678
avg: 48202.83
var: 11374920439.47
dev: 106653.27
$

$ path-set-test -p hash-size -A ...
min: 2097169
max: 2097169
avg: 2097169.00
var: 0.00
dev: 0.00
$

$ path-set-test -p hash-used -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p hash-load -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct-size -A ...
min: 8
max: 8
avg: 8.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p node-mem -A ...
min: 664
max: 55521711
avg: 10492484.17
var: 411220297472318.50
dev: 20278567.44
$

$ path-set-test -p total-node-mem -A ...
min: 664
max: 55521711
avg: 10492484.17
var: 411220297472318.50
dev: 20278567.44
$

$ path-set-test -p total-mem -A ...
min: 16778080
max: 72299127
avg: 27269900.17
var: 411220297472318.50
dev: 20278567.44
$

$ path-set-test -p real-insert-time -A ...
min: 1248
max: 509525
avg: 98952.00
var: 34220983189.33
dev: 184989.14
$

$ path-set-test -p user-insert-time -A ...
min: 0
max: 308020
avg: 58403.67
var: 12640636853.89
dev: 112430.59
$

$ path-set-test -p sys-insert-time -A ...
min: 0
max: 209612
avg: 41068.83
var: 5787052552.81
dev: 76072.68
$

