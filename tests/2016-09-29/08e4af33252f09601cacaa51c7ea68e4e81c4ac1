#
# # meta command:
# $ path-set-test \
# --input=tests/files2.txt \
# --expr='10 ** x' \
# --limits=1-6 \
# --pool-size=512M \
# --hash-size=2M \
# --node-size=4M \
# --separators='/' \
# --repeat=10 \
# --sleep=100 \
# --plain-set \
# --ternary-tree \
# --run-tests
#

$ date +'%Y-%m-%d %H:%M:%S.%N %z'
2016-09-29 13:23:45.698891640 +0300
$

$ ./path-set -C
CONFIG_PATH_TRIE_NODE_32BIT_OFFSETS: no
CONFIG_PATH_TRIE_ELEM_32BIT_OFFSETS: no
CONFIG_PATH_TRIE_UINT_HASH_IDENTOP:  no
CONFIG_TRIE_PATH_SET_PRINT_SET:      no
CONFIG_VALUE_TYPE_SIZE:              64
32BIT:                               no
DEBUG:                               yes
OPT:                                 -
$

$ ./path-set --plain-set --ternary-tree -I
node-struct-size: 32
$

$ ./path-set --plain-set --ternary-tree -N
dups-line
uniq-line
line-mem
dups-node
uniq-node
node-insert-eq
node-insert-lt
node-insert-gt
node-struct-size
node-struct
node-mem
total-node-mem
total-mem
insert-time
$

$ PATH_SET_TEST_INPUT=tests/files2.txt
$ PATH_SET_TEST_POOL_SIZE=512M
$ PATH_SET_TEST_HASH_SIZE=2M
$ PATH_SET_TEST_NODE_SIZE=4M
$ PATH_SET_TEST_STRUCT_TYPE=plain-set
$ PATH_SET_TEST_SET_TYPE=ternary-tree
$ PATH_SET_TEST_SEPARATORS='/'
$

$ time path-set-test -t 10
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10           10           10.00           0.00              0.00           
line-mem          466          698          573.00          7028.20           83.83          
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10           10           10.00           0.00              0.00           
node-insert-eq    82           136          105.90          336.49            18.34          
node-insert-lt    6            13           9.60            5.84              2.42           
node-insert-gt    4            15           7.50            12.65             3.56           
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       351          589          477.10          5953.49           77.16          
node-mem          11232        18848        15267.20        6096373.76        2469.08        
total-node-mem    11232        18848        15267.20        6096373.76        2469.08        
total-mem         11288        18904        15323.20        6096373.76        2469.08        
real-insert-time  31           47           37.30           22.61             4.75           
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m1.897s
user	0m0.756s
sys	0m0.300s
$

$ time path-set-test -t 100
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100          100          100.00          0.00              0.00           
line-mem          5604         5919         5779.00         9160.80           95.71          
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100          100          100.00          0.00              0.00           
node-insert-eq    1684         2180         1912.10         15737.69          125.45         
node-insert-lt    148          284          199.90          1552.29           39.40          
node-insert-gt    130          264          199.20          2561.76           50.61          
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       3755         4114         3966.90         10083.69          100.42         
node-mem          120160       131648       126940.80       10325698.56       3213.36        
total-node-mem    120160       131648       126940.80       10325698.56       3213.36        
total-mem         120216       131704       126996.80       10325698.56       3213.36        
real-insert-time  217          287          244.20          309.96            17.61          
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m1.345s
user	0m0.784s
sys	0m0.272s
$

$ time path-set-test -t 1000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         1000         1000         1000.00         0.00              0.00           
line-mem          56465        58672        57579.50        304742.25         552.03         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         1000         1000         1000.00         0.00              0.00           
node-insert-eq    27679        29403        28554.50        232580.85         482.27         
node-insert-lt    2045         3751         2895.40         218049.44         466.96         
node-insert-gt    2179         4139         2934.80         259786.76         509.69         
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       29584        30491        30025.00        87602.60          295.98         
node-mem          946688       975712       960800.00       89705062.40       9471.28        
total-node-mem    946688       975712       960800.00       89705062.40       9471.28        
total-mem         946744       975768       960856.00       89705062.40       9471.28        
real-insert-time  3377         3961         3778.70         21220.01          145.67         
user-insert-time  0            4000         2000.00         4000000.00        2000.00        
sys-insert-time   0            4000         400.00          1440000.00        1200.00        

real	0m1.383s
user	0m0.824s
sys	0m0.268s
$

$ time path-set-test -t 10000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10000        10000        10000.00        0.00              0.00           
line-mem          573214       580883       577399.70       6041524.61        2457.95        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10000        10000        10000.00        0.00              0.00           
node-insert-eq    366821       373143       369772.50       3117508.05        1765.65        
node-insert-lt    34866        46229        39120.20        11645680.36       3412.58        
node-insert-gt    32736        51347        38883.10        28670486.89       5354.48        
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       216119       218834       217627.20       867455.36         931.37         
node-mem          6915808      7002688      6964070.40      888274288.63      29803.93       
total-node-mem    6915808      7002688      6964070.40      888274288.63      29803.93       
total-mem         6915864      7002744      6964126.40      888274288.63      29803.93       
real-insert-time  17961        23739        20829.80        2603158.56        1613.43        
user-insert-time  8000         24001        14400.60        29442720.24       5426.11        
sys-insert-time   0            16001        5600.10         23042080.09       4800.22        

real	0m1.572s
user	0m0.996s
sys	0m0.324s
$

$ time path-set-test -t 100000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100000       100000       100000.00       0.00              0.00           
line-mem          5779211      5801198      5788753.40      36735591.64       6060.99        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100000       100000       100000.00       0.00              0.00           
node-insert-eq    4363930      4387216      4374162.20      36599748.76       6049.77        
node-insert-lt    444763       522111       482075.10       596593032.89      24425.25       
node-insert-gt    426069       601933       502041.10       3496331574.89     59129.79       
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       1512139      1516865      1514591.20      1494940.76        1222.68        
node-mem          48388448     48539680     48466918.40     1530819338.50     39125.69       
total-node-mem    48388448     48539680     48466918.40     1530819338.50     39125.69       
total-mem         48388504     48539736     48466974.40     1530819338.50     39125.69       
real-insert-time  166094       172869       169828.70       4953172.41        2225.57        
user-insert-time  100007       172011       134008.00       468058402.40      21634.66       
sys-insert-time   20001        56003        37602.40        170265121.24      13048.57       

real	0m3.508s
user	0m2.672s
sys	0m0.888s
$

$ time path-set-test -t 1000000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         830206       830206       830206.00       0.00              0.00           
line-mem          48049857     48049857     48049857.00     -0.50             0.71           
dups-node         0            0            0.00            0.00              0.00           
uniq-node         830206       830206       830206.00       0.00              0.00           
node-insert-eq    39958859     39958859     39958859.00     -0.25             0.50           
node-insert-lt    4560984      5706083      5082846.60      150194581538.25   387549.46      
node-insert-gt    4316150      5284611      4875956.10      84500256154.09    290689.28      
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       8921204      8921204      8921204.00      0.00              0.00           
node-mem          285478528    285478528    285478528.00    0.00              0.00           
total-node-mem    285478528    285478528    285478528.00    0.00              0.00           
total-mem         285478584    285478584    285478584.00    -16.00            4.00           
real-insert-time  1407661      1460540      1430213.00      308214939.20      17556.05       
user-insert-time  1120064      1228072      1172473.80      1255972176.76     35439.70       
sys-insert-time   232013       332019       284416.90       1403213687.69     37459.49       

real	0m19.377s
user	0m17.205s
sys	0m4.460s
$

$ path-set-test -p dups-line -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-line -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p line-mem -R ...
files       min          max          avg             var               dev
10          466          698          573.00          7028.20           83.83
100         5604         5919         5779.00         9160.80           95.71
1000        56465        58672        57579.50        304742.25         552.03
10000       573214       580883       577399.70       6041524.61        2457.95
100000      5779211      5801198      5788753.40      36735591.64       6060.99
1000000     48049857     48049857     48049857.00     -0.50             0.71
$

$ path-set-test -p dups-node -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-node -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p node-insert-eq -R ...
files       min          max          avg             var               dev
10          82           136          105.90          336.49            18.34
100         1684         2180         1912.10         15737.69          125.45
1000        27679        29403        28554.50        232580.85         482.27
10000       366821       373143       369772.50       3117508.05        1765.65
100000      4363930      4387216      4374162.20      36599748.76       6049.77
1000000     39958859     39958859     39958859.00     -0.25             0.50
$

$ path-set-test -p node-insert-lt -R ...
files       min          max          avg             var               dev
10          6            13           9.60            5.84              2.42
100         148          284          199.90          1552.29           39.40
1000        2045         3751         2895.40         218049.44         466.96
10000       34866        46229        39120.20        11645680.36       3412.58
100000      444763       522111       482075.10       596593032.89      24425.25
1000000     4560984      5706083      5082846.60      150194581538.25   387549.46
$

$ path-set-test -p node-insert-gt -R ...
files       min          max          avg             var               dev
10          4            15           7.50            12.65             3.56
100         130          264          199.20          2561.76           50.61
1000        2179         4139         2934.80         259786.76         509.69
10000       32736        51347        38883.10        28670486.89       5354.48
100000      426069       601933       502041.10       3496331574.89     59129.79
1000000     4316150      5284611      4875956.10      84500256154.09    290689.28
$

$ path-set-test -p node-struct-size -R ...
files       min          max          avg             var               dev
10          32           32           32.00           0.00              0.00
100         32           32           32.00           0.00              0.00
1000        32           32           32.00           0.00              0.00
10000       32           32           32.00           0.00              0.00
100000      32           32           32.00           0.00              0.00
1000000     32           32           32.00           0.00              0.00
$

$ path-set-test -p node-struct -R ...
files       min          max          avg             var               dev
10          351          589          477.10          5953.49           77.16
100         3755         4114         3966.90         10083.69          100.42
1000        29584        30491        30025.00        87602.60          295.98
10000       216119       218834       217627.20       867455.36         931.37
100000      1512139      1516865      1514591.20      1494940.76        1222.68
1000000     8921204      8921204      8921204.00      0.00              0.00
$

$ path-set-test -p node-mem -R ...
files       min          max          avg             var               dev
10          11232        18848        15267.20        6096373.76        2469.08
100         120160       131648       126940.80       10325698.56       3213.36
1000        946688       975712       960800.00       89705062.40       9471.28
10000       6915808      7002688      6964070.40      888274288.63      29803.93
100000      48388448     48539680     48466918.40     1530819338.50     39125.69
1000000     285478528    285478528    285478528.00    0.00              0.00
$

$ path-set-test -p total-node-mem -R ...
files       min          max          avg             var               dev
10          11232        18848        15267.20        6096373.76        2469.08
100         120160       131648       126940.80       10325698.56       3213.36
1000        946688       975712       960800.00       89705062.40       9471.28
10000       6915808      7002688      6964070.40      888274288.63      29803.93
100000      48388448     48539680     48466918.40     1530819338.50     39125.69
1000000     285478528    285478528    285478528.00    0.00              0.00
$

$ path-set-test -p total-mem -R ...
files       min          max          avg             var               dev
10          11288        18904        15323.20        6096373.76        2469.08
100         120216       131704       126996.80       10325698.56       3213.36
1000        946744       975768       960856.00       89705062.40       9471.28
10000       6915864      7002744      6964126.40      888274288.63      29803.93
100000      48388504     48539736     48466974.40     1530819338.50     39125.69
1000000     285478584    285478584    285478584.00    -16.00            4.00
$

$ path-set-test -p real-insert-time -R ...
files       min          max          avg             var               dev
10          31           47           37.30           22.61             4.75
100         217          287          244.20          309.96            17.61
1000        3377         3961         3778.70         21220.01          145.67
10000       17961        23739        20829.80        2603158.56        1613.43
100000      166094       172869       169828.70       4953172.41        2225.57
1000000     1407661      1460540      1430213.00      308214939.20      17556.05
$

$ path-set-test -p user-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         2000.00         4000000.00        2000.00
10000       8000         24001        14400.60        29442720.24       5426.11
100000      100007       172011       134008.00       468058402.40      21634.66
1000000     1120064      1228072      1172473.80      1255972176.76     35439.70
$

$ path-set-test -p sys-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         400.00          1440000.00        1200.00
10000       0            16001        5600.10         23042080.09       4800.22
100000      20001        56003        37602.40        170265121.24      13048.57
1000000     232013       332019       284416.90       1403213687.69     37459.49
$

$ path-set-test -p dups-line -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-line -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p line-mem -A ...
min: 573
max: 48049857
avg: 9079990.00
var: 307992974547745.00
dev: 17549728.62
$

$ path-set-test -p dups-node -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-node -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p node-insert-eq -A ...
min: 105
max: 39958859
avg: 7455560.67
var: 213744824497951.88
dev: 14620014.52
$

$ path-set-test -p node-insert-lt -A ...
min: 9
max: 5082846
avg: 934524.00
var: 3471541320165.33
dev: 1863207.27
$

$ path-set-test -p node-insert-gt -A ...
min: 7
max: 4875956
avg: 903336.67
var: 3188734969207.56
dev: 1785702.93
$

$ path-set-test -p node-struct-size -A ...
min: 32
max: 32
avg: 32.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct -A ...
min: 477
max: 8921204
avg: 1781315.00
var: 10481941149997.67
dev: 3237582.61
$

$ path-set-test -p node-mem -A ...
min: 15267
max: 285478528
avg: 57002087.17
var: 10733507032629618.00
dev: 103602640.09
$

$ path-set-test -p total-node-mem -A ...
min: 15267
max: 285478528
avg: 57002087.17
var: 10733507032629618.00
dev: 103602640.09
$

$ path-set-test -p total-mem -A ...
min: 15323
max: 285478584
avg: 57002143.17
var: 10733507032629620.00
dev: 103602640.09
$

$ path-set-test -p real-insert-time -A ...
min: 37
max: 1430213
avg: 270821.50
var: 272455541201.58
dev: 521972.74
$

$ path-set-test -p user-insert-time -A ...
min: 0
max: 1172473
avg: 220480.17
var: 183532236072.14
dev: 428406.62
$

$ path-set-test -p sys-insert-time -A ...
min: 0
max: 284416
avg: 54669.67
var: 10734209456.56
dev: 103606.03
$

