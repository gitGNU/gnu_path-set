#
# # meta command:
# $ path-set-test \
# --input=tests/files2.txt \
# --expr='10 ** x' \
# --limits=1-6 \
# --pool-size=512M \
# --hash-size=2M \
# --node-size=4M \
# --separators='/' \
# --repeat=10 \
# --sleep=100 \
# --plain-set \
# --gnulib-hash \
# --run-tests
#

$ date +'%Y-%m-%d %H:%M:%S.%N %z'
2016-09-29 13:24:34.051563259 +0300
$

$ ./path-set -C
CONFIG_PATH_TRIE_NODE_32BIT_OFFSETS: no
CONFIG_PATH_TRIE_ELEM_32BIT_OFFSETS: no
CONFIG_PATH_TRIE_UINT_HASH_IDENTOP:  no
CONFIG_TRIE_PATH_SET_PRINT_SET:      no
CONFIG_VALUE_TYPE_SIZE:              64
32BIT:                               no
DEBUG:                               yes
OPT:                                 -
$

$ ./path-set --plain-set --gnulib-hash -I
node-struct-size: 16
$

$ ./path-set --plain-set --gnulib-hash -N
dups-line
uniq-line
line-mem
dups-node
uniq-node
node-insert-eq
node-insert-ne
node-rehash-eq
node-rehash-ne
hash-size
hash-used
hash-load
node-struct-size
node-struct
node-mem
total-node-mem
total-mem
insert-time
$

$ PATH_SET_TEST_INPUT=tests/files2.txt
$ PATH_SET_TEST_POOL_SIZE=512M
$ PATH_SET_TEST_HASH_SIZE=2M
$ PATH_SET_TEST_NODE_SIZE=4M
$ PATH_SET_TEST_STRUCT_TYPE=plain-set
$ PATH_SET_TEST_SET_TYPE=gnulib-hash
$ PATH_SET_TEST_SEPARATORS='/'
$

$ time path-set-test -t 10
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10           10           10.00           0.00              0.00           
line-mem          498          703          573.50          3032.65           55.07          
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10           10           10.00           0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            0            0.00            0.00              0.00           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         10           10           10.00           0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       10           10           10.00           0.00              0.00           
node-mem          668          873          743.50          3032.65           55.07          
total-node-mem    668          873          743.50          3032.65           55.07          
total-mem         41944028     41944233     41944103.50     3032.50           55.07          
real-insert-time  1454         2525         2068.60         88601.04          297.66         
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m1.495s
user	0m0.884s
sys	0m0.316s
$

$ time path-set-test -t 100
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100          100          100.00          0.00              0.00           
line-mem          5414         5985         5754.00         39940.00          199.85         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100          100          100.00          0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            0            0.00            0.00              0.00           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         100          100          100.00          0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       100          100          100.00          0.00              0.00           
node-mem          7114         7685         7454.00         39940.00          199.85         
total-node-mem    7114         7685         7454.00         39940.00          199.85         
total-mem         41950474     41951045     41950814.00     39940.00          199.85         
real-insert-time  5205         5820         5547.20         39115.76          197.78         
user-insert-time  0            4000         400.00          1440000.00        1200.00        
sys-insert-time   0            4000         3600.00         1440000.00        1200.00        

real	0m1.513s
user	0m0.872s
sys	0m0.352s
$

$ time path-set-test -t 1000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         1000         1000         1000.00         0.00              0.00           
line-mem          56692        58308        57449.70        283598.01         532.54         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         1000         1000         1000.00         0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            1            0.20            0.16              0.40           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         999          1000         999.80          0.16              0.40           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       1000         1000         1000.00         0.00              0.00           
node-mem          73692        75308        74449.70        283598.01         532.54         
total-node-mem    73692        75308        74449.70        283598.01         532.54         
total-mem         42017052     42018668     42017812.90     285612.25         534.43         
real-insert-time  5667         7295         6763.20         295801.56         543.88         
user-insert-time  0            4000         400.00          1440000.00        1200.00        
sys-insert-time   4000         4000         4000.00         0.00              0.00           

real	0m1.507s
user	0m0.884s
sys	0m0.336s
$

$ time path-set-test -t 10000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10000        10000        10000.00        0.00              0.00           
line-mem          576636       582158       578533.50       3152432.05        1775.51        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10000        10000        10000.00        0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    12           27           18.60           21.04             4.59           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         9973         9988         9981.40         21.04             4.59           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       10000        10000        10000.00        0.00              0.00           
node-mem          746636       752158       748533.50       3152432.05        1775.51        
total-node-mem    746636       752158       748533.50       3152432.05        1775.51        
total-mem         42690252     42695822     42692191.10     3142582.75        1772.73        
real-insert-time  13088        16187        14313.80        1039309.96        1019.47        
user-insert-time  0            16001        2800.10         22562640.09       4750.01        
sys-insert-time   0            16001        8000.40         22404000.24       4733.29        

real	0m1.600s
user	0m0.916s
sys	0m0.416s
$

$ time path-set-test -t 100000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100000       100000       100000.00       0.00              0.00           
line-mem          5778846      5796304      5787614.10      25607008.50       5060.34        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100000       100000       100000.00       0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    1840         1979         1919.90         1577.29           39.72          
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         98045        98181        98105.60        1586.04           39.83          
hash-load         0.04         0.04         0.04            0.00              0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       100000       100000       100000.00       0.00              0.00           
node-mem          7478846      7496304      7487614.10      25607008.49       5060.34        
total-node-mem    7478846      7496304      7487614.10      25607008.49       5060.34        
total-mem         49453038     49470944     49461284.50     26722969.50       5169.43        
real-insert-time  70717        77195        74283.10        2343340.49        1530.80        
user-insert-time  32001        60003        44002.60        92812800.64       9633.94        
sys-insert-time   16001        48004        31201.70        101775520.81      10088.39       

real	0m2.632s
user	0m1.768s
sys	0m0.832s
$

$ time path-set-test -t 1000000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         830206       830206       830206.00       0.00              0.00           
line-mem          48049857     48049857     48049857.00     -0.50             0.71           
dups-node         0            0            0.00            0.00              0.00           
uniq-node         830206       830206       830206.00       0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    131735       131735       131735.00       0.00              0.00           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         711483       711483       711483.00       0.00              0.00           
hash-load         0.27         0.27         0.27            -0.00             0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       830206       830206       830206.00       0.00              0.00           
node-mem          62163359     62163359     62163359.00     0.00              0.00           
total-node-mem    62163359     62163359     62163359.00     0.00              0.00           
total-mem         106006287    106006287    106006287.00    0.00              0.00           
real-insert-time  559510       585663       574683.70       59648589.21       7723.25        
user-insert-time  308016       404028       348020.40       755346414.44      27483.57       
sys-insert-time   180010       268021       226413.30       608736170.81      24672.58       

real	0m10.950s
user	0m8.429s
sys	0m4.440s
$

$ path-set-test -p dups-line -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-line -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p line-mem -R ...
files       min          max          avg             var               dev
10          498          703          573.50          3032.65           55.07
100         5414         5985         5754.00         39940.00          199.85
1000        56692        58308        57449.70        283598.01         532.54
10000       576636       582158       578533.50       3152432.05        1775.51
100000      5778846      5796304      5787614.10      25607008.50       5060.34
1000000     48049857     48049857     48049857.00     -0.50             0.71
$

$ path-set-test -p dups-node -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-node -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p node-insert-eq -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p node-insert-ne -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            1            0.20            0.16              0.40
10000       12           27           18.60           21.04             4.59
100000      1840         1979         1919.90         1577.29           39.72
1000000     131735       131735       131735.00       0.00              0.00
$

$ path-set-test -p node-rehash-eq -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p node-rehash-ne -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p hash-size -R ...
files       min          max          avg             var               dev
10          2621447      2621447      2621447.00      0.00              0.00
100         2621447      2621447      2621447.00      0.00              0.00
1000        2621447      2621447      2621447.00      0.00              0.00
10000       2621447      2621447      2621447.00      0.00              0.00
100000      2621447      2621447      2621447.00      0.00              0.00
1000000     2621447      2621447      2621447.00      0.00              0.00
$

$ path-set-test -p hash-used -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        999          1000         999.80          0.16              0.40
10000       9973         9988         9981.40         21.04             4.59
100000      98045        98181        98105.60        1586.04           39.83
1000000     711483       711483       711483.00       0.00              0.00
$

$ path-set-test -p hash-load -R ...
files       min          max          avg             var               dev
10          0.00         0.00         0.00            0.00              0.00
100         0.00         0.00         0.00            0.00              0.00
1000        0.00         0.00         0.00            0.00              0.00
10000       0.00         0.00         0.00            0.00              0.00
100000      0.04         0.04         0.04            0.00              0.00
1000000     0.27         0.27         0.27            -0.00             0.00
$

$ path-set-test -p node-struct-size -R ...
files       min          max          avg             var               dev
10          16           16           16.00           0.00              0.00
100         16           16           16.00           0.00              0.00
1000        16           16           16.00           0.00              0.00
10000       16           16           16.00           0.00              0.00
100000      16           16           16.00           0.00              0.00
1000000     16           16           16.00           0.00              0.00
$

$ path-set-test -p node-struct -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p node-mem -R ...
files       min          max          avg             var               dev
10          668          873          743.50          3032.65           55.07
100         7114         7685         7454.00         39940.00          199.85
1000        73692        75308        74449.70        283598.01         532.54
10000       746636       752158       748533.50       3152432.05        1775.51
100000      7478846      7496304      7487614.10      25607008.49       5060.34
1000000     62163359     62163359     62163359.00     0.00              0.00
$

$ path-set-test -p total-node-mem -R ...
files       min          max          avg             var               dev
10          668          873          743.50          3032.65           55.07
100         7114         7685         7454.00         39940.00          199.85
1000        73692        75308        74449.70        283598.01         532.54
10000       746636       752158       748533.50       3152432.05        1775.51
100000      7478846      7496304      7487614.10      25607008.49       5060.34
1000000     62163359     62163359     62163359.00     0.00              0.00
$

$ path-set-test -p total-mem -R ...
files       min          max          avg             var               dev
10          41944028     41944233     41944103.50     3032.50           55.07
100         41950474     41951045     41950814.00     39940.00          199.85
1000        42017052     42018668     42017812.90     285612.25         534.43
10000       42690252     42695822     42692191.10     3142582.75        1772.73
100000      49453038     49470944     49461284.50     26722969.50       5169.43
1000000     106006287    106006287    106006287.00    0.00              0.00
$

$ path-set-test -p real-insert-time -R ...
files       min          max          avg             var               dev
10          1454         2525         2068.60         88601.04          297.66
100         5205         5820         5547.20         39115.76          197.78
1000        5667         7295         6763.20         295801.56         543.88
10000       13088        16187        14313.80        1039309.96        1019.47
100000      70717        77195        74283.10        2343340.49        1530.80
1000000     559510       585663       574683.70       59648589.21       7723.25
$

$ path-set-test -p user-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            4000         400.00          1440000.00        1200.00
1000        0            4000         400.00          1440000.00        1200.00
10000       0            16001        2800.10         22562640.09       4750.01
100000      32001        60003        44002.60        92812800.64       9633.94
1000000     308016       404028       348020.40       755346414.44      27483.57
$

$ path-set-test -p sys-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            4000         3600.00         1440000.00        1200.00
1000        4000         4000         4000.00         0.00              0.00
10000       0            16001        8000.40         22404000.24       4733.29
100000      16001        48004        31201.70        101775520.81      10088.39
1000000     180010       268021       226413.30       608736170.81      24672.58
$

$ path-set-test -p dups-line -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-line -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p line-mem -A ...
min: 573
max: 48049857
avg: 9079963.33
var: 307991477163652.25
dev: 17549685.96
$

$ path-set-test -p dups-node -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-node -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p node-insert-eq -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-insert-ne -A ...
min: 0
max: 131735
avg: 22278.67
var: 2396626529.89
dev: 48955.35
$

$ path-set-test -p node-rehash-eq -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-rehash-ne -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p hash-size -A ...
min: 2621447
max: 2621447
avg: 2621447.00
var: 0.00
dev: 0.00
$

$ path-set-test -p hash-used -A ...
min: 10
max: 711483
avg: 136779.67
var: 67280202582.56
dev: 259384.28
$

$ path-set-test -p hash-load -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct-size -A ...
min: 16
max: 16
avg: 16.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p node-mem -A ...
min: 743
max: 62163359
avg: 11747025.33
var: 515492973483980.25
dev: 22704470.34
$

$ path-set-test -p total-node-mem -A ...
min: 743
max: 62163359
avg: 11747025.33
var: 515492973483980.25
dev: 22704470.34
$

$ path-set-test -p total-mem -A ...
min: 41944103
max: 106006287
avg: 54012081.83
var: 547869977335979.00
dev: 23406622.51
$

$ path-set-test -p real-insert-time -A ...
min: 2068
max: 574683
avg: 112942.83
var: 43254609823.47
dev: 207977.43
$

$ path-set-test -p user-insert-time -A ...
min: 0
max: 348020
avg: 65937.00
var: 16162688098.33
dev: 127132.56
$

$ path-set-test -p sys-insert-time -A ...
min: 0
max: 226413
avg: 45535.67
var: 6648054556.22
dev: 81535.60
$

