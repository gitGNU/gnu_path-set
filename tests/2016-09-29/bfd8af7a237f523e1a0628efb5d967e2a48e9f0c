#
# # meta command:
# $ path-set-test \
# --input=tests/files2.txt \
# --expr='10 ** x' \
# --limits=1-6 \
# --pool-size=512M \
# --hash-size=2M \
# --node-size=4M \
# --separators='/' \
# --repeat=10 \
# --sleep=100 \
# --plain-set \
# --gnulib-hash \
# --run-tests
#

$ date +'%Y-%m-%d %H:%M:%S.%N %z'
2016-09-29 13:27:40.252796843 +0300
$

$ ./path-set -C
CONFIG_PATH_TRIE_NODE_32BIT_OFFSETS: yes
CONFIG_PATH_TRIE_ELEM_32BIT_OFFSETS: yes
CONFIG_PATH_TRIE_UINT_HASH_IDENTOP:  no
CONFIG_TRIE_PATH_SET_PRINT_SET:      no
CONFIG_VALUE_TYPE_SIZE:              64
32BIT:                               no
DEBUG:                               yes
OPT:                                 -
$

$ ./path-set --plain-set --gnulib-hash -I
node-struct-size: 16
$

$ ./path-set --plain-set --gnulib-hash -N
dups-line
uniq-line
line-mem
dups-node
uniq-node
node-insert-eq
node-insert-ne
node-rehash-eq
node-rehash-ne
hash-size
hash-used
hash-load
node-struct-size
node-struct
node-mem
total-node-mem
total-mem
insert-time
$

$ PATH_SET_TEST_INPUT=tests/files2.txt
$ PATH_SET_TEST_POOL_SIZE=512M
$ PATH_SET_TEST_HASH_SIZE=2M
$ PATH_SET_TEST_NODE_SIZE=4M
$ PATH_SET_TEST_STRUCT_TYPE=plain-set
$ PATH_SET_TEST_SET_TYPE=gnulib-hash
$ PATH_SET_TEST_SEPARATORS='/'
$

$ time path-set-test -t 10
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10           10           10.00           0.00              0.00           
line-mem          496          806          619.40          6577.24           81.10          
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10           10           10.00           0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            0            0.00            0.00              0.00           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         10           10           10.00           0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       10           10           10.00           0.00              0.00           
node-mem          666          976          789.40          6577.24           81.10          
total-node-mem    666          976          789.40          6577.24           81.10          
total-mem         41944026     41944336     41944149.40     6577.25           81.10          
real-insert-time  1905         2577         2178.50         49995.05          223.60         
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m1.486s
user	0m0.900s
sys	0m0.308s
$

$ time path-set-test -t 100
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100          100          100.00          0.00              0.00           
line-mem          5576         6015         5834.50         17465.45          132.16         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100          100          100.00          0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            0            0.00            0.00              0.00           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         100          100          100.00          0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       100          100          100.00          0.00              0.00           
node-mem          7276         7715         7534.50         17465.45          132.16         
total-node-mem    7276         7715         7534.50         17465.45          132.16         
total-mem         41950636     41951075     41950894.50     17465.25          132.16         
real-insert-time  5375         5759         5662.90         11649.69          107.93         
user-insert-time  0            4000         1200.00         3360000.00        1833.03        
sys-insert-time   0            4000         2800.00         3360000.00        1833.03        

real	0m1.517s
user	0m0.880s
sys	0m0.352s
$

$ time path-set-test -t 1000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         1000         1000         1000.00         0.00              0.00           
line-mem          56804        60060        57989.40        643525.44         802.20         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         1000         1000         1000.00         0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            0            0.00            0.00              0.00           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         1000         1000         1000.00         0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       1000         1000         1000.00         0.00              0.00           
node-mem          73804        77060        74989.40        643525.44         802.20         
total-node-mem    73804        77060        74989.40        643525.44         802.20         
total-mem         42017164     42020420     42018349.40     643525.50         802.20         
real-insert-time  5743         7233         6812.80         336258.36         579.88         
user-insert-time  0            4000         800.00          2560000.00        1600.00        
sys-insert-time   0            8000         4400.00         4640000.00        2154.07        

real	0m1.512s
user	0m0.872s
sys	0m0.348s
$

$ time path-set-test -t 10000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10000        10000        10000.00        0.00              0.00           
line-mem          575120       583078       578328.60       3968062.44        1992.00        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10000        10000        10000.00        0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    10           25           18.70           18.01             4.24           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         9975         9990         9981.30         18.01             4.24           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       10000        10000        10000.00        0.00              0.00           
node-mem          745120       753078       748328.60       3968062.44        1992.00        
total-node-mem    745120       753078       748328.60       3968062.44        1992.00        
total-mem         42688800     42696726     42691987.80     3907347.50        1976.70        
real-insert-time  12686        16656        14797.40        1279140.04        1130.99        
user-insert-time  0            8000         5600.00         10240000.00       3200.00        
sys-insert-time   4000         16001        10400.30        19843360.21       4454.59        

real	0m1.620s
user	0m0.964s
sys	0m0.388s
$

$ time path-set-test -t 100000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100000       100000       100000.00       0.00              0.00           
line-mem          5783087      5792872      5787364.80      10680421.96       3268.09        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100000       100000       100000.00       0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    1830         1957         1892.00         1438.80           37.93          
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         98072        98194        98131.40        1394.64           37.34          
hash-load         0.04         0.04         0.04            0.00              0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       100000       100000       100000.00       0.00              0.00           
node-mem          7483087      7492872      7487364.80      10680421.96       3268.09        
total-node-mem    7483087      7492872      7487364.80      10680421.96       3268.09        
total-mem         49455343     49465416     49460622.40     11164625.00       3341.35        
real-insert-time  69470        77513        74454.00        4875277.80        2208.00        
user-insert-time  24001        52003        37602.40        71044320.84       8428.78        
sys-insert-time   20001        44004        29602.10        55050080.89       7419.57        

real	0m2.674s
user	0m1.772s
sys	0m0.852s
$

$ time path-set-test -t 1000000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         830206       830206       830206.00       0.00              0.00           
line-mem          48049857     48049857     48049857.00     -0.50             0.71           
dups-node         0            0            0.00            0.00              0.00           
uniq-node         830206       830206       830206.00       0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    131735       131735       131735.00       0.00              0.00           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         711483       711483       711483.00       0.00              0.00           
hash-load         0.27         0.27         0.27            -0.00             0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       830206       830206       830206.00       0.00              0.00           
node-mem          62163359     62163359     62163359.00     0.00              0.00           
total-node-mem    62163359     62163359     62163359.00     0.00              0.00           
total-mem         106006287    106006287    106006287.00    0.00              0.00           
real-insert-time  555616       582215       568229.40       77150207.24       8783.52        
user-insert-time  324022       360026       346421.50       106257606.25      10308.13       
sys-insert-time   168009       272018       222813.80       973061124.96      31193.93       

real	0m10.860s
user	0m8.317s
sys	0m4.428s
$

$ path-set-test -p dups-line -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-line -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p line-mem -R ...
files       min          max          avg             var               dev
10          496          806          619.40          6577.24           81.10
100         5576         6015         5834.50         17465.45          132.16
1000        56804        60060        57989.40        643525.44         802.20
10000       575120       583078       578328.60       3968062.44        1992.00
100000      5783087      5792872      5787364.80      10680421.96       3268.09
1000000     48049857     48049857     48049857.00     -0.50             0.71
$

$ path-set-test -p dups-node -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-node -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p node-insert-eq -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p node-insert-ne -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       10           25           18.70           18.01             4.24
100000      1830         1957         1892.00         1438.80           37.93
1000000     131735       131735       131735.00       0.00              0.00
$

$ path-set-test -p node-rehash-eq -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p node-rehash-ne -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p hash-size -R ...
files       min          max          avg             var               dev
10          2621447      2621447      2621447.00      0.00              0.00
100         2621447      2621447      2621447.00      0.00              0.00
1000        2621447      2621447      2621447.00      0.00              0.00
10000       2621447      2621447      2621447.00      0.00              0.00
100000      2621447      2621447      2621447.00      0.00              0.00
1000000     2621447      2621447      2621447.00      0.00              0.00
$

$ path-set-test -p hash-used -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       9975         9990         9981.30         18.01             4.24
100000      98072        98194        98131.40        1394.64           37.34
1000000     711483       711483       711483.00       0.00              0.00
$

$ path-set-test -p hash-load -R ...
files       min          max          avg             var               dev
10          0.00         0.00         0.00            0.00              0.00
100         0.00         0.00         0.00            0.00              0.00
1000        0.00         0.00         0.00            0.00              0.00
10000       0.00         0.00         0.00            0.00              0.00
100000      0.04         0.04         0.04            0.00              0.00
1000000     0.27         0.27         0.27            -0.00             0.00
$

$ path-set-test -p node-struct-size -R ...
files       min          max          avg             var               dev
10          16           16           16.00           0.00              0.00
100         16           16           16.00           0.00              0.00
1000        16           16           16.00           0.00              0.00
10000       16           16           16.00           0.00              0.00
100000      16           16           16.00           0.00              0.00
1000000     16           16           16.00           0.00              0.00
$

$ path-set-test -p node-struct -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p node-mem -R ...
files       min          max          avg             var               dev
10          666          976          789.40          6577.24           81.10
100         7276         7715         7534.50         17465.45          132.16
1000        73804        77060        74989.40        643525.44         802.20
10000       745120       753078       748328.60       3968062.44        1992.00
100000      7483087      7492872      7487364.80      10680421.96       3268.09
1000000     62163359     62163359     62163359.00     0.00              0.00
$

$ path-set-test -p total-node-mem -R ...
files       min          max          avg             var               dev
10          666          976          789.40          6577.24           81.10
100         7276         7715         7534.50         17465.45          132.16
1000        73804        77060        74989.40        643525.44         802.20
10000       745120       753078       748328.60       3968062.44        1992.00
100000      7483087      7492872      7487364.80      10680421.96       3268.09
1000000     62163359     62163359     62163359.00     0.00              0.00
$

$ path-set-test -p total-mem -R ...
files       min          max          avg             var               dev
10          41944026     41944336     41944149.40     6577.25           81.10
100         41950636     41951075     41950894.50     17465.25          132.16
1000        42017164     42020420     42018349.40     643525.50         802.20
10000       42688800     42696726     42691987.80     3907347.50        1976.70
100000      49455343     49465416     49460622.40     11164625.00       3341.35
1000000     106006287    106006287    106006287.00    0.00              0.00
$

$ path-set-test -p real-insert-time -R ...
files       min          max          avg             var               dev
10          1905         2577         2178.50         49995.05          223.60
100         5375         5759         5662.90         11649.69          107.93
1000        5743         7233         6812.80         336258.36         579.88
10000       12686        16656        14797.40        1279140.04        1130.99
100000      69470        77513        74454.00        4875277.80        2208.00
1000000     555616       582215       568229.40       77150207.24       8783.52
$

$ path-set-test -p user-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            4000         1200.00         3360000.00        1833.03
1000        0            4000         800.00          2560000.00        1600.00
10000       0            8000         5600.00         10240000.00       3200.00
100000      24001        52003        37602.40        71044320.84       8428.78
1000000     324022       360026       346421.50       106257606.25      10308.13
$

$ path-set-test -p sys-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            4000         2800.00         3360000.00        1833.03
1000        0            8000         4400.00         4640000.00        2154.07
10000       4000         16001        10400.30        19843360.21       4454.59
100000      20001        44004        29602.10        55050080.89       7419.57
1000000     168009       272018       222813.80       973061124.96      31193.93
$

$ path-set-test -p dups-line -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-line -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p line-mem -A ...
min: 619
max: 48049857
avg: 9079998.50
var: 307990327274558.94
dev: 17549653.20
$

$ path-set-test -p dups-node -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-node -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p node-insert-eq -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-insert-ne -A ...
min: 0
max: 131735
avg: 22274.17
var: 2396809868.14
dev: 48957.22
$

$ path-set-test -p node-rehash-eq -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-rehash-ne -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p hash-size -A ...
min: 2621447
max: 2621447
avg: 2621447.00
var: 0.00
dev: 0.00
$

$ path-set-test -p hash-used -A ...
min: 10
max: 711483
avg: 136784.17
var: 67279822234.47
dev: 259383.54
$

$ path-set-test -p hash-load -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct-size -A ...
min: 16
max: 16
avg: 16.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p node-mem -A ...
min: 789
max: 62163359
avg: 11747060.50
var: 515491485836132.88
dev: 22704437.58
$

$ path-set-test -p total-node-mem -A ...
min: 789
max: 62163359
avg: 11747060.50
var: 515491485836132.88
dev: 22704437.58
$

$ path-set-test -p total-mem -A ...
min: 41944149
max: 106006287
avg: 54012048.00
var: 547869097775806.00
dev: 23406603.72
$

$ path-set-test -p real-insert-time -A ...
min: 2178
max: 568229
avg: 112022.00
var: 42239363355.67
dev: 205522.17
$

$ path-set-test -p user-insert-time -A ...
min: 0
max: 346421
avg: 65270.50
var: 15982238437.25
dev: 126420.88
$

$ path-set-test -p sys-insert-time -A ...
min: 0
max: 222813
avg: 45002.50
var: 6417653555.92
dev: 80110.26
$

