#
# # meta command:
# $ path-set-test \
# --input=tests/files.txt \
# --expr='10 ** x' \
# --limits=1-6 \
# --pool-size=128M \
# --hash-size=2M \
# --node-size=4M \
# --separators='/.-' \
# --repeat=10 \
# --sleep=100 \
# --plain-set \
# --ternary-tree \
# --run-tests
#

$ date +'%Y-%m-%d %H:%M:%S.%N %z'
2016-09-29 13:21:39.460441628 +0300
$

$ ./path-set -C
CONFIG_PATH_TRIE_NODE_32BIT_OFFSETS: no
CONFIG_PATH_TRIE_ELEM_32BIT_OFFSETS: no
CONFIG_PATH_TRIE_UINT_HASH_IDENTOP:  no
CONFIG_TRIE_PATH_SET_PRINT_SET:      no
CONFIG_VALUE_TYPE_SIZE:              32
32BIT:                               yes
DEBUG:                               yes
OPT:                                 -
$

$ ./path-set --plain-set --ternary-tree -I
node-struct-size: 16
$

$ ./path-set --plain-set --ternary-tree -N
dups-line
uniq-line
line-mem
dups-node
uniq-node
node-insert-eq
node-insert-lt
node-insert-gt
node-struct-size
node-struct
node-mem
total-node-mem
total-mem
insert-time
$

$ PATH_SET_TEST_INPUT=tests/files.txt
$ PATH_SET_TEST_POOL_SIZE=128M
$ PATH_SET_TEST_HASH_SIZE=2M
$ PATH_SET_TEST_NODE_SIZE=4M
$ PATH_SET_TEST_STRUCT_TYPE=plain-set
$ PATH_SET_TEST_SET_TYPE=ternary-tree
$ PATH_SET_TEST_SEPARATORS='/.-'
$

$ time path-set-test -t 10
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10           10           10.00           0.00              0.00           
line-mem          537          760          645.60          4636.44           68.09          
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10           10           10.00           0.00              0.00           
node-insert-eq    131          207          165.70          497.61            22.31          
node-insert-lt    4            11           7.80            4.56              2.14           
node-insert-gt    6            11           8.50            1.85              1.36           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       388          594          489.90          3571.69           59.76          
node-mem          6208         9504         7838.40         914352.64         956.22         
total-node-mem    6208         9504         7838.40         914352.64         956.22         
total-mem         6236         9532         7866.40         914352.64         956.22         
real-insert-time  29           39           34.20           10.76             3.28           
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m0.866s
user	0m0.380s
sys	0m0.212s
$

$ time path-set-test -t 100
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100          100          100.00          0.00              0.00           
line-mem          6315         6844         6566.10         26364.89          162.37         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100          100          100.00          0.00              0.00           
node-insert-eq    2646         3022         2834.00         13868.60          117.77         
node-insert-lt    104          269          170.20          3739.76           61.15          
node-insert-gt    97           227          173.70          1556.21           39.45          
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       3558         4098         3832.10         27619.49          166.19         
node-mem          56928        65568        61313.60        7070589.44        2659.06        
total-node-mem    56928        65568        61313.60        7070589.44        2659.06        
total-mem         56956        65596        61341.60        7070589.44        2659.06        
real-insert-time  194          221          203.50          54.25             7.37           
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m0.863s
user	0m0.396s
sys	0m0.184s
$

$ time path-set-test -t 1000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         1000         1000         1000.00         0.00              0.00           
line-mem          64087        66619        65406.40        473303.44         687.97         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         1000         1000         1000.00         0.00              0.00           
node-insert-eq    38717        40313        39510.40        272715.24         522.22         
node-insert-lt    2399         2935         2659.30         31558.81          177.65         
node-insert-gt    2292         3510         2654.60         119911.64         346.28         
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       26116        27418        26896.00        154473.00         393.03         
node-mem          417856       438688       430336.00       39545088.00       6288.49        
total-node-mem    417856       438688       430336.00       39545088.00       6288.49        
total-mem         417884       438716       430364.00       39545088.00       6288.49        
real-insert-time  3174         3511         3312.00         11766.20          108.47         
user-insert-time  0            4000         2000.00         4000000.00        2000.00        
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m0.914s
user	0m0.452s
sys	0m0.188s
$

$ time path-set-test -t 10000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10000        10000        10000.00        0.00              0.00           
line-mem          653803       660064       657451.40       5391219.04        2321.90        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10000        10000        10000.00        0.00              0.00           
node-insert-eq    482112       488436       485914.40       3844939.64        1960.85        
node-insert-lt    30598        40200        36341.80        9427270.16        3070.39        
node-insert-gt    33506        47666        38299.70        17797186.61       4218.67        
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       180197       182935       181537.00       466812.40         683.24         
node-mem          2883152      2926960      2904592.00      119503974.40      10931.79       
total-node-mem    2883152      2926960      2904592.00      119503974.40      10931.79       
total-mem         2883180      2926988      2904620.00      119503974.40      10931.79       
real-insert-time  16516        21085        19115.70        2918455.21        1708.35        
user-insert-time  0            24001        13200.70        48162320.21       6939.91        
sys-insert-time   0            20001        6400.20         26243040.16       5122.80        

real	0m1.123s
user	0m0.620s
sys	0m0.268s
$

$ time path-set-test -t 100000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100000       100000       100000.00       0.00              0.00           
line-mem          6558866      6579881      6566914.90      33195026.28       5761.51        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100000       100000       100000.00       0.00              0.00           
node-insert-eq    5427166      5448339      5436068.80      28756364.36       5362.50        
node-insert-lt    407863       496977       459064.00       651504719.20      25524.59       
node-insert-gt    436674       535872       476611.20       672710594.56      25936.67       
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       1229625      1233477      1230846.10      1247852.09        1117.07        
node-mem          19674000     19735632     19693537.60     319450135.00      17873.17       
total-node-mem    19674000     19735632     19693537.60     319450135.00      17873.17       
total-mem         19674028     19735660     19693565.60     319450134.94      17873.17       
real-insert-time  151215       157513       155058.60       2833677.04        1683.35        
user-insert-time  76003        164011       106806.70       675467285.81      25989.75       
sys-insert-time   32002        60004        45202.50        70569200.65       8400.55        

real	0m3.036s
user	0m2.144s
sys	0m0.952s
$

$ time path-set-test -t 1000000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         405909       405909       405909.00       0.00              0.00           
line-mem          26666438     26666438     26666438.00     0.00              0.00           
dups-node         0            0            0.00            0.00              0.00           
uniq-node         405909       405909       405909.00       0.00              0.00           
node-insert-eq    23077486     23077486     23077486.00     0.00              0.00           
node-insert-lt    1970423      2554570      2199562.30      31837154028.61    178429.69      
node-insert-gt    1938440      2351596      2171114.00      16293795959.60    127647.15      
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       3994861      3994861      3994861.00      0.00              0.00           
node-mem          63917776     63917776     63917776.00     0.00              0.00           
total-node-mem    63917776     63917776     63917776.00     0.00              0.00           
total-mem         63917804     63917804     63917804.00     0.00              0.00           
real-insert-time  627230       654254       644046.30       72109918.01       8491.76        
user-insert-time  440029       524028       481628.90       749453121.89      27376.14       
sys-insert-time   112006       204011       167210.20       546629923.16      23380.12       

real	0m9.719s
user	0m7.828s
sys	0m2.980s
$

$ path-set-test -p dups-line -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-line -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p line-mem -R ...
files       min          max          avg             var               dev
10          537          760          645.60          4636.44           68.09
100         6315         6844         6566.10         26364.89          162.37
1000        64087        66619        65406.40        473303.44         687.97
10000       653803       660064       657451.40       5391219.04        2321.90
100000      6558866      6579881      6566914.90      33195026.28       5761.51
1000000     26666438     26666438     26666438.00     0.00              0.00
$

$ path-set-test -p dups-node -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-node -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p node-insert-eq -R ...
files       min          max          avg             var               dev
10          131          207          165.70          497.61            22.31
100         2646         3022         2834.00         13868.60          117.77
1000        38717        40313        39510.40        272715.24         522.22
10000       482112       488436       485914.40       3844939.64        1960.85
100000      5427166      5448339      5436068.80      28756364.36       5362.50
1000000     23077486     23077486     23077486.00     0.00              0.00
$

$ path-set-test -p node-insert-lt -R ...
files       min          max          avg             var               dev
10          4            11           7.80            4.56              2.14
100         104          269          170.20          3739.76           61.15
1000        2399         2935         2659.30         31558.81          177.65
10000       30598        40200        36341.80        9427270.16        3070.39
100000      407863       496977       459064.00       651504719.20      25524.59
1000000     1970423      2554570      2199562.30      31837154028.61    178429.69
$

$ path-set-test -p node-insert-gt -R ...
files       min          max          avg             var               dev
10          6            11           8.50            1.85              1.36
100         97           227          173.70          1556.21           39.45
1000        2292         3510         2654.60         119911.64         346.28
10000       33506        47666        38299.70        17797186.61       4218.67
100000      436674       535872       476611.20       672710594.56      25936.67
1000000     1938440      2351596      2171114.00      16293795959.60    127647.15
$

$ path-set-test -p node-struct-size -R ...
files       min          max          avg             var               dev
10          16           16           16.00           0.00              0.00
100         16           16           16.00           0.00              0.00
1000        16           16           16.00           0.00              0.00
10000       16           16           16.00           0.00              0.00
100000      16           16           16.00           0.00              0.00
1000000     16           16           16.00           0.00              0.00
$

$ path-set-test -p node-struct -R ...
files       min          max          avg             var               dev
10          388          594          489.90          3571.69           59.76
100         3558         4098         3832.10         27619.49          166.19
1000        26116        27418        26896.00        154473.00         393.03
10000       180197       182935       181537.00       466812.40         683.24
100000      1229625      1233477      1230846.10      1247852.09        1117.07
1000000     3994861      3994861      3994861.00      0.00              0.00
$

$ path-set-test -p node-mem -R ...
files       min          max          avg             var               dev
10          6208         9504         7838.40         914352.64         956.22
100         56928        65568        61313.60        7070589.44        2659.06
1000        417856       438688       430336.00       39545088.00       6288.49
10000       2883152      2926960      2904592.00      119503974.40      10931.79
100000      19674000     19735632     19693537.60     319450135.00      17873.17
1000000     63917776     63917776     63917776.00     0.00              0.00
$

$ path-set-test -p total-node-mem -R ...
files       min          max          avg             var               dev
10          6208         9504         7838.40         914352.64         956.22
100         56928        65568        61313.60        7070589.44        2659.06
1000        417856       438688       430336.00       39545088.00       6288.49
10000       2883152      2926960      2904592.00      119503974.40      10931.79
100000      19674000     19735632     19693537.60     319450135.00      17873.17
1000000     63917776     63917776     63917776.00     0.00              0.00
$

$ path-set-test -p total-mem -R ...
files       min          max          avg             var               dev
10          6236         9532         7866.40         914352.64         956.22
100         56956        65596        61341.60        7070589.44        2659.06
1000        417884       438716       430364.00       39545088.00       6288.49
10000       2883180      2926988      2904620.00      119503974.40      10931.79
100000      19674028     19735660     19693565.60     319450134.94      17873.17
1000000     63917804     63917804     63917804.00     0.00              0.00
$

$ path-set-test -p real-insert-time -R ...
files       min          max          avg             var               dev
10          29           39           34.20           10.76             3.28
100         194          221          203.50          54.25             7.37
1000        3174         3511         3312.00         11766.20          108.47
10000       16516        21085        19115.70        2918455.21        1708.35
100000      151215       157513       155058.60       2833677.04        1683.35
1000000     627230       654254       644046.30       72109918.01       8491.76
$

$ path-set-test -p user-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         2000.00         4000000.00        2000.00
10000       0            24001        13200.70        48162320.21       6939.91
100000      76003        164011       106806.70       675467285.81      25989.75
1000000     440029       524028       481628.90       749453121.89      27376.14
$

$ path-set-test -p sys-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            20001        6400.20         26243040.16       5122.80
100000      32002        60004        45202.50        70569200.65       8400.55
1000000     112006       204011       167210.20       546629923.16      23380.12
$

$ path-set-test -p dups-line -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-line -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p line-mem -A ...
min: 645
max: 26666438
avg: 5660570.00
var: 93734587005409.67
dev: 9681662.41
$

$ path-set-test -p dups-node -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-node -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p node-insert-eq -A ...
min: 165
max: 23077486
avg: 4840329.50
var: 70297689813945.92
dev: 8384371.76
$

$ path-set-test -p node-insert-lt -A ...
min: 7
max: 2199562
avg: 449633.83
var: 639519501830.47
dev: 799699.63
$

$ path-set-test -p node-insert-gt -A ...
min: 8
max: 2171114
avg: 448143.17
var: 622895691074.47
dev: 789237.41
$

$ path-set-test -p node-struct-size -A ...
min: 16
max: 16
avg: 16.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct -A ...
min: 489
max: 3994861
avg: 906410.17
var: 2096352324024.47
dev: 1447878.56
$

$ path-set-test -p node-mem -A ...
min: 7838
max: 63917776
avg: 14502565.33
var: 536666124224751.25
dev: 23166055.43
$

$ path-set-test -p total-node-mem -A ...
min: 7838
max: 63917776
avg: 14502565.33
var: 536666124224751.25
dev: 23166055.43
$

$ path-set-test -p total-mem -A ...
min: 7866
max: 63917804
avg: 14502593.33
var: 536666124224751.12
dev: 23166055.43
$

$ path-set-test -p real-insert-time -A ...
min: 34
max: 644046
avg: 136961.33
var: 54444031240.56
dev: 233332.45
$

$ path-set-test -p user-insert-time -A ...
min: 0
max: 481628
avg: 100605.67
var: 30470381837.89
dev: 174557.67
$

$ path-set-test -p sys-insert-time -A ...
min: 0
max: 167210
avg: 36468.67
var: 3677263835.56
dev: 60640.45
$

