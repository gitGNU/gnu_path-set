#
# # meta command:
# $ path-set-test \
# --input=tests/files.txt \
# --expr='10 ** x' \
# --limits=1-6 \
# --pool-size=128M \
# --hash-size=2M \
# --node-size=4M \
# --separators='/.-' \
# --repeat=10 \
# --sleep=100 \
# --plain-set \
# --ternary-tree \
# --run-tests
#

$ date +'%Y-%m-%d %H:%M:%S.%N %z'
2016-09-29 13:19:40.542420996 +0300
$

$ ./path-set -C
CONFIG_PATH_TRIE_NODE_32BIT_OFFSETS: yes
CONFIG_PATH_TRIE_ELEM_32BIT_OFFSETS: yes
CONFIG_PATH_TRIE_UINT_HASH_IDENTOP:  no
CONFIG_TRIE_PATH_SET_PRINT_SET:      no
CONFIG_VALUE_TYPE_SIZE:              64
32BIT:                               no
DEBUG:                               yes
OPT:                                 -
$

$ ./path-set --plain-set --ternary-tree -I
node-struct-size: 32
$

$ ./path-set --plain-set --ternary-tree -N
dups-line
uniq-line
line-mem
dups-node
uniq-node
node-insert-eq
node-insert-lt
node-insert-gt
node-struct-size
node-struct
node-mem
total-node-mem
total-mem
insert-time
$

$ PATH_SET_TEST_INPUT=tests/files.txt
$ PATH_SET_TEST_POOL_SIZE=128M
$ PATH_SET_TEST_HASH_SIZE=2M
$ PATH_SET_TEST_NODE_SIZE=4M
$ PATH_SET_TEST_STRUCT_TYPE=plain-set
$ PATH_SET_TEST_SET_TYPE=ternary-tree
$ PATH_SET_TEST_SEPARATORS='/.-'
$

$ time path-set-test -t 10
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10           10           10.00           0.00              0.00           
line-mem          532          683          618.80          2151.76           46.39          
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10           10           10.00           0.00              0.00           
node-insert-eq    113          184          150.00          598.20            24.46          
node-insert-lt    3            14           9.90            11.69             3.42           
node-insert-gt    3            10           6.50            4.05              2.01           
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       379          549          478.80          2741.56           52.36          
node-mem          12128        17568        15321.60        2807357.44        1675.52        
total-node-mem    12128        17568        15321.60        2807357.44        1675.52        
total-mem         12184        17624        15377.60        2807357.44        1675.52        
real-insert-time  31           45           37.60           14.04             3.75           
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m0.875s
user	0m0.440s
sys	0m0.136s
$

$ time path-set-test -t 100
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100          100          100.00          0.00              0.00           
line-mem          6051         6895         6493.60         68012.64          260.79         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100          100          100.00          0.00              0.00           
node-insert-eq    2564         2979         2716.10         14300.09          119.58         
node-insert-lt    122          257          180.00          1671.20           40.88          
node-insert-gt    111          215          168.30          819.01            28.62          
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       3575         4164         3877.50         40342.25          200.85         
node-mem          114400       133248       124080.00       41310464.00       6427.32        
total-node-mem    114400       133248       124080.00       41310464.00       6427.32        
total-mem         114456       133304       124136.00       41310464.00       6427.32        
real-insert-time  229          289          245.20          246.36            15.70          
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m0.868s
user	0m0.388s
sys	0m0.196s
$

$ time path-set-test -t 1000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         1000         1000         1000.00         0.00              0.00           
line-mem          64401        66689        65496.30        430287.81         655.96         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         1000         1000         1000.00         0.00              0.00           
node-insert-eq    38776        40178        39408.60        154193.84         392.68         
node-insert-lt    2216         3734         2927.20         241904.96         491.84         
node-insert-gt    2175         2603         2380.40         17588.64          132.62         
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       26488        27511        27087.70        97963.21          312.99         
node-mem          847616       880352       866806.40       100314327.04      10015.70       
total-node-mem    847616       880352       866806.40       100314327.04      10015.70       
total-mem         847672       880408       866862.40       100314327.04      10015.70       
real-insert-time  3417         3892         3679.40         15433.64          124.23         
user-insert-time  0            4000         1200.00         3360000.00        1833.03        
sys-insert-time   0            4000         2000.00         4000000.00        2000.00        

real	0m0.887s
user	0m0.400s
sys	0m0.200s
$

$ time path-set-test -t 10000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10000        10000        10000.00        0.00              0.00           
line-mem          653974       660323       656648.60       4002767.04        2000.69        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10000        10000        10000.00        0.00              0.00           
node-insert-eq    484079       488389       485654.60       1673189.84        1293.52        
node-insert-lt    31200        49576        38067.90        28565832.89       5344.70        
node-insert-gt    32292        43654        37041.10        19332098.29       4396.83        
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       179707       182169       180994.00       636441.00         797.77         
node-mem          5750624      5829408      5791808.00      651715584.00      25528.72       
total-node-mem    5750624      5829408      5791808.00      651715584.00      25528.72       
total-mem         5750680      5829464      5791864.00      651715584.00      25528.72       
real-insert-time  17546        22352        20896.90        1605352.89        1267.03        
user-insert-time  8000         28001        14800.60        28963040.24       5381.73        
sys-insert-time   0            20001        8400.20         43043840.16       6560.78        

real	0m1.160s
user	0m0.632s
sys	0m0.284s
$

$ time path-set-test -t 100000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100000       100000       100000.00       0.00              0.00           
line-mem          6555692      6574943      6567845.60      37867114.65       6153.63        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100000       100000       100000.00       0.00              0.00           
node-insert-eq    5427714      5445317      5438042.00      29037635.40       5388.66        
node-insert-lt    417135       586652       490843.10       3312804715.09     57556.97       
node-insert-gt    429718       544979       497491.70       1078817568.41     32845.36       
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       1226646      1232843      1229803.60      3520114.64        1876.20        
node-mem          39252672     39450976     39353715.20     3604597391.25     60038.30       
total-node-mem    39252672     39450976     39353715.20     3604597391.25     60038.30       
total-mem         39252728     39451032     39353771.20     3604597391.00     60038.30       
real-insert-time  160485       170731       166620.80       8483421.96        2912.63        
user-insert-time  96004        152010       126406.80       304700163.56      17455.66       
sys-insert-time   32001        56004        41602.30        103056641.21      10151.68       

real	0m3.008s
user	0m2.260s
sys	0m0.820s
$

$ time path-set-test -t 1000000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         405909       405909       405909.00       0.00              0.00           
line-mem          26666438     26666438     26666438.00     0.00              0.00           
dups-node         0            0            0.00            0.00              0.00           
uniq-node         405909       405909       405909.00       0.00              0.00           
node-insert-eq    23077486     23077486     23077486.00     0.00              0.00           
node-insert-lt    1965550      2533084      2239952.00      34642819829.40    186125.82      
node-insert-gt    2003770      2341979      2211790.20      15629332801.36    125017.33      
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       3994861      3994861      3994861.00      0.00              0.00           
node-mem          127835552    127835552    127835552.00    0.00              0.00           
total-node-mem    127835552    127835552    127835552.00    0.00              0.00           
total-mem         127835608    127835608    127835608.00    0.00              0.00           
real-insert-time  673220       689700       680342.30       36198447.61       6016.51        
user-insert-time  508030       580037       544833.90       703459365.29      26522.81       
sys-insert-time   76005        164012       138808.80       659453123.96      25679.82       

real	0m9.517s
user	0m8.229s
sys	0m2.312s
$

$ path-set-test -p dups-line -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-line -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p line-mem -R ...
files       min          max          avg             var               dev
10          532          683          618.80          2151.76           46.39
100         6051         6895         6493.60         68012.64          260.79
1000        64401        66689        65496.30        430287.81         655.96
10000       653974       660323       656648.60       4002767.04        2000.69
100000      6555692      6574943      6567845.60      37867114.65       6153.63
1000000     26666438     26666438     26666438.00     0.00              0.00
$

$ path-set-test -p dups-node -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-node -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p node-insert-eq -R ...
files       min          max          avg             var               dev
10          113          184          150.00          598.20            24.46
100         2564         2979         2716.10         14300.09          119.58
1000        38776        40178        39408.60        154193.84         392.68
10000       484079       488389       485654.60       1673189.84        1293.52
100000      5427714      5445317      5438042.00      29037635.40       5388.66
1000000     23077486     23077486     23077486.00     0.00              0.00
$

$ path-set-test -p node-insert-lt -R ...
files       min          max          avg             var               dev
10          3            14           9.90            11.69             3.42
100         122          257          180.00          1671.20           40.88
1000        2216         3734         2927.20         241904.96         491.84
10000       31200        49576        38067.90        28565832.89       5344.70
100000      417135       586652       490843.10       3312804715.09     57556.97
1000000     1965550      2533084      2239952.00      34642819829.40    186125.82
$

$ path-set-test -p node-insert-gt -R ...
files       min          max          avg             var               dev
10          3            10           6.50            4.05              2.01
100         111          215          168.30          819.01            28.62
1000        2175         2603         2380.40         17588.64          132.62
10000       32292        43654        37041.10        19332098.29       4396.83
100000      429718       544979       497491.70       1078817568.41     32845.36
1000000     2003770      2341979      2211790.20      15629332801.36    125017.33
$

$ path-set-test -p node-struct-size -R ...
files       min          max          avg             var               dev
10          32           32           32.00           0.00              0.00
100         32           32           32.00           0.00              0.00
1000        32           32           32.00           0.00              0.00
10000       32           32           32.00           0.00              0.00
100000      32           32           32.00           0.00              0.00
1000000     32           32           32.00           0.00              0.00
$

$ path-set-test -p node-struct -R ...
files       min          max          avg             var               dev
10          379          549          478.80          2741.56           52.36
100         3575         4164         3877.50         40342.25          200.85
1000        26488        27511        27087.70        97963.21          312.99
10000       179707       182169       180994.00       636441.00         797.77
100000      1226646      1232843      1229803.60      3520114.64        1876.20
1000000     3994861      3994861      3994861.00      0.00              0.00
$

$ path-set-test -p node-mem -R ...
files       min          max          avg             var               dev
10          12128        17568        15321.60        2807357.44        1675.52
100         114400       133248       124080.00       41310464.00       6427.32
1000        847616       880352       866806.40       100314327.04      10015.70
10000       5750624      5829408      5791808.00      651715584.00      25528.72
100000      39252672     39450976     39353715.20     3604597391.25     60038.30
1000000     127835552    127835552    127835552.00    0.00              0.00
$

$ path-set-test -p total-node-mem -R ...
files       min          max          avg             var               dev
10          12128        17568        15321.60        2807357.44        1675.52
100         114400       133248       124080.00       41310464.00       6427.32
1000        847616       880352       866806.40       100314327.04      10015.70
10000       5750624      5829408      5791808.00      651715584.00      25528.72
100000      39252672     39450976     39353715.20     3604597391.25     60038.30
1000000     127835552    127835552    127835552.00    0.00              0.00
$

$ path-set-test -p total-mem -R ...
files       min          max          avg             var               dev
10          12184        17624        15377.60        2807357.44        1675.52
100         114456       133304       124136.00       41310464.00       6427.32
1000        847672       880408       866862.40       100314327.04      10015.70
10000       5750680      5829464      5791864.00      651715584.00      25528.72
100000      39252728     39451032     39353771.20     3604597391.00     60038.30
1000000     127835608    127835608    127835608.00    0.00              0.00
$

$ path-set-test -p real-insert-time -R ...
files       min          max          avg             var               dev
10          31           45           37.60           14.04             3.75
100         229          289          245.20          246.36            15.70
1000        3417         3892         3679.40         15433.64          124.23
10000       17546        22352        20896.90        1605352.89        1267.03
100000      160485       170731       166620.80       8483421.96        2912.63
1000000     673220       689700       680342.30       36198447.61       6016.51
$

$ path-set-test -p user-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         1200.00         3360000.00        1833.03
10000       8000         28001        14800.60        28963040.24       5381.73
100000      96004        152010       126406.80       304700163.56      17455.66
1000000     508030       580037       544833.90       703459365.29      26522.81
$

$ path-set-test -p sys-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         2000.00         4000000.00        2000.00
10000       0            20001        8400.20         43043840.16       6560.78
100000      32001        56004        41602.30        103056641.21      10151.68
1000000     76005        164012       138808.80       659453123.96      25679.82
$

$ path-set-test -p dups-line -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-line -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p line-mem -A ...
min: 618
max: 26666438
avg: 5660589.67
var: 93736228361420.22
dev: 9681747.18
$

$ path-set-test -p dups-node -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-node -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p node-insert-eq -A ...
min: 150
max: 23077486
avg: 4840576.00
var: 70298837500106.67
dev: 8384440.20
$

$ path-set-test -p node-insert-lt -A ...
min: 9
max: 2239952
avg: 461996.33
var: 663187639528.56
dev: 814363.33
$

$ path-set-test -p node-insert-gt -A ...
min: 6
max: 2211790
avg: 458146.00
var: 646917247271.00
dev: 804311.66
$

$ path-set-test -p node-struct-size -A ...
min: 32
max: 32
avg: 32.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct -A ...
min: 478
max: 3994861
avg: 906183.33
var: 2096304703280.22
dev: 1447862.11
$

$ path-set-test -p node-mem -A ...
min: 15321
max: 127835552
avg: 28997880.33
var: 2146615479936325.00
dev: 46331581.88
$

$ path-set-test -p total-node-mem -A ...
min: 15321
max: 127835552
avg: 28997880.33
var: 2146615479936325.00
dev: 46331581.88
$

$ path-set-test -p total-mem -A ...
min: 15377
max: 127835608
avg: 28997936.33
var: 2146615479936325.00
dev: 46331581.88
$

$ path-set-test -p real-insert-time -A ...
min: 37
max: 680342
avg: 145303.17
var: 60733273192.47
dev: 246441.22
$

$ path-set-test -p user-insert-time -A ...
min: 0
max: 544833
avg: 114539.83
var: 39054285700.81
dev: 197621.57
$

$ path-set-test -p sys-insert-time -A ...
min: 0
max: 138808
avg: 31801.67
var: 2500811875.22
dev: 50008.12
$

