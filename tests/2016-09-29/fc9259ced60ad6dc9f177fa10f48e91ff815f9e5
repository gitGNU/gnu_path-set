#
# # meta command:
# $ path-set-test \
# --input=tests/files.txt \
# --expr='10 ** x' \
# --limits=1-6 \
# --pool-size=128M \
# --hash-size=2M \
# --node-size=4M \
# --separators='/' \
# --repeat=10 \
# --sleep=100 \
# --plain-set \
# --ternary-tree \
# --run-tests
#

$ date +'%Y-%m-%d %H:%M:%S.%N %z'
2016-09-29 13:12:02.246777198 +0300
$

$ ./path-set -C
CONFIG_PATH_TRIE_NODE_32BIT_OFFSETS: no
CONFIG_PATH_TRIE_ELEM_32BIT_OFFSETS: no
CONFIG_PATH_TRIE_UINT_HASH_IDENTOP:  no
CONFIG_TRIE_PATH_SET_PRINT_SET:      no
CONFIG_VALUE_TYPE_SIZE:              64
32BIT:                               no
DEBUG:                               yes
OPT:                                 -
$

$ ./path-set --plain-set --ternary-tree -I
node-struct-size: 32
$

$ ./path-set --plain-set --ternary-tree -N
dups-line
uniq-line
line-mem
dups-node
uniq-node
node-insert-eq
node-insert-lt
node-insert-gt
node-struct-size
node-struct
node-mem
total-node-mem
total-mem
insert-time
$

$ PATH_SET_TEST_INPUT=tests/files.txt
$ PATH_SET_TEST_POOL_SIZE=128M
$ PATH_SET_TEST_HASH_SIZE=2M
$ PATH_SET_TEST_NODE_SIZE=4M
$ PATH_SET_TEST_STRUCT_TYPE=plain-set
$ PATH_SET_TEST_SET_TYPE=ternary-tree
$ PATH_SET_TEST_SEPARATORS='/'
$

$ time path-set-test -t 10
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10           10           10.00           0.00              0.00           
line-mem          561          781          656.60          3611.04           60.09          
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10           10           10.00           0.00              0.00           
node-insert-eq    128          291          170.50          1788.45           42.29          
node-insert-lt    3            14           8.20            11.56             3.40           
node-insert-gt    5            11           8.50            3.85              1.96           
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       414          613          496.10          3307.89           57.51          
node-mem          13248        19616        15875.20        3387279.36        1840.46        
total-node-mem    13248        19616        15875.20        3387279.36        1840.46        
total-mem         13304        19672        15931.20        3387279.36        1840.46        
real-insert-time  33           48           39.00           18.80             4.34           
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m1.174s
user	0m0.420s
sys	0m0.156s
$

$ time path-set-test -t 100
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100          100          100.00          0.00              0.00           
line-mem          6459         6896         6690.90         16452.49          128.27         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100          100          100.00          0.00              0.00           
node-insert-eq    2749         2977         2872.00         5122.00           71.57          
node-insert-lt    121          271          191.70          2196.61           46.87          
node-insert-gt    82           222          158.40          1927.44           43.90          
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       3810         4150         3918.90         8013.09           89.52          
node-mem          121920       132800       125404.80       8205404.16        2864.51        
total-node-mem    121920       132800       125404.80       8205404.16        2864.51        
total-mem         121976       132856       125460.80       8205404.16        2864.51        
real-insert-time  233          301          246.00          351.40            18.75          
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m0.856s
user	0m0.408s
sys	0m0.180s
$

$ time path-set-test -t 1000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         1000         1000         1000.00         0.00              0.00           
line-mem          64206        66762        65390.20        706485.56         840.53         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         1000         1000         1000.00         0.00              0.00           
node-insert-eq    38690        40439        39604.50        245238.25         495.22         
node-insert-lt    1881         3952         2796.40         361434.44         601.19         
node-insert-gt    2007         3201         2640.80         139113.36         372.98         
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       26046        27850        26785.70        294154.81         542.36         
node-mem          833472       891200       857142.40       301214525.44      17355.53       
total-node-mem    833472       891200       857142.40       301214525.44      17355.53       
total-mem         833528       891256       857198.40       301214525.44      17355.53       
real-insert-time  2963         3885         3621.80         53288.96          230.84         
user-insert-time  0            4000         2800.00         3360000.00        1833.03        
sys-insert-time   0            4000         800.00          2560000.00        1600.00        

real	0m0.879s
user	0m0.444s
sys	0m0.164s
$

$ time path-set-test -t 10000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10000        10000        10000.00        0.00              0.00           
line-mem          654906       660712       656971.80       2808018.76        1675.71        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10000        10000        10000.00        0.00              0.00           
node-insert-eq    483853       488810       485587.80       2427203.96        1557.95        
node-insert-lt    32675        45245        39083.50        16481473.45       4059.74        
node-insert-gt    29472        42732        35702.00        15566031.00       3945.38        
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       180423       182777       181384.00       470146.80         685.67         
node-mem          5773536      5848864      5804288.00      481430323.20      21941.52       
total-node-mem    5773536      5848864      5804288.00      481430323.20      21941.52       
total-mem         5773592      5848920      5804344.00      481430323.20      21941.52       
real-insert-time  15920        23673        19104.90        8549686.29        2923.98        
user-insert-time  8000         20001        11600.50        14242000.25       3773.86        
sys-insert-time   4000         16001        7600.10         11041680.09       3322.90        

real	0m1.100s
user	0m0.660s
sys	0m0.264s
$

$ time path-set-test -t 100000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100000       100000       100000.00       0.00              0.00           
line-mem          6560144      6580780      6571413.40      30837947.04       5553.19        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100000       100000       100000.00       0.00              0.00           
node-insert-eq    5429626      5448984      5440445.50      27761076.05       5268.88        
node-insert-lt    391933       572879       477082.10       3315486800.69     57580.26       
node-insert-gt    407850       549192       488381.00       1930200117.40     43934.04       
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       1227579      1234244      1230967.90      3362926.49        1833.83        
node-mem          39282528     39495808     39390972.80     3443636726.00     58682.51       
total-node-mem    39282528     39495808     39390972.80     3443636726.00     58682.51       
total-mem         39282584     39495864     39391028.80     3443636726.00     58682.51       
real-insert-time  159899       170144       164826.00       9379064.60        3062.53        
user-insert-time  104006       164011       123607.70       273482962.41      16537.32       
sys-insert-time   20002        60004        38802.40        147373760.84      12139.76       

real	0m2.950s
user	0m2.276s
sys	0m0.768s
$

$ time path-set-test -t 1000000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         405909       405909       405909.00       0.00              0.00           
line-mem          26666438     26666438     26666438.00     0.00              0.00           
dups-node         0            0            0.00            0.00              0.00           
uniq-node         405909       405909       405909.00       0.00              0.00           
node-insert-eq    23077486     23077486     23077486.00     0.00              0.00           
node-insert-lt    1957844      2377969      2191885.40      22168468183.64    148890.79      
node-insert-gt    2071892      2433456      2240975.60      9484732943.64     97389.59       
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       3994861      3994861      3994861.00      0.00              0.00           
node-mem          127835552    127835552    127835552.00    0.00              0.00           
total-node-mem    127835552    127835552    127835552.00    0.00              0.00           
total-mem         127835608    127835608    127835608.00    0.00              0.00           
real-insert-time  678924       698429       687839.50       34903148.05       5907.89        
user-insert-time  492029       600037       541633.90       1219974725.49     34928.14       
sys-insert-time   116007       180011       150009.40       416842401.84      20416.72       

real	0m9.559s
user	0m8.189s
sys	0m2.424s
$

$ path-set-test -p dups-line -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-line -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p line-mem -R ...
files       min          max          avg             var               dev
10          561          781          656.60          3611.04           60.09
100         6459         6896         6690.90         16452.49          128.27
1000        64206        66762        65390.20        706485.56         840.53
10000       654906       660712       656971.80       2808018.76        1675.71
100000      6560144      6580780      6571413.40      30837947.04       5553.19
1000000     26666438     26666438     26666438.00     0.00              0.00
$

$ path-set-test -p dups-node -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-node -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p node-insert-eq -R ...
files       min          max          avg             var               dev
10          128          291          170.50          1788.45           42.29
100         2749         2977         2872.00         5122.00           71.57
1000        38690        40439        39604.50        245238.25         495.22
10000       483853       488810       485587.80       2427203.96        1557.95
100000      5429626      5448984      5440445.50      27761076.05       5268.88
1000000     23077486     23077486     23077486.00     0.00              0.00
$

$ path-set-test -p node-insert-lt -R ...
files       min          max          avg             var               dev
10          3            14           8.20            11.56             3.40
100         121          271          191.70          2196.61           46.87
1000        1881         3952         2796.40         361434.44         601.19
10000       32675        45245        39083.50        16481473.45       4059.74
100000      391933       572879       477082.10       3315486800.69     57580.26
1000000     1957844      2377969      2191885.40      22168468183.64    148890.79
$

$ path-set-test -p node-insert-gt -R ...
files       min          max          avg             var               dev
10          5            11           8.50            3.85              1.96
100         82           222          158.40          1927.44           43.90
1000        2007         3201         2640.80         139113.36         372.98
10000       29472        42732        35702.00        15566031.00       3945.38
100000      407850       549192       488381.00       1930200117.40     43934.04
1000000     2071892      2433456      2240975.60      9484732943.64     97389.59
$

$ path-set-test -p node-struct-size -R ...
files       min          max          avg             var               dev
10          32           32           32.00           0.00              0.00
100         32           32           32.00           0.00              0.00
1000        32           32           32.00           0.00              0.00
10000       32           32           32.00           0.00              0.00
100000      32           32           32.00           0.00              0.00
1000000     32           32           32.00           0.00              0.00
$

$ path-set-test -p node-struct -R ...
files       min          max          avg             var               dev
10          414          613          496.10          3307.89           57.51
100         3810         4150         3918.90         8013.09           89.52
1000        26046        27850        26785.70        294154.81         542.36
10000       180423       182777       181384.00       470146.80         685.67
100000      1227579      1234244      1230967.90      3362926.49        1833.83
1000000     3994861      3994861      3994861.00      0.00              0.00
$

$ path-set-test -p node-mem -R ...
files       min          max          avg             var               dev
10          13248        19616        15875.20        3387279.36        1840.46
100         121920       132800       125404.80       8205404.16        2864.51
1000        833472       891200       857142.40       301214525.44      17355.53
10000       5773536      5848864      5804288.00      481430323.20      21941.52
100000      39282528     39495808     39390972.80     3443636726.00     58682.51
1000000     127835552    127835552    127835552.00    0.00              0.00
$

$ path-set-test -p total-node-mem -R ...
files       min          max          avg             var               dev
10          13248        19616        15875.20        3387279.36        1840.46
100         121920       132800       125404.80       8205404.16        2864.51
1000        833472       891200       857142.40       301214525.44      17355.53
10000       5773536      5848864      5804288.00      481430323.20      21941.52
100000      39282528     39495808     39390972.80     3443636726.00     58682.51
1000000     127835552    127835552    127835552.00    0.00              0.00
$

$ path-set-test -p total-mem -R ...
files       min          max          avg             var               dev
10          13304        19672        15931.20        3387279.36        1840.46
100         121976       132856       125460.80       8205404.16        2864.51
1000        833528       891256       857198.40       301214525.44      17355.53
10000       5773592      5848920      5804344.00      481430323.20      21941.52
100000      39282584     39495864     39391028.80     3443636726.00     58682.51
1000000     127835608    127835608    127835608.00    0.00              0.00
$

$ path-set-test -p real-insert-time -R ...
files       min          max          avg             var               dev
10          33           48           39.00           18.80             4.34
100         233          301          246.00          351.40            18.75
1000        2963         3885         3621.80         53288.96          230.84
10000       15920        23673        19104.90        8549686.29        2923.98
100000      159899       170144       164826.00       9379064.60        3062.53
1000000     678924       698429       687839.50       34903148.05       5907.89
$

$ path-set-test -p user-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         2800.00         3360000.00        1833.03
10000       8000         20001        11600.50        14242000.25       3773.86
100000      104006       164011       123607.70       273482962.41      16537.32
1000000     492029       600037       541633.90       1219974725.49     34928.14
$

$ path-set-test -p sys-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         800.00          2560000.00        1600.00
10000       4000         16001        7600.10         11041680.09       3322.90
100000      20002        60004        38802.40        147373760.84      12139.76
1000000     116007       180011       150009.40       416842401.84      20416.72
$

$ path-set-test -p dups-line -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-line -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p line-mem -A ...
min: 656
max: 26666438
avg: 5661259.67
var: 93736525046204.89
dev: 9681762.50
$

$ path-set-test -p dups-node -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-node -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p node-insert-eq -A ...
min: 170
max: 23077486
avg: 4841027.33
var: 70298816585734.56
dev: 8384438.95
$

$ path-set-test -p node-insert-lt -A ...
min: 8
max: 2191885
avg: 451840.83
var: 634756931832.47
dev: 796716.34
$

$ path-set-test -p node-insert-gt -A ...
min: 8
max: 2240975
avg: 461310.67
var: 664153565355.89
dev: 814956.17
$

$ path-set-test -p node-struct-size -A ...
min: 32
max: 32
avg: 32.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct -A ...
min: 496
max: 3994861
avg: 906401.83
var: 2096406942001.81
dev: 1447897.42
$

$ path-set-test -p node-mem -A ...
min: 15875
max: 127835552
avg: 29004872.17
var: 2146720300599231.25
dev: 46332713.07
$

$ path-set-test -p total-node-mem -A ...
min: 15875
max: 127835552
avg: 29004872.17
var: 2146720300599231.25
dev: 46332713.07
$

$ path-set-test -p total-mem -A ...
min: 15931
max: 127835608
avg: 29004928.17
var: 2146720300599231.00
dev: 46332713.07
$

$ path-set-test -p real-insert-time -A ...
min: 39
max: 687839
avg: 145945.83
var: 62144519847.81
dev: 249288.03
$

$ path-set-test -p user-insert-time -A ...
min: 0
max: 541633
avg: 113273.33
var: 38633718145.22
dev: 196554.62
$

$ path-set-test -p sys-insert-time -A ...
min: 0
max: 150009
avg: 32868.50
var: 2930777588.58
dev: 54136.66
$

