#
# # meta command:
# $ path-set-test \
# --input=tests/files2.txt \
# --expr='10 ** x' \
# --limits=1-6 \
# --pool-size=512M \
# --hash-size=2M \
# --node-size=4M \
# --separators='/.-' \
# --repeat=10 \
# --sleep=100 \
# --plain-set \
# --ternary-tree \
# --run-tests
#

$ date +'%Y-%m-%d %H:%M:%S.%N %z'
2016-09-29 13:36:30.450092236 +0300
$

$ ./path-set -C
CONFIG_PATH_TRIE_NODE_32BIT_OFFSETS: yes
CONFIG_PATH_TRIE_ELEM_32BIT_OFFSETS: yes
CONFIG_PATH_TRIE_UINT_HASH_IDENTOP:  no
CONFIG_TRIE_PATH_SET_PRINT_SET:      no
CONFIG_VALUE_TYPE_SIZE:              64
32BIT:                               no
DEBUG:                               yes
OPT:                                 -
$

$ ./path-set --plain-set --ternary-tree -I
node-struct-size: 32
$

$ ./path-set --plain-set --ternary-tree -N
dups-line
uniq-line
line-mem
dups-node
uniq-node
node-insert-eq
node-insert-lt
node-insert-gt
node-struct-size
node-struct
node-mem
total-node-mem
total-mem
insert-time
$

$ PATH_SET_TEST_INPUT=tests/files2.txt
$ PATH_SET_TEST_POOL_SIZE=512M
$ PATH_SET_TEST_HASH_SIZE=2M
$ PATH_SET_TEST_NODE_SIZE=4M
$ PATH_SET_TEST_STRUCT_TYPE=plain-set
$ PATH_SET_TEST_SET_TYPE=ternary-tree
$ PATH_SET_TEST_SEPARATORS='/.-'
$

$ time path-set-test -t 10
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10           10           10.00           0.00              0.00           
line-mem          495          673          571.40          2372.44           48.71          
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10           10           10.00           0.00              0.00           
node-insert-eq    73           135          100.30          331.01            18.19          
node-insert-lt    6            13           8.30            5.61              2.37           
node-insert-gt    2            15           7.70            12.21             3.49           
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       421          593          481.10          2358.49           48.56          
node-mem          13472        18976        15395.20        2415093.76        1554.06        
total-node-mem    13472        18976        15395.20        2415093.76        1554.06        
total-mem         13528        19032        15451.20        2415093.76        1554.06        
real-insert-time  35           42           37.70           3.81              1.95           
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m1.344s
user	0m0.816s
sys	0m0.232s
$

$ time path-set-test -t 100
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100          100          100.00          0.00              0.00           
line-mem          5596         6111         5828.70         17102.61          130.78         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100          100          100.00          0.00              0.00           
node-insert-eq    1839         2160         1976.00         7414.60           86.11          
node-insert-lt    152          244          182.30          722.41            26.88          
node-insert-gt    109          255          168.40          1483.44           38.52          
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       3845         4225         3952.70         11160.61          105.64         
node-mem          123040       135200       126486.40       11428464.64       3380.60        
total-node-mem    123040       135200       126486.40       11428464.64       3380.60        
total-mem         123096       135256       126542.40       11428464.64       3380.60        
real-insert-time  227          414          253.20          2890.96           53.77          
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m1.323s
user	0m0.796s
sys	0m0.248s
$

$ time path-set-test -t 1000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         1000         1000         1000.00         0.00              0.00           
line-mem          56694        58779        57785.40        371605.24         609.59         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         1000         1000         1000.00         0.00              0.00           
node-insert-eq    28008        29515        28568.30        227478.61         476.95         
node-insert-lt    2456         3693         3017.40         136550.64         369.53         
node-insert-gt    2181         3167         2542.80         89842.76          299.74         
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       29606        30857        30217.10        195026.49         441.62         
node-mem          947392       987424       966947.20       199707125.76      14131.78       
total-node-mem    947392       987424       966947.20       199707125.76      14131.78       
total-mem         947448       987480       967003.20       199707125.76      14131.78       
real-insert-time  3420         3883         3638.60         21286.04          145.90         
user-insert-time  0            4000         2800.00         3360000.00        1833.03        
sys-insert-time   0            4000         1200.00         3360000.00        1833.03        

real	0m1.350s
user	0m0.808s
sys	0m0.256s
$

$ time path-set-test -t 10000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10000        10000        10000.00        0.00              0.00           
line-mem          575634       580917       578552.90       2718178.29        1648.69        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10000        10000        10000.00        0.00              0.00           
node-insert-eq    368455       373718       371208.40       2470200.84        1571.69        
node-insert-lt    33575        47309        40053.00        16115671.00       4014.43        
node-insert-gt    30694        50504        39396.50        37041656.65       6086.19        
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       216062       218749       217344.50       519246.25         720.59         
node-mem          6913984      6999968      6955024.00      531708160.00      23058.80       
total-node-mem    6913984      6999968      6955024.00      531708160.00      23058.80       
total-mem         6914040      7000024      6955080.00      531708160.00      23058.80       
real-insert-time  18041        23336        21091.10        3332100.69        1825.40        
user-insert-time  4000         24001        16400.80        30242560.16       5499.32        
sys-insert-time   0            12000        4400.00         14240000.00       3773.59        

real	0m1.588s
user	0m1.004s
sys	0m0.316s
$

$ time path-set-test -t 100000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100000       100000       100000.00       0.00              0.00           
line-mem          5782033      5798088      5789208.40      21040162.84       4586.96        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100000       100000       100000.00       0.00              0.00           
node-insert-eq    4368291      4377943      4374193.80      12139084.16       3484.12        
node-insert-lt    448303       540065       492212.00       635623502.00      25211.57       
node-insert-gt    441922       584261       507554.30       2944350983.61     54261.87       
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       1511821      1520826      1515014.60      6763077.04        2600.59        
node-mem          48378272     48666432     48480467.20     6925390889.00     83218.93       
total-node-mem    48378272     48666432     48480467.20     6925390889.00     83218.93       
total-mem         48378328     48666488     48480523.20     6925390888.50     83218.93       
real-insert-time  168118       172730       169988.10       2290636.09        1513.48        
user-insert-time  116006       156009       135607.40       119857921.64      10947.96       
sys-insert-time   12001        56004        37602.20        131855360.76      11482.83       

real	0m3.483s
user	0m2.708s
sys	0m0.840s
$

$ time path-set-test -t 1000000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         830206       830206       830206.00       0.00              0.00           
line-mem          48049857     48049857     48049857.00     -0.50             0.71           
dups-node         0            0            0.00            0.00              0.00           
uniq-node         830206       830206       830206.00       0.00              0.00           
node-insert-eq    39958859     39958859     39958859.00     -0.25             0.50           
node-insert-lt    4591750      5162396      4875786.70      25165626667.01    158636.78      
node-insert-gt    4528498      5836311      5158742.60      164543442811.84   405639.55      
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       8921204      8921204      8921204.00      0.00              0.00           
node-mem          285478528    285478528    285478528.00    0.00              0.00           
total-node-mem    285478528    285478528    285478528.00    0.00              0.00           
total-mem         285478584    285478584    285478584.00    -16.00            4.00           
real-insert-time  1401287      1450564      1422639.10      194628509.69      13950.93       
user-insert-time  1072057      1224075      1136066.60      1568326422.24     39602.10       
sys-insert-time   276019       340023       303619.20       356708165.56      18886.72       

real	0m19.283s
user	0m16.865s
sys	0m4.684s
$

$ path-set-test -p dups-line -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-line -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p line-mem -R ...
files       min          max          avg             var               dev
10          495          673          571.40          2372.44           48.71
100         5596         6111         5828.70         17102.61          130.78
1000        56694        58779        57785.40        371605.24         609.59
10000       575634       580917       578552.90       2718178.29        1648.69
100000      5782033      5798088      5789208.40      21040162.84       4586.96
1000000     48049857     48049857     48049857.00     -0.50             0.71
$

$ path-set-test -p dups-node -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-node -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p node-insert-eq -R ...
files       min          max          avg             var               dev
10          73           135          100.30          331.01            18.19
100         1839         2160         1976.00         7414.60           86.11
1000        28008        29515        28568.30        227478.61         476.95
10000       368455       373718       371208.40       2470200.84        1571.69
100000      4368291      4377943      4374193.80      12139084.16       3484.12
1000000     39958859     39958859     39958859.00     -0.25             0.50
$

$ path-set-test -p node-insert-lt -R ...
files       min          max          avg             var               dev
10          6            13           8.30            5.61              2.37
100         152          244          182.30          722.41            26.88
1000        2456         3693         3017.40         136550.64         369.53
10000       33575        47309        40053.00        16115671.00       4014.43
100000      448303       540065       492212.00       635623502.00      25211.57
1000000     4591750      5162396      4875786.70      25165626667.01    158636.78
$

$ path-set-test -p node-insert-gt -R ...
files       min          max          avg             var               dev
10          2            15           7.70            12.21             3.49
100         109          255          168.40          1483.44           38.52
1000        2181         3167         2542.80         89842.76          299.74
10000       30694        50504        39396.50        37041656.65       6086.19
100000      441922       584261       507554.30       2944350983.61     54261.87
1000000     4528498      5836311      5158742.60      164543442811.84   405639.55
$

$ path-set-test -p node-struct-size -R ...
files       min          max          avg             var               dev
10          32           32           32.00           0.00              0.00
100         32           32           32.00           0.00              0.00
1000        32           32           32.00           0.00              0.00
10000       32           32           32.00           0.00              0.00
100000      32           32           32.00           0.00              0.00
1000000     32           32           32.00           0.00              0.00
$

$ path-set-test -p node-struct -R ...
files       min          max          avg             var               dev
10          421          593          481.10          2358.49           48.56
100         3845         4225         3952.70         11160.61          105.64
1000        29606        30857        30217.10        195026.49         441.62
10000       216062       218749       217344.50       519246.25         720.59
100000      1511821      1520826      1515014.60      6763077.04        2600.59
1000000     8921204      8921204      8921204.00      0.00              0.00
$

$ path-set-test -p node-mem -R ...
files       min          max          avg             var               dev
10          13472        18976        15395.20        2415093.76        1554.06
100         123040       135200       126486.40       11428464.64       3380.60
1000        947392       987424       966947.20       199707125.76      14131.78
10000       6913984      6999968      6955024.00      531708160.00      23058.80
100000      48378272     48666432     48480467.20     6925390889.00     83218.93
1000000     285478528    285478528    285478528.00    0.00              0.00
$

$ path-set-test -p total-node-mem -R ...
files       min          max          avg             var               dev
10          13472        18976        15395.20        2415093.76        1554.06
100         123040       135200       126486.40       11428464.64       3380.60
1000        947392       987424       966947.20       199707125.76      14131.78
10000       6913984      6999968      6955024.00      531708160.00      23058.80
100000      48378272     48666432     48480467.20     6925390889.00     83218.93
1000000     285478528    285478528    285478528.00    0.00              0.00
$

$ path-set-test -p total-mem -R ...
files       min          max          avg             var               dev
10          13528        19032        15451.20        2415093.76        1554.06
100         123096       135256       126542.40       11428464.64       3380.60
1000        947448       987480       967003.20       199707125.76      14131.78
10000       6914040      7000024      6955080.00      531708160.00      23058.80
100000      48378328     48666488     48480523.20     6925390888.50     83218.93
1000000     285478584    285478584    285478584.00    -16.00            4.00
$

$ path-set-test -p real-insert-time -R ...
files       min          max          avg             var               dev
10          35           42           37.70           3.81              1.95
100         227          414          253.20          2890.96           53.77
1000        3420         3883         3638.60         21286.04          145.90
10000       18041        23336        21091.10        3332100.69        1825.40
100000      168118       172730       169988.10       2290636.09        1513.48
1000000     1401287      1450564      1422639.10      194628509.69      13950.93
$

$ path-set-test -p user-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         2800.00         3360000.00        1833.03
10000       4000         24001        16400.80        30242560.16       5499.32
100000      116006       156009       135607.40       119857921.64      10947.96
1000000     1072057      1224075      1136066.60      1568326422.24     39602.10
$

$ path-set-test -p sys-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         1200.00         3360000.00        1833.03
10000       0            12000        4400.00         14240000.00       3773.59
100000      12001        56004        37602.20        131855360.76      11482.83
1000000     276019       340023       303619.20       356708165.56      18886.72
$

$ path-set-test -p dups-line -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-line -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p line-mem -A ...
min: 571
max: 48049857
avg: 9080300.17
var: 307988446016944.50
dev: 17549599.60
$

$ path-set-test -p dups-node -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-node -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p node-insert-eq -A ...
min: 100
max: 39958859
avg: 7455817.33
var: 213741219959898.56
dev: 14619891.24
$

$ path-set-test -p node-insert-lt -A ...
min: 8
max: 4875786
avg: 901876.33
var: 3189481604210.89
dev: 1785911.98
$

$ path-set-test -p node-insert-gt -A ...
min: 7
max: 5158742
avg: 951401.50
var: 3573466622519.92
dev: 1890361.51
$

$ path-set-test -p node-struct-size -A ...
min: 32
max: 32
avg: 32.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct -A ...
min: 481
max: 8921204
avg: 1781368.67
var: 10481944933568.56
dev: 3237583.19
$

$ path-set-test -p node-mem -A ...
min: 15395
max: 285478528
avg: 57003807.83
var: 10733510760940484.00
dev: 103602658.08
$

$ path-set-test -p total-node-mem -A ...
min: 15395
max: 285478528
avg: 57003807.83
var: 10733510760940484.00
dev: 103602658.08
$

$ path-set-test -p total-mem -A ...
min: 15451
max: 285478584
avg: 57003863.83
var: 10733510760940486.00
dev: 103602658.08
$

$ path-set-test -p real-insert-time -A ...
min: 37
max: 1422639
avg: 269607.67
var: 269521001935.89
dev: 519154.12
$

$ path-set-test -p user-insert-time -A ...
min: 0
max: 1136066
avg: 215145.50
var: 171931082963.92
dev: 414645.73
$

$ path-set-test -p sys-insert-time -A ...
min: 0
max: 303619
avg: 57803.50
var: 12261956648.58
dev: 110733.72
$

