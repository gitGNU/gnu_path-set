#
# # meta command:
# $ path-set-test \
# --input=tests/files.txt \
# --expr='10 ** x' \
# --limits=1-6 \
# --pool-size=128M \
# --hash-size=2M \
# --node-size=4M \
# --separators='/' \
# --repeat=10 \
# --sleep=100 \
# --plain-set \
# --linear-hash \
# --run-tests
#

$ date +'%Y-%m-%d %H:%M:%S.%N %z'
2016-09-29 13:14:10.977382468 +0300
$

$ ./path-set -C
CONFIG_PATH_TRIE_NODE_32BIT_OFFSETS: yes
CONFIG_PATH_TRIE_ELEM_32BIT_OFFSETS: yes
CONFIG_PATH_TRIE_UINT_HASH_IDENTOP:  no
CONFIG_TRIE_PATH_SET_PRINT_SET:      no
CONFIG_VALUE_TYPE_SIZE:              64
32BIT:                               no
DEBUG:                               yes
OPT:                                 -
$

$ ./path-set --plain-set --linear-hash -I
node-struct-size: 8
$

$ ./path-set --plain-set --linear-hash -N
dups-line
uniq-line
line-mem
dups-node
uniq-node
node-insert-eq
node-insert-ne
hash-size
hash-used
hash-load
node-struct-size
node-struct
node-mem
total-node-mem
total-mem
insert-time
$

$ PATH_SET_TEST_INPUT=tests/files.txt
$ PATH_SET_TEST_POOL_SIZE=128M
$ PATH_SET_TEST_HASH_SIZE=2M
$ PATH_SET_TEST_NODE_SIZE=4M
$ PATH_SET_TEST_STRUCT_TYPE=plain-set
$ PATH_SET_TEST_SET_TYPE=linear-hash
$ PATH_SET_TEST_SEPARATORS='/'
$

$ time path-set-test -t 10
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10           10           10.00           0.00              0.00           
line-mem          597          791          656.00          3201.60           56.58          
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10           10           10.00           0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            0            0.00            0.00              0.00           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         10           10           10.00           0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       10           10           10.00           0.00              0.00           
node-mem          687          881          746.00          3201.60           56.58          
total-node-mem    687          881          746.00          3201.60           56.58          
total-mem         16778103     16778297     16778162.00     3201.62           56.58          
real-insert-time  947          1584         1325.90         54630.49          233.73         
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m0.864s
user	0m0.372s
sys	0m0.212s
$

$ time path-set-test -t 100
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100          100          100.00          0.00              0.00           
line-mem          6136         6970         6622.20         87536.56          295.87         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100          100          100.00          0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            0            0.00            0.00              0.00           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         100          100          100.00          0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       100          100          100.00          0.00              0.00           
node-mem          7036         7870         7522.20         87536.56          295.87         
total-node-mem    7036         7870         7522.20         87536.56          295.87         
total-mem         16784452     16785286     16784938.20     87536.62          295.87         
real-insert-time  1778         2143         2012.60         11253.44          106.08         
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m0.880s
user	0m0.392s
sys	0m0.192s
$

$ time path-set-test -t 1000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         1000         1000         1000.00         0.00              0.00           
line-mem          64478        67431        65758.10        734007.29         856.74         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         1000         1000         1000.00         0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            0            0.00            0.00              0.00           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         1000         1000         1000.00         0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       1000         1000         1000.00         0.00              0.00           
node-mem          73478        76431        74758.10        734007.29         856.74         
total-node-mem    73478        76431        74758.10        734007.29         856.74         
total-mem         16850894     16853847     16852174.10     734007.25         856.74         
real-insert-time  2972         3712         3540.30         45309.81          212.86         
user-insert-time  0            4000         800.00          2560000.00        1600.00        
sys-insert-time   0            4000         2000.00         4000000.00        2000.00        

real	0m0.916s
user	0m0.404s
sys	0m0.220s
$

$ time path-set-test -t 10000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10000        10000        10000.00        0.00              0.00           
line-mem          654993       659555       657503.90       1332693.89        1154.42        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10000        10000        10000.00        0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    17           39           26.00           53.40             7.31           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         10000        10000        10000.00        0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       10000        10000        10000.00        0.00              0.00           
node-mem          744993       749555       747503.90       1332693.89        1154.42        
total-node-mem    744993       749555       747503.90       1332693.89        1154.42        
total-mem         17522409     17526971     17524919.90     1332693.94        1154.42        
real-insert-time  10525        13850        12068.40        1315960.64        1147.15        
user-insert-time  4000         8000         4800.00         2560000.00        1600.00        
sys-insert-time   0            12000        6000.00         16800000.00       4098.78        

real	0m1.021s
user	0m0.488s
sys	0m0.284s
$

$ time path-set-test -t 100000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100000       100000       100000.00       0.00              0.00           
line-mem          6559065      6580716      6570708.90      37701238.88       6140.13        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100000       100000       100000.00       0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    2584         2755         2649.60         2245.44           47.39          
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         100000       100000       100000.00       0.00              0.00           
hash-load         0.05         0.05         0.05            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       100000       100000       100000.00       0.00              0.00           
node-mem          7459065      7480716      7470708.90      37701238.88       6140.13        
total-node-mem    7459065      7480716      7470708.90      37701238.88       6140.13        
total-mem         24236481     24258132     24248124.90     37701238.88       6140.13        
real-insert-time  65223        69485        66876.30        2090904.41        1446.00        
user-insert-time  24001        44003        34002.00        48808000.60       6986.27        
sys-insert-time   20001        48003        34402.10        67848320.69       8237.01        

real	0m1.985s
user	0m1.188s
sys	0m0.816s
$

$ time path-set-test -t 1000000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         405909       405909       405909.00       0.00              0.00           
line-mem          26666438     26666438     26666438.00     0.00              0.00           
dups-node         0            0            0.00            0.00              0.00           
uniq-node         405909       405909       405909.00       0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    71277        71277        71277.00        0.00              0.00           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         405909       405909       405909.00       0.00              0.00           
hash-load         0.19         0.19         0.19            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       405909       405909       405909.00       0.00              0.00           
node-mem          30319619     30319619     30319619.00     0.00              0.00           
total-node-mem    30319619     30319619     30319619.00     0.00              0.00           
total-mem         47097035     47097035     47097035.00     -0.50             0.71           
real-insert-time  248062       265622       259325.20       31235358.56       5588.86        
user-insert-time  96005        200012       149607.80       682333445.16      26121.51       
sys-insert-time   76007        140004       101604.60       311037283.04      17636.25       

real	0m5.303s
user	0m3.836s
sys	0m2.328s
$

$ path-set-test -p dups-line -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-line -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p line-mem -R ...
files       min          max          avg             var               dev
10          597          791          656.00          3201.60           56.58
100         6136         6970         6622.20         87536.56          295.87
1000        64478        67431        65758.10        734007.29         856.74
10000       654993       659555       657503.90       1332693.89        1154.42
100000      6559065      6580716      6570708.90      37701238.88       6140.13
1000000     26666438     26666438     26666438.00     0.00              0.00
$

$ path-set-test -p dups-node -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-node -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p node-insert-eq -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p node-insert-ne -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       17           39           26.00           53.40             7.31
100000      2584         2755         2649.60         2245.44           47.39
1000000     71277        71277        71277.00        0.00              0.00
$

$ path-set-test -p hash-size -R ...
files       min          max          avg             var               dev
10          2097169      2097169      2097169.00      0.00              0.00
100         2097169      2097169      2097169.00      0.00              0.00
1000        2097169      2097169      2097169.00      0.00              0.00
10000       2097169      2097169      2097169.00      0.00              0.00
100000      2097169      2097169      2097169.00      0.00              0.00
1000000     2097169      2097169      2097169.00      0.00              0.00
$

$ path-set-test -p hash-used -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p hash-load -R ...
files       min          max          avg             var               dev
10          0.00         0.00         0.00            0.00              0.00
100         0.00         0.00         0.00            0.00              0.00
1000        0.00         0.00         0.00            0.00              0.00
10000       0.00         0.00         0.00            0.00              0.00
100000      0.05         0.05         0.05            0.00              0.00
1000000     0.19         0.19         0.19            0.00              0.00
$

$ path-set-test -p node-struct-size -R ...
files       min          max          avg             var               dev
10          8            8            8.00            0.00              0.00
100         8            8            8.00            0.00              0.00
1000        8            8            8.00            0.00              0.00
10000       8            8            8.00            0.00              0.00
100000      8            8            8.00            0.00              0.00
1000000     8            8            8.00            0.00              0.00
$

$ path-set-test -p node-struct -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p node-mem -R ...
files       min          max          avg             var               dev
10          687          881          746.00          3201.60           56.58
100         7036         7870         7522.20         87536.56          295.87
1000        73478        76431        74758.10        734007.29         856.74
10000       744993       749555       747503.90       1332693.89        1154.42
100000      7459065      7480716      7470708.90      37701238.88       6140.13
1000000     30319619     30319619     30319619.00     0.00              0.00
$

$ path-set-test -p total-node-mem -R ...
files       min          max          avg             var               dev
10          687          881          746.00          3201.60           56.58
100         7036         7870         7522.20         87536.56          295.87
1000        73478        76431        74758.10        734007.29         856.74
10000       744993       749555       747503.90       1332693.89        1154.42
100000      7459065      7480716      7470708.90      37701238.88       6140.13
1000000     30319619     30319619     30319619.00     0.00              0.00
$

$ path-set-test -p total-mem -R ...
files       min          max          avg             var               dev
10          16778103     16778297     16778162.00     3201.62           56.58
100         16784452     16785286     16784938.20     87536.62          295.87
1000        16850894     16853847     16852174.10     734007.25         856.74
10000       17522409     17526971     17524919.90     1332693.94        1154.42
100000      24236481     24258132     24248124.90     37701238.88       6140.13
1000000     47097035     47097035     47097035.00     -0.50             0.71
$

$ path-set-test -p real-insert-time -R ...
files       min          max          avg             var               dev
10          947          1584         1325.90         54630.49          233.73
100         1778         2143         2012.60         11253.44          106.08
1000        2972         3712         3540.30         45309.81          212.86
10000       10525        13850        12068.40        1315960.64        1147.15
100000      65223        69485        66876.30        2090904.41        1446.00
1000000     248062       265622       259325.20       31235358.56       5588.86
$

$ path-set-test -p user-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         800.00          2560000.00        1600.00
10000       4000         8000         4800.00         2560000.00        1600.00
100000      24001        44003        34002.00        48808000.60       6986.27
1000000     96005        200012       149607.80       682333445.16      26121.51
$

$ path-set-test -p sys-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         2000.00         4000000.00        2000.00
10000       0            12000        6000.00         16800000.00       4098.78
100000      20001        48003        34402.10        67848320.69       8237.01
1000000     76007        140004       101604.60       311037283.04      17636.25
$

$ path-set-test -p dups-line -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-line -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p line-mem -A ...
min: 656
max: 26666438
avg: 5661280.83
var: 93734865629449.47
dev: 9681676.80
$

$ path-set-test -p dups-node -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-node -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p node-insert-eq -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-insert-ne -A ...
min: 0
max: 71277
avg: 12325.33
var: 695990925.89
dev: 26381.64
$

$ path-set-test -p hash-size -A ...
min: 2097169
max: 2097169
avg: 2097169.00
var: 0.00
dev: 0.00
$

$ path-set-test -p hash-used -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p hash-load -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct-size -A ...
min: 8
max: 8
avg: 8.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p node-mem -A ...
min: 746
max: 30319619
avg: 6436809.33
var: 121176682432479.23
dev: 11008028.09
$

$ path-set-test -p total-node-mem -A ...
min: 746
max: 30319619
avg: 6436809.33
var: 121176682432479.23
dev: 11008028.09
$

$ path-set-test -p total-mem -A ...
min: 16778162
max: 47097035
avg: 23214225.33
var: 121176682432479.31
dev: 11008028.09
$

$ path-set-test -p real-insert-time -A ...
min: 1325
max: 259325
avg: 57524.33
var: 8671922240.22
dev: 93123.16
$

$ path-set-test -p user-insert-time -A ...
min: 0
max: 149607
avg: 31534.83
var: 2932566028.81
dev: 54153.17
$

$ path-set-test -p sys-insert-time -A ...
min: 0
max: 101604
avg: 24001.00
var: 1348430402.33
dev: 36720.98
$

