#
# # meta command:
# $ path-set-test \
# --input=tests/files.txt \
# --expr='10 ** x' \
# --limits=1-6 \
# --pool-size=128M \
# --hash-size=2M \
# --node-size=4M \
# --separators='/.-' \
# --repeat=10 \
# --sleep=100 \
# --plain-set \
# --linear-hash \
# --run-tests
#

$ date +'%Y-%m-%d %H:%M:%S.%N %z'
2016-09-29 13:19:57.459578601 +0300
$

$ ./path-set -C
CONFIG_PATH_TRIE_NODE_32BIT_OFFSETS: yes
CONFIG_PATH_TRIE_ELEM_32BIT_OFFSETS: yes
CONFIG_PATH_TRIE_UINT_HASH_IDENTOP:  no
CONFIG_TRIE_PATH_SET_PRINT_SET:      no
CONFIG_VALUE_TYPE_SIZE:              64
32BIT:                               no
DEBUG:                               yes
OPT:                                 -
$

$ ./path-set --plain-set --linear-hash -I
node-struct-size: 8
$

$ ./path-set --plain-set --linear-hash -N
dups-line
uniq-line
line-mem
dups-node
uniq-node
node-insert-eq
node-insert-ne
hash-size
hash-used
hash-load
node-struct-size
node-struct
node-mem
total-node-mem
total-mem
insert-time
$

$ PATH_SET_TEST_INPUT=tests/files.txt
$ PATH_SET_TEST_POOL_SIZE=128M
$ PATH_SET_TEST_HASH_SIZE=2M
$ PATH_SET_TEST_NODE_SIZE=4M
$ PATH_SET_TEST_STRUCT_TYPE=plain-set
$ PATH_SET_TEST_SET_TYPE=linear-hash
$ PATH_SET_TEST_SEPARATORS='/.-'
$

$ time path-set-test -t 10
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10           10           10.00           0.00              0.00           
line-mem          596          750          678.20          1998.96           44.71          
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10           10           10.00           0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            0            0.00            0.00              0.00           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         10           10           10.00           0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       10           10           10.00           0.00              0.00           
node-mem          686          840          768.20          1998.96           44.71          
total-node-mem    686          840          768.20          1998.96           44.71          
total-mem         16778102     16778256     16778184.20     1999.00           44.71          
real-insert-time  933          1588         1306.40         53085.84          230.40         
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m0.881s
user	0m0.408s
sys	0m0.176s
$

$ time path-set-test -t 100
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100          100          100.00          0.00              0.00           
line-mem          6182         6979         6655.30         49142.81          221.68         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100          100          100.00          0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            0            0.00            0.00              0.00           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         100          100          100.00          0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       100          100          100.00          0.00              0.00           
node-mem          7082         7879         7555.30         49142.81          221.68         
total-node-mem    7082         7879         7555.30         49142.81          221.68         
total-mem         16784498     16785295     16784971.30     49142.81          221.68         
real-insert-time  1994         2062         2038.20         354.16            18.82          
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m0.875s
user	0m0.388s
sys	0m0.184s
$

$ time path-set-test -t 1000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         1000         1000         1000.00         0.00              0.00           
line-mem          64624        66023        65412.70        245300.41         495.28         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         1000         1000         1000.00         0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            1            0.10            0.09              0.30           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         1000         1000         1000.00         0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       1000         1000         1000.00         0.00              0.00           
node-mem          73624        75023        74412.70        245300.41         495.28         
total-node-mem    73624        75023        74412.70        245300.41         495.28         
total-mem         16851040     16852439     16851828.70     245300.44         495.28         
real-insert-time  3501         3788         3625.00         5220.80           72.26          
user-insert-time  0            4000         400.00          1440000.00        1200.00        
sys-insert-time   0            4000         1200.00         3360000.00        1833.03        

real	0m0.895s
user	0m0.424s
sys	0m0.196s
$

$ time path-set-test -t 10000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10000        10000        10000.00        0.00              0.00           
line-mem          655400       657603       656138.90       478088.09         691.44         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10000        10000        10000.00        0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    18           32           27.30           15.61             3.95           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         10000        10000        10000.00        0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       10000        10000        10000.00        0.00              0.00           
node-mem          745400       747603       746138.90       478088.09         691.44         
total-node-mem    745400       747603       746138.90       478088.09         691.44         
total-mem         17522816     17525019     17523554.90     478088.19         691.44         
real-insert-time  10109        13439        11707.00        1396176.40        1181.60        
user-insert-time  0            8000         4400.00         7840000.00        2800.00        
sys-insert-time   0            16001        6000.20         29603200.16       5440.88        

real	0m1.045s
user	0m0.532s
sys	0m0.272s
$

$ time path-set-test -t 100000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100000       100000       100000.00       0.00              0.00           
line-mem          6559100      6576529      6570165.00      23085723.40       4804.76        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100000       100000       100000.00       0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    2503         2691         2623.70         2897.21           53.83          
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         100000       100000       100000.00       0.00              0.00           
hash-load         0.05         0.05         0.05            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       100000       100000       100000.00       0.00              0.00           
node-mem          7459100      7476529      7470165.00      23085723.40       4804.76        
total-node-mem    7459100      7476529      7470165.00      23085723.40       4804.76        
total-mem         24236516     24253945     24247581.00     23085723.38       4804.76        
real-insert-time  66257        72558        68649.30        3291372.81        1814.21        
user-insert-time  28001        52003        40002.10        60809600.49       7798.05        
sys-insert-time   12000        40003        24801.40        85772961.04       9261.37        

real	0m1.976s
user	0m1.288s
sys	0m0.732s
$

$ time path-set-test -t 1000000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         405909       405909       405909.00       0.00              0.00           
line-mem          26666438     26666438     26666438.00     0.00              0.00           
dups-node         0            0            0.00            0.00              0.00           
uniq-node         405909       405909       405909.00       0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    71277        71277        71277.00        0.00              0.00           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         405909       405909       405909.00       0.00              0.00           
hash-load         0.19         0.19         0.19            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       405909       405909       405909.00       0.00              0.00           
node-mem          30319619     30319619     30319619.00     0.00              0.00           
total-node-mem    30319619     30319619     30319619.00     0.00              0.00           
total-mem         47097035     47097035     47097035.00     -0.50             0.71           
real-insert-time  248300       261092       254908.20       15944557.76       3993.06        
user-insert-time  128010       176012       145208.50       214585204.05      14648.73       
sys-insert-time   92005        132010       116007.60       185639203.04      13624.95       

real	0m5.219s
user	0m3.764s
sys	0m2.296s
$

$ path-set-test -p dups-line -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-line -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p line-mem -R ...
files       min          max          avg             var               dev
10          596          750          678.20          1998.96           44.71
100         6182         6979         6655.30         49142.81          221.68
1000        64624        66023        65412.70        245300.41         495.28
10000       655400       657603       656138.90       478088.09         691.44
100000      6559100      6576529      6570165.00      23085723.40       4804.76
1000000     26666438     26666438     26666438.00     0.00              0.00
$

$ path-set-test -p dups-node -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-node -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p node-insert-eq -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p node-insert-ne -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            1            0.10            0.09              0.30
10000       18           32           27.30           15.61             3.95
100000      2503         2691         2623.70         2897.21           53.83
1000000     71277        71277        71277.00        0.00              0.00
$

$ path-set-test -p hash-size -R ...
files       min          max          avg             var               dev
10          2097169      2097169      2097169.00      0.00              0.00
100         2097169      2097169      2097169.00      0.00              0.00
1000        2097169      2097169      2097169.00      0.00              0.00
10000       2097169      2097169      2097169.00      0.00              0.00
100000      2097169      2097169      2097169.00      0.00              0.00
1000000     2097169      2097169      2097169.00      0.00              0.00
$

$ path-set-test -p hash-used -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p hash-load -R ...
files       min          max          avg             var               dev
10          0.00         0.00         0.00            0.00              0.00
100         0.00         0.00         0.00            0.00              0.00
1000        0.00         0.00         0.00            0.00              0.00
10000       0.00         0.00         0.00            0.00              0.00
100000      0.05         0.05         0.05            0.00              0.00
1000000     0.19         0.19         0.19            0.00              0.00
$

$ path-set-test -p node-struct-size -R ...
files       min          max          avg             var               dev
10          8            8            8.00            0.00              0.00
100         8            8            8.00            0.00              0.00
1000        8            8            8.00            0.00              0.00
10000       8            8            8.00            0.00              0.00
100000      8            8            8.00            0.00              0.00
1000000     8            8            8.00            0.00              0.00
$

$ path-set-test -p node-struct -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p node-mem -R ...
files       min          max          avg             var               dev
10          686          840          768.20          1998.96           44.71
100         7082         7879         7555.30         49142.81          221.68
1000        73624        75023        74412.70        245300.41         495.28
10000       745400       747603       746138.90       478088.09         691.44
100000      7459100      7476529      7470165.00      23085723.40       4804.76
1000000     30319619     30319619     30319619.00     0.00              0.00
$

$ path-set-test -p total-node-mem -R ...
files       min          max          avg             var               dev
10          686          840          768.20          1998.96           44.71
100         7082         7879         7555.30         49142.81          221.68
1000        73624        75023        74412.70        245300.41         495.28
10000       745400       747603       746138.90       478088.09         691.44
100000      7459100      7476529      7470165.00      23085723.40       4804.76
1000000     30319619     30319619     30319619.00     0.00              0.00
$

$ path-set-test -p total-mem -R ...
files       min          max          avg             var               dev
10          16778102     16778256     16778184.20     1999.00           44.71
100         16784498     16785295     16784971.30     49142.81          221.68
1000        16851040     16852439     16851828.70     245300.44         495.28
10000       17522816     17525019     17523554.90     478088.19         691.44
100000      24236516     24253945     24247581.00     23085723.38       4804.76
1000000     47097035     47097035     47097035.00     -0.50             0.71
$

$ path-set-test -p real-insert-time -R ...
files       min          max          avg             var               dev
10          933          1588         1306.40         53085.84          230.40
100         1994         2062         2038.20         354.16            18.82
1000        3501         3788         3625.00         5220.80           72.26
10000       10109        13439        11707.00        1396176.40        1181.60
100000      66257        72558        68649.30        3291372.81        1814.21
1000000     248300       261092       254908.20       15944557.76       3993.06
$

$ path-set-test -p user-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         400.00          1440000.00        1200.00
10000       0            8000         4400.00         7840000.00        2800.00
100000      28001        52003        40002.10        60809600.49       7798.05
1000000     128010       176012       145208.50       214585204.05      14648.73
$

$ path-set-test -p sys-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         1200.00         3360000.00        1833.03
10000       0            16001        6000.20         29603200.16       5440.88
100000      12000        40003        24801.40        85772961.04       9261.37
1000000     92005        132010       116007.60       185639203.04      13624.95
$

$ path-set-test -p dups-line -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-line -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p line-mem -A ...
min: 678
max: 26666438
avg: 5660914.33
var: 93737519625422.22
dev: 9681813.86
$

$ path-set-test -p dups-node -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-node -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p node-insert-eq -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-insert-ne -A ...
min: 0
max: 71277
avg: 12321.17
var: 696070783.14
dev: 26383.15
$

$ path-set-test -p hash-size -A ...
min: 2097169
max: 2097169
avg: 2097169.00
var: 0.00
dev: 0.00
$

$ path-set-test -p hash-used -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p hash-load -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct-size -A ...
min: 8
max: 8
avg: 8.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p node-mem -A ...
min: 768
max: 30319619
avg: 6436442.83
var: 121179700013402.47
dev: 11008165.15
$

$ path-set-test -p total-node-mem -A ...
min: 768
max: 30319619
avg: 6436442.83
var: 121179700013402.47
dev: 11008165.15
$

$ path-set-test -p total-mem -A ...
min: 16778184
max: 47097035
avg: 23213858.83
var: 121179700013402.50
dev: 11008165.15
$

$ path-set-test -p real-insert-time -A ...
min: 1306
max: 254908
avg: 57038.83
var: 8387709361.81
dev: 91584.44
$

$ path-set-test -p user-insert-time -A ...
min: 0
max: 145208
avg: 31668.33
var: 2781290541.89
dev: 52737.94
$

$ path-set-test -p sys-insert-time -A ...
min: 0
max: 116007
avg: 24668.00
var: 1743182051.00
dev: 41751.43
$

