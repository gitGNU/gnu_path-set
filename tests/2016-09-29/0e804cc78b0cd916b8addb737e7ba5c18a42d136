#
# # meta command:
# $ path-set-test \
# --input=tests/files2.txt \
# --expr='10 ** x' \
# --limits=1-6 \
# --pool-size=512M \
# --hash-size=2M \
# --node-size=4M \
# --separators='/.-' \
# --repeat=10 \
# --sleep=100 \
# --plain-set \
# --ternary-tree \
# --run-tests
#

$ date +'%Y-%m-%d %H:%M:%S.%N %z'
2016-09-29 13:33:11.952775028 +0300
$

$ ./path-set -C
CONFIG_PATH_TRIE_NODE_32BIT_OFFSETS: no
CONFIG_PATH_TRIE_ELEM_32BIT_OFFSETS: no
CONFIG_PATH_TRIE_UINT_HASH_IDENTOP:  no
CONFIG_TRIE_PATH_SET_PRINT_SET:      no
CONFIG_VALUE_TYPE_SIZE:              64
32BIT:                               no
DEBUG:                               yes
OPT:                                 -
$

$ ./path-set --plain-set --ternary-tree -I
node-struct-size: 32
$

$ ./path-set --plain-set --ternary-tree -N
dups-line
uniq-line
line-mem
dups-node
uniq-node
node-insert-eq
node-insert-lt
node-insert-gt
node-struct-size
node-struct
node-mem
total-node-mem
total-mem
insert-time
$

$ PATH_SET_TEST_INPUT=tests/files2.txt
$ PATH_SET_TEST_POOL_SIZE=512M
$ PATH_SET_TEST_HASH_SIZE=2M
$ PATH_SET_TEST_NODE_SIZE=4M
$ PATH_SET_TEST_STRUCT_TYPE=plain-set
$ PATH_SET_TEST_SET_TYPE=ternary-tree
$ PATH_SET_TEST_SEPARATORS='/.-'
$

$ time path-set-test -t 10
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10           10           10.00           0.00              0.00           
line-mem          494          735          576.00          4568.40           67.59          
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10           10           10.00           0.00              0.00           
node-insert-eq    62           142          100.90          675.29            25.99          
node-insert-lt    5            19           9.60            19.44             4.41           
node-insert-gt    2            18           8.10            24.29             4.93           
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       368          603          485.10          4706.09           68.60          
node-mem          11776        19296        15523.20        4819036.16        2195.23        
total-node-mem    11776        19296        15523.20        4819036.16        2195.23        
total-mem         11832        19352        15579.20        4819036.16        2195.23        
real-insert-time  28           45           37.60           25.24             5.02           
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m1.331s
user	0m0.812s
sys	0m0.232s
$

$ time path-set-test -t 100
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100          100          100.00          0.00              0.00           
line-mem          5439         6287         5876.40         67055.04          258.95         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100          100          100.00          0.00              0.00           
node-insert-eq    1803         2262         2015.30         21325.01          146.03         
node-insert-lt    118          226          172.10          1265.29           35.57          
node-insert-gt    123          346          205.80          4852.56           69.66          
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       3654         4161         3961.10         26402.09          162.49         
node-mem          116928       133152       126755.20       27035740.16       5199.59        
total-node-mem    116928       133152       126755.20       27035740.16       5199.59        
total-mem         116984       133208       126811.20       27035740.16       5199.59        
real-insert-time  225          397          260.00          2383.40           48.82          
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m1.348s
user	0m0.796s
sys	0m0.268s
$

$ time path-set-test -t 1000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         1000         1000         1000.00         0.00              0.00           
line-mem          56652        58847        57818.10        499039.89         706.43         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         1000         1000         1000.00         0.00              0.00           
node-insert-eq    28029        29237        28542.90        139637.09         373.68         
node-insert-lt    2315         3258         2748.20         62282.16          249.56         
node-insert-gt    2207         3360         2740.30         163485.41         404.33         
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       29243        31104        30275.20        266380.36         516.12         
node-mem          935776       995328       968806.40       272773488.64      16515.86       
total-node-mem    935776       995328       968806.40       272773488.64      16515.86       
total-mem         935832       995384       968862.40       272773488.64      16515.86       
real-insert-time  3580         4023         3834.60         21909.64          148.02         
user-insert-time  0            4000         1600.00         3840000.00        1959.59        
sys-insert-time   0            4000         1200.00         3360000.00        1833.03        

real	0m1.386s
user	0m0.808s
sys	0m0.292s
$

$ time path-set-test -t 10000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10000        10000        10000.00        0.00              0.00           
line-mem          575860       583737       579600.30       3807937.81        1951.39        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10000        10000        10000.00        0.00              0.00           
node-insert-eq    368336       375038       371545.10       2823351.29        1680.28        
node-insert-lt    34326        46427        40248.80        14957051.16       3867.43        
node-insert-gt    32630        53935        42309.40        37791728.84       6147.50        
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       216116       219258       218055.20       849482.76         921.67         
node-mem          6915712      7016256      6977766.40      869870346.23      29493.56       
total-node-mem    6915712      7016256      6977766.40      869870346.23      29493.56       
total-mem         6915768      7016312      6977822.40      869870346.23      29493.56       
real-insert-time  17323        24160        21006.50        4008761.65        2002.19        
user-insert-time  12000        20001        14400.80        10239360.16       3199.90        
sys-insert-time   0            12000        4800.00         15360000.00       3919.18        

real	0m1.590s
user	0m0.988s
sys	0m0.336s
$

$ time path-set-test -t 100000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100000       100000       100000.00       0.00              0.00           
line-mem          5780596      5795372      5787486.30      27053544.81       5201.30        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100000       100000       100000.00       0.00              0.00           
node-insert-eq    4365461      4377851      4372108.20      16386503.56       4048.02        
node-insert-lt    446326       561251       489274.90       1388683084.49     37265.04       
node-insert-gt    448796       574342       509002.40       1410550061.64     37557.29       
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       1512130      1519180      1515378.10      3406930.09        1845.79        
node-mem          48388160     48613760     48492099.20     3488696412.00     59065.19       
total-node-mem    48388160     48613760     48492099.20     3488696412.00     59065.19       
total-mem         48388216     48613816     48492155.20     3488696411.50     59065.19       
real-insert-time  166098       172541       169209.60       3321418.84        1822.48        
user-insert-time  108005       144009       132007.90       131216801.89      11454.99       
sys-insert-time   20000        48004        33601.90        109456321.29      10462.14       

real	0m3.503s
user	0m2.760s
sys	0m0.804s
$

$ time path-set-test -t 1000000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         830206       830206       830206.00       0.00              0.00           
line-mem          48049857     48049857     48049857.00     -0.50             0.71           
dups-node         0            0            0.00            0.00              0.00           
uniq-node         830206       830206       830206.00       0.00              0.00           
node-insert-eq    39958859     39958859     39958859.00     -0.25             0.50           
node-insert-lt    4260108      5404178      4972689.50      128625772333.25   358644.35      
node-insert-gt    4290702      5619513      4929200.30      207570440077.21   455598.99      
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       8921204      8921204      8921204.00      0.00              0.00           
node-mem          285478528    285478528    285478528.00    0.00              0.00           
total-node-mem    285478528    285478528    285478528.00    0.00              0.00           
total-mem         285478584    285478584    285478584.00    -16.00            4.00           
real-insert-time  1411613      1447456      1424069.90      126810968.89      11261.04       
user-insert-time  1076063      1216073      1117266.70      1805127931.81     42486.80       
sys-insert-time   272014       344020       309218.80       659414884.96      25679.07       

real	0m19.284s
user	0m16.821s
sys	0m4.748s
$

$ path-set-test -p dups-line -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-line -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p line-mem -R ...
files       min          max          avg             var               dev
10          494          735          576.00          4568.40           67.59
100         5439         6287         5876.40         67055.04          258.95
1000        56652        58847        57818.10        499039.89         706.43
10000       575860       583737       579600.30       3807937.81        1951.39
100000      5780596      5795372      5787486.30      27053544.81       5201.30
1000000     48049857     48049857     48049857.00     -0.50             0.71
$

$ path-set-test -p dups-node -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-node -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p node-insert-eq -R ...
files       min          max          avg             var               dev
10          62           142          100.90          675.29            25.99
100         1803         2262         2015.30         21325.01          146.03
1000        28029        29237        28542.90        139637.09         373.68
10000       368336       375038       371545.10       2823351.29        1680.28
100000      4365461      4377851      4372108.20      16386503.56       4048.02
1000000     39958859     39958859     39958859.00     -0.25             0.50
$

$ path-set-test -p node-insert-lt -R ...
files       min          max          avg             var               dev
10          5            19           9.60            19.44             4.41
100         118          226          172.10          1265.29           35.57
1000        2315         3258         2748.20         62282.16          249.56
10000       34326        46427        40248.80        14957051.16       3867.43
100000      446326       561251       489274.90       1388683084.49     37265.04
1000000     4260108      5404178      4972689.50      128625772333.25   358644.35
$

$ path-set-test -p node-insert-gt -R ...
files       min          max          avg             var               dev
10          2            18           8.10            24.29             4.93
100         123          346          205.80          4852.56           69.66
1000        2207         3360         2740.30         163485.41         404.33
10000       32630        53935        42309.40        37791728.84       6147.50
100000      448796       574342       509002.40       1410550061.64     37557.29
1000000     4290702      5619513      4929200.30      207570440077.21   455598.99
$

$ path-set-test -p node-struct-size -R ...
files       min          max          avg             var               dev
10          32           32           32.00           0.00              0.00
100         32           32           32.00           0.00              0.00
1000        32           32           32.00           0.00              0.00
10000       32           32           32.00           0.00              0.00
100000      32           32           32.00           0.00              0.00
1000000     32           32           32.00           0.00              0.00
$

$ path-set-test -p node-struct -R ...
files       min          max          avg             var               dev
10          368          603          485.10          4706.09           68.60
100         3654         4161         3961.10         26402.09          162.49
1000        29243        31104        30275.20        266380.36         516.12
10000       216116       219258       218055.20       849482.76         921.67
100000      1512130      1519180      1515378.10      3406930.09        1845.79
1000000     8921204      8921204      8921204.00      0.00              0.00
$

$ path-set-test -p node-mem -R ...
files       min          max          avg             var               dev
10          11776        19296        15523.20        4819036.16        2195.23
100         116928       133152       126755.20       27035740.16       5199.59
1000        935776       995328       968806.40       272773488.64      16515.86
10000       6915712      7016256      6977766.40      869870346.23      29493.56
100000      48388160     48613760     48492099.20     3488696412.00     59065.19
1000000     285478528    285478528    285478528.00    0.00              0.00
$

$ path-set-test -p total-node-mem -R ...
files       min          max          avg             var               dev
10          11776        19296        15523.20        4819036.16        2195.23
100         116928       133152       126755.20       27035740.16       5199.59
1000        935776       995328       968806.40       272773488.64      16515.86
10000       6915712      7016256      6977766.40      869870346.23      29493.56
100000      48388160     48613760     48492099.20     3488696412.00     59065.19
1000000     285478528    285478528    285478528.00    0.00              0.00
$

$ path-set-test -p total-mem -R ...
files       min          max          avg             var               dev
10          11832        19352        15579.20        4819036.16        2195.23
100         116984       133208       126811.20       27035740.16       5199.59
1000        935832       995384       968862.40       272773488.64      16515.86
10000       6915768      7016312      6977822.40      869870346.23      29493.56
100000      48388216     48613816     48492155.20     3488696411.50     59065.19
1000000     285478584    285478584    285478584.00    -16.00            4.00
$

$ path-set-test -p real-insert-time -R ...
files       min          max          avg             var               dev
10          28           45           37.60           25.24             5.02
100         225          397          260.00          2383.40           48.82
1000        3580         4023         3834.60         21909.64          148.02
10000       17323        24160        21006.50        4008761.65        2002.19
100000      166098       172541       169209.60       3321418.84        1822.48
1000000     1411613      1447456      1424069.90      126810968.89      11261.04
$

$ path-set-test -p user-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         1600.00         3840000.00        1959.59
10000       12000        20001        14400.80        10239360.16       3199.90
100000      108005       144009       132007.90       131216801.89      11454.99
1000000     1076063      1216073      1117266.70      1805127931.81     42486.80
$

$ path-set-test -p sys-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         1200.00         3360000.00        1833.03
10000       0            12000        4800.00         15360000.00       3919.18
100000      20000        48004        33601.90        109456321.29      10462.14
1000000     272014       344020       309218.80       659414884.96      25679.07
$

$ path-set-test -p dups-line -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-line -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p line-mem -A ...
min: 576
max: 48049857
avg: 9080202.17
var: 307987106255948.81
dev: 17549561.43
$

$ path-set-test -p dups-node -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-node -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p node-insert-eq -A ...
min: 100
max: 39958859
avg: 7455528.17
var: 213742533980799.81
dev: 14619936.18
$

$ path-set-test -p node-insert-lt -A ...
min: 9
max: 4972689
avg: 917523.33
var: 3319593002867.22
dev: 1821975.03
$

$ path-set-test -p node-insert-gt -A ...
min: 8
max: 4929200
avg: 913910.67
var: 3257749506215.22
dev: 1804923.68
$

$ path-set-test -p node-struct-size -A ...
min: 32
max: 32
avg: 32.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct -A ...
min: 485
max: 8921204
avg: 1781559.67
var: 10481500450089.22
dev: 3237514.55
$

$ path-set-test -p node-mem -A ...
min: 15523
max: 285478528
avg: 57009912.83
var: 10733056126349488.00
dev: 103600463.93
$

$ path-set-test -p total-node-mem -A ...
min: 15523
max: 285478528
avg: 57009912.83
var: 10733056126349488.00
dev: 103600463.93
$

$ path-set-test -p total-mem -A ...
min: 15579
max: 285478584
avg: 57009968.83
var: 10733056126349490.00
dev: 103600463.93
$

$ path-set-test -p real-insert-time -A ...
min: 37
max: 1424069
avg: 269735.83
var: 270085950716.47
dev: 519697.94
$

$ path-set-test -p user-insert-time -A ...
min: 0
max: 1117266
avg: 210878.83
var: 166516631452.81
dev: 408064.49
$

$ path-set-test -p sys-insert-time -A ...
min: 0
max: 309218
avg: 58136.50
var: 12748360488.58
dev: 112908.64
$

