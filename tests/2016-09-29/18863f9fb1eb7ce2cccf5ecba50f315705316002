#
# # meta command:
# $ path-set-test \
# --input=tests/files.txt \
# --expr='10 ** x' \
# --limits=1-6 \
# --pool-size=128M \
# --hash-size=2M \
# --node-size=4M \
# --separators='/.-' \
# --repeat=10 \
# --sleep=100 \
# --plain-set \
# --ternary-tree \
# --run-tests
#

$ date +'%Y-%m-%d %H:%M:%S.%N %z'
2016-09-29 13:17:41.491349022 +0300
$

$ ./path-set -C
CONFIG_PATH_TRIE_NODE_32BIT_OFFSETS: no
CONFIG_PATH_TRIE_ELEM_32BIT_OFFSETS: no
CONFIG_PATH_TRIE_UINT_HASH_IDENTOP:  no
CONFIG_TRIE_PATH_SET_PRINT_SET:      no
CONFIG_VALUE_TYPE_SIZE:              64
32BIT:                               no
DEBUG:                               yes
OPT:                                 -
$

$ ./path-set --plain-set --ternary-tree -I
node-struct-size: 32
$

$ ./path-set --plain-set --ternary-tree -N
dups-line
uniq-line
line-mem
dups-node
uniq-node
node-insert-eq
node-insert-lt
node-insert-gt
node-struct-size
node-struct
node-mem
total-node-mem
total-mem
insert-time
$

$ PATH_SET_TEST_INPUT=tests/files.txt
$ PATH_SET_TEST_POOL_SIZE=128M
$ PATH_SET_TEST_HASH_SIZE=2M
$ PATH_SET_TEST_NODE_SIZE=4M
$ PATH_SET_TEST_STRUCT_TYPE=plain-set
$ PATH_SET_TEST_SET_TYPE=ternary-tree
$ PATH_SET_TEST_SEPARATORS='/.-'
$

$ time path-set-test -t 10
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10           10           10.00           0.00              0.00           
line-mem          590          835          698.10          4106.69           64.08          
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10           10           10.00           0.00              0.00           
node-insert-eq    146          207          179.50          378.25            19.45          
node-insert-lt    1            18           6.60            18.44             4.29           
node-insert-gt    5            15           9.10            9.89              3.14           
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       437          683          528.60          4487.44           66.99          
node-mem          13984        21856        16915.20        4595138.56        2143.63        
total-node-mem    13984        21856        16915.20        4595138.56        2143.63        
total-mem         14040        21912        16971.20        4595138.56        2143.63        
real-insert-time  35           47           40.50           15.85             3.98           
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m0.866s
user	0m0.404s
sys	0m0.180s
$

$ time path-set-test -t 100
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100          100          100.00          0.00              0.00           
line-mem          6187         7103         6636.50         54088.45          232.57         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100          100          100.00          0.00              0.00           
node-insert-eq    2674         3018         2808.10         10118.09          100.59         
node-insert-lt    123          250          163.60          1658.04           40.72          
node-insert-gt    124          217          172.20          996.36            31.57          
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       3525         4384         3928.40         53216.24          230.69         
node-mem          112800       140288       125708.80       54493429.76       7381.97        
total-node-mem    112800       140288       125708.80       54493429.76       7381.97        
total-mem         112856       140344       125764.80       54493429.76       7381.97        
real-insert-time  237          416          293.00          4883.20           69.88          
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m0.868s
user	0m0.412s
sys	0m0.168s
$

$ time path-set-test -t 1000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         1000         1000         1000.00         0.00              0.00           
line-mem          64263        66519        65378.50        545965.65         738.89         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         1000         1000         1000.00         0.00              0.00           
node-insert-eq    38175        40507        39327.30        541117.21         735.61         
node-insert-lt    2039         3494         2703.80         252606.16         502.60         
node-insert-gt    2333         3097         2710.30         77638.41          278.64         
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       26663        27451        27051.20        59720.76          244.38         
node-mem          853216       878432       865638.40       61154058.24       7820.11        
total-node-mem    853216       878432       865638.40       61154058.24       7820.11        
total-mem         853272       878488       865694.40       61154058.24       7820.11        
real-insert-time  3298         3865         3647.30         34254.61          185.08         
user-insert-time  0            4000         2000.00         4000000.00        2000.00        
sys-insert-time   0            4000         800.00          2560000.00        1600.00        

real	0m0.931s
user	0m0.404s
sys	0m0.228s
$

$ time path-set-test -t 10000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10000        10000        10000.00        0.00              0.00           
line-mem          652993       660407       656602.20       6190780.76        2488.13        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10000        10000        10000.00        0.00              0.00           
node-insert-eq    482171       489062       485524.50       4649175.25        2156.19        
node-insert-lt    31080        47407        35997.40        23484489.04       4846.08        
node-insert-gt    27140        43417        36483.70        25112059.21       5011.19        
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       179827       181738       181077.70       371080.21         609.16         
node-mem          5754464      5815616      5794486.40      379986135.04      19493.23       
total-node-mem    5754464      5815616      5794486.40      379986135.04      19493.23       
total-mem         5754520      5815672      5794542.40      379986135.04      19493.23       
real-insert-time  17769        22901        20099.80        3923479.36        1980.78        
user-insert-time  4000         20001        12400.70        30244240.21       5499.48        
sys-insert-time   0            12000        6800.00         16160000.00       4019.95        

real	0m1.074s
user	0m0.592s
sys	0m0.236s
$

$ time path-set-test -t 100000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100000       100000       100000.00       0.00              0.00           
line-mem          6560182      6576148      6568572.20      20854443.76       4566.67        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100000       100000       100000.00       0.00              0.00           
node-insert-eq    5428331      5446752      5438148.90      24369563.29       4936.55        
node-insert-lt    416521       572517       473793.60       2309639081.04     48058.70       
node-insert-gt    411221       554771       473225.10       1840187085.29     42897.40       
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       1227570      1232882      1230423.30      3625042.81        1903.95        
node-mem          39282240     39452224     39373545.60     3712043837.25     60926.54       
total-node-mem    39282240     39452224     39373545.60     3712043837.25     60926.54       
total-mem         39282296     39452280     39373601.60     3712043837.25     60926.54       
real-insert-time  162352       171010       167165.50       5726295.85        2392.97        
user-insert-time  108005       160009       131607.90       327877522.89      18107.39       
sys-insert-time   16000        52003        38402.00        112662401.40      10614.25       

real	0m2.994s
user	0m2.324s
sys	0m0.748s
$

$ time path-set-test -t 1000000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         405909       405909       405909.00       0.00              0.00           
line-mem          26666438     26666438     26666438.00     0.00              0.00           
dups-node         0            0            0.00            0.00              0.00           
uniq-node         405909       405909       405909.00       0.00              0.00           
node-insert-eq    23077486     23077486     23077486.00     0.00              0.00           
node-insert-lt    2004547      2594566      2309197.00      41891596667.20    204674.37      
node-insert-gt    1912669      2357168      2157923.30      23240255314.41    152447.55      
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       3994861      3994861      3994861.00      0.00              0.00           
node-mem          127835552    127835552    127835552.00    0.00              0.00           
total-node-mem    127835552    127835552    127835552.00    0.00              0.00           
total-mem         127835608    127835608    127835608.00    0.00              0.00           
real-insert-time  673934       699363       684825.90       82646958.29       9091.04        
user-insert-time  484030       552034       536034.00       358433606.40      18932.34       
sys-insert-time   120008       184012       149609.10       387886081.89      19694.82       

real	0m9.552s
user	0m8.237s
sys	0m2.360s
$

$ path-set-test -p dups-line -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-line -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p line-mem -R ...
files       min          max          avg             var               dev
10          590          835          698.10          4106.69           64.08
100         6187         7103         6636.50         54088.45          232.57
1000        64263        66519        65378.50        545965.65         738.89
10000       652993       660407       656602.20       6190780.76        2488.13
100000      6560182      6576148      6568572.20      20854443.76       4566.67
1000000     26666438     26666438     26666438.00     0.00              0.00
$

$ path-set-test -p dups-node -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-node -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p node-insert-eq -R ...
files       min          max          avg             var               dev
10          146          207          179.50          378.25            19.45
100         2674         3018         2808.10         10118.09          100.59
1000        38175        40507        39327.30        541117.21         735.61
10000       482171       489062       485524.50       4649175.25        2156.19
100000      5428331      5446752      5438148.90      24369563.29       4936.55
1000000     23077486     23077486     23077486.00     0.00              0.00
$

$ path-set-test -p node-insert-lt -R ...
files       min          max          avg             var               dev
10          1            18           6.60            18.44             4.29
100         123          250          163.60          1658.04           40.72
1000        2039         3494         2703.80         252606.16         502.60
10000       31080        47407        35997.40        23484489.04       4846.08
100000      416521       572517       473793.60       2309639081.04     48058.70
1000000     2004547      2594566      2309197.00      41891596667.20    204674.37
$

$ path-set-test -p node-insert-gt -R ...
files       min          max          avg             var               dev
10          5            15           9.10            9.89              3.14
100         124          217          172.20          996.36            31.57
1000        2333         3097         2710.30         77638.41          278.64
10000       27140        43417        36483.70        25112059.21       5011.19
100000      411221       554771       473225.10       1840187085.29     42897.40
1000000     1912669      2357168      2157923.30      23240255314.41    152447.55
$

$ path-set-test -p node-struct-size -R ...
files       min          max          avg             var               dev
10          32           32           32.00           0.00              0.00
100         32           32           32.00           0.00              0.00
1000        32           32           32.00           0.00              0.00
10000       32           32           32.00           0.00              0.00
100000      32           32           32.00           0.00              0.00
1000000     32           32           32.00           0.00              0.00
$

$ path-set-test -p node-struct -R ...
files       min          max          avg             var               dev
10          437          683          528.60          4487.44           66.99
100         3525         4384         3928.40         53216.24          230.69
1000        26663        27451        27051.20        59720.76          244.38
10000       179827       181738       181077.70       371080.21         609.16
100000      1227570      1232882      1230423.30      3625042.81        1903.95
1000000     3994861      3994861      3994861.00      0.00              0.00
$

$ path-set-test -p node-mem -R ...
files       min          max          avg             var               dev
10          13984        21856        16915.20        4595138.56        2143.63
100         112800       140288       125708.80       54493429.76       7381.97
1000        853216       878432       865638.40       61154058.24       7820.11
10000       5754464      5815616      5794486.40      379986135.04      19493.23
100000      39282240     39452224     39373545.60     3712043837.25     60926.54
1000000     127835552    127835552    127835552.00    0.00              0.00
$

$ path-set-test -p total-node-mem -R ...
files       min          max          avg             var               dev
10          13984        21856        16915.20        4595138.56        2143.63
100         112800       140288       125708.80       54493429.76       7381.97
1000        853216       878432       865638.40       61154058.24       7820.11
10000       5754464      5815616      5794486.40      379986135.04      19493.23
100000      39282240     39452224     39373545.60     3712043837.25     60926.54
1000000     127835552    127835552    127835552.00    0.00              0.00
$

$ path-set-test -p total-mem -R ...
files       min          max          avg             var               dev
10          14040        21912        16971.20        4595138.56        2143.63
100         112856       140344       125764.80       54493429.76       7381.97
1000        853272       878488       865694.40       61154058.24       7820.11
10000       5754520      5815672      5794542.40      379986135.04      19493.23
100000      39282296     39452280     39373601.60     3712043837.25     60926.54
1000000     127835608    127835608    127835608.00    0.00              0.00
$

$ path-set-test -p real-insert-time -R ...
files       min          max          avg             var               dev
10          35           47           40.50           15.85             3.98
100         237          416          293.00          4883.20           69.88
1000        3298         3865         3647.30         34254.61          185.08
10000       17769        22901        20099.80        3923479.36        1980.78
100000      162352       171010       167165.50       5726295.85        2392.97
1000000     673934       699363       684825.90       82646958.29       9091.04
$

$ path-set-test -p user-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         2000.00         4000000.00        2000.00
10000       4000         20001        12400.70        30244240.21       5499.48
100000      108005       160009       131607.90       327877522.89      18107.39
1000000     484030       552034       536034.00       358433606.40      18932.34
$

$ path-set-test -p sys-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         800.00          2560000.00        1600.00
10000       0            12000        6800.00         16160000.00       4019.95
100000      16000        52003        38402.00        112662401.40      10614.25
1000000     120008       184012       149609.10       387886081.89      19694.82
$

$ path-set-test -p dups-line -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-line -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p line-mem -A ...
min: 698
max: 26666438
avg: 5660720.67
var: 93736324653975.56
dev: 9681752.15
$

$ path-set-test -p dups-node -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-node -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p node-insert-eq -A ...
min: 179
max: 23077486
avg: 4840578.67
var: 70298981810896.55
dev: 8384448.81
$

$ path-set-test -p node-insert-lt -A ...
min: 6
max: 2309197
avg: 470309.83
var: 705170945416.81
dev: 839744.57
$

$ path-set-test -p node-insert-gt -A ...
min: 9
max: 2157923
avg: 445087.00
var: 615549555365.67
dev: 784569.66
$

$ path-set-test -p node-struct-size -A ...
min: 32
max: 32
avg: 32.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct -A ...
min: 528
max: 3994861
avg: 906311.33
var: 2096331685862.89
dev: 1447871.43
$

$ path-set-test -p node-mem -A ...
min: 16915
max: 127835552
avg: 29001974.00
var: 2146643151900233.50
dev: 46331880.51
$

$ path-set-test -p total-node-mem -A ...
min: 16915
max: 127835552
avg: 29001974.00
var: 2146643151900233.50
dev: 46331880.51
$

$ path-set-test -p total-mem -A ...
min: 16971
max: 127835608
avg: 29002030.00
var: 2146643151900233.50
dev: 46331880.51
$

$ path-set-test -p real-insert-time -A ...
min: 40
max: 684825
avg: 146011.50
var: 61571771152.58
dev: 248136.60
$

$ path-set-test -p user-insert-time -A ...
min: 0
max: 536034
avg: 113673.50
var: 37880103998.58
dev: 194628.12
$

$ path-set-test -p sys-insert-time -A ...
min: 0
max: 149609
avg: 32601.83
var: 2921194877.47
dev: 54048.08
$

