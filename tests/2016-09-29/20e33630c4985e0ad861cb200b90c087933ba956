#
# # meta command:
# $ path-set-test \
# --input=tests/files2.txt \
# --expr='10 ** x' \
# --limits=1-6 \
# --pool-size=512M \
# --hash-size=2M \
# --node-size=4M \
# --separators='/' \
# --repeat=10 \
# --sleep=100 \
# --plain-set \
# --ternary-tree \
# --run-tests
#

$ date +'%Y-%m-%d %H:%M:%S.%N %z'
2016-09-29 13:26:52.438775320 +0300
$

$ ./path-set -C
CONFIG_PATH_TRIE_NODE_32BIT_OFFSETS: yes
CONFIG_PATH_TRIE_ELEM_32BIT_OFFSETS: yes
CONFIG_PATH_TRIE_UINT_HASH_IDENTOP:  no
CONFIG_TRIE_PATH_SET_PRINT_SET:      no
CONFIG_VALUE_TYPE_SIZE:              64
32BIT:                               no
DEBUG:                               yes
OPT:                                 -
$

$ ./path-set --plain-set --ternary-tree -I
node-struct-size: 32
$

$ ./path-set --plain-set --ternary-tree -N
dups-line
uniq-line
line-mem
dups-node
uniq-node
node-insert-eq
node-insert-lt
node-insert-gt
node-struct-size
node-struct
node-mem
total-node-mem
total-mem
insert-time
$

$ PATH_SET_TEST_INPUT=tests/files2.txt
$ PATH_SET_TEST_POOL_SIZE=512M
$ PATH_SET_TEST_HASH_SIZE=2M
$ PATH_SET_TEST_NODE_SIZE=4M
$ PATH_SET_TEST_STRUCT_TYPE=plain-set
$ PATH_SET_TEST_SET_TYPE=ternary-tree
$ PATH_SET_TEST_SEPARATORS='/'
$

$ time path-set-test -t 10
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10           10           10.00           0.00              0.00           
line-mem          547          700          619.90          2534.09           50.34          
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10           10           10.00           0.00              0.00           
node-insert-eq    69           166          117.70          803.81            28.35          
node-insert-lt    5            17           10.60           11.84             3.44           
node-insert-gt    0            15           7.50            22.25             4.72           
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       413          623          512.20          4250.76           65.20          
node-mem          13216        19936        16390.40        4352778.24        2086.33        
total-node-mem    13216        19936        16390.40        4352778.24        2086.33        
total-mem         13272        19992        16446.40        4352778.24        2086.33        
real-insert-time  35           56           42.40           36.04             6.00           
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m1.330s
user	0m0.780s
sys	0m0.276s
$

$ time path-set-test -t 100
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100          100          100.00          0.00              0.00           
line-mem          5271         6001         5782.20         37413.36          193.43         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100          100          100.00          0.00              0.00           
node-insert-eq    1856         2160         1983.60         5857.44           76.53          
node-insert-lt    114          258          191.20          1886.56           43.43          
node-insert-gt    119          312          192.10          3309.49           57.53          
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       3402         4245         3898.60         43051.04          207.49         
node-mem          108864       135840       124755.20       44084264.96       6639.60        
total-node-mem    108864       135840       124755.20       44084264.96       6639.60        
total-mem         108920       135896       124811.20       44084264.96       6639.60        
real-insert-time  209          394          263.30          3923.41           62.64          
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m1.351s
user	0m0.820s
sys	0m0.240s
$

$ time path-set-test -t 1000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         1000         1000         1000.00         0.00              0.00           
line-mem          57356        59605        58193.10        357718.09         598.10         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         1000         1000         1000.00         0.00              0.00           
node-insert-eq    27815        29949        28581.50        277661.05         526.94         
node-insert-lt    2432         4115         2857.30         199409.01         446.55         
node-insert-gt    1899         3452         2728.20         191343.76         437.43         
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       30175        31071        30611.60        77739.64          278.82         
node-mem          965600       994272       979571.20       79605391.36       8922.19        
total-node-mem    965600       994272       979571.20       79605391.36       8922.19        
total-mem         965656       994328       979627.20       79605391.36       8922.19        
real-insert-time  3460         3827         3700.10         11088.09          105.30         
user-insert-time  0            4000         2400.00         3840000.00        1959.59        
sys-insert-time   0            4000         800.00          2560000.00        1600.00        

real	0m1.355s
user	0m0.824s
sys	0m0.260s
$

$ time path-set-test -t 10000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10000        10000        10000.00        0.00              0.00           
line-mem          574742       583549       578990.90       6096811.29        2469.17        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10000        10000        10000.00        0.00              0.00           
node-insert-eq    368739       375565       371499.00       4577681.80        2139.55        
node-insert-lt    33297        43902        39164.00        9634333.20        3103.92        
node-insert-gt    30996        48321        39705.20        26108582.96       5109.66        
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       214972       219412       217491.90       1438458.49        1199.36        
node-mem          6879104      7021184      6959740.80      1472981493.76     38379.44       
total-node-mem    6879104      7021184      6959740.80      1472981493.76     38379.44       
total-mem         6879160      7021240      6959796.80      1472981493.77     38379.44       
real-insert-time  18770        23318        20412.90        2032060.69        1425.50        
user-insert-time  8000         20001        13600.40        16640320.24       4079.25        
sys-insert-time   0            12001        4400.10         14241520.09       3773.79        

real	0m1.598s
user	0m0.980s
sys	0m0.340s
$

$ time path-set-test -t 100000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100000       100000       100000.00       0.00              0.00           
line-mem          5773614      5794693      5786079.90      31960609.68       5653.37        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100000       100000       100000.00       0.00              0.00           
node-insert-eq    4357922      4379105      4371399.30      31921774.81       5649.94        
node-insert-lt    455642       553579       494813.20       770016092.56      27749.16       
node-insert-gt    389187       558835       475380.20       1919751053.36     43814.96       
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       1512632      1517371      1514680.60      2434463.04        1560.28        
node-mem          48404224     48555872     48469779.20     2492890152.50     49928.85       
total-node-mem    48404224     48555872     48469779.20     2492890152.50     49928.85       
total-mem         48404280     48555928     48469835.20     2492890152.50     49928.85       
real-insert-time  166761       174119       170973.10       3619142.49        1902.40        
user-insert-time  100006       140007       122406.80       151053760.76      12290.39       
sys-insert-time   32002        56004        45202.90        67368240.49       8207.82        

real	0m3.525s
user	0m2.628s
sys	0m0.952s
$

$ time path-set-test -t 1000000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         830206       830206       830206.00       0.00              0.00           
line-mem          48049857     48049857     48049857.00     -0.50             0.71           
dups-node         0            0            0.00            0.00              0.00           
uniq-node         830206       830206       830206.00       0.00              0.00           
node-insert-eq    39958859     39958859     39958859.00     -0.25             0.50           
node-insert-lt    4656663      5158552      4866736.70      22441337864.01    149804.33      
node-insert-gt    4469855      5876260      4898780.10      170759773383.49   413230.90      
node-struct-size  32           32           32.00           0.00              0.00           
node-struct       8921204      8921204      8921204.00      0.00              0.00           
node-mem          285478528    285478528    285478528.00    0.00              0.00           
total-node-mem    285478528    285478528    285478528.00    0.00              0.00           
total-mem         285478584    285478584    285478584.00    -16.00            4.00           
real-insert-time  1417599      1442034      1429243.70      83114283.41       9116.70        
user-insert-time  1076070      1280073      1159270.90      2553067843.89     50527.89       
sys-insert-time   248015       344021       298418.70       762357447.41      27610.82       

real	0m19.322s
user	0m17.013s
sys	0m4.608s
$

$ path-set-test -p dups-line -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-line -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p line-mem -R ...
files       min          max          avg             var               dev
10          547          700          619.90          2534.09           50.34
100         5271         6001         5782.20         37413.36          193.43
1000        57356        59605        58193.10        357718.09         598.10
10000       574742       583549       578990.90       6096811.29        2469.17
100000      5773614      5794693      5786079.90      31960609.68       5653.37
1000000     48049857     48049857     48049857.00     -0.50             0.71
$

$ path-set-test -p dups-node -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-node -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p node-insert-eq -R ...
files       min          max          avg             var               dev
10          69           166          117.70          803.81            28.35
100         1856         2160         1983.60         5857.44           76.53
1000        27815        29949        28581.50        277661.05         526.94
10000       368739       375565       371499.00       4577681.80        2139.55
100000      4357922      4379105      4371399.30      31921774.81       5649.94
1000000     39958859     39958859     39958859.00     -0.25             0.50
$

$ path-set-test -p node-insert-lt -R ...
files       min          max          avg             var               dev
10          5            17           10.60           11.84             3.44
100         114          258          191.20          1886.56           43.43
1000        2432         4115         2857.30         199409.01         446.55
10000       33297        43902        39164.00        9634333.20        3103.92
100000      455642       553579       494813.20       770016092.56      27749.16
1000000     4656663      5158552      4866736.70      22441337864.01    149804.33
$

$ path-set-test -p node-insert-gt -R ...
files       min          max          avg             var               dev
10          0            15           7.50            22.25             4.72
100         119          312          192.10          3309.49           57.53
1000        1899         3452         2728.20         191343.76         437.43
10000       30996        48321        39705.20        26108582.96       5109.66
100000      389187       558835       475380.20       1919751053.36     43814.96
1000000     4469855      5876260      4898780.10      170759773383.49   413230.90
$

$ path-set-test -p node-struct-size -R ...
files       min          max          avg             var               dev
10          32           32           32.00           0.00              0.00
100         32           32           32.00           0.00              0.00
1000        32           32           32.00           0.00              0.00
10000       32           32           32.00           0.00              0.00
100000      32           32           32.00           0.00              0.00
1000000     32           32           32.00           0.00              0.00
$

$ path-set-test -p node-struct -R ...
files       min          max          avg             var               dev
10          413          623          512.20          4250.76           65.20
100         3402         4245         3898.60         43051.04          207.49
1000        30175        31071        30611.60        77739.64          278.82
10000       214972       219412       217491.90       1438458.49        1199.36
100000      1512632      1517371      1514680.60      2434463.04        1560.28
1000000     8921204      8921204      8921204.00      0.00              0.00
$

$ path-set-test -p node-mem -R ...
files       min          max          avg             var               dev
10          13216        19936        16390.40        4352778.24        2086.33
100         108864       135840       124755.20       44084264.96       6639.60
1000        965600       994272       979571.20       79605391.36       8922.19
10000       6879104      7021184      6959740.80      1472981493.76     38379.44
100000      48404224     48555872     48469779.20     2492890152.50     49928.85
1000000     285478528    285478528    285478528.00    0.00              0.00
$

$ path-set-test -p total-node-mem -R ...
files       min          max          avg             var               dev
10          13216        19936        16390.40        4352778.24        2086.33
100         108864       135840       124755.20       44084264.96       6639.60
1000        965600       994272       979571.20       79605391.36       8922.19
10000       6879104      7021184      6959740.80      1472981493.76     38379.44
100000      48404224     48555872     48469779.20     2492890152.50     49928.85
1000000     285478528    285478528    285478528.00    0.00              0.00
$

$ path-set-test -p total-mem -R ...
files       min          max          avg             var               dev
10          13272        19992        16446.40        4352778.24        2086.33
100         108920       135896       124811.20       44084264.96       6639.60
1000        965656       994328       979627.20       79605391.36       8922.19
10000       6879160      7021240      6959796.80      1472981493.77     38379.44
100000      48404280     48555928     48469835.20     2492890152.50     49928.85
1000000     285478584    285478584    285478584.00    -16.00            4.00
$

$ path-set-test -p real-insert-time -R ...
files       min          max          avg             var               dev
10          35           56           42.40           36.04             6.00
100         209          394          263.30          3923.41           62.64
1000        3460         3827         3700.10         11088.09          105.30
10000       18770        23318        20412.90        2032060.69        1425.50
100000      166761       174119       170973.10       3619142.49        1902.40
1000000     1417599      1442034      1429243.70      83114283.41       9116.70
$

$ path-set-test -p user-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         2400.00         3840000.00        1959.59
10000       8000         20001        13600.40        16640320.24       4079.25
100000      100006       140007       122406.80       151053760.76      12290.39
1000000     1076070      1280073      1159270.90      2553067843.89     50527.89
$

$ path-set-test -p sys-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         800.00          2560000.00        1600.00
10000       0            12001        4400.10         14241520.09       3773.79
100000      32002        56004        45202.90        67368240.49       8207.82
1000000     248015       344021       298418.70       762357447.41      27610.82
$

$ path-set-test -p dups-line -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-line -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p line-mem -A ...
min: 619
max: 48049857
avg: 9079920.00
var: 307989405722720.69
dev: 17549626.94
$

$ path-set-test -p dups-node -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-node -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p node-insert-eq -A ...
min: 117
max: 39958859
avg: 7455406.33
var: 213743312092496.88
dev: 14619962.79
$

$ path-set-test -p node-insert-lt -A ...
min: 10
max: 4866736
avg: 900628.50
var: 3177451841086.25
dev: 1782540.84
$

$ path-set-test -p node-insert-gt -A ...
min: 7
max: 4898780
avg: 902798.67
var: 3222557167251.89
dev: 1795148.23
$

$ path-set-test -p node-struct-size -A ...
min: 32
max: 32
avg: 32.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct -A ...
min: 512
max: 8921204
avg: 1781399.33
var: 10481681604693.89
dev: 3237542.53
$

$ path-set-test -p node-mem -A ...
min: 16390
max: 285478528
avg: 57004793.83
var: 10733240613020728.00
dev: 103601354.30
$

$ path-set-test -p total-node-mem -A ...
min: 16390
max: 285478528
avg: 57004793.83
var: 10733240613020728.00
dev: 103601354.30
$

$ path-set-test -p total-mem -A ...
min: 16446
max: 285478584
avg: 57004849.83
var: 10733240613020726.00
dev: 103601354.30
$

$ path-set-test -p real-insert-time -A ...
min: 42
max: 1429243
avg: 270772.17
var: 272082055501.14
dev: 521614.85
$

$ path-set-test -p user-insert-time -A ...
min: 0
max: 1159270
avg: 216279.33
var: 179736730262.22
dev: 423953.69
$

$ path-set-test -p sys-insert-time -A ...
min: 0
max: 298418
avg: 58136.67
var: 11806215243.56
dev: 108656.41
$

