#
# # meta command:
# $ path-set-test \
# --input=tests/files2.txt \
# --expr='10 ** x' \
# --limits=1-6 \
# --pool-size=512M \
# --hash-size=2M \
# --node-size=4M \
# --separators='/' \
# --repeat=10 \
# --sleep=100 \
# --plain-set \
# --linear-hash \
# --run-tests
#

$ date +'%Y-%m-%d %H:%M:%S.%N %z'
2016-09-29 13:24:15.387037023 +0300
$

$ ./path-set -C
CONFIG_PATH_TRIE_NODE_32BIT_OFFSETS: no
CONFIG_PATH_TRIE_ELEM_32BIT_OFFSETS: no
CONFIG_PATH_TRIE_UINT_HASH_IDENTOP:  no
CONFIG_TRIE_PATH_SET_PRINT_SET:      no
CONFIG_VALUE_TYPE_SIZE:              64
32BIT:                               no
DEBUG:                               yes
OPT:                                 -
$

$ ./path-set --plain-set --linear-hash -I
node-struct-size: 8
$

$ ./path-set --plain-set --linear-hash -N
dups-line
uniq-line
line-mem
dups-node
uniq-node
node-insert-eq
node-insert-ne
hash-size
hash-used
hash-load
node-struct-size
node-struct
node-mem
total-node-mem
total-mem
insert-time
$

$ PATH_SET_TEST_INPUT=tests/files2.txt
$ PATH_SET_TEST_POOL_SIZE=512M
$ PATH_SET_TEST_HASH_SIZE=2M
$ PATH_SET_TEST_NODE_SIZE=4M
$ PATH_SET_TEST_STRUCT_TYPE=plain-set
$ PATH_SET_TEST_SET_TYPE=linear-hash
$ PATH_SET_TEST_SEPARATORS='/'
$

$ time path-set-test -t 10
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10           10           10.00           0.00              0.00           
line-mem          480          665          562.60          3011.84           54.88          
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10           10           10.00           0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            0            0.00            0.00              0.00           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         10           10           10.00           0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       10           10           10.00           0.00              0.00           
node-mem          570          755          652.60          3011.84           54.88          
total-node-mem    570          755          652.60          3011.84           54.88          
total-mem         16777986     16778171     16778068.60     3011.81           54.88          
real-insert-time  1017         1927         1434.70         68882.41          262.45         
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m1.342s
user	0m0.756s
sys	0m0.288s
$

$ time path-set-test -t 100
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100          100          100.00          0.00              0.00           
line-mem          5416         6024         5773.40         49116.44          221.62         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100          100          100.00          0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            0            0.00            0.00              0.00           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         100          100          100.00          0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       100          100          100.00          0.00              0.00           
node-mem          6316         6924         6673.40         49116.44          221.62         
total-node-mem    6316         6924         6673.40         49116.44          221.62         
total-mem         16783732     16784340     16784089.40     49116.50          221.62         
real-insert-time  1551         2140         2053.70         28457.01          168.69         
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m1.316s
user	0m0.760s
sys	0m0.272s
$

$ time path-set-test -t 1000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         1000         1000         1000.00         0.00              0.00           
line-mem          57391        59348        58156.60        274023.04         523.47         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         1000         1000         1000.00         0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            0            0.00            0.00              0.00           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         1000         1000         1000.00         0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       1000         1000         1000.00         0.00              0.00           
node-mem          66391        68348        67156.60        274023.04         523.47         
total-node-mem    66391        68348        67156.60        274023.04         523.47         
total-mem         16843807     16845764     16844572.60     274023.00         523.47         
real-insert-time  3288         3690         3497.40         22893.24          151.31         
user-insert-time  0            4000         1200.00         3360000.00        1833.03        
sys-insert-time   0            4000         1600.00         3840000.00        1959.59        

real	0m1.372s
user	0m0.800s
sys	0m0.304s
$

$ time path-set-test -t 10000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10000        10000        10000.00        0.00              0.00           
line-mem          574936       582651       578448.10       3491347.49        1868.51        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10000        10000        10000.00        0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    18           29           23.70           12.41             3.52           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         10000        10000        10000.00        0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       10000        10000        10000.00        0.00              0.00           
node-mem          664936       672651       668448.10       3491347.49        1868.51        
total-node-mem    664936       672651       668448.10       3491347.49        1868.51        
total-mem         17442352     17450067     17445864.10     3491347.44        1868.51        
real-insert-time  10016        15913        11983.30        2320364.21        1523.27        
user-insert-time  0            8000         3600.00         7840000.00        2800.00        
sys-insert-time   4000         16001        8400.10         23841520.09       4882.78        

real	0m1.486s
user	0m0.900s
sys	0m0.344s
$

$ time path-set-test -t 100000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100000       100000       100000.00       0.00              0.00           
line-mem          5781207      5802247      5789344.50      37610720.25       6132.76        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100000       100000       100000.00       0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    2417         2605         2528.20         2923.56           54.07          
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         100000       100000       100000.00       0.00              0.00           
hash-load         0.05         0.05         0.05            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       100000       100000       100000.00       0.00              0.00           
node-mem          6681207      6702247      6689344.50      37610720.25       6132.76        
total-node-mem    6681207      6702247      6689344.50      37610720.25       6132.76        
total-mem         23458623     23479663     23466760.50     37610720.25       6132.76        
real-insert-time  62116        65398        64445.10        734552.29         857.06         
user-insert-time  8000         64003        41202.40        272204642.24      16498.63       
sys-insert-time   12000        32002        24401.50        33446000.65       5783.25        

real	0m2.407s
user	0m1.592s
sys	0m0.812s
$

$ time path-set-test -t 1000000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         830206       830206       830206.00       0.00              0.00           
line-mem          48049857     48049857     48049857.00     -0.50             0.71           
dups-node         0            0            0.00            0.00              0.00           
uniq-node         830206       830206       830206.00       0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    286678       286678       286678.00       0.00              0.00           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         830206       830206       830206.00       0.00              0.00           
hash-load         0.40         0.40         0.40            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       830206       830206       830206.00       0.00              0.00           
node-mem          55521711     55521711     55521711.00     -0.50             0.71           
total-node-mem    55521711     55521711     55521711.00     -0.50             0.71           
total-mem         72299127     72299127     72299127.00     0.00              0.00           
real-insert-time  499071       524137       511176.70       82226243.61       9067.87        
user-insert-time  236014       340019       297217.50       825855607.05      28737.70       
sys-insert-time   188012       264014       222814.30       576218327.01      24004.55       

real	0m10.107s
user	0m7.504s
sys	0m4.464s
$

$ path-set-test -p dups-line -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-line -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p line-mem -R ...
files       min          max          avg             var               dev
10          480          665          562.60          3011.84           54.88
100         5416         6024         5773.40         49116.44          221.62
1000        57391        59348        58156.60        274023.04         523.47
10000       574936       582651       578448.10       3491347.49        1868.51
100000      5781207      5802247      5789344.50      37610720.25       6132.76
1000000     48049857     48049857     48049857.00     -0.50             0.71
$

$ path-set-test -p dups-node -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-node -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p node-insert-eq -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p node-insert-ne -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       18           29           23.70           12.41             3.52
100000      2417         2605         2528.20         2923.56           54.07
1000000     286678       286678       286678.00       0.00              0.00
$

$ path-set-test -p hash-size -R ...
files       min          max          avg             var               dev
10          2097169      2097169      2097169.00      0.00              0.00
100         2097169      2097169      2097169.00      0.00              0.00
1000        2097169      2097169      2097169.00      0.00              0.00
10000       2097169      2097169      2097169.00      0.00              0.00
100000      2097169      2097169      2097169.00      0.00              0.00
1000000     2097169      2097169      2097169.00      0.00              0.00
$

$ path-set-test -p hash-used -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p hash-load -R ...
files       min          max          avg             var               dev
10          0.00         0.00         0.00            0.00              0.00
100         0.00         0.00         0.00            0.00              0.00
1000        0.00         0.00         0.00            0.00              0.00
10000       0.00         0.00         0.00            0.00              0.00
100000      0.05         0.05         0.05            0.00              0.00
1000000     0.40         0.40         0.40            0.00              0.00
$

$ path-set-test -p node-struct-size -R ...
files       min          max          avg             var               dev
10          8            8            8.00            0.00              0.00
100         8            8            8.00            0.00              0.00
1000        8            8            8.00            0.00              0.00
10000       8            8            8.00            0.00              0.00
100000      8            8            8.00            0.00              0.00
1000000     8            8            8.00            0.00              0.00
$

$ path-set-test -p node-struct -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p node-mem -R ...
files       min          max          avg             var               dev
10          570          755          652.60          3011.84           54.88
100         6316         6924         6673.40         49116.44          221.62
1000        66391        68348        67156.60        274023.04         523.47
10000       664936       672651       668448.10       3491347.49        1868.51
100000      6681207      6702247      6689344.50      37610720.25       6132.76
1000000     55521711     55521711     55521711.00     -0.50             0.71
$

$ path-set-test -p total-node-mem -R ...
files       min          max          avg             var               dev
10          570          755          652.60          3011.84           54.88
100         6316         6924         6673.40         49116.44          221.62
1000        66391        68348        67156.60        274023.04         523.47
10000       664936       672651       668448.10       3491347.49        1868.51
100000      6681207      6702247      6689344.50      37610720.25       6132.76
1000000     55521711     55521711     55521711.00     -0.50             0.71
$

$ path-set-test -p total-mem -R ...
files       min          max          avg             var               dev
10          16777986     16778171     16778068.60     3011.81           54.88
100         16783732     16784340     16784089.40     49116.50          221.62
1000        16843807     16845764     16844572.60     274023.00         523.47
10000       17442352     17450067     17445864.10     3491347.44        1868.51
100000      23458623     23479663     23466760.50     37610720.25       6132.76
1000000     72299127     72299127     72299127.00     0.00              0.00
$

$ path-set-test -p real-insert-time -R ...
files       min          max          avg             var               dev
10          1017         1927         1434.70         68882.41          262.45
100         1551         2140         2053.70         28457.01          168.69
1000        3288         3690         3497.40         22893.24          151.31
10000       10016        15913        11983.30        2320364.21        1523.27
100000      62116        65398        64445.10        734552.29         857.06
1000000     499071       524137       511176.70       82226243.61       9067.87
$

$ path-set-test -p user-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         1200.00         3360000.00        1833.03
10000       0            8000         3600.00         7840000.00        2800.00
100000      8000         64003        41202.40        272204642.24      16498.63
1000000     236014       340019       297217.50       825855607.05      28737.70
$

$ path-set-test -p sys-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         1600.00         3840000.00        1959.59
10000       4000         16001        8400.10         23841520.09       4882.78
100000      12000        32002        24401.50        33446000.65       5783.25
1000000     188012       264014       222814.30       576218327.01      24004.55
$

$ path-set-test -p dups-line -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-line -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p line-mem -A ...
min: 562
max: 48049857
avg: 9080356.67
var: 307987669393321.94
dev: 17549577.47
$

$ path-set-test -p dups-node -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-node -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p node-insert-eq -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-insert-ne -A ...
min: 0
max: 286678
avg: 48204.83
var: 11374738542.81
dev: 106652.42
$

$ path-set-test -p hash-size -A ...
min: 2097169
max: 2097169
avg: 2097169.00
var: 0.00
dev: 0.00
$

$ path-set-test -p hash-used -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p hash-load -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct-size -A ...
min: 8
max: 8
avg: 8.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p node-mem -A ...
min: 652
max: 55521711
avg: 10492330.67
var: 411220846036147.94
dev: 20278580.97
$

$ path-set-test -p total-node-mem -A ...
min: 652
max: 55521711
avg: 10492330.67
var: 411220846036147.94
dev: 20278580.97
$

$ path-set-test -p total-mem -A ...
min: 16778068
max: 72299127
avg: 27269746.67
var: 411220846036147.88
dev: 20278580.97
$

$ path-set-test -p real-insert-time -A ...
min: 1434
max: 511176
avg: 99098.00
var: 34448945306.67
dev: 185604.27
$

$ path-set-test -p user-insert-time -A ...
min: 0
max: 297217
avg: 57203.17
var: 11736122705.47
dev: 108333.39
$

$ path-set-test -p sys-insert-time -A ...
min: 0
max: 222814
avg: 42869.17
var: 6548002448.81
dev: 80919.73
$

