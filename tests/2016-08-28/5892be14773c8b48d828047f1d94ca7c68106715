#
# # meta command:
# $ path-set-test \
# --input=tests/files.txt \
# --expr='10 ** x' \
# --limits=1-6 \
# --pool-size=128M \
# --hash-size=2M \
# --node-size=4M \
# --separators='/' \
# --repeat=10 \
# --sleep=100 \
# --plain-set \
# --linear-hash \
# --run-tests
#

$ date +'%Y-%m-%d %H:%M:%S.%N %z'
2016-08-28 19:33:56.354027762 +0300
$

$ ./path-set -C
CONFIG_PATH_TRIE_NODE_32BIT_OFFSETS: no
CONFIG_PATH_TRIE_ELEM_32BIT_OFFSETS: no
CONFIG_PATH_TRIE_UINT_HASH_IDENTOP:  no
CONFIG_TRIE_PATH_SET_PRINT_SET:      no
CONFIG_VALUE_TYPE_SIZE:              64
32BIT:                               no
DEBUG:                               yes
OPT:                                 -
$

$ ./path-set --plain-set --linear-hash -I
node-struct-size: 8
$

$ ./path-set --plain-set --linear-hash -N
dups-line
uniq-line
line-mem
dups-node
uniq-node
node-insert-eq
node-insert-ne
hash-size
hash-used
hash-load
node-struct-size
node-struct
node-mem
total-node-mem
insert-time
$

$ PATH_SET_TEST_INPUT=tests/files.txt
$ PATH_SET_TEST_POOL_SIZE=128M
$ PATH_SET_TEST_HASH_SIZE=2M
$ PATH_SET_TEST_NODE_SIZE=4M
$ PATH_SET_TEST_STRUCT_TYPE=plain-set
$ PATH_SET_TEST_SET_TYPE=linear-hash
$ PATH_SET_TEST_SEPARATORS='/'
$

$ time path-set-test -t 10
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10           10           10.00           0.00              0.00           
line-mem          538          707          615.80          1782.36           42.22          
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10           10           10.00           0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            0            0.00            0.00              0.00           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         10           10           10.00           0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       10           10           10.00           0.00              0.00           
node-mem          628          797          705.80          1782.36           42.22          
total-node-mem    628          797          705.80          1782.36           42.22          
real-insert-time  598          1372         937.90          42874.49          207.06         
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m0.877s
user	0m0.440s
sys	0m0.164s
$

$ time path-set-test -t 100
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100          100          100.00          0.00              0.00           
line-mem          6467         7147         6641.60         45098.84          212.36         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100          100          100.00          0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            0            0.00            0.00              0.00           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         100          100          100.00          0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       100          100          100.00          0.00              0.00           
node-mem          7367         8047         7541.60         45098.84          212.36         
total-node-mem    7367         8047         7541.60         45098.84          212.36         
real-insert-time  1410         1816         1581.70         10492.61          102.43         
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m0.881s
user	0m0.420s
sys	0m0.176s
$

$ time path-set-test -t 1000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         1000         1000         1000.00         0.00              0.00           
line-mem          64697        67673        65894.40        820654.64         905.90         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         1000         1000         1000.00         0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            2            0.20            0.36              0.60           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         1000         1000         1000.00         0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       1000         1000         1000.00         0.00              0.00           
node-mem          73697        76673        74894.40        820654.64         905.90         
total-node-mem    73697        76673        74894.40        820654.64         905.90         
real-insert-time  2628         3209         2979.80         23573.16          153.54         
user-insert-time  0            4000         800.00          2560000.00        1600.00        
sys-insert-time   0            4000         2000.00         4000000.00        2000.00        

real	0m0.898s
user	0m0.428s
sys	0m0.192s
$

$ time path-set-test -t 10000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10000        10000        10000.00        0.00              0.00           
line-mem          654652       660296       657354.90       2620937.49        1618.93        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10000        10000        10000.00        0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    18           29           23.60           12.04             3.47           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         10000        10000        10000.00        0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       10000        10000        10000.00        0.00              0.00           
node-mem          744652       750296       747354.90       2620937.49        1618.93        
total-node-mem    744652       750296       747354.90       2620937.49        1618.93        
real-insert-time  9541         13566        11434.00        1423444.80        1193.08        
user-insert-time  0            8000         3200.00         5760000.00        2400.00        
sys-insert-time   0            12001        6000.10         13601200.09       3687.98        

real	0m0.992s
user	0m0.484s
sys	0m0.260s
$

$ time path-set-test -t 100000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100000       100000       100000.00       0.00              0.00           
line-mem          6559867      6575501      6567277.10      28833308.09       5369.67        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100000       100000       100000.00       0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    2549         2711         2638.50         2349.85           48.48          
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         100000       100000       100000.00       0.00              0.00           
hash-load         0.05         0.05         0.05            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       100000       100000       100000.00       0.00              0.00           
node-mem          7459867      7475501      7467277.10      28833308.09       5369.67        
total-node-mem    7459867      7475501      7467277.10      28833308.09       5369.67        
real-insert-time  66048        71231        67493.50        2205661.05        1485.15        
user-insert-time  28002        56003        39602.40        84643520.84       9200.19        
sys-insert-time   8000         32001        20000.80        41601600.16       6449.93        

real	0m1.968s
user	0m1.296s
sys	0m0.692s
$

$ time path-set-test -t 1000000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         405909       405909       405909.00       0.00              0.00           
line-mem          26666438     26666438     26666438.00     0.00              0.00           
dups-node         0            0            0.00            0.00              0.00           
uniq-node         405909       405909       405909.00       0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    71277        71277        71277.00        0.00              0.00           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         405909       405909       405909.00       0.00              0.00           
hash-load         0.19         0.19         0.19            0.00              0.00           
node-struct-size  8            8            8.00            0.00              0.00           
node-struct       405909       405909       405909.00       0.00              0.00           
node-mem          30319619     30319619     30319619.00     0.00              0.00           
total-node-mem    30319619     30319619     30319619.00     0.00              0.00           
real-insert-time  256512       266342       260126.10       12457900.89       3529.58        
user-insert-time  112008       172010       155208.90       261775041.29      16179.46       
sys-insert-time   92005        128011       107606.20       132665763.76      11518.06       

real	0m5.233s
user	0m3.832s
sys	0m2.304s
$

$ path-set-test -p dups-line -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-line -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p line-mem -R ...
files       min          max          avg             var               dev
10          538          707          615.80          1782.36           42.22
100         6467         7147         6641.60         45098.84          212.36
1000        64697        67673        65894.40        820654.64         905.90
10000       654652       660296       657354.90       2620937.49        1618.93
100000      6559867      6575501      6567277.10      28833308.09       5369.67
1000000     26666438     26666438     26666438.00     0.00              0.00
$

$ path-set-test -p dups-node -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-node -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p node-insert-eq -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p node-insert-ne -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            2            0.20            0.36              0.60
10000       18           29           23.60           12.04             3.47
100000      2549         2711         2638.50         2349.85           48.48
1000000     71277        71277        71277.00        0.00              0.00
$

$ path-set-test -p hash-size -R ...
files       min          max          avg             var               dev
10          2097169      2097169      2097169.00      0.00              0.00
100         2097169      2097169      2097169.00      0.00              0.00
1000        2097169      2097169      2097169.00      0.00              0.00
10000       2097169      2097169      2097169.00      0.00              0.00
100000      2097169      2097169      2097169.00      0.00              0.00
1000000     2097169      2097169      2097169.00      0.00              0.00
$

$ path-set-test -p hash-used -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p hash-load -R ...
files       min          max          avg             var               dev
10          0.00         0.00         0.00            0.00              0.00
100         0.00         0.00         0.00            0.00              0.00
1000        0.00         0.00         0.00            0.00              0.00
10000       0.00         0.00         0.00            0.00              0.00
100000      0.05         0.05         0.05            0.00              0.00
1000000     0.19         0.19         0.19            0.00              0.00
$

$ path-set-test -p node-struct-size -R ...
files       min          max          avg             var               dev
10          8            8            8.00            0.00              0.00
100         8            8            8.00            0.00              0.00
1000        8            8            8.00            0.00              0.00
10000       8            8            8.00            0.00              0.00
100000      8            8            8.00            0.00              0.00
1000000     8            8            8.00            0.00              0.00
$

$ path-set-test -p node-struct -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p node-mem -R ...
files       min          max          avg             var               dev
10          628          797          705.80          1782.36           42.22
100         7367         8047         7541.60         45098.84          212.36
1000        73697        76673        74894.40        820654.64         905.90
10000       744652       750296       747354.90       2620937.49        1618.93
100000      7459867      7475501      7467277.10      28833308.09       5369.67
1000000     30319619     30319619     30319619.00     0.00              0.00
$

$ path-set-test -p total-node-mem -R ...
files       min          max          avg             var               dev
10          628          797          705.80          1782.36           42.22
100         7367         8047         7541.60         45098.84          212.36
1000        73697        76673        74894.40        820654.64         905.90
10000       744652       750296       747354.90       2620937.49        1618.93
100000      7459867      7475501      7467277.10      28833308.09       5369.67
1000000     30319619     30319619     30319619.00     0.00              0.00
$

$ path-set-test -p real-insert-time -R ...
files       min          max          avg             var               dev
10          598          1372         937.90          42874.49          207.06
100         1410         1816         1581.70         10492.61          102.43
1000        2628         3209         2979.80         23573.16          153.54
10000       9541         13566        11434.00        1423444.80        1193.08
100000      66048        71231        67493.50        2205661.05        1485.15
1000000     256512       266342       260126.10       12457900.89       3529.58
$

$ path-set-test -p user-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         800.00          2560000.00        1600.00
10000       0            8000         3200.00         5760000.00        2400.00
100000      28002        56003        39602.40        84643520.84       9200.19
1000000     112008       172010       155208.90       261775041.29      16179.46
$

$ path-set-test -p sys-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         2000.00         4000000.00        2000.00
10000       0            12001        6000.10         13601200.09       3687.98
100000      8000         32001        20000.80        41601600.16       6449.93
1000000     92005        128011       107606.20       132665763.76      11518.06
$

$ path-set-test -p dups-line -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-line -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p line-mem -A ...
min: 615
max: 26666438
avg: 5660703.17
var: 93733863589595.14
dev: 9681625.05
$

$ path-set-test -p dups-node -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-node -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p node-insert-eq -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-insert-ne -A ...
min: 0
max: 71277
avg: 12323.00
var: 696038721.33
dev: 26382.55
$

$ path-set-test -p hash-size -A ...
min: 2097169
max: 2097169
avg: 2097169.00
var: 0.00
dev: 0.00
$

$ path-set-test -p hash-used -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p hash-load -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct-size -A ...
min: 8
max: 8
avg: 8.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p node-mem -A ...
min: 705
max: 30319619
avg: 6436231.67
var: 121175543029021.88
dev: 11007976.34
$

$ path-set-test -p total-node-mem -A ...
min: 705
max: 30319619
avg: 6436231.67
var: 121175543029021.88
dev: 11007976.34
$

$ path-set-test -p real-insert-time -A ...
min: 937
max: 260126
avg: 57425.00
var: 8763007583.67
dev: 93610.94
$

$ path-set-test -p user-insert-time -A ...
min: 0
max: 155208
avg: 33135.00
var: 3180192053.00
dev: 56393.19
$

$ path-set-test -p sys-insert-time -A ...
min: 0
max: 107606
avg: 22601.00
var: 1492370005.00
dev: 38631.21
$

