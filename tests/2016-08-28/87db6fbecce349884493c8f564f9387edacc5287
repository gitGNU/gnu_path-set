#
# # meta command:
# $ path-set-test \
# --input=tests/files.txt \
# --expr='10 ** x' \
# --limits=1-6 \
# --pool-size=128M \
# --hash-size=2M \
# --node-size=4M \
# --separators='/.-' \
# --repeat=10 \
# --sleep=100 \
# --plain-set \
# --gnulib-hash \
# --run-tests
#

$ date +'%Y-%m-%d %H:%M:%S.%N %z'
2016-08-28 19:41:43.398717854 +0300
$

$ ./path-set -C
CONFIG_PATH_TRIE_NODE_32BIT_OFFSETS: yes
CONFIG_PATH_TRIE_ELEM_32BIT_OFFSETS: yes
CONFIG_PATH_TRIE_UINT_HASH_IDENTOP:  no
CONFIG_TRIE_PATH_SET_PRINT_SET:      no
CONFIG_VALUE_TYPE_SIZE:              64
32BIT:                               no
DEBUG:                               yes
OPT:                                 -
$

$ ./path-set --plain-set --gnulib-hash -I
node-struct-size: 16
$

$ ./path-set --plain-set --gnulib-hash -N
dups-line
uniq-line
line-mem
dups-node
uniq-node
node-insert-eq
node-insert-ne
node-rehash-eq
node-rehash-ne
hash-size
hash-used
hash-load
node-struct-size
node-struct
node-mem
total-node-mem
insert-time
$

$ PATH_SET_TEST_INPUT=tests/files.txt
$ PATH_SET_TEST_POOL_SIZE=128M
$ PATH_SET_TEST_HASH_SIZE=2M
$ PATH_SET_TEST_NODE_SIZE=4M
$ PATH_SET_TEST_STRUCT_TYPE=plain-set
$ PATH_SET_TEST_SET_TYPE=gnulib-hash
$ PATH_SET_TEST_SEPARATORS='/.-'
$

$ time path-set-test -t 10
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10           10           10.00           0.00              0.00           
line-mem          599          752          668.70          2394.41           48.93          
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10           10           10.00           0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            0            0.00            0.00              0.00           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         10           10           10.00           0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       10           10           10.00           0.00              0.00           
node-mem          769          922          838.70          2394.41           48.93          
total-node-mem    769          922          838.70          2394.41           48.93          
real-insert-time  921          2218         1637.40         205211.44         453.00         
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m0.997s
user	0m0.488s
sys	0m0.212s
$

$ time path-set-test -t 100
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100          100          100.00          0.00              0.00           
line-mem          6537         7126         6737.80         31480.76          177.43         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100          100          100.00          0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            0            0.00            0.00              0.00           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         100          100          100.00          0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       100          100          100.00          0.00              0.00           
node-mem          8237         8826         8437.80         31480.76          177.43         
total-node-mem    8237         8826         8437.80         31480.76          177.43         
real-insert-time  2814         5319         4900.20         498182.56         705.82         
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            4000         3600.00         1440000.00        1200.00        

real	0m0.983s
user	0m0.420s
sys	0m0.288s
$

$ time path-set-test -t 1000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         1000         1000         1000.00         0.00              0.00           
line-mem          64044        66240        65365.60        418440.84         646.87         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         1000         1000         1000.00         0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            2            0.20            0.36              0.60           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         998          1000         999.80          0.36              0.60           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       1000         1000         1000.00         0.00              0.00           
node-mem          81044        83240        82365.60        418440.84         646.87         
total-node-mem    81044        83240        82365.60        418440.84         646.87         
real-insert-time  5014         6639         5751.70         331597.41         575.84         
user-insert-time  0            4000         1200.00         3360000.00        1833.03        
sys-insert-time   0            4000         3200.00         2560000.00        1600.00        

real	0m1.025s
user	0m0.476s
sys	0m0.256s
$

$ time path-set-test -t 10000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10000        10000        10000.00        0.00              0.00           
line-mem          652958       661108       657920.50       6216284.45        2493.25        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10000        10000        10000.00        0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    15           29           20.60           16.24             4.03           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         9971         9985         9979.50         15.85             3.98           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       10000        10000        10000.00        0.00              0.00           
node-mem          822958       831108       827920.50       6216284.45        2493.25        
total-node-mem    822958       831108       827920.50       6216284.45        2493.25        
real-insert-time  9568         15673        13631.20        2924600.16        1710.15        
user-insert-time  0            12000        5600.00         10240000.00       3200.00        
sys-insert-time   0            12001        7200.20         15361120.16       3919.33        

real	0m1.138s
user	0m0.564s
sys	0m0.300s
$

$ time path-set-test -t 100000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100000       100000       100000.00       0.00              0.00           
line-mem          6559506      6570631      6566918.60      10467482.25       3235.35        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100000       100000       100000.00       0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    1881         1996         1924.70         1092.01           33.05          
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         98044        98142        98099.90        910.89            30.18          
hash-load         0.04         0.04         0.04            0.00              0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       100000       100000       100000.00       0.00              0.00           
node-mem          8259506      8270631      8266918.60      10467482.25       3235.35        
total-node-mem    8259506      8270631      8266918.60      10467482.25       3235.35        
real-insert-time  74180        79120        77046.80        2280430.76        1510.11        
user-insert-time  40001        60004        48802.80        34569921.36       5879.62        
sys-insert-time   16001        52004        28401.30        119859761.21      10948.05       

real	0m2.157s
user	0m1.424s
sys	0m0.784s
$

$ time path-set-test -t 1000000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         405909       405909       405909.00       0.00              0.00           
line-mem          26666438     26666438     26666438.00     0.00              0.00           
dups-node         0            0            0.00            0.00              0.00           
uniq-node         405909       405909       405909.00       0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    31613        31613        31613.00        0.00              0.00           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         375952       375952       375952.00       0.00              0.00           
hash-load         0.14         0.14         0.14            -0.00             0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       405909       405909       405909.00       0.00              0.00           
node-mem          33566891     33566891     33566891.00     -0.25             0.50           
total-node-mem    33566891     33566891     33566891.00     -0.25             0.50           
real-insert-time  277369       292794       284874.00       17568580.00       4191.49        
user-insert-time  136009       224014       176011.10       614452003.49      24788.14       
sys-insert-time   68004        140007       116406.60       331071521.84      18195.37       

real	0m5.620s
user	0m4.160s
sys	0m2.328s
$

$ path-set-test -p dups-line -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-line -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p line-mem -R ...
files       min          max          avg             var               dev
10          599          752          668.70          2394.41           48.93
100         6537         7126         6737.80         31480.76          177.43
1000        64044        66240        65365.60        418440.84         646.87
10000       652958       661108       657920.50       6216284.45        2493.25
100000      6559506      6570631      6566918.60      10467482.25       3235.35
1000000     26666438     26666438     26666438.00     0.00              0.00
$

$ path-set-test -p dups-node -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-node -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p node-insert-eq -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p node-insert-ne -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            2            0.20            0.36              0.60
10000       15           29           20.60           16.24             4.03
100000      1881         1996         1924.70         1092.01           33.05
1000000     31613        31613        31613.00        0.00              0.00
$

$ path-set-test -p node-rehash-eq -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p node-rehash-ne -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p hash-size -R ...
files       min          max          avg             var               dev
10          2621447      2621447      2621447.00      0.00              0.00
100         2621447      2621447      2621447.00      0.00              0.00
1000        2621447      2621447      2621447.00      0.00              0.00
10000       2621447      2621447      2621447.00      0.00              0.00
100000      2621447      2621447      2621447.00      0.00              0.00
1000000     2621447      2621447      2621447.00      0.00              0.00
$

$ path-set-test -p hash-used -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        998          1000         999.80          0.36              0.60
10000       9971         9985         9979.50         15.85             3.98
100000      98044        98142        98099.90        910.89            30.18
1000000     375952       375952       375952.00       0.00              0.00
$

$ path-set-test -p hash-load -R ...
files       min          max          avg             var               dev
10          0.00         0.00         0.00            0.00              0.00
100         0.00         0.00         0.00            0.00              0.00
1000        0.00         0.00         0.00            0.00              0.00
10000       0.00         0.00         0.00            0.00              0.00
100000      0.04         0.04         0.04            0.00              0.00
1000000     0.14         0.14         0.14            -0.00             0.00
$

$ path-set-test -p node-struct-size -R ...
files       min          max          avg             var               dev
10          16           16           16.00           0.00              0.00
100         16           16           16.00           0.00              0.00
1000        16           16           16.00           0.00              0.00
10000       16           16           16.00           0.00              0.00
100000      16           16           16.00           0.00              0.00
1000000     16           16           16.00           0.00              0.00
$

$ path-set-test -p node-struct -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     405909       405909       405909.00       0.00              0.00
$

$ path-set-test -p node-mem -R ...
files       min          max          avg             var               dev
10          769          922          838.70          2394.41           48.93
100         8237         8826         8437.80         31480.76          177.43
1000        81044        83240        82365.60        418440.84         646.87
10000       822958       831108       827920.50       6216284.45        2493.25
100000      8259506      8270631      8266918.60      10467482.25       3235.35
1000000     33566891     33566891     33566891.00     -0.25             0.50
$

$ path-set-test -p total-node-mem -R ...
files       min          max          avg             var               dev
10          769          922          838.70          2394.41           48.93
100         8237         8826         8437.80         31480.76          177.43
1000        81044        83240        82365.60        418440.84         646.87
10000       822958       831108       827920.50       6216284.45        2493.25
100000      8259506      8270631      8266918.60      10467482.25       3235.35
1000000     33566891     33566891     33566891.00     -0.25             0.50
$

$ path-set-test -p real-insert-time -R ...
files       min          max          avg             var               dev
10          921          2218         1637.40         205211.44         453.00
100         2814         5319         4900.20         498182.56         705.82
1000        5014         6639         5751.70         331597.41         575.84
10000       9568         15673        13631.20        2924600.16        1710.15
100000      74180        79120        77046.80        2280430.76        1510.11
1000000     277369       292794       284874.00       17568580.00       4191.49
$

$ path-set-test -p user-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         1200.00         3360000.00        1833.03
10000       0            12000        5600.00         10240000.00       3200.00
100000      40001        60004        48802.80        34569921.36       5879.62
1000000     136009       224014       176011.10       614452003.49      24788.14
$

$ path-set-test -p sys-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            4000         3600.00         1440000.00        1200.00
1000        0            4000         3200.00         2560000.00        1600.00
10000       0            12001        7200.20         15361120.16       3919.33
100000      16001        52004        28401.30        119859761.21      10948.05
1000000     68004        140007       116406.60       331071521.84      18195.37
$

$ path-set-test -p dups-line -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-line -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p line-mem -A ...
min: 668
max: 26666438
avg: 5660674.33
var: 93733516886872.22
dev: 9681607.14
$

$ path-set-test -p dups-node -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-node -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p node-insert-eq -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-insert-ne -A ...
min: 0
max: 31613
avg: 5592.83
var: 135900872.81
dev: 11657.65
$

$ path-set-test -p node-rehash-eq -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-rehash-ne -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p hash-size -A ...
min: 2621447
max: 2621447
avg: 2621447.00
var: 0.00
dev: 0.00
$

$ path-set-test -p hash-used -A ...
min: 10
max: 375952
avg: 80856.50
var: 18639544515.58
dev: 136526.72
$

$ path-set-test -p hash-load -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct-size -A ...
min: 16
max: 16
avg: 16.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct -A ...
min: 10
max: 405909
avg: 86169.83
var: 21718614220.14
dev: 147372.37
$

$ path-set-test -p node-mem -A ...
min: 838
max: 33566891
avg: 7125561.50
var: 148521441981291.59
dev: 12186937.35
$

$ path-set-test -p total-node-mem -A ...
min: 838
max: 33566891
avg: 7125561.50
var: 148521441981291.59
dev: 12186937.35
$

$ path-set-test -p real-insert-time -A ...
min: 1637
max: 284874
avg: 64639.83
var: 10377500267.14
dev: 101870.02
$

$ path-set-test -p user-insert-time -A ...
min: 0
max: 176011
avg: 38602.17
var: 4075590616.14
dev: 63840.35
$

$ path-set-test -p sys-insert-time -A ...
min: 0
max: 116406
avg: 26467.83
var: 1704789404.81
dev: 41289.10
$

