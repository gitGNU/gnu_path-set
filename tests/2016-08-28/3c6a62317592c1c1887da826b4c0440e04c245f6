#
# # meta command:
# $ path-set-test \
# --input=tests/files2.txt \
# --expr='10 ** x' \
# --limits=1-6 \
# --pool-size=512M \
# --hash-size=2M \
# --node-size=4M \
# --separators='/' \
# --repeat=10 \
# --sleep=100 \
# --plain-set \
# --linear-hash \
# --run-tests
#

$ date +'%Y-%m-%d %H:%M:%S.%N %z'
2016-08-28 19:51:58.738511431 +0300
$

$ ./path-set -C
CONFIG_PATH_TRIE_NODE_32BIT_OFFSETS: no
CONFIG_PATH_TRIE_ELEM_32BIT_OFFSETS: no
CONFIG_PATH_TRIE_UINT_HASH_IDENTOP:  no
CONFIG_TRIE_PATH_SET_PRINT_SET:      no
CONFIG_VALUE_TYPE_SIZE:              32
32BIT:                               yes
DEBUG:                               yes
OPT:                                 -
$

$ ./path-set --plain-set --linear-hash -I
node-struct-size: 4
$

$ ./path-set --plain-set --linear-hash -N
dups-line
uniq-line
line-mem
dups-node
uniq-node
node-insert-eq
node-insert-ne
hash-size
hash-used
hash-load
node-struct-size
node-struct
node-mem
total-node-mem
insert-time
$

$ PATH_SET_TEST_INPUT=tests/files2.txt
$ PATH_SET_TEST_POOL_SIZE=512M
$ PATH_SET_TEST_HASH_SIZE=2M
$ PATH_SET_TEST_NODE_SIZE=4M
$ PATH_SET_TEST_STRUCT_TYPE=plain-set
$ PATH_SET_TEST_SET_TYPE=linear-hash
$ PATH_SET_TEST_SEPARATORS='/'
$

$ time path-set-test -t 10
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10           10           10.00           0.00              0.00           
line-mem          485          689          586.70          3525.61           59.38          
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10           10           10.00           0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            0            0.00            0.00              0.00           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         10           10           10.00           0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  4            4            4.00            0.00              0.00           
node-struct       10           10           10.00           0.00              0.00           
node-mem          535          739          636.70          3525.61           59.38          
total-node-mem    535          739          636.70          3525.61           59.38          
real-insert-time  320          508          454.50          2456.05           49.56          
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m1.294s
user	0m0.796s
sys	0m0.224s
$

$ time path-set-test -t 100
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100          100          100.00          0.00              0.00           
line-mem          5459         6009         5799.70         38143.41          195.30         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100          100          100.00          0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            0            0.00            0.00              0.00           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         100          100          100.00          0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  4            4            4.00            0.00              0.00           
node-struct       100          100          100.00          0.00              0.00           
node-mem          5959         6509         6299.70         38143.41          195.30         
total-node-mem    5959         6509         6299.70         38143.41          195.30         
real-insert-time  545          681          583.50          1333.25           36.51          
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m1.333s
user	0m0.820s
sys	0m0.208s
$

$ time path-set-test -t 1000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         1000         1000         1000.00         0.00              0.00           
line-mem          57460        58744        58228.50        146904.85         383.28         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         1000         1000         1000.00         0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            1            0.30            0.21              0.46           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         1000         1000         1000.00         0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  4            4            4.00            0.00              0.00           
node-struct       1000         1000         1000.00         0.00              0.00           
node-mem          62460        63744        63228.50        146904.85         383.28         
total-node-mem    62460        63744        63228.50        146904.85         383.28         
real-insert-time  1422         2556         2313.60         95250.04          308.63         
user-insert-time  0            4000         1600.00         3840000.00        1959.59        
sys-insert-time   0            4000         1200.00         3360000.00        1833.03        

real	0m1.341s
user	0m0.824s
sys	0m0.240s
$

$ time path-set-test -t 10000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10000        10000        10000.00        0.00              0.00           
line-mem          575952       581310       578899.40       3347486.04        1829.61        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10000        10000        10000.00        0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    18           34           25.40           25.24             5.02           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         10000        10000        10000.00        0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  4            4            4.00            0.00              0.00           
node-struct       10000        10000        10000.00        0.00              0.00           
node-mem          625952       631310       628899.40       3347486.04        1829.61        
total-node-mem    625952       631310       628899.40       3347486.04        1829.61        
real-insert-time  9778         13056        11448.40        979969.24         989.93         
user-insert-time  0            12001        4800.10         15361440.09       3919.37        
sys-insert-time   0            16001        7200.20         18562720.16       4308.45        

real	0m1.481s
user	0m0.888s
sys	0m0.344s
$

$ time path-set-test -t 100000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100000       100000       100000.00       0.00              0.00           
line-mem          5778412      5797145      5786822.80      36614781.96       6051.01        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100000       100000       100000.00       0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    2410         2615         2517.80         2708.76           52.05          
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         100000       100000       100000.00       0.00              0.00           
hash-load         0.05         0.05         0.05            0.00              0.00           
node-struct-size  4            4            4.00            0.00              0.00           
node-struct       100000       100000       100000.00       0.00              0.00           
node-mem          6278412      6297145      6286822.80      36614781.96       6051.01        
total-node-mem    6278412      6297145      6286822.80      36614781.96       6051.01        
real-insert-time  68579        73958        71705.70        3048397.81        1745.97        
user-insert-time  28003        64004        44802.60        117762240.64      10851.83       
sys-insert-time   16001        52002        29202.00        121774401.00      11035.14       

real	0m2.593s
user	0m1.732s
sys	0m0.884s
$

$ time path-set-test -t 1000000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         830206       830206       830206.00       0.00              0.00           
line-mem          48049857     48049857     48049857.00     -0.50             0.71           
dups-node         0            0            0.00            0.00              0.00           
uniq-node         830206       830206       830206.00       0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    286686       286686       286686.00       0.00              0.00           
hash-size         2097169      2097169      2097169.00      0.00              0.00           
hash-used         830206       830206       830206.00       0.00              0.00           
hash-load         0.40         0.40         0.40            0.00              0.00           
node-struct-size  4            4            4.00            0.00              0.00           
node-struct       830206       830206       830206.00       0.00              0.00           
node-mem          52200887     52200887     52200887.00     -0.50             0.71           
total-node-mem    52200887     52200887     52200887.00     -0.50             0.71           
real-insert-time  560233       589760       573592.50       98725900.65       9936.09        
user-insert-time  260013       356026       314419.80       739980972.16      27202.59       
sys-insert-time   220016       300018       258416.40       650312486.44      25501.23       

real	0m11.770s
user	0m8.269s
sys	0m5.416s
$

$ path-set-test -p dups-line -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-line -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p line-mem -R ...
files       min          max          avg             var               dev
10          485          689          586.70          3525.61           59.38
100         5459         6009         5799.70         38143.41          195.30
1000        57460        58744        58228.50        146904.85         383.28
10000       575952       581310       578899.40       3347486.04        1829.61
100000      5778412      5797145      5786822.80      36614781.96       6051.01
1000000     48049857     48049857     48049857.00     -0.50             0.71
$

$ path-set-test -p dups-node -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-node -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p node-insert-eq -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p node-insert-ne -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            1            0.30            0.21              0.46
10000       18           34           25.40           25.24             5.02
100000      2410         2615         2517.80         2708.76           52.05
1000000     286686       286686       286686.00       0.00              0.00
$

$ path-set-test -p hash-size -R ...
files       min          max          avg             var               dev
10          2097169      2097169      2097169.00      0.00              0.00
100         2097169      2097169      2097169.00      0.00              0.00
1000        2097169      2097169      2097169.00      0.00              0.00
10000       2097169      2097169      2097169.00      0.00              0.00
100000      2097169      2097169      2097169.00      0.00              0.00
1000000     2097169      2097169      2097169.00      0.00              0.00
$

$ path-set-test -p hash-used -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p hash-load -R ...
files       min          max          avg             var               dev
10          0.00         0.00         0.00            0.00              0.00
100         0.00         0.00         0.00            0.00              0.00
1000        0.00         0.00         0.00            0.00              0.00
10000       0.00         0.00         0.00            0.00              0.00
100000      0.05         0.05         0.05            0.00              0.00
1000000     0.40         0.40         0.40            0.00              0.00
$

$ path-set-test -p node-struct-size -R ...
files       min          max          avg             var               dev
10          4            4            4.00            0.00              0.00
100         4            4            4.00            0.00              0.00
1000        4            4            4.00            0.00              0.00
10000       4            4            4.00            0.00              0.00
100000      4            4            4.00            0.00              0.00
1000000     4            4            4.00            0.00              0.00
$

$ path-set-test -p node-struct -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p node-mem -R ...
files       min          max          avg             var               dev
10          535          739          636.70          3525.61           59.38
100         5959         6509         6299.70         38143.41          195.30
1000        62460        63744        63228.50        146904.85         383.28
10000       625952       631310       628899.40       3347486.04        1829.61
100000      6278412      6297145      6286822.80      36614781.96       6051.01
1000000     52200887     52200887     52200887.00     -0.50             0.71
$

$ path-set-test -p total-node-mem -R ...
files       min          max          avg             var               dev
10          535          739          636.70          3525.61           59.38
100         5959         6509         6299.70         38143.41          195.30
1000        62460        63744        63228.50        146904.85         383.28
10000       625952       631310       628899.40       3347486.04        1829.61
100000      6278412      6297145      6286822.80      36614781.96       6051.01
1000000     52200887     52200887     52200887.00     -0.50             0.71
$

$ path-set-test -p real-insert-time -R ...
files       min          max          avg             var               dev
10          320          508          454.50          2456.05           49.56
100         545          681          583.50          1333.25           36.51
1000        1422         2556         2313.60         95250.04          308.63
10000       9778         13056        11448.40        979969.24         989.93
100000      68579        73958        71705.70        3048397.81        1745.97
1000000     560233       589760       573592.50       98725900.65       9936.09
$

$ path-set-test -p user-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         1600.00         3840000.00        1959.59
10000       0            12001        4800.10         15361440.09       3919.37
100000      28003        64004        44802.60        117762240.64      10851.83
1000000     260013       356026       314419.80       739980972.16      27202.59
$

$ path-set-test -p sys-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            4000         1200.00         3360000.00        1833.03
10000       0            16001        7200.20         18562720.16       4308.45
100000      16001        52002        29202.00        121774401.00      11035.14
1000000     220016       300018       258416.40       650312486.44      25501.23
$

$ path-set-test -p dups-line -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-line -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p line-mem -A ...
min: 586
max: 48049857
avg: 9080031.83
var: 307988791089672.50
dev: 17549609.43
$

$ path-set-test -p dups-node -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-node -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p node-insert-eq -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-insert-ne -A ...
min: 0
max: 286686
avg: 48204.67
var: 11375509863.22
dev: 106656.04
$

$ path-set-test -p hash-size -A ...
min: 2097169
max: 2097169
avg: 2097169.00
var: 0.00
dev: 0.00
$

$ path-set-test -p hash-used -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p hash-load -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct-size -A ...
min: 4
max: 4
avg: 4.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p node-mem -A ...
min: 636
max: 52200887
avg: 9864461.83
var: 363501773782132.44
dev: 19065722.48
$

$ path-set-test -p total-node-mem -A ...
min: 636
max: 52200887
avg: 9864461.83
var: 363501773782132.44
dev: 19065722.48
$

$ path-set-test -p real-insert-time -A ...
min: 454
max: 573592
avg: 110015.83
var: 43610906777.14
dev: 208832.25
$

$ path-set-test -p user-insert-time -A ...
min: 0
max: 314419
avg: 60936.83
var: 13102056804.14
dev: 114464.22
$

$ path-set-test -p sys-insert-time -A ...
min: 0
max: 258416
avg: 49336.33
var: 8846737189.89
dev: 94057.10
$

