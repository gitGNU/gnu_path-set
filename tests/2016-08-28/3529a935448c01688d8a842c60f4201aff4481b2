#
# # meta command:
# $ path-set-test \
# --input=tests/files2.txt \
# --expr='10 ** x' \
# --limits=1-6 \
# --pool-size=512M \
# --hash-size=2M \
# --node-size=4M \
# --separators='/' \
# --repeat=10 \
# --sleep=100 \
# --plain-set \
# --gnulib-hash \
# --run-tests
#

$ date +'%Y-%m-%d %H:%M:%S.%N %z'
2016-08-28 19:46:05.523448438 +0300
$

$ ./path-set -C
CONFIG_PATH_TRIE_NODE_32BIT_OFFSETS: no
CONFIG_PATH_TRIE_ELEM_32BIT_OFFSETS: no
CONFIG_PATH_TRIE_UINT_HASH_IDENTOP:  no
CONFIG_TRIE_PATH_SET_PRINT_SET:      no
CONFIG_VALUE_TYPE_SIZE:              64
32BIT:                               no
DEBUG:                               yes
OPT:                                 -
$

$ ./path-set --plain-set --gnulib-hash -I
node-struct-size: 16
$

$ ./path-set --plain-set --gnulib-hash -N
dups-line
uniq-line
line-mem
dups-node
uniq-node
node-insert-eq
node-insert-ne
node-rehash-eq
node-rehash-ne
hash-size
hash-used
hash-load
node-struct-size
node-struct
node-mem
total-node-mem
insert-time
$

$ PATH_SET_TEST_INPUT=tests/files2.txt
$ PATH_SET_TEST_POOL_SIZE=512M
$ PATH_SET_TEST_HASH_SIZE=2M
$ PATH_SET_TEST_NODE_SIZE=4M
$ PATH_SET_TEST_STRUCT_TYPE=plain-set
$ PATH_SET_TEST_SET_TYPE=gnulib-hash
$ PATH_SET_TEST_SEPARATORS='/'
$

$ time path-set-test -t 10
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10           10           10.00           0.00              0.00           
line-mem          496          782          597.00          6701.40           81.86          
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10           10           10.00           0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            0            0.00            0.00              0.00           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         10           10           10.00           0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       10           10           10.00           0.00              0.00           
node-mem          666          952          767.00          6701.40           81.86          
total-node-mem    666          952          767.00          6701.40           81.86          
real-insert-time  1076         2008         1412.30         81374.01          285.26         
user-insert-time  0            0            0.00            0.00              0.00           
sys-insert-time   0            0            0.00            0.00              0.00           

real	0m1.455s
user	0m0.904s
sys	0m0.268s
$

$ time path-set-test -t 100
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100          100          100.00          0.00              0.00           
line-mem          5411         6015         5759.30         40166.61          200.42         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100          100          100.00          0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            0            0.00            0.00              0.00           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         100          100          100.00          0.00              0.00           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       100          100          100.00          0.00              0.00           
node-mem          7111         7715         7459.30         40166.61          200.42         
total-node-mem    7111         7715         7459.30         40166.61          200.42         
real-insert-time  2669         5143         4549.10         470370.09         685.84         
user-insert-time  0            4000         1600.00         3840000.00        1959.59        
sys-insert-time   0            4000         1600.00         3840000.00        1959.59        

real	0m1.453s
user	0m0.888s
sys	0m0.276s
$

$ time path-set-test -t 1000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         1000         1000         1000.00         0.00              0.00           
line-mem          57100        58748        57810.40        296852.04         544.84         
dups-node         0            0            0.00            0.00              0.00           
uniq-node         1000         1000         1000.00         0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    0            1            0.10            0.09              0.30           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         999          1000         999.90          0.09              0.30           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       1000         1000         1000.00         0.00              0.00           
node-mem          74100        75748        74810.40        296852.04         544.84         
total-node-mem    74100        75748        74810.40        296852.04         544.84         
real-insert-time  3831         6584         5931.10         692749.69         832.32         
user-insert-time  0            4000         2000.00         4000000.00        2000.00        
sys-insert-time   0            8000         4000.00         6400000.00        2529.82        

real	0m1.497s
user	0m0.892s
sys	0m0.312s
$

$ time path-set-test -t 10000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         10000        10000        10000.00        0.00              0.00           
line-mem          573542       581091       578483.60       5153392.04        2270.11        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         10000        10000        10000.00        0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    12           26           17.50           17.05             4.13           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         9974         9988         9982.50         17.05             4.13           
hash-load         0.00         0.00         0.00            0.00              0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       10000        10000        10000.00        0.00              0.00           
node-mem          743542       751091       748483.60       5153392.04        2270.11        
total-node-mem    743542       751091       748483.60       5153392.04        2270.11        
real-insert-time  9989         14852        12403.60        2489501.24        1577.82        
user-insert-time  0            16001        5600.10         23042080.09       4800.22        
sys-insert-time   0            12000        6800.00         9760000.00        3124.10        

real	0m1.576s
user	0m1.012s
sys	0m0.304s
$

$ time path-set-test -t 100000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         100000       100000       100000.00       0.00              0.00           
line-mem          5784980      5793365      5789396.40      8270422.23        2875.83        
dups-node         0            0            0.00            0.00              0.00           
uniq-node         100000       100000       100000.00       0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    1859         2031         1920.70         2898.21           53.84          
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         97998        98163        98103.80        2874.16           53.61          
hash-load         0.04         0.04         0.04            0.00              0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       100000       100000       100000.00       0.00              0.00           
node-mem          7484980      7493365      7489396.40      8270422.23        2875.83        
total-node-mem    7484980      7493365      7489396.40      8270422.23        2875.83        
real-insert-time  71778        76397        73481.10        1634789.69        1278.59        
user-insert-time  32001        56004        42402.40        51854081.44       7200.98        
sys-insert-time   20001        44003        32802.00        47364000.40       6882.15        

real	0m2.571s
user	0m1.736s
sys	0m0.816s
$

$ time path-set-test -t 1000000
param             min          max          avg             var               dev            
dups-line         0            0            0.00            0.00              0.00           
uniq-line         830206       830206       830206.00       0.00              0.00           
line-mem          48049857     48049857     48049857.00     -0.50             0.71           
dups-node         0            0            0.00            0.00              0.00           
uniq-node         830206       830206       830206.00       0.00              0.00           
node-insert-eq    0            0            0.00            0.00              0.00           
node-insert-ne    131735       131735       131735.00       0.00              0.00           
node-rehash-eq    0            0            0.00            0.00              0.00           
node-rehash-ne    0            0            0.00            0.00              0.00           
hash-size         2621447      2621447      2621447.00      0.00              0.00           
hash-used         711483       711483       711483.00       0.00              0.00           
hash-load         0.27         0.27         0.27            -0.00             0.00           
node-struct-size  16           16           16.00           0.00              0.00           
node-struct       830206       830206       830206.00       0.00              0.00           
node-mem          62163359     62163359     62163359.00     0.00              0.00           
total-node-mem    62163359     62163359     62163359.00     0.00              0.00           
real-insert-time  540145       575849       557770.00       152007090.40      12329.12       
user-insert-time  284020       388022       320819.20       908192482.16      30136.23       
sys-insert-time   208012       256018       229214.60       243403362.64      15601.39       

real	0m10.709s
user	0m8.241s
sys	0m4.360s
$

$ path-set-test -p dups-line -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-line -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p line-mem -R ...
files       min          max          avg             var               dev
10          496          782          597.00          6701.40           81.86
100         5411         6015         5759.30         40166.61          200.42
1000        57100        58748        57810.40        296852.04         544.84
10000       573542       581091       578483.60       5153392.04        2270.11
100000      5784980      5793365      5789396.40      8270422.23        2875.83
1000000     48049857     48049857     48049857.00     -0.50             0.71
$

$ path-set-test -p dups-node -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p uniq-node -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p node-insert-eq -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p node-insert-ne -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            1            0.10            0.09              0.30
10000       12           26           17.50           17.05             4.13
100000      1859         2031         1920.70         2898.21           53.84
1000000     131735       131735       131735.00       0.00              0.00
$

$ path-set-test -p node-rehash-eq -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p node-rehash-ne -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            0            0.00            0.00              0.00
1000        0            0            0.00            0.00              0.00
10000       0            0            0.00            0.00              0.00
100000      0            0            0.00            0.00              0.00
1000000     0            0            0.00            0.00              0.00
$

$ path-set-test -p hash-size -R ...
files       min          max          avg             var               dev
10          2621447      2621447      2621447.00      0.00              0.00
100         2621447      2621447      2621447.00      0.00              0.00
1000        2621447      2621447      2621447.00      0.00              0.00
10000       2621447      2621447      2621447.00      0.00              0.00
100000      2621447      2621447      2621447.00      0.00              0.00
1000000     2621447      2621447      2621447.00      0.00              0.00
$

$ path-set-test -p hash-used -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        999          1000         999.90          0.09              0.30
10000       9974         9988         9982.50         17.05             4.13
100000      97998        98163        98103.80        2874.16           53.61
1000000     711483       711483       711483.00       0.00              0.00
$

$ path-set-test -p hash-load -R ...
files       min          max          avg             var               dev
10          0.00         0.00         0.00            0.00              0.00
100         0.00         0.00         0.00            0.00              0.00
1000        0.00         0.00         0.00            0.00              0.00
10000       0.00         0.00         0.00            0.00              0.00
100000      0.04         0.04         0.04            0.00              0.00
1000000     0.27         0.27         0.27            -0.00             0.00
$

$ path-set-test -p node-struct-size -R ...
files       min          max          avg             var               dev
10          16           16           16.00           0.00              0.00
100         16           16           16.00           0.00              0.00
1000        16           16           16.00           0.00              0.00
10000       16           16           16.00           0.00              0.00
100000      16           16           16.00           0.00              0.00
1000000     16           16           16.00           0.00              0.00
$

$ path-set-test -p node-struct -R ...
files       min          max          avg             var               dev
10          10           10           10.00           0.00              0.00
100         100          100          100.00          0.00              0.00
1000        1000         1000         1000.00         0.00              0.00
10000       10000        10000        10000.00        0.00              0.00
100000      100000       100000       100000.00       0.00              0.00
1000000     830206       830206       830206.00       0.00              0.00
$

$ path-set-test -p node-mem -R ...
files       min          max          avg             var               dev
10          666          952          767.00          6701.40           81.86
100         7111         7715         7459.30         40166.61          200.42
1000        74100        75748        74810.40        296852.04         544.84
10000       743542       751091       748483.60       5153392.04        2270.11
100000      7484980      7493365      7489396.40      8270422.23        2875.83
1000000     62163359     62163359     62163359.00     0.00              0.00
$

$ path-set-test -p total-node-mem -R ...
files       min          max          avg             var               dev
10          666          952          767.00          6701.40           81.86
100         7111         7715         7459.30         40166.61          200.42
1000        74100        75748        74810.40        296852.04         544.84
10000       743542       751091       748483.60       5153392.04        2270.11
100000      7484980      7493365      7489396.40      8270422.23        2875.83
1000000     62163359     62163359     62163359.00     0.00              0.00
$

$ path-set-test -p real-insert-time -R ...
files       min          max          avg             var               dev
10          1076         2008         1412.30         81374.01          285.26
100         2669         5143         4549.10         470370.09         685.84
1000        3831         6584         5931.10         692749.69         832.32
10000       9989         14852        12403.60        2489501.24        1577.82
100000      71778        76397        73481.10        1634789.69        1278.59
1000000     540145       575849       557770.00       152007090.40      12329.12
$

$ path-set-test -p user-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            4000         1600.00         3840000.00        1959.59
1000        0            4000         2000.00         4000000.00        2000.00
10000       0            16001        5600.10         23042080.09       4800.22
100000      32001        56004        42402.40        51854081.44       7200.98
1000000     284020       388022       320819.20       908192482.16      30136.23
$

$ path-set-test -p sys-insert-time -R ...
files       min          max          avg             var               dev
10          0            0            0.00            0.00              0.00
100         0            4000         1600.00         3840000.00        1959.59
1000        0            8000         4000.00         6400000.00        2529.82
10000       0            12000        6800.00         9760000.00        3124.10
100000      20001        44003        32802.00        47364000.40       6882.15
1000000     208012       256018       229214.60       243403362.64      15601.39
$

$ path-set-test -p dups-line -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-line -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p line-mem -A ...
min: 597
max: 48049857
avg: 9080317.00
var: 307988490157035.00
dev: 17549600.85
$

$ path-set-test -p dups-node -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p uniq-node -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p node-insert-eq -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-insert-ne -A ...
min: 0
max: 131735
avg: 22278.67
var: 2396627163.89
dev: 48955.36
$

$ path-set-test -p node-rehash-eq -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-rehash-ne -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p hash-size -A ...
min: 2621447
max: 2621447
avg: 2621447.00
var: 0.00
dev: 0.00
$

$ path-set-test -p hash-used -A ...
min: 10
max: 711483
avg: 136779.50
var: 67280186100.25
dev: 259384.24
$

$ path-set-test -p hash-load -A ...
min: 0
max: 0
avg: 0.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct-size -A ...
min: 16
max: 16
avg: 16.00
var: 0.00
dev: 0.00
$

$ path-set-test -p node-struct -A ...
min: 10
max: 830206
avg: 156886.00
var: 91943951760.00
dev: 303222.61
$

$ path-set-test -p node-mem -A ...
min: 767
max: 62163359
avg: 11747379.00
var: 515489108992035.00
dev: 22704385.24
$

$ path-set-test -p total-node-mem -A ...
min: 767
max: 62163359
avg: 11747379.00
var: 515489108992035.00
dev: 22704385.24
$

$ path-set-test -p real-insert-time -A ...
min: 1412
max: 557770
avg: 109257.67
var: 40849183703.89
dev: 202111.81
$

$ path-set-test -p user-insert-time -A ...
min: 0
max: 320819
avg: 62070.17
var: 13607407804.14
dev: 116650.79
$

$ path-set-test -p sys-insert-time -A ...
min: 0
max: 229214
avg: 45736.00
var: 6854856470.67
dev: 82794.06
$

